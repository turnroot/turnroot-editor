/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e,t,A,i,s={354:function(e){e.exports=function(){"use strict";var e=function(t,A){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var A in t)Object.prototype.hasOwnProperty.call(t,A)&&(e[A]=t[A])},e(t,A)};function t(t,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function i(){this.constructor=t}e(t,A),t.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}var A=function(){return A=Object.assign||function(e){for(var t,A=1,i=arguments.length;A<i;A++)for(var s in t=arguments[A])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},A.apply(this,arguments)};function i(e,t,A,i){return new(A||(A=Promise))((function(s,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof A?t:new A((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))}function s(e,t){var A,i,s,n,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(A)throw new TypeError("Generator is already executing.");for(;r;)try{if(A=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,i=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(!((s=(s=r.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){r=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){r.label=n[1];break}if(6===n[0]&&r.label<s[1]){r.label=s[1],s=n;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(n);break}s[2]&&r.ops.pop(),r.trys.pop();continue}n=t.call(e,r)}catch(e){n=[6,e],i=0}finally{A=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}function n(e,t,A){if(A||2===arguments.length)for(var i,s=0,n=t.length;s<n;s++)!i&&s in t||(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return e.concat(i||t)}for(var r=function(){function e(e,t,A,i){this.left=e,this.top=t,this.width=A,this.height=i}return e.prototype.add=function(t,A,i,s){return new e(this.left+t,this.top+A,this.width+i,this.height+s)},e.fromClientRect=function(t,A){return new e(A.left+t.windowBounds.left,A.top+t.windowBounds.top,A.width,A.height)},e.fromDOMRectList=function(t,A){var i=Array.from(A).find((function(e){return 0!==e.width}));return i?new e(i.left+t.windowBounds.left,i.top+t.windowBounds.top,i.width,i.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),o=function(e,t){return r.fromClientRect(e,t.getBoundingClientRect())},l=function(e){for(var t=[],A=0,i=e.length;A<i;){var s=e.charCodeAt(A++);if(s>=55296&&s<=56319&&A<i){var n=e.charCodeAt(A++);56320==(64512&n)?t.push(((1023&s)<<10)+(1023&n)+65536):(t.push(s),A--)}else t.push(s)}return t},a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var A=e.length;if(!A)return"";for(var i=[],s=-1,n="";++s<A;){var r=e[s];r<=65535?i.push(r):(r-=65536,i.push(55296+(r>>10),r%1024+56320)),(s+1===A||i.length>16384)&&(n+=String.fromCharCode.apply(String,i),i.length=0)}return n},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="undefined"==typeof Uint8Array?[]:new Uint8Array(256),h=0;h<64;h++)c[d.charCodeAt(h)]=h;for(var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p="undefined"==typeof Uint8Array?[]:new Uint8Array(256),g=0;g<64;g++)p[u.charCodeAt(g)]=g;for(var m=function(e,t,A){return e.slice?e.slice(t,A):new Uint16Array(Array.prototype.slice.call(e,t,A))},f=function(){function e(e,t,A,i,s,n){this.initialValue=e,this.errorValue=t,this.highStart=A,this.highValueIndex=i,this.index=s,this.data=n}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B="undefined"==typeof Uint8Array?[]:new Uint8Array(256),y=0;y<64;y++)B[w.charCodeAt(y)]=y;var b=10,v=13,C=15,x=17,Q=18,F=19,U=20,E=21,k=22,I=24,H=25,S=26,T=27,_=28,D=30,L=32,M=33,O=34,R=35,K=37,$=38,N=39,G=40,z=42,P=[9001,65288],V="×",j="÷",W=function(e,t){var A,i,s,n=function(e){var t,A,i,s,n,r=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);var a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(r):new Array(r),d=Array.isArray(a)?a:new Uint8Array(a);for(t=0;t<o;t+=4)A=p[e.charCodeAt(t)],i=p[e.charCodeAt(t+1)],s=p[e.charCodeAt(t+2)],n=p[e.charCodeAt(t+3)],d[l++]=A<<2|i>>4,d[l++]=(15&i)<<4|s>>2,d[l++]=(3&s)<<6|63&n;return a}(e),r=Array.isArray(n)?function(e){for(var t=e.length,A=[],i=0;i<t;i+=4)A.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return A}(n):new Uint32Array(n),o=Array.isArray(n)?function(e){for(var t=e.length,A=[],i=0;i<t;i+=2)A.push(e[i+1]<<8|e[i]);return A}(n):new Uint16Array(n),l=m(o,12,r[4]/2),a=2===r[5]?m(o,(24+r[4])/2):(A=r,i=Math.ceil((24+r[4])/4),A.slice?A.slice(i,s):new Uint32Array(Array.prototype.slice.call(A,i,s)));return new f(r[0],r[1],r[2],r[3],l,a)}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),X=[D,36],Y=[1,2,3,5],J=[b,8],Z=[T,S],q=Y.concat(J),ee=[$,N,G,O,R],te=[C,v],Ae=function(e,t,A,i){var s=i[A];if(Array.isArray(e)?-1!==e.indexOf(s):e===s)for(var n=A;n<=i.length;){if((l=i[++n])===t)return!0;if(l!==b)break}if(s===b)for(n=A;n>0;){var r=i[--n];if(Array.isArray(e)?-1!==e.indexOf(r):e===r)for(var o=A;o<=i.length;){var l;if((l=i[++o])===t)return!0;if(l!==b)break}if(r!==b)break}return!1},ie=function(e,t){for(var A=e;A>=0;){var i=t[A];if(i!==b)return i;A--}return 0},se=function(e,t,A,i,s){if(0===A[i])return V;var n=i-1;if(Array.isArray(s)&&!0===s[n])return V;var r=n-1,o=n+1,l=t[n],a=r>=0?t[r]:0,d=t[o];if(2===l&&3===d)return V;if(-1!==Y.indexOf(l))return"!";if(-1!==Y.indexOf(d))return V;if(-1!==J.indexOf(d))return V;if(8===ie(n,t))return j;if(11===W.get(e[n]))return V;if((l===L||l===M)&&11===W.get(e[o]))return V;if(7===l||7===d)return V;if(9===l)return V;if(-1===[b,v,C].indexOf(l)&&9===d)return V;if(-1!==[x,Q,F,I,_].indexOf(d))return V;if(ie(n,t)===k)return V;if(Ae(23,k,n,t))return V;if(Ae([x,Q],E,n,t))return V;if(Ae(12,12,n,t))return V;if(l===b)return j;if(23===l||23===d)return V;if(16===d||16===l)return j;if(-1!==[v,C,E].indexOf(d)||14===l)return V;if(36===a&&-1!==te.indexOf(l))return V;if(l===_&&36===d)return V;if(d===U)return V;if(-1!==X.indexOf(d)&&l===H||-1!==X.indexOf(l)&&d===H)return V;if(l===T&&-1!==[K,L,M].indexOf(d)||-1!==[K,L,M].indexOf(l)&&d===S)return V;if(-1!==X.indexOf(l)&&-1!==Z.indexOf(d)||-1!==Z.indexOf(l)&&-1!==X.indexOf(d))return V;if(-1!==[T,S].indexOf(l)&&(d===H||-1!==[k,C].indexOf(d)&&t[o+1]===H)||-1!==[k,C].indexOf(l)&&d===H||l===H&&-1!==[H,_,I].indexOf(d))return V;if(-1!==[H,_,I,x,Q].indexOf(d))for(var c=n;c>=0;){if((h=t[c])===H)return V;if(-1===[_,I].indexOf(h))break;c--}if(-1!==[T,S].indexOf(d))for(c=-1!==[x,Q].indexOf(l)?r:n;c>=0;){var h;if((h=t[c])===H)return V;if(-1===[_,I].indexOf(h))break;c--}if($===l&&-1!==[$,N,O,R].indexOf(d)||-1!==[N,O].indexOf(l)&&-1!==[N,G].indexOf(d)||-1!==[G,R].indexOf(l)&&d===G)return V;if(-1!==ee.indexOf(l)&&-1!==[U,S].indexOf(d)||-1!==ee.indexOf(d)&&l===T)return V;if(-1!==X.indexOf(l)&&-1!==X.indexOf(d))return V;if(l===I&&-1!==X.indexOf(d))return V;if(-1!==X.concat(H).indexOf(l)&&d===k&&-1===P.indexOf(e[o])||-1!==X.concat(H).indexOf(d)&&l===Q)return V;if(41===l&&41===d){for(var u=A[n],p=1;u>0&&41===t[--u];)p++;if(p%2!=0)return V}return l===L&&d===M?V:j},ne=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var A=function(e,t){void 0===t&&(t="strict");var A=[],i=[],s=[];return e.forEach((function(e,n){var r=W.get(e);if(r>50?(s.push(!0),r-=50):s.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return i.push(n),A.push(16);if(4===r||11===r){if(0===n)return i.push(n),A.push(D);var o=A[n-1];return-1===q.indexOf(o)?(i.push(i[n-1]),A.push(o)):(i.push(n),A.push(D))}return i.push(n),31===r?A.push("strict"===t?E:K):r===z||29===r?A.push(D):43===r?e>=131072&&e<=196605||e>=196608&&e<=262141?A.push(K):A.push(D):void A.push(r)})),[i,A,s]}(e,t.lineBreak),i=A[0],s=A[1],n=A[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(s=s.map((function(e){return-1!==[H,D,z].indexOf(e)?K:e})));var r="keep-all"===t.wordBreak?n.map((function(t,A){return t&&e[A]>=19968&&e[A]<=40959})):void 0;return[i,s,r]},re=function(){function e(e,t,A,i){this.codePoints=e,this.required="!"===t,this.start=A,this.end=i}return e.prototype.slice=function(){return a.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),oe=45,le=43,ae=-1,de=function(e){return e>=48&&e<=57},ce=function(e){return de(e)||e>=65&&e<=70||e>=97&&e<=102},he=function(e){return 10===e||9===e||32===e},ue=function(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return e>=128}(e)||95===e},pe=function(e){return ue(e)||de(e)||e===oe},ge=function(e){return e>=0&&e<=8||11===e||e>=14&&e<=31||127===e},me=function(e,t){return 92===e&&10!==t},fe=function(e,t,A){return e===oe?ue(t)||me(t,A):!!ue(e)||!(92!==e||!me(e,t))},we=function(e,t,A){return e===le||e===oe?!!de(t)||46===t&&de(A):de(46===e?t:e)},Be=function(e){var t=0,A=1;e[t]!==le&&e[t]!==oe||(e[t]===oe&&(A=-1),t++);for(var i=[];de(e[t]);)i.push(e[t++]);var s=i.length?parseInt(a.apply(void 0,i),10):0;46===e[t]&&t++;for(var n=[];de(e[t]);)n.push(e[t++]);var r=n.length,o=r?parseInt(a.apply(void 0,n),10):0;69!==e[t]&&101!==e[t]||t++;var l=1;e[t]!==le&&e[t]!==oe||(e[t]===oe&&(l=-1),t++);for(var d=[];de(e[t]);)d.push(e[t++]);var c=d.length?parseInt(a.apply(void 0,d),10):0;return A*(s+o*Math.pow(10,-r))*Math.pow(10,l*c)},ye={type:2},be={type:3},ve={type:4},Ce={type:13},xe={type:8},Qe={type:21},Fe={type:9},Ue={type:10},Ee={type:11},ke={type:12},Ie={type:14},He={type:23},Se={type:1},Te={type:25},_e={type:24},De={type:26},Le={type:27},Me={type:28},Oe={type:29},Re={type:31},Ke={type:32},$e=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(l(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Ke;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case 34:return this.consumeStringToken(34);case 35:var t=this.peekCodePoint(0),A=this.peekCodePoint(1),i=this.peekCodePoint(2);if(pe(t)||me(A,i)){var s=fe(t,A,i)?2:1;return{type:5,value:this.consumeName(),flags:s}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ce;break;case 39:return this.consumeStringToken(39);case 40:return ye;case 41:return be;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ie;break;case le:if(we(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 44:return ve;case oe:var n=e,r=this.peekCodePoint(0),o=this.peekCodePoint(1);if(we(n,r,o))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(fe(n,r,o))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(r===oe&&62===o)return this.consumeCodePoint(),this.consumeCodePoint(),_e;break;case 46:if(we(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(42===l&&47===(l=this.consumeCodePoint()))return this.consumeToken();if(l===ae)return this.consumeToken()}break;case 58:return De;case 59:return Le;case 60:if(33===this.peekCodePoint(0)&&this.peekCodePoint(1)===oe&&this.peekCodePoint(2)===oe)return this.consumeCodePoint(),this.consumeCodePoint(),Te;break;case 64:var d=this.peekCodePoint(0),c=this.peekCodePoint(1),h=this.peekCodePoint(2);if(fe(d,c,h))return{type:7,value:this.consumeName()};break;case 91:return Me;case 92:if(me(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case 93:return Oe;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),xe;break;case 123:return Ee;case 125:return ke;case 117:case 85:var u=this.peekCodePoint(0),p=this.peekCodePoint(1);return u!==le||!ce(p)&&63!==p||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Fe;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),Qe;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ue;break;case ae:return Ke}return he(e)?(this.consumeWhiteSpace(),Re):de(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):ue(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:a(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();ce(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var A=!1;63===t&&e.length<6;)e.push(t),t=this.consumeCodePoint(),A=!0;if(A)return{type:30,start:parseInt(a.apply(void 0,e.map((function(e){return 63===e?48:e}))),16),end:parseInt(a.apply(void 0,e.map((function(e){return 63===e?70:e}))),16)};var i=parseInt(a.apply(void 0,e),16);if(this.peekCodePoint(0)===oe&&ce(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var s=[];ce(t)&&s.length<6;)s.push(t),t=this.consumeCodePoint();return{type:30,start:i,end:parseInt(a.apply(void 0,s),16)}}return{type:30,start:i,end:i}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===ae)return{type:22,value:""};var t=this.peekCodePoint(0);if(39===t||34===t){var A=this.consumeStringToken(this.consumeCodePoint());return 0===A.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===ae||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:A.value}):(this.consumeBadUrlRemnants(),He)}for(;;){var i=this.consumeCodePoint();if(i===ae||41===i)return{type:22,value:a.apply(void 0,e)};if(he(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===ae||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:a.apply(void 0,e)}):(this.consumeBadUrlRemnants(),He);if(34===i||39===i||40===i||ge(i))return this.consumeBadUrlRemnants(),He;if(92===i){if(!me(i,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),He;e.push(this.consumeEscapedCodePoint())}else e.push(i)}},e.prototype.consumeWhiteSpace=function(){for(;he(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(41===e||e===ae)return;me(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t="";e>0;){var A=Math.min(5e4,e);t+=a.apply(void 0,this._value.splice(0,A)),e-=A}return this._value.shift(),t},e.prototype.consumeStringToken=function(e){for(var t="",A=0;;){var i=this._value[A];if(i===ae||void 0===i||i===e)return{type:0,value:t+=this.consumeStringSlice(A)};if(10===i)return this._value.splice(0,A),Se;if(92===i){var s=this._value[A+1];s!==ae&&void 0!==s&&(10===s?(t+=this.consumeStringSlice(A),A=-1,this._value.shift()):me(i,s)&&(t+=this.consumeStringSlice(A),t+=a(this.consumeEscapedCodePoint()),A=-1))}A++}},e.prototype.consumeNumber=function(){var e=[],t=4,A=this.peekCodePoint(0);for(A!==le&&A!==oe||e.push(this.consumeCodePoint());de(this.peekCodePoint(0));)e.push(this.consumeCodePoint());A=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(46===A&&de(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;de(this.peekCodePoint(0));)e.push(this.consumeCodePoint());A=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((69===A||101===A)&&((i===le||i===oe)&&de(s)||de(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;de(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[Be(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],A=e[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),n=this.peekCodePoint(2);return fe(i,s,n)?{type:15,number:t,flags:A,unit:this.consumeName()}:37===i?(this.consumeCodePoint(),{type:16,number:t,flags:A}):{type:17,number:t,flags:A}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(ce(e)){for(var t=a(e);ce(this.peekCodePoint(0))&&t.length<6;)t+=a(this.consumeCodePoint());he(this.peekCodePoint(0))&&this.consumeCodePoint();var A=parseInt(t,16);return 0===A||function(e){return e>=55296&&e<=57343}(A)||A>1114111?65533:A}return e===ae?65533:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(pe(t))e+=a(t);else{if(!me(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=a(this.consumeEscapedCodePoint())}}},e}(),Ne=function(){function e(e){this._tokens=e}return e.create=function(t){var A=new $e;return A.write(t),new e(A.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},A=this.consumeToken();;){if(32===A.type||Je(A,e))return t;this.reconsumeToken(A),t.values.push(this.consumeComponentValue()),A=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var A=this.consumeToken();if(32===A.type||3===A.type)return t;this.reconsumeToken(A),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Ke:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Ge=function(e){return 15===e.type},ze=function(e){return 17===e.type},Pe=function(e){return 20===e.type},Ve=function(e){return 0===e.type},je=function(e,t){return Pe(e)&&e.value===t},We=function(e){return 31!==e.type},Xe=function(e){return 31!==e.type&&4!==e.type},Ye=function(e){var t=[],A=[];return e.forEach((function(e){if(4===e.type){if(0===A.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(A),void(A=[])}31!==e.type&&A.push(e)})),A.length&&t.push(A),t},Je=function(e,t){return 11===t&&12===e.type||28===t&&29===e.type||2===t&&3===e.type},Ze=function(e){return 17===e.type||15===e.type},qe=function(e){return 16===e.type||Ze(e)},et=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},tt={type:17,number:0,flags:4},At={type:16,number:50,flags:4},it={type:16,number:100,flags:4},st=function(e,t,A){var i=e[0],s=e[1];return[nt(i,t),nt(void 0!==s?s:i,A)]},nt=function(e,t){if(16===e.type)return e.number/100*t;if(Ge(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},rt="grad",ot="turn",lt=function(e,t){if(15===t.type)switch(t.unit){case"deg":return Math.PI*t.number/180;case rt:return Math.PI/200*t.number;case"rad":return t.number;case ot:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")},at=function(e){return 15===e.type&&("deg"===e.unit||e.unit===rt||"rad"===e.unit||e.unit===ot)},dt=function(e){switch(e.filter(Pe).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[tt,tt];case"to top":case"bottom":return ct(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[tt,it];case"to right":case"left":return ct(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[it,it];case"to bottom":case"top":return ct(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[it,tt];case"to left":case"right":return ct(270)}return 0},ct=function(e){return Math.PI*e/180},ht=function(e,t){if(18===t.type){var A=yt[t.name];if(void 0===A)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return A(e,t.values)}if(5===t.type){if(3===t.value.length){var i=t.value.substring(0,1),s=t.value.substring(1,2),n=t.value.substring(2,3);return gt(parseInt(i+i,16),parseInt(s+s,16),parseInt(n+n,16),1)}if(4===t.value.length){i=t.value.substring(0,1),s=t.value.substring(1,2),n=t.value.substring(2,3);var r=t.value.substring(3,4);return gt(parseInt(i+i,16),parseInt(s+s,16),parseInt(n+n,16),parseInt(r+r,16)/255)}if(6===t.value.length)return i=t.value.substring(0,2),s=t.value.substring(2,4),n=t.value.substring(4,6),gt(parseInt(i,16),parseInt(s,16),parseInt(n,16),1);if(8===t.value.length)return i=t.value.substring(0,2),s=t.value.substring(2,4),n=t.value.substring(4,6),r=t.value.substring(6,8),gt(parseInt(i,16),parseInt(s,16),parseInt(n,16),parseInt(r,16)/255)}if(20===t.type){var o=vt[t.value.toUpperCase()];if(void 0!==o)return o}return vt.TRANSPARENT},ut=function(e){return!(255&e)},pt=function(e){var t=255&e,A=255&e>>8,i=255&e>>16,s=255&e>>24;return t<255?"rgba("+s+","+i+","+A+","+t/255+")":"rgb("+s+","+i+","+A+")"},gt=function(e,t,A,i){return(e<<24|t<<16|A<<8|Math.round(255*i))>>>0},mt=function(e,t){if(17===e.type)return e.number;if(16===e.type){var A=3===t?1:255;return 3===t?e.number/100*A:Math.round(e.number/100*A)}return 0},ft=function(e,t){var A=t.filter(Xe);if(3===A.length){var i=A.map(mt),s=i[0],n=i[1],r=i[2];return gt(s,n,r,1)}if(4===A.length){var o=A.map(mt),l=(s=o[0],n=o[1],r=o[2],o[3]);return gt(s,n,r,l)}return 0};function wt(e,t,A){return A<0&&(A+=1),A>=1&&(A-=1),A<1/6?(t-e)*A*6+e:A<.5?t:A<2/3?6*(t-e)*(2/3-A)+e:e}var Bt=function(e,t){var A=t.filter(Xe),i=A[0],s=A[1],n=A[2],r=A[3],o=(17===i.type?ct(i.number):lt(e,i))/(2*Math.PI),l=qe(s)?s.number/100:0,a=qe(n)?n.number/100:0,d=void 0!==r&&qe(r)?nt(r,1):1;if(0===l)return gt(255*a,255*a,255*a,1);var c=a<=.5?a*(l+1):a+l-a*l,h=2*a-c,u=wt(h,c,o+1/3),p=wt(h,c,o),g=wt(h,c,o-1/3);return gt(255*u,255*p,255*g,d)},yt={hsl:Bt,hsla:Bt,rgb:ft,rgba:ft},bt=function(e,t){return ht(e,Ne.create(t).parseComponentValue())},vt={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Ct={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Pe(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},xt={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Qt=function(e,t){var A=ht(e,t[0]),i=t[1];return i&&qe(i)?{color:A,stop:i}:{color:A,stop:null}},Ft=function(e,t){var A=e[0],i=e[e.length-1];null===A.stop&&(A.stop=tt),null===i.stop&&(i.stop=it);for(var s=[],n=0,r=0;r<e.length;r++){var o=e[r].stop;if(null!==o){var l=nt(o,t);l>n?s.push(l):s.push(n),n=l}else s.push(null)}var a=null;for(r=0;r<s.length;r++){var d=s[r];if(null===d)null===a&&(a=r);else if(null!==a){for(var c=r-a,h=(d-s[a-1])/(c+1),u=1;u<=c;u++)s[a+u-1]=h*u;a=null}}return e.map((function(e,A){return{color:e.color,stop:Math.max(Math.min(1,s[A]/t),0)}}))},Ut=function(e,t,A){var i="number"==typeof e?e:function(e,t,A){var i=t/2,s=A/2,n=nt(e[0],t)-i,r=s-nt(e[1],A);return(Math.atan2(r,n)+2*Math.PI)%(2*Math.PI)}(e,t,A),s=Math.abs(t*Math.sin(i))+Math.abs(A*Math.cos(i)),n=t/2,r=A/2,o=s/2,l=Math.sin(i-Math.PI/2)*o,a=Math.cos(i-Math.PI/2)*o;return[s,n-a,n+a,r-l,r+l]},Et=function(e,t){return Math.sqrt(e*e+t*t)},kt=function(e,t,A,i,s){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var n=t[0],r=t[1],o=Et(A-n,i-r);return(s?o<e.optimumDistance:o>e.optimumDistance)?{optimumCorner:t,optimumDistance:o}:e}),{optimumDistance:s?1/0:-1/0,optimumCorner:null}).optimumCorner},It=function(e,t){var A=ct(180),i=[];return Ye(t).forEach((function(t,s){if(0===s){var n=t[0];if(20===n.type&&-1!==["top","left","right","bottom"].indexOf(n.value))return void(A=dt(t));if(at(n))return void(A=(lt(e,n)+ct(270))%ct(360))}var r=Qt(e,t);i.push(r)})),{angle:A,stops:i,type:1}},Ht="closest-side",St="farthest-side",Tt="closest-corner",_t="farthest-corner",Dt="circle",Lt="ellipse",Mt="cover",Ot="contain",Rt=function(e,t){var A=0,i=3,s=[],n=[];return Ye(t).forEach((function(t,r){var o=!0;if(0===r?o=t.reduce((function(e,t){if(Pe(t))switch(t.value){case"center":return n.push(At),!1;case"top":case"left":return n.push(tt),!1;case"right":case"bottom":return n.push(it),!1}else if(qe(t)||Ze(t))return n.push(t),!1;return e}),o):1===r&&(o=t.reduce((function(e,t){if(Pe(t))switch(t.value){case Dt:return A=0,!1;case Lt:return A=1,!1;case Ot:case Ht:return i=0,!1;case St:return i=1,!1;case Tt:return i=2,!1;case Mt:case _t:return i=3,!1}else if(Ze(t)||qe(t))return Array.isArray(i)||(i=[]),i.push(t),!1;return e}),o)),o){var l=Qt(e,t);s.push(l)}})),{size:i,shape:A,stops:s,position:n,type:2}},Kt=function(e,t){if(22===t.type){var A={url:t.value,type:0};return e.cache.addImage(t.value),A}if(18===t.type){var i=Nt[t.name];if(void 0===i)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return i(e,t.values)}throw new Error("Unsupported image type "+t.type)};var $t,Nt={"linear-gradient":function(e,t){var A=ct(180),i=[];return Ye(t).forEach((function(t,s){if(0===s){var n=t[0];if(20===n.type&&"to"===n.value)return void(A=dt(t));if(at(n))return void(A=lt(e,n))}var r=Qt(e,t);i.push(r)})),{angle:A,stops:i,type:1}},"-moz-linear-gradient":It,"-ms-linear-gradient":It,"-o-linear-gradient":It,"-webkit-linear-gradient":It,"radial-gradient":function(e,t){var A=0,i=3,s=[],n=[];return Ye(t).forEach((function(t,r){var o=!0;if(0===r){var l=!1;o=t.reduce((function(e,t){if(l)if(Pe(t))switch(t.value){case"center":return n.push(At),e;case"top":case"left":return n.push(tt),e;case"right":case"bottom":return n.push(it),e}else(qe(t)||Ze(t))&&n.push(t);else if(Pe(t))switch(t.value){case Dt:return A=0,!1;case Lt:return A=1,!1;case"at":return l=!0,!1;case Ht:return i=0,!1;case Mt:case St:return i=1,!1;case Ot:case Tt:return i=2,!1;case _t:return i=3,!1}else if(Ze(t)||qe(t))return Array.isArray(i)||(i=[]),i.push(t),!1;return e}),o)}if(o){var a=Qt(e,t);s.push(a)}})),{size:i,shape:A,stops:s,position:n,type:2}},"-moz-radial-gradient":Rt,"-ms-radial-gradient":Rt,"-o-radial-gradient":Rt,"-webkit-radial-gradient":Rt,"-webkit-gradient":function(e,t){var A=ct(180),i=[],s=1;return Ye(t).forEach((function(t,A){var n=t[0];if(0===A){if(Pe(n)&&"linear"===n.value)return void(s=1);if(Pe(n)&&"radial"===n.value)return void(s=2)}if(18===n.type)if("from"===n.name){var r=ht(e,n.values[0]);i.push({stop:tt,color:r})}else if("to"===n.name)r=ht(e,n.values[0]),i.push({stop:it,color:r});else if("color-stop"===n.name){var o=n.values.filter(Xe);if(2===o.length){r=ht(e,o[1]);var l=o[0];ze(l)&&i.push({stop:{type:16,number:100*l.number,flags:l.flags},color:r})}}})),1===s?{angle:(A+ct(180))%ct(360),stops:i,type:s}:{size:3,shape:0,stops:i,position:[],type:s}}},Gt={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var A=t[0];return 20===A.type&&"none"===A.value?[]:t.filter((function(e){return Xe(e)&&function(e){return!(20===e.type&&"none"===e.value||18===e.type&&!Nt[e.name])}(e)})).map((function(t){return Kt(e,t)}))}},zt={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Pe(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Pt={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Ye(t).map((function(e){return e.filter(qe)})).map(et)}},Vt={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Ye(t).map((function(e){return e.filter(Pe).map((function(e){return e.value})).join(" ")})).map(jt)}},jt=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}($t||($t={}));var Wt,Xt={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Ye(t).map((function(e){return e.filter(Yt)}))}},Yt=function(e){return Pe(e)||qe(e)},Jt=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Zt=Jt("top"),qt=Jt("right"),eA=Jt("bottom"),tA=Jt("left"),AA=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return et(t.filter(qe))}}},iA=AA("top-left"),sA=AA("top-right"),nA=AA("bottom-right"),rA=AA("bottom-left"),oA=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},lA=oA("top"),aA=oA("right"),dA=oA("bottom"),cA=oA("left"),hA=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ge(t)?t.number:0}}},uA=hA("top"),pA=hA("right"),gA=hA("bottom"),mA=hA("left"),fA={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},wA={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},BA={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Pe).reduce((function(e,t){return e|yA(t.value)}),0)}},yA=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},bA={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},vA={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Wt||(Wt={}));var CA,xA={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?Wt.STRICT:Wt.NORMAL}},QA={name:"line-height",initialValue:"normal",prefix:!1,type:4},FA=function(e,t){return Pe(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:qe(e)?nt(e,t):t},UA={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:Kt(e,t)}},EA={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},kA={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},IA=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},HA=IA("top"),SA=IA("right"),TA=IA("bottom"),_A=IA("left"),DA={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Pe).map((function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},LA={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},MA=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},OA=MA("top"),RA=MA("right"),KA=MA("bottom"),$A=MA("left"),NA={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},GA={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},zA={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&je(t[0],"none")?[]:Ye(t).map((function(t){for(var A={color:vt.TRANSPARENT,offsetX:tt,offsetY:tt,blur:tt},i=0,s=0;s<t.length;s++){var n=t[s];Ze(n)?(0===i?A.offsetX=n:1===i?A.offsetY=n:A.blur=n,i++):A.color=ht(e,n)}return A}))}},PA={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},VA={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var A=jA[t.name];if(void 0===A)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return A(t.values)}return null}},jA={matrix:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number})),A=t[0],i=t[1];t[2],t[3];var s=t[4],n=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var r=t[12],o=t[13];return t[14],t[15],16===t.length?[A,i,s,n,r,o]:null}},WA={type:16,number:50,flags:4},XA=[WA,WA],YA={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var A=t.filter(qe);return 2!==A.length?XA:[A[0],A[1]]}},JA={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(CA||(CA={}));for(var ZA={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return CA.BREAK_ALL;case"keep-all":return CA.KEEP_ALL;default:return CA.NORMAL}}},qA={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(ze(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},ei={name:"time",parse:function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},ti={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return ze(t)?t.number:1}},Ai={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},ii={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Pe).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},si={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var A=[],i=[];return t.forEach((function(e){switch(e.type){case 20:case 0:A.push(e.value);break;case 17:A.push(e.number.toString());break;case 4:i.push(A.join(" ")),A.length=0}})),A.length&&i.push(A.join(" ")),i.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},ni={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ri={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return ze(t)?t.number:Pe(t)&&"bold"===t.value?700:400}},oi={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Pe).map((function(e){return e.value}))}},li={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},ai=function(e,t){return!!(e&t)},di={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var A=t[0];return 20===A.type&&"none"===A.value?[]:t}},ci={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var A=t[0];if(20===A.type&&"none"===A.value)return null;for(var i=[],s=t.filter(We),n=0;n<s.length;n++){var r=s[n],o=s[n+1];if(20===r.type){var l=o&&ze(o)?o.number:1;i.push({counter:r.value,increment:l})}}return i}},hi={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var A=[],i=t.filter(We),s=0;s<i.length;s++){var n=i[s],r=i[s+1];if(Pe(n)&&"none"!==n.value){var o=r&&ze(r)?r.number:0;A.push({counter:n.value,reset:o})}}return A}},ui={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Ge).map((function(t){return ei.parse(e,t)}))}},pi={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var A=t[0];if(20===A.type&&"none"===A.value)return null;var i=[],s=t.filter(Ve);if(s.length%2!=0)return null;for(var n=0;n<s.length;n+=2){var r=s[n].value,o=s[n+1].value;i.push({open:r,close:o})}return i}},gi=function(e,t,A){if(!e)return"";var i=e[Math.min(t,e.length-1)];return i?A?i.open:i.close:""},mi={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&je(t[0],"none")?[]:Ye(t).map((function(t){for(var A={color:255,offsetX:tt,offsetY:tt,blur:tt,spread:tt,inset:!1},i=0,s=0;s<t.length;s++){var n=t[s];je(n,"inset")?A.inset=!0:Ze(n)?(0===i?A.offsetX=n:1===i?A.offsetY=n:2===i?A.blur=n:A.spread=n,i++):A.color=ht(e,n)}return A}))}},fi={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var A=[];return t.filter(Pe).forEach((function(e){switch(e.value){case"stroke":A.push(1);break;case"fill":A.push(0);break;case"markers":A.push(2)}})),[0,1,2].forEach((function(e){-1===A.indexOf(e)&&A.push(e)})),A}},wi={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Bi={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ge(t)?t.number:0}},yi=function(){function e(e,t){var A,i;this.animationDuration=Ci(e,ui,t.animationDuration),this.backgroundClip=Ci(e,Ct,t.backgroundClip),this.backgroundColor=Ci(e,xt,t.backgroundColor),this.backgroundImage=Ci(e,Gt,t.backgroundImage),this.backgroundOrigin=Ci(e,zt,t.backgroundOrigin),this.backgroundPosition=Ci(e,Pt,t.backgroundPosition),this.backgroundRepeat=Ci(e,Vt,t.backgroundRepeat),this.backgroundSize=Ci(e,Xt,t.backgroundSize),this.borderTopColor=Ci(e,Zt,t.borderTopColor),this.borderRightColor=Ci(e,qt,t.borderRightColor),this.borderBottomColor=Ci(e,eA,t.borderBottomColor),this.borderLeftColor=Ci(e,tA,t.borderLeftColor),this.borderTopLeftRadius=Ci(e,iA,t.borderTopLeftRadius),this.borderTopRightRadius=Ci(e,sA,t.borderTopRightRadius),this.borderBottomRightRadius=Ci(e,nA,t.borderBottomRightRadius),this.borderBottomLeftRadius=Ci(e,rA,t.borderBottomLeftRadius),this.borderTopStyle=Ci(e,lA,t.borderTopStyle),this.borderRightStyle=Ci(e,aA,t.borderRightStyle),this.borderBottomStyle=Ci(e,dA,t.borderBottomStyle),this.borderLeftStyle=Ci(e,cA,t.borderLeftStyle),this.borderTopWidth=Ci(e,uA,t.borderTopWidth),this.borderRightWidth=Ci(e,pA,t.borderRightWidth),this.borderBottomWidth=Ci(e,gA,t.borderBottomWidth),this.borderLeftWidth=Ci(e,mA,t.borderLeftWidth),this.boxShadow=Ci(e,mi,t.boxShadow),this.color=Ci(e,fA,t.color),this.direction=Ci(e,wA,t.direction),this.display=Ci(e,BA,t.display),this.float=Ci(e,bA,t.cssFloat),this.fontFamily=Ci(e,si,t.fontFamily),this.fontSize=Ci(e,ni,t.fontSize),this.fontStyle=Ci(e,li,t.fontStyle),this.fontVariant=Ci(e,oi,t.fontVariant),this.fontWeight=Ci(e,ri,t.fontWeight),this.letterSpacing=Ci(e,vA,t.letterSpacing),this.lineBreak=Ci(e,xA,t.lineBreak),this.lineHeight=Ci(e,QA,t.lineHeight),this.listStyleImage=Ci(e,UA,t.listStyleImage),this.listStylePosition=Ci(e,EA,t.listStylePosition),this.listStyleType=Ci(e,kA,t.listStyleType),this.marginTop=Ci(e,HA,t.marginTop),this.marginRight=Ci(e,SA,t.marginRight),this.marginBottom=Ci(e,TA,t.marginBottom),this.marginLeft=Ci(e,_A,t.marginLeft),this.opacity=Ci(e,ti,t.opacity);var s=Ci(e,DA,t.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=Ci(e,LA,t.overflowWrap),this.paddingTop=Ci(e,OA,t.paddingTop),this.paddingRight=Ci(e,RA,t.paddingRight),this.paddingBottom=Ci(e,KA,t.paddingBottom),this.paddingLeft=Ci(e,$A,t.paddingLeft),this.paintOrder=Ci(e,fi,t.paintOrder),this.position=Ci(e,GA,t.position),this.textAlign=Ci(e,NA,t.textAlign),this.textDecorationColor=Ci(e,Ai,null!==(A=t.textDecorationColor)&&void 0!==A?A:t.color),this.textDecorationLine=Ci(e,ii,null!==(i=t.textDecorationLine)&&void 0!==i?i:t.textDecoration),this.textShadow=Ci(e,zA,t.textShadow),this.textTransform=Ci(e,PA,t.textTransform),this.transform=Ci(e,VA,t.transform),this.transformOrigin=Ci(e,YA,t.transformOrigin),this.visibility=Ci(e,JA,t.visibility),this.webkitTextStrokeColor=Ci(e,wi,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Ci(e,Bi,t.webkitTextStrokeWidth),this.wordBreak=Ci(e,ZA,t.wordBreak),this.zIndex=Ci(e,qA,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return ut(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return ai(this.display,4)||ai(this.display,33554432)||ai(this.display,268435456)||ai(this.display,536870912)||ai(this.display,67108864)||ai(this.display,134217728)},e}(),bi=function(e,t){this.content=Ci(e,di,t.content),this.quotes=Ci(e,pi,t.quotes)},vi=function(e,t){this.counterIncrement=Ci(e,ci,t.counterIncrement),this.counterReset=Ci(e,hi,t.counterReset)},Ci=function(e,t,A){var i=new $e,s=null!=A?A.toString():t.initialValue;i.write(s);var n=new Ne(i.read());switch(t.type){case 2:var r=n.parseComponentValue();return t.parse(e,Pe(r)?r.value:t.initialValue);case 0:return t.parse(e,n.parseComponentValue());case 1:return t.parse(e,n.parseComponentValues());case 4:return n.parseComponentValue();case 3:switch(t.format){case"angle":return lt(e,n.parseComponentValue());case"color":return ht(e,n.parseComponentValue());case"image":return Kt(e,n.parseComponentValue());case"length":var o=n.parseComponentValue();return Ze(o)?o:tt;case"length-percentage":var l=n.parseComponentValue();return qe(l)?l:tt;case"time":return ei.parse(e,n.parseComponentValue())}}},xi=function(e,t){var A=function(e){switch(e.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(e);return 1===A||t===A},Qi=function(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,xi(t,3),this.styles=new yi(e,window.getComputedStyle(t,null)),ks(t)&&(this.styles.animationDuration.some((function(e){return e>0}))&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=o(this.context,t),xi(t,4)&&(this.flags|=16)},Fi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ui="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ei=0;Ei<64;Ei++)Ui[Fi.charCodeAt(Ei)]=Ei;for(var ki=function(e,t,A){return e.slice?e.slice(t,A):new Uint16Array(Array.prototype.slice.call(e,t,A))},Ii=function(){function e(e,t,A,i,s,n){this.initialValue=e,this.errorValue=t,this.highStart=A,this.highValueIndex=i,this.index=s,this.data=n}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),Hi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Si="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ti=0;Ti<64;Ti++)Si[Hi.charCodeAt(Ti)]=Ti;var _i,Di=8,Li=9,Mi=11,Oi=12,Ri=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var A=e.length;if(!A)return"";for(var i=[],s=-1,n="";++s<A;){var r=e[s];r<=65535?i.push(r):(r-=65536,i.push(55296+(r>>10),r%1024+56320)),(s+1===A||i.length>16384)&&(n+=String.fromCharCode.apply(String,i),i.length=0)}return n},Ki=function(e,t){var A,i,s,n=function(e){var t,A,i,s,n,r=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);var a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(r):new Array(r),d=Array.isArray(a)?a:new Uint8Array(a);for(t=0;t<o;t+=4)A=Ui[e.charCodeAt(t)],i=Ui[e.charCodeAt(t+1)],s=Ui[e.charCodeAt(t+2)],n=Ui[e.charCodeAt(t+3)],d[l++]=A<<2|i>>4,d[l++]=(15&i)<<4|s>>2,d[l++]=(3&s)<<6|63&n;return a}(e),r=Array.isArray(n)?function(e){for(var t=e.length,A=[],i=0;i<t;i+=4)A.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return A}(n):new Uint32Array(n),o=Array.isArray(n)?function(e){for(var t=e.length,A=[],i=0;i<t;i+=2)A.push(e[i+1]<<8|e[i]);return A}(n):new Uint16Array(n),l=ki(o,12,r[4]/2),a=2===r[5]?ki(o,(24+r[4])/2):(A=r,i=Math.ceil((24+r[4])/4),A.slice?A.slice(i,s):new Uint32Array(Array.prototype.slice.call(A,i,s)));return new Ii(r[0],r[1],r[2],r[3],l,a)}("AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),$i="×",Ni=function(e){return Ki.get(e)},Gi=function(e,t,A){var i=A-2,s=t[i],n=t[A-1],r=t[A];if(2===n&&3===r)return $i;if(2===n||3===n||4===n)return"÷";if(2===r||3===r||4===r)return"÷";if(n===Di&&-1!==[Di,Li,Mi,Oi].indexOf(r))return $i;if(!(n!==Mi&&n!==Li||r!==Li&&10!==r))return $i;if((n===Oi||10===n)&&10===r)return $i;if(13===r||5===r)return $i;if(7===r)return $i;if(1===n)return $i;if(13===n&&14===r){for(;5===s;)s=t[--i];if(14===s)return $i}if(15===n&&15===r){for(var o=0;15===s;)o++,s=t[--i];if(o%2==0)return $i}return"÷"},zi=function(e){var t=function(e){for(var t=[],A=0,i=e.length;A<i;){var s=e.charCodeAt(A++);if(s>=55296&&s<=56319&&A<i){var n=e.charCodeAt(A++);56320==(64512&n)?t.push(((1023&s)<<10)+(1023&n)+65536):(t.push(s),A--)}else t.push(s)}return t}(e),A=t.length,i=0,s=0,n=t.map(Ni);return{next:function(){if(i>=A)return{done:!0,value:null};for(var e=$i;i<A&&(e=Gi(0,n,++i))===$i;);if(e!==$i||i===A){var r=Ri.apply(null,t.slice(s,i));return s=i,{value:r,done:!1}}return{done:!0,value:null}}}},Pi=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},Vi=function(e,t,A,i,s){var n="http://www.w3.org/2000/svg",r=document.createElementNS(n,"svg"),o=document.createElementNS(n,"foreignObject");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",A.toString()),o.setAttributeNS(null,"y",i.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),r.appendChild(o),o.appendChild(s),r},ji=function(e){return new Promise((function(t,A){var i=new Image;i.onload=function(){return t(i)},i.onerror=A,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Wi={get SUPPORT_RANGE_BOUNDS(){var e=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var A=e.createElement("boundtest");A.style.height="123px",A.style.display="block",e.body.appendChild(A),t.selectNode(A);var i=t.getBoundingClientRect(),s=Math.round(i.height);if(e.body.removeChild(A),123===s)return!0}}return!1}(document);return Object.defineProperty(Wi,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Wi.SUPPORT_RANGE_BOUNDS&&function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var A=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var i=t.firstChild,s=l(i.data).map((function(e){return a(e)})),n=0,r={},o=s.every((function(e,t){A.setStart(i,n),A.setEnd(i,n+e.length);var s=A.getBoundingClientRect();n+=e.length;var o=s.x>r.x||s.y>r.y;return r=s,0===t||o}));return e.body.removeChild(t),o}(document);return Object.defineProperty(Wi,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=function(e){var t=new Image,A=e.createElement("canvas"),i=A.getContext("2d");if(!i)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(t,0,0),A.toDataURL()}catch(e){return!1}return!0}(document);return Object.defineProperty(Wi,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?function(e){var t=e.createElement("canvas"),A=100;t.width=A,t.height=A;var i=t.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,A,A);var s=new Image,n=t.toDataURL();s.src=n;var r=Vi(A,A,0,0,s);return i.fillStyle="red",i.fillRect(0,0,A,A),ji(r).then((function(t){i.drawImage(t,0,0);var s=i.getImageData(0,0,A,A).data;i.fillStyle="red",i.fillRect(0,0,A,A);var r=e.createElement("div");return r.style.backgroundImage="url("+n+")",r.style.height=A+"px",Pi(s)?ji(Vi(A,A,0,0,r)):Promise.reject(!1)})).then((function(e){return i.drawImage(e,0,0),Pi(i.getImageData(0,0,A,A).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Wi,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=void 0!==(new Image).crossOrigin;return Object.defineProperty(Wi,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Wi,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Wi,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Wi,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Xi=function(e,t){this.text=e,this.bounds=t},Yi=function(e,t){var A=t.ownerDocument;if(A){var i=A.createElement("html2canvaswrapper");i.appendChild(t.cloneNode(!0));var s=t.parentNode;if(s){s.replaceChild(i,t);var n=o(e,i);return i.firstChild&&s.replaceChild(i.firstChild,i),n}}return r.EMPTY},Ji=function(e,t,A){var i=e.ownerDocument;if(!i)throw new Error("Node has no owner document");var s=i.createRange();return s.setStart(e,t),s.setEnd(e,t+A),s},Zi=function(e){if(Wi.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map((function(e){return e.segment}))}return function(e){for(var t,A=zi(e),i=[];!(t=A.next()).done;)t.value&&i.push(t.value.slice());return i}(e)},qi=function(e,t){return 0!==t.letterSpacing?Zi(e):function(e,t){if(Wi.SUPPORT_NATIVE_TEXT_SEGMENTATION){var A=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(A.segment(e)).map((function(e){return e.segment}))}return ts(e,t)}(e,t)},es=[32,160,4961,65792,65793,4153,4241],ts=function(e,t){for(var A,i=function(e,t){var A=l(e),i=ne(A,t),s=i[0],n=i[1],r=i[2],o=A.length,a=0,d=0;return{next:function(){if(d>=o)return{done:!0,value:null};for(var e=V;d<o&&(e=se(A,n,s,++d,r))===V;);if(e!==V||d===o){var t=new re(A,e,a,d);return a=d,{value:t,done:!1}}return{done:!0,value:null}}}}(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),s=[],n=function(){if(A.value){var e=A.value.slice(),t=l(e),i="";t.forEach((function(e){-1===es.indexOf(e)?i+=a(e):(i.length&&s.push(i),s.push(a(e)),i="")})),i.length&&s.push(i)}};!(A=i.next()).done;)n();return s},As=function(e,t,A){this.text=is(t.data,A.textTransform),this.textBounds=function(e,t,A,i){var s=qi(t,A),n=[],o=0;return s.forEach((function(t){if(A.textDecorationLine.length||t.trim().length>0)if(Wi.SUPPORT_RANGE_BOUNDS){var s=Ji(i,o,t.length).getClientRects();if(s.length>1){var l=Zi(t),a=0;l.forEach((function(t){n.push(new Xi(t,r.fromDOMRectList(e,Ji(i,a+o,t.length).getClientRects()))),a+=t.length}))}else n.push(new Xi(t,r.fromDOMRectList(e,s)))}else{var d=i.splitText(t.length);n.push(new Xi(t,Yi(e,i))),i=d}else Wi.SUPPORT_RANGE_BOUNDS||(i=i.splitText(t.length));o+=t.length})),n}(e,this.text,A,t)},is=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(ss,ns);case 2:return e.toUpperCase();default:return e}},ss=/(^|\s|:|-|\(|\))([a-z])/g,ns=function(e,t,A){return e.length>0?t+A.toUpperCase():e},rs=function(e){function A(t,A){var i=e.call(this,t,A)||this;return i.src=A.currentSrc||A.src,i.intrinsicWidth=A.naturalWidth,i.intrinsicHeight=A.naturalHeight,i.context.cache.addImage(i.src),i}return t(A,e),A}(Qi),os=function(e){function A(t,A){var i=e.call(this,t,A)||this;return i.canvas=A,i.intrinsicWidth=A.width,i.intrinsicHeight=A.height,i}return t(A,e),A}(Qi),ls=function(e){function A(t,A){var i=e.call(this,t,A)||this,s=new XMLSerializer,n=o(t,A);return A.setAttribute("width",n.width+"px"),A.setAttribute("height",n.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(A)),i.intrinsicWidth=A.width.baseVal.value,i.intrinsicHeight=A.height.baseVal.value,i.context.cache.addImage(i.svg),i}return t(A,e),A}(Qi),as=function(e){function A(t,A){var i=e.call(this,t,A)||this;return i.value=A.value,i}return t(A,e),A}(Qi),ds=function(e){function A(t,A){var i=e.call(this,t,A)||this;return i.start=A.start,i.reversed="boolean"==typeof A.reversed&&!0===A.reversed,i}return t(A,e),A}(Qi),cs=[{type:15,flags:0,unit:"px",number:3}],hs=[{type:16,flags:0,number:50}],us="checkbox",ps="radio",gs="password",ms=707406591,fs=function(e){function A(t,A){var i,s,n,o=e.call(this,t,A)||this;switch(o.type=A.type.toLowerCase(),o.checked=A.checked,o.value=0===(n=(s=A).type===gs?new Array(s.value.length+1).join("•"):s.value).length?s.placeholder||"":n,o.type!==us&&o.type!==ps||(o.styles.backgroundColor=3739148031,o.styles.borderTopColor=o.styles.borderRightColor=o.styles.borderBottomColor=o.styles.borderLeftColor=2779096575,o.styles.borderTopWidth=o.styles.borderRightWidth=o.styles.borderBottomWidth=o.styles.borderLeftWidth=1,o.styles.borderTopStyle=o.styles.borderRightStyle=o.styles.borderBottomStyle=o.styles.borderLeftStyle=1,o.styles.backgroundClip=[0],o.styles.backgroundOrigin=[0],o.bounds=(i=o.bounds).width>i.height?new r(i.left+(i.width-i.height)/2,i.top,i.height,i.height):i.width<i.height?new r(i.left,i.top+(i.height-i.width)/2,i.width,i.width):i),o.type){case us:o.styles.borderTopRightRadius=o.styles.borderTopLeftRadius=o.styles.borderBottomRightRadius=o.styles.borderBottomLeftRadius=cs;break;case ps:o.styles.borderTopRightRadius=o.styles.borderTopLeftRadius=o.styles.borderBottomRightRadius=o.styles.borderBottomLeftRadius=hs}return o}return t(A,e),A}(Qi),ws=function(e){function A(t,A){var i=e.call(this,t,A)||this,s=A.options[A.selectedIndex||0];return i.value=s&&s.text||"",i}return t(A,e),A}(Qi),Bs=function(e){function A(t,A){var i=e.call(this,t,A)||this;return i.value=A.value,i}return t(A,e),A}(Qi),ys=function(e){function A(t,A){var i=e.call(this,t,A)||this;i.src=A.src,i.width=parseInt(A.width,10)||0,i.height=parseInt(A.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(A.contentWindow&&A.contentWindow.document&&A.contentWindow.document.documentElement){i.tree=xs(t,A.contentWindow.document.documentElement);var s=A.contentWindow.document.documentElement?bt(t,getComputedStyle(A.contentWindow.document.documentElement).backgroundColor):vt.TRANSPARENT,n=A.contentWindow.document.body?bt(t,getComputedStyle(A.contentWindow.document.body).backgroundColor):vt.TRANSPARENT;i.backgroundColor=ut(s)?ut(n)?i.styles.backgroundColor:n:s}}catch(e){}return i}return t(A,e),A}(Qi),bs=["OL","UL","MENU"],vs=function(e,t,A,i){for(var s=t.firstChild,n=void 0;s;s=n)if(n=s.nextSibling,Us(s)&&s.data.trim().length>0)A.textNodes.push(new As(e,s,A.styles));else if(Es(s))if(Gs(s)&&s.assignedNodes)s.assignedNodes().forEach((function(t){return vs(e,t,A,i)}));else{var r=Cs(e,s);r.styles.isVisible()&&(Qs(s,r,i)?r.flags|=4:Fs(r.styles)&&(r.flags|=2),-1!==bs.indexOf(s.tagName)&&(r.flags|=8),A.elements.push(r),s.slot,s.shadowRoot?vs(e,s.shadowRoot,r,i):$s(s)||_s(s)||Ns(s)||vs(e,s,r,i))}},Cs=function(e,t){return Os(t)?new rs(e,t):Ls(t)?new os(e,t):_s(t)?new ls(e,t):Hs(t)?new as(e,t):Ss(t)?new ds(e,t):Ts(t)?new fs(e,t):Ns(t)?new ws(e,t):$s(t)?new Bs(e,t):Rs(t)?new ys(e,t):new Qi(e,t)},xs=function(e,t){var A=Cs(e,t);return A.flags|=4,vs(e,t,A,A),A},Qs=function(e,t,A){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Ds(e)&&A.styles.isTransparent()},Fs=function(e){return e.isPositioned()||e.isFloating()},Us=function(e){return e.nodeType===Node.TEXT_NODE},Es=function(e){return e.nodeType===Node.ELEMENT_NODE},ks=function(e){return Es(e)&&void 0!==e.style&&!Is(e)},Is=function(e){return"object"==typeof e.className},Hs=function(e){return"LI"===e.tagName},Ss=function(e){return"OL"===e.tagName},Ts=function(e){return"INPUT"===e.tagName},_s=function(e){return"svg"===e.tagName},Ds=function(e){return"BODY"===e.tagName},Ls=function(e){return"CANVAS"===e.tagName},Ms=function(e){return"VIDEO"===e.tagName},Os=function(e){return"IMG"===e.tagName},Rs=function(e){return"IFRAME"===e.tagName},Ks=function(e){return"STYLE"===e.tagName},$s=function(e){return"TEXTAREA"===e.tagName},Ns=function(e){return"SELECT"===e.tagName},Gs=function(e){return"SLOT"===e.tagName},zs=function(e){return e.tagName.indexOf("-")>0},Ps=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){return this.counters[e]||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,A=e.counterIncrement,i=e.counterReset,s=!0;null!==A&&A.forEach((function(e){var A=t.counters[e.counter];A&&0!==e.increment&&(s=!1,A.length||A.push(1),A[Math.max(0,A.length-1)]+=e.increment)}));var n=[];return s&&i.forEach((function(e){var A=t.counters[e.counter];n.push(e.counter),A||(A=t.counters[e.counter]=[]),A.push(e.reset)})),n},e}(),Vs={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},js={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},Ws={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Xs={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},Ys=function(e,t,A,i,s,n){return e<t||e>A?rn(e,s,n.length>0):i.integers.reduce((function(t,A,s){for(;e>=A;)e-=A,t+=i.values[s];return t}),"")+n},Js=function(e,t,A,i){var s="";do{A||e--,s=i(e)+s,e/=t}while(e*t>=t);return s},Zs=function(e,t,A,i,s){var n=A-t+1;return(e<0?"-":"")+(Js(Math.abs(e),n,i,(function(e){return a(Math.floor(e%n)+t)}))+s)},qs=function(e,t,A){void 0===A&&(A=". ");var i=t.length;return Js(Math.abs(e),i,!1,(function(e){return t[Math.floor(e%i)]}))+A},en=function(e,t,A,i,s,n){if(e<-9999||e>9999)return rn(e,4,s.length>0);var r=Math.abs(e),o=s;if(0===r)return t[0]+o;for(var l=0;r>0&&l<=4;l++){var a=r%10;0===a&&ai(n,1)&&""!==o?o=t[a]+o:a>1||1===a&&0===l||1===a&&1===l&&ai(n,2)||1===a&&1===l&&ai(n,4)&&e>100||1===a&&l>1&&ai(n,8)?o=t[a]+(l>0?A[l-1]:"")+o:1===a&&l>0&&(o=A[l-1]+o),r=Math.floor(r/10)}return(e<0?i:"")+o},tn="十百千萬",An="拾佰仟萬",sn="マイナス",nn="마이너스",rn=function(e,t,A){var i=A?". ":"",s=A?"、":"",n=A?", ":"",r=A?" ":"";switch(t){case 0:return"•"+r;case 1:return"◦"+r;case 2:return"◾"+r;case 5:var o=Zs(e,48,57,!0,i);return o.length<4?"0"+o:o;case 4:return qs(e,"〇一二三四五六七八九",s);case 6:return Ys(e,1,3999,Vs,3,i).toLowerCase();case 7:return Ys(e,1,3999,Vs,3,i);case 8:return Zs(e,945,969,!1,i);case 9:return Zs(e,97,122,!1,i);case 10:return Zs(e,65,90,!1,i);case 11:return Zs(e,1632,1641,!0,i);case 12:case 49:return Ys(e,1,9999,js,3,i);case 35:return Ys(e,1,9999,js,3,i).toLowerCase();case 13:return Zs(e,2534,2543,!0,i);case 14:case 30:return Zs(e,6112,6121,!0,i);case 15:return qs(e,"子丑寅卯辰巳午未申酉戌亥",s);case 16:return qs(e,"甲乙丙丁戊己庚辛壬癸",s);case 17:case 48:return en(e,"零一二三四五六七八九",tn,"負",s,14);case 47:return en(e,"零壹貳參肆伍陸柒捌玖",An,"負",s,15);case 42:return en(e,"零一二三四五六七八九",tn,"负",s,14);case 41:return en(e,"零壹贰叁肆伍陆柒捌玖",An,"负",s,15);case 26:return en(e,"〇一二三四五六七八九","十百千万",sn,s,0);case 25:return en(e,"零壱弐参四伍六七八九","拾百千万",sn,s,7);case 31:return en(e,"영일이삼사오육칠팔구","십백천만",nn,n,7);case 33:return en(e,"零一二三四五六七八九","十百千萬",nn,n,0);case 32:return en(e,"零壹貳參四五六七八九","拾百千",nn,n,7);case 18:return Zs(e,2406,2415,!0,i);case 20:return Ys(e,1,19999,Xs,3,i);case 21:return Zs(e,2790,2799,!0,i);case 22:return Zs(e,2662,2671,!0,i);case 22:return Ys(e,1,10999,Ws,3,i);case 23:return qs(e,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return qs(e,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return Zs(e,3302,3311,!0,i);case 28:return qs(e,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",s);case 29:return qs(e,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",s);case 34:return Zs(e,3792,3801,!0,i);case 37:return Zs(e,6160,6169,!0,i);case 38:return Zs(e,4160,4169,!0,i);case 39:return Zs(e,2918,2927,!0,i);case 40:return Zs(e,1776,1785,!0,i);case 43:return Zs(e,3046,3055,!0,i);case 44:return Zs(e,3174,3183,!0,i);case 45:return Zs(e,3664,3673,!0,i);case 46:return Zs(e,3872,3881,!0,i);default:return Zs(e,48,57,!0,i)}},on="data-html2canvas-ignore",ln=function(){function e(e,t,A){if(this.context=e,this.options=A,this.scrolledElements=[],this.referenceElement=t,this.counters=new Ps,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var A=this,n=dn(e,t);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var r=e.defaultView.pageXOffset,o=e.defaultView.pageYOffset,l=n.contentWindow,a=l.document,d=un(n).then((function(){return i(A,void 0,void 0,(function(){var e,A;return s(this,(function(i){switch(i.label){case 0:return this.scrolledElements.forEach(wn),l&&(l.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.scrollY===t.top&&l.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-t.left,l.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(A=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:a.fonts&&a.fonts.ready?[4,a.fonts.ready]:[3,2];case 1:i.sent(),i.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,hn(a)]:[3,4];case 3:i.sent(),i.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(a,A)})).then((function(){return n}))]:[2,n]}}))}))}));return a.open(),a.write(mn(document.doctype)+"<html></html>"),fn(this.referenceElement.ownerDocument,r,o),a.replaceChild(a.adoptNode(this.documentElement),a.documentElement),a.close(),d},e.prototype.createElementClone=function(e){if(xi(e,2),Ls(e))return this.createCanvasClone(e);if(Ms(e))return this.createVideoClone(e);if(Ks(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return Os(t)&&(Os(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),zs(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return gn(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var A=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),i=e.cloneNode(!1);return i.textContent=A,i}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var A=e.ownerDocument.createElement("img");try{return A.src=e.toDataURL(),A}catch(t){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var s=e.getContext("2d"),n=i.getContext("2d");if(n)if(!this.options.allowTaint&&s)n.putImageData(s.getImageData(0,0,e.width,e.height),0,0);else{var r=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(r){var o=r.getContextAttributes();!1===(null==o?void 0:o.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}n.drawImage(e,0,0)}return i}catch(t){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var A=t.getContext("2d");try{return A&&(A.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||A.getImageData(0,0,t.width,t.height)),t}catch(t){this.context.logger.info("Unable to clone video as it is tainted",e)}var i=e.ownerDocument.createElement("canvas");return i.width=e.offsetWidth,i.height=e.offsetHeight,i},e.prototype.appendChildNode=function(e,t,A){Es(t)&&("SCRIPT"===t.tagName||t.hasAttribute(on)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&Es(t)&&Ks(t)||e.appendChild(this.cloneNode(t,A))},e.prototype.cloneChildNodes=function(e,t,A){for(var i=this,s=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;s;s=s.nextSibling)if(Es(s)&&Gs(s)&&"function"==typeof s.assignedNodes){var n=s.assignedNodes();n.length&&n.forEach((function(e){return i.appendChildNode(t,e,A)}))}else this.appendChildNode(t,s,A)},e.prototype.cloneNode=function(e,t){if(Us(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var A=e.ownerDocument.defaultView;if(A&&Es(e)&&(ks(e)||Is(e))){var i=this.createElementClone(e);i.style.transitionProperty="none";var s=A.getComputedStyle(e),n=A.getComputedStyle(e,":before"),r=A.getComputedStyle(e,":after");this.referenceElement===e&&ks(i)&&(this.clonedReferenceElement=i),Ds(i)&&vn(i);var o=this.counters.parse(new vi(this.context,s)),l=this.resolvePseudoContent(e,i,n,_i.BEFORE);zs(e)&&(t=!0),Ms(e)||this.cloneChildNodes(e,i,t),l&&i.insertBefore(l,i.firstChild);var a=this.resolvePseudoContent(e,i,r,_i.AFTER);return a&&i.appendChild(a),this.counters.pop(o),(s&&(this.options.copyStyles||Is(e))&&!Rs(e)||t)&&gn(s,i),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([i,e.scrollLeft,e.scrollTop]),($s(e)||Ns(e))&&($s(i)||Ns(i))&&(i.value=e.value),i}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,A,i){var s=this;if(A){var n=A.content,r=t.ownerDocument;if(r&&n&&"none"!==n&&"-moz-alt-content"!==n&&"none"!==A.display){this.counters.parse(new vi(this.context,A));var o=new bi(this.context,A),l=r.createElement("html2canvaspseudoelement");gn(A,l),o.content.forEach((function(t){if(0===t.type)l.appendChild(r.createTextNode(t.value));else if(22===t.type){var A=r.createElement("img");A.src=t.value,A.style.opacity="1",l.appendChild(A)}else if(18===t.type){if("attr"===t.name){var i=t.values.filter(Pe);i.length&&l.appendChild(r.createTextNode(e.getAttribute(i[0].value)||""))}else if("counter"===t.name){var n=t.values.filter(Xe),a=n[0],d=n[1];if(a&&Pe(a)){var c=s.counters.getCounterValue(a.value),h=d&&Pe(d)?kA.parse(s.context,d.value):3;l.appendChild(r.createTextNode(rn(c,h,!1)))}}else if("counters"===t.name){var u=t.values.filter(Xe),p=(a=u[0],u[1]);if(d=u[2],a&&Pe(a)){var g=s.counters.getCounterValues(a.value),m=d&&Pe(d)?kA.parse(s.context,d.value):3,f=p&&0===p.type?p.value:"",w=g.map((function(e){return rn(e,m,!1)})).join(f);l.appendChild(r.createTextNode(w))}}}else if(20===t.type)switch(t.value){case"open-quote":l.appendChild(r.createTextNode(gi(o.quotes,s.quoteDepth++,!0)));break;case"close-quote":l.appendChild(r.createTextNode(gi(o.quotes,--s.quoteDepth,!1)));break;default:l.appendChild(r.createTextNode(t.value))}})),l.className=Bn+" "+yn;var a=i===_i.BEFORE?" "+Bn:" "+yn;return Is(t)?t.className.baseValue+=a:t.className+=a,l}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(_i||(_i={}));var an,dn=function(e,t){var A=e.createElement("iframe");return A.className="html2canvas-container",A.style.visibility="hidden",A.style.position="fixed",A.style.left="-10000px",A.style.top="0px",A.style.border="0",A.width=t.width.toString(),A.height=t.height.toString(),A.scrolling="no",A.setAttribute(on,"true"),e.body.appendChild(A),A},cn=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},hn=function(e){return Promise.all([].slice.call(e.images,0).map(cn))},un=function(e){return new Promise((function(t,A){var i=e.contentWindow;if(!i)return A("No window assigned for iframe");var s=i.document;i.onload=e.onload=function(){i.onload=e.onload=null;var A=setInterval((function(){s.body.childNodes.length>0&&"complete"===s.readyState&&(clearInterval(A),t(e))}),50)}}))},pn=["all","d","content"],gn=function(e,t){for(var A=e.length-1;A>=0;A--){var i=e.item(A);-1===pn.indexOf(i)&&t.style.setProperty(i,e.getPropertyValue(i))}return t},mn=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},fn=function(e,t,A){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||A!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,A)},wn=function(e){var t=e[0],A=e[1],i=e[2];t.scrollLeft=A,t.scrollTop=i},Bn="___html2canvas___pseudoelement_before",yn="___html2canvas___pseudoelement_after",bn='{\n    content: "" !important;\n    display: none !important;\n}',vn=function(e){Cn(e,"."+Bn+":before"+bn+"\n         ."+yn+":after"+bn)},Cn=function(e,t){var A=e.ownerDocument;if(A){var i=A.createElement("style");i.textContent=t,e.appendChild(i)}},xn=function(){function e(){}return e.getOrigin=function(t){var A=e._link;return A?(A.href=t,A.href=A.href,A.protocol+A.hostname+A.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),Qn=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:Sn(e)||kn(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return i(this,void 0,void 0,(function(){var t,A,i,n,r=this;return s(this,(function(s){switch(s.label){case 0:return t=xn.isSameOrigin(e),A=!In(e)&&!0===this._options.useCORS&&Wi.SUPPORT_CORS_IMAGES&&!t,i=!In(e)&&!t&&!Sn(e)&&"string"==typeof this._options.proxy&&Wi.SUPPORT_CORS_XHR&&!A,t||!1!==this._options.allowTaint||In(e)||Sn(e)||i||A?(n=e,i?[4,this.proxy(n)]:[3,2]):[2];case 1:n=s.sent(),s.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var i=new Image;i.onload=function(){return e(i)},i.onerror=t,(Hn(n)||A)&&(i.crossOrigin="anonymous"),i.src=n,!0===i.complete&&setTimeout((function(){return e(i)}),500),r._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+r._options.imageTimeout+"ms) loading image")}),r._options.imageTimeout)}))];case 3:return[2,s.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,A=this._options.proxy;if(!A)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise((function(s,n){var r=Wi.SUPPORT_RESPONSE_TYPE?"blob":"text",o=new XMLHttpRequest;o.onload=function(){if(200===o.status)if("text"===r)s(o.response);else{var e=new FileReader;e.addEventListener("load",(function(){return s(e.result)}),!1),e.addEventListener("error",(function(e){return n(e)}),!1),e.readAsDataURL(o.response)}else n("Failed to proxy resource "+i+" with status code "+o.status)},o.onerror=n;var l=A.indexOf("?")>-1?"&":"?";if(o.open("GET",""+A+l+"url="+encodeURIComponent(e)+"&responseType="+r),"text"!==r&&o instanceof XMLHttpRequest&&(o.responseType=r),t._options.imageTimeout){var a=t._options.imageTimeout;o.timeout=a,o.ontimeout=function(){return n("Timed out ("+a+"ms) proxying "+i)}}o.send()}))},e}(),Fn=/^data:image\/svg\+xml/i,Un=/^data:image\/.*;base64,/i,En=/^data:image\/.*/i,kn=function(e){return Wi.SUPPORT_SVG_DRAWING||!Tn(e)},In=function(e){return En.test(e)},Hn=function(e){return Un.test(e)},Sn=function(e){return"blob"===e.substr(0,4)},Tn=function(e){return"svg"===e.substr(-3).toLowerCase()||Fn.test(e)},_n=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,A){return new e(this.x+t,this.y+A)},e}(),Dn=function(e,t,A){return new _n(e.x+(t.x-e.x)*A,e.y+(t.y-e.y)*A)},Ln=function(){function e(e,t,A,i){this.type=1,this.start=e,this.startControl=t,this.endControl=A,this.end=i}return e.prototype.subdivide=function(t,A){var i=Dn(this.start,this.startControl,t),s=Dn(this.startControl,this.endControl,t),n=Dn(this.endControl,this.end,t),r=Dn(i,s,t),o=Dn(s,n,t),l=Dn(r,o,t);return A?new e(this.start,i,r,l):new e(l,o,n,this.end)},e.prototype.add=function(t,A){return new e(this.start.add(t,A),this.startControl.add(t,A),this.endControl.add(t,A),this.end.add(t,A))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),Mn=function(e){return 1===e.type},On=function(e){var t=e.styles,A=e.bounds,i=st(t.borderTopLeftRadius,A.width,A.height),s=i[0],n=i[1],r=st(t.borderTopRightRadius,A.width,A.height),o=r[0],l=r[1],a=st(t.borderBottomRightRadius,A.width,A.height),d=a[0],c=a[1],h=st(t.borderBottomLeftRadius,A.width,A.height),u=h[0],p=h[1],g=[];g.push((s+o)/A.width),g.push((u+d)/A.width),g.push((n+p)/A.height),g.push((l+c)/A.height);var m=Math.max.apply(Math,g);m>1&&(s/=m,n/=m,o/=m,l/=m,d/=m,c/=m,u/=m,p/=m);var f=A.width-o,w=A.height-c,B=A.width-d,y=A.height-p,b=t.borderTopWidth,v=t.borderRightWidth,C=t.borderBottomWidth,x=t.borderLeftWidth,Q=nt(t.paddingTop,e.bounds.width),F=nt(t.paddingRight,e.bounds.width),U=nt(t.paddingBottom,e.bounds.width),E=nt(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||n>0?Rn(A.left+x/3,A.top+b/3,s-x/3,n-b/3,an.TOP_LEFT):new _n(A.left+x/3,A.top+b/3),this.topRightBorderDoubleOuterBox=s>0||n>0?Rn(A.left+f,A.top+b/3,o-v/3,l-b/3,an.TOP_RIGHT):new _n(A.left+A.width-v/3,A.top+b/3),this.bottomRightBorderDoubleOuterBox=d>0||c>0?Rn(A.left+B,A.top+w,d-v/3,c-C/3,an.BOTTOM_RIGHT):new _n(A.left+A.width-v/3,A.top+A.height-C/3),this.bottomLeftBorderDoubleOuterBox=u>0||p>0?Rn(A.left+x/3,A.top+y,u-x/3,p-C/3,an.BOTTOM_LEFT):new _n(A.left+x/3,A.top+A.height-C/3),this.topLeftBorderDoubleInnerBox=s>0||n>0?Rn(A.left+2*x/3,A.top+2*b/3,s-2*x/3,n-2*b/3,an.TOP_LEFT):new _n(A.left+2*x/3,A.top+2*b/3),this.topRightBorderDoubleInnerBox=s>0||n>0?Rn(A.left+f,A.top+2*b/3,o-2*v/3,l-2*b/3,an.TOP_RIGHT):new _n(A.left+A.width-2*v/3,A.top+2*b/3),this.bottomRightBorderDoubleInnerBox=d>0||c>0?Rn(A.left+B,A.top+w,d-2*v/3,c-2*C/3,an.BOTTOM_RIGHT):new _n(A.left+A.width-2*v/3,A.top+A.height-2*C/3),this.bottomLeftBorderDoubleInnerBox=u>0||p>0?Rn(A.left+2*x/3,A.top+y,u-2*x/3,p-2*C/3,an.BOTTOM_LEFT):new _n(A.left+2*x/3,A.top+A.height-2*C/3),this.topLeftBorderStroke=s>0||n>0?Rn(A.left+x/2,A.top+b/2,s-x/2,n-b/2,an.TOP_LEFT):new _n(A.left+x/2,A.top+b/2),this.topRightBorderStroke=s>0||n>0?Rn(A.left+f,A.top+b/2,o-v/2,l-b/2,an.TOP_RIGHT):new _n(A.left+A.width-v/2,A.top+b/2),this.bottomRightBorderStroke=d>0||c>0?Rn(A.left+B,A.top+w,d-v/2,c-C/2,an.BOTTOM_RIGHT):new _n(A.left+A.width-v/2,A.top+A.height-C/2),this.bottomLeftBorderStroke=u>0||p>0?Rn(A.left+x/2,A.top+y,u-x/2,p-C/2,an.BOTTOM_LEFT):new _n(A.left+x/2,A.top+A.height-C/2),this.topLeftBorderBox=s>0||n>0?Rn(A.left,A.top,s,n,an.TOP_LEFT):new _n(A.left,A.top),this.topRightBorderBox=o>0||l>0?Rn(A.left+f,A.top,o,l,an.TOP_RIGHT):new _n(A.left+A.width,A.top),this.bottomRightBorderBox=d>0||c>0?Rn(A.left+B,A.top+w,d,c,an.BOTTOM_RIGHT):new _n(A.left+A.width,A.top+A.height),this.bottomLeftBorderBox=u>0||p>0?Rn(A.left,A.top+y,u,p,an.BOTTOM_LEFT):new _n(A.left,A.top+A.height),this.topLeftPaddingBox=s>0||n>0?Rn(A.left+x,A.top+b,Math.max(0,s-x),Math.max(0,n-b),an.TOP_LEFT):new _n(A.left+x,A.top+b),this.topRightPaddingBox=o>0||l>0?Rn(A.left+Math.min(f,A.width-v),A.top+b,f>A.width+v?0:Math.max(0,o-v),Math.max(0,l-b),an.TOP_RIGHT):new _n(A.left+A.width-v,A.top+b),this.bottomRightPaddingBox=d>0||c>0?Rn(A.left+Math.min(B,A.width-x),A.top+Math.min(w,A.height-C),Math.max(0,d-v),Math.max(0,c-C),an.BOTTOM_RIGHT):new _n(A.left+A.width-v,A.top+A.height-C),this.bottomLeftPaddingBox=u>0||p>0?Rn(A.left+x,A.top+Math.min(y,A.height-C),Math.max(0,u-x),Math.max(0,p-C),an.BOTTOM_LEFT):new _n(A.left+x,A.top+A.height-C),this.topLeftContentBox=s>0||n>0?Rn(A.left+x+E,A.top+b+Q,Math.max(0,s-(x+E)),Math.max(0,n-(b+Q)),an.TOP_LEFT):new _n(A.left+x+E,A.top+b+Q),this.topRightContentBox=o>0||l>0?Rn(A.left+Math.min(f,A.width+x+E),A.top+b+Q,f>A.width+x+E?0:o-x+E,l-(b+Q),an.TOP_RIGHT):new _n(A.left+A.width-(v+F),A.top+b+Q),this.bottomRightContentBox=d>0||c>0?Rn(A.left+Math.min(B,A.width-(x+E)),A.top+Math.min(w,A.height+b+Q),Math.max(0,d-(v+F)),c-(C+U),an.BOTTOM_RIGHT):new _n(A.left+A.width-(v+F),A.top+A.height-(C+U)),this.bottomLeftContentBox=u>0||p>0?Rn(A.left+x+E,A.top+y,Math.max(0,u-(x+E)),p-(C+U),an.BOTTOM_LEFT):new _n(A.left+x+E,A.top+A.height-(C+U))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(an||(an={}));var Rn=function(e,t,A,i,s){var n=(Math.sqrt(2)-1)/3*4,r=A*n,o=i*n,l=e+A,a=t+i;switch(s){case an.TOP_LEFT:return new Ln(new _n(e,a),new _n(e,a-o),new _n(l-r,t),new _n(l,t));case an.TOP_RIGHT:return new Ln(new _n(e,t),new _n(e+r,t),new _n(l,a-o),new _n(l,a));case an.BOTTOM_RIGHT:return new Ln(new _n(l,t),new _n(l,t+o),new _n(e+r,a),new _n(e,a));case an.BOTTOM_LEFT:default:return new Ln(new _n(l,a),new _n(l-r,a),new _n(e,t+o),new _n(e,t))}},Kn=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},$n=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},Nn=function(e,t,A){this.offsetX=e,this.offsetY=t,this.matrix=A,this.type=0,this.target=6},Gn=function(e,t){this.path=e,this.target=t,this.type=1},zn=function(e){this.opacity=e,this.type=2,this.target=6},Pn=function(e){return 1===e.type},Vn=function(e,t){return e.length===t.length&&e.some((function(e,A){return e===t[A]}))},jn=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},Wn=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new On(this.container),this.container.styles.opacity<1&&this.effects.push(new zn(this.container.styles.opacity)),null!==this.container.styles.transform){var A=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new Nn(A,i,s))}if(0!==this.container.styles.overflowX){var n=Kn(this.curves),r=$n(this.curves);Vn(n,r)?this.effects.push(new Gn(n,6)):(this.effects.push(new Gn(n,2)),this.effects.push(new Gn(r,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),A=this.parent,i=this.effects.slice(0);A;){var s=A.effects.filter((function(e){return!Pn(e)}));if(t||0!==A.container.styles.position||!A.parent){if(i.unshift.apply(i,s),t=-1===[2,3].indexOf(A.container.styles.position),0!==A.container.styles.overflowX){var n=Kn(A.curves),r=$n(A.curves);Vn(n,r)||i.unshift(new Gn(r,6))}}else i.unshift.apply(i,s);A=A.parent}return i.filter((function(t){return ai(t.target,e)}))},e}(),Xn=function(e,t,A,i){e.container.elements.forEach((function(s){var n=ai(s.flags,4),r=ai(s.flags,2),o=new Wn(s,e);ai(s.styles.display,2048)&&i.push(o);var l=ai(s.flags,8)?[]:i;if(n||r){var a=n||s.styles.isPositioned()?A:t,d=new jn(o);if(s.styles.isPositioned()||s.styles.opacity<1||s.styles.isTransformed()){var c=s.styles.zIndex.order;if(c<0){var h=0;a.negativeZIndex.some((function(e,t){return c>e.element.container.styles.zIndex.order?(h=t,!1):h>0})),a.negativeZIndex.splice(h,0,d)}else if(c>0){var u=0;a.positiveZIndex.some((function(e,t){return c>=e.element.container.styles.zIndex.order?(u=t+1,!1):u>0})),a.positiveZIndex.splice(u,0,d)}else a.zeroOrAutoZIndexOrTransformedOrOpacity.push(d)}else s.styles.isFloating()?a.nonPositionedFloats.push(d):a.nonPositionedInlineLevel.push(d);Xn(o,d,n?d:A,l)}else s.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),Xn(o,t,A,l);ai(s.flags,8)&&Yn(s,l)}))},Yn=function(e,t){for(var A=e instanceof ds?e.start:1,i=e instanceof ds&&e.reversed,s=0;s<t.length;s++){var n=t[s];n.container instanceof as&&"number"==typeof n.container.value&&0!==n.container.value&&(A=n.container.value),n.listValue=rn(A,n.container.styles.listStyleType,!0),A+=i?-1:1}},Jn=function(e,t){switch(t){case 0:return qn(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return qn(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return qn(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return qn(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},Zn=function(e,t){var A=[];return Mn(e)?A.push(e.subdivide(.5,!1)):A.push(e),Mn(t)?A.push(t.subdivide(.5,!0)):A.push(t),A},qn=function(e,t,A,i){var s=[];return Mn(e)?s.push(e.subdivide(.5,!1)):s.push(e),Mn(A)?s.push(A.subdivide(.5,!0)):s.push(A),Mn(i)?s.push(i.subdivide(.5,!0).reverse()):s.push(i),Mn(t)?s.push(t.subdivide(.5,!1).reverse()):s.push(t),s},er=function(e){var t=e.bounds,A=e.styles;return t.add(A.borderLeftWidth,A.borderTopWidth,-(A.borderRightWidth+A.borderLeftWidth),-(A.borderTopWidth+A.borderBottomWidth))},tr=function(e){var t=e.styles,A=e.bounds,i=nt(t.paddingLeft,A.width),s=nt(t.paddingRight,A.width),n=nt(t.paddingTop,A.width),r=nt(t.paddingBottom,A.width);return A.add(i+t.borderLeftWidth,n+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+i+s),-(t.borderTopWidth+t.borderBottomWidth+n+r))},Ar=function(e,t,A){var i=function(e,t){return 0===e?t.bounds:2===e?tr(t):er(t)}(rr(e.styles.backgroundOrigin,t),e),s=function(e,t){return 0===e?t.bounds:2===e?tr(t):er(t)}(rr(e.styles.backgroundClip,t),e),n=nr(rr(e.styles.backgroundSize,t),A,i),r=n[0],o=n[1],l=st(rr(e.styles.backgroundPosition,t),i.width-r,i.height-o);return[or(rr(e.styles.backgroundRepeat,t),l,n,i,s),Math.round(i.left+l[0]),Math.round(i.top+l[1]),r,o]},ir=function(e){return Pe(e)&&e.value===$t.AUTO},sr=function(e){return"number"==typeof e},nr=function(e,t,A){var i=t[0],s=t[1],n=t[2],r=e[0],o=e[1];if(!r)return[0,0];if(qe(r)&&o&&qe(o))return[nt(r,A.width),nt(o,A.height)];var l=sr(n);if(Pe(r)&&(r.value===$t.CONTAIN||r.value===$t.COVER))return sr(n)?A.width/A.height<n!=(r.value===$t.COVER)?[A.width,A.width/n]:[A.height*n,A.height]:[A.width,A.height];var a=sr(i),d=sr(s),c=a||d;if(ir(r)&&(!o||ir(o)))return a&&d?[i,s]:l||c?c&&l?[a?i:s*n,d?s:i/n]:[a?i:A.width,d?s:A.height]:[A.width,A.height];if(l){var h=0,u=0;return qe(r)?h=nt(r,A.width):qe(o)&&(u=nt(o,A.height)),ir(r)?h=u*n:o&&!ir(o)||(u=h/n),[h,u]}var p=null,g=null;if(qe(r)?p=nt(r,A.width):o&&qe(o)&&(g=nt(o,A.height)),null===p||o&&!ir(o)||(g=a&&d?p/i*s:A.height),null!==g&&ir(r)&&(p=a&&d?g/s*i:A.width),null!==p&&null!==g)return[p,g];throw new Error("Unable to calculate background-size for element")},rr=function(e,t){var A=e[t];return void 0===A?e[0]:A},or=function(e,t,A,i,s){var n=t[0],r=t[1],o=A[0],l=A[1];switch(e){case 2:return[new _n(Math.round(i.left),Math.round(i.top+r)),new _n(Math.round(i.left+i.width),Math.round(i.top+r)),new _n(Math.round(i.left+i.width),Math.round(l+i.top+r)),new _n(Math.round(i.left),Math.round(l+i.top+r))];case 3:return[new _n(Math.round(i.left+n),Math.round(i.top)),new _n(Math.round(i.left+n+o),Math.round(i.top)),new _n(Math.round(i.left+n+o),Math.round(i.height+i.top)),new _n(Math.round(i.left+n),Math.round(i.height+i.top))];case 1:return[new _n(Math.round(i.left+n),Math.round(i.top+r)),new _n(Math.round(i.left+n+o),Math.round(i.top+r)),new _n(Math.round(i.left+n+o),Math.round(i.top+r+l)),new _n(Math.round(i.left+n),Math.round(i.top+r+l))];default:return[new _n(Math.round(s.left),Math.round(s.top)),new _n(Math.round(s.left+s.width),Math.round(s.top)),new _n(Math.round(s.left+s.width),Math.round(s.height+s.top)),new _n(Math.round(s.left),Math.round(s.height+s.top))]}},lr="Hidden Text",ar=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var A=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),n=this._document.body;A.style.visibility="hidden",A.style.fontFamily=e,A.style.fontSize=t,A.style.margin="0",A.style.padding="0",A.style.whiteSpace="nowrap",n.appendChild(A),i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(lr)),A.appendChild(s),A.appendChild(i);var r=i.offsetTop-s.offsetTop+2;A.removeChild(s),A.appendChild(this._document.createTextNode(lr)),A.style.lineHeight="normal",i.style.verticalAlign="super";var o=i.offsetTop-A.offsetTop+2;return n.removeChild(A),{baseline:r,middle:o}},e.prototype.getMetrics=function(e,t){var A=e+" "+t;return void 0===this._data[A]&&(this._data[A]=this.parseMetrics(e,t)),this._data[A]},e}(),dr=function(e,t){this.context=e,this.options=t},cr=function(e){function A(t,A){var i=e.call(this,t,A)||this;return i._activeEffects=[],i.canvas=A.canvas?A.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),A.canvas||(i.canvas.width=Math.floor(A.width*A.scale),i.canvas.height=Math.floor(A.height*A.scale),i.canvas.style.width=A.width+"px",i.canvas.style.height=A.height+"px"),i.fontMetrics=new ar(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-A.x,-A.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+A.width+"x"+A.height+") with scale "+A.scale),i}return t(A,e),A.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach((function(e){return t.applyEffect(e)}))},A.prototype.applyEffect=function(e){this.ctx.save(),function(e){return 2===e.type}(e)&&(this.ctx.globalAlpha=e.opacity),function(e){return 0===e.type}(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),Pn(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},A.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},A.prototype.renderStack=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},A.prototype.renderNode=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return ai(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},A.prototype.renderTextWithLetterSpacing=function(e,t,A){var i=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+A):Zi(e.text).reduce((function(t,s){return i.ctx.fillText(s,t,e.bounds.top+A),t+i.ctx.measureText(s).width}),e.bounds.left)},A.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),A=mr(e.fontFamily).join(", "),i=Ge(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,i,A].join(" "),A,i]},A.prototype.renderTextNode=function(e,t){return i(this,void 0,void 0,(function(){var A,i,n,r,o,l,a,d,c=this;return s(this,(function(s){return A=this.createFontStyle(t),i=A[0],n=A[1],r=A[2],this.ctx.font=i,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",o=this.fontMetrics.getMetrics(n,r),l=o.baseline,a=o.middle,d=t.paintOrder,e.textBounds.forEach((function(e){d.forEach((function(A){switch(A){case 0:c.ctx.fillStyle=pt(t.color),c.renderTextWithLetterSpacing(e,t.letterSpacing,l);var i=t.textShadow;i.length&&e.text.trim().length&&(i.slice(0).reverse().forEach((function(A){c.ctx.shadowColor=pt(A.color),c.ctx.shadowOffsetX=A.offsetX.number*c.options.scale,c.ctx.shadowOffsetY=A.offsetY.number*c.options.scale,c.ctx.shadowBlur=A.blur.number,c.renderTextWithLetterSpacing(e,t.letterSpacing,l)})),c.ctx.shadowColor="",c.ctx.shadowOffsetX=0,c.ctx.shadowOffsetY=0,c.ctx.shadowBlur=0),t.textDecorationLine.length&&(c.ctx.fillStyle=pt(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:c.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+l),e.bounds.width,1);break;case 2:c.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:c.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+a),e.bounds.width,1)}})));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(c.ctx.strokeStyle=pt(t.webkitTextStrokeColor),c.ctx.lineWidth=t.webkitTextStrokeWidth,c.ctx.lineJoin=window.chrome?"miter":"round",c.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+l)),c.ctx.strokeStyle="",c.ctx.lineWidth=0,c.ctx.lineJoin="miter"}}))})),[2]}))}))},A.prototype.renderReplacedElement=function(e,t,A){if(A&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var i=tr(e),s=$n(t);this.path(s),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(A,0,0,e.intrinsicWidth,e.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},A.prototype.renderNodeContent=function(e){return i(this,void 0,void 0,(function(){var t,i,n,o,l,a,d,c,h,u,p,g,m,f,w,B,y,b;return s(this,(function(s){switch(s.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,i=e.curves,n=t.styles,o=0,l=t.textNodes,s.label=1;case 1:return o<l.length?(a=l[o],[4,this.renderTextNode(a,n)]):[3,4];case 2:s.sent(),s.label=3;case 3:return o++,[3,1];case 4:if(!(t instanceof rs))return[3,8];s.label=5;case 5:return s.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return w=s.sent(),this.renderReplacedElement(t,i,w),[3,8];case 7:return s.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof os&&this.renderReplacedElement(t,i,t.canvas),!(t instanceof ls))return[3,12];s.label=9;case 9:return s.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return w=s.sent(),this.renderReplacedElement(t,i,w),[3,12];case 11:return s.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof ys&&t.tree?[4,new A(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:d=s.sent(),t.width&&t.height&&this.ctx.drawImage(d,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),s.label=14;case 14:if(t instanceof fs&&(c=Math.min(t.bounds.width,t.bounds.height),t.type===us?t.checked&&(this.ctx.save(),this.path([new _n(t.bounds.left+.39363*c,t.bounds.top+.79*c),new _n(t.bounds.left+.16*c,t.bounds.top+.5549*c),new _n(t.bounds.left+.27347*c,t.bounds.top+.44071*c),new _n(t.bounds.left+.39694*c,t.bounds.top+.5649*c),new _n(t.bounds.left+.72983*c,t.bounds.top+.23*c),new _n(t.bounds.left+.84*c,t.bounds.top+.34085*c),new _n(t.bounds.left+.39363*c,t.bounds.top+.79*c)]),this.ctx.fillStyle=pt(ms),this.ctx.fill(),this.ctx.restore()):t.type===ps&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+c/2,t.bounds.top+c/2,c/4,0,2*Math.PI,!0),this.ctx.fillStyle=pt(ms),this.ctx.fill(),this.ctx.restore())),hr(t)&&t.value.length){switch(h=this.createFontStyle(n),y=h[0],u=h[1],p=this.fontMetrics.getMetrics(y,u).baseline,this.ctx.font=y,this.ctx.fillStyle=pt(n.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=pr(t.styles.textAlign),b=tr(t),g=0,t.styles.textAlign){case 1:g+=b.width/2;break;case 2:g+=b.width}m=b.add(g,0,0,-b.height/2+1),this.ctx.save(),this.path([new _n(b.left,b.top),new _n(b.left+b.width,b.top),new _n(b.left+b.width,b.top+b.height),new _n(b.left,b.top+b.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Xi(t.value,m),n.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ai(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if(0!==(f=t.styles.listStyleImage).type)return[3,18];w=void 0,B=f.url,s.label=15;case 15:return s.trys.push([15,17,,18]),[4,this.context.cache.match(B)];case 16:return w=s.sent(),this.ctx.drawImage(w,t.bounds.left-(w.width+10),t.bounds.top),[3,18];case 17:return s.sent(),this.context.logger.error("Error loading list-style-image "+B),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==t.styles.listStyleType&&(y=this.createFontStyle(n)[0],this.ctx.font=y,this.ctx.fillStyle=pt(n.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",b=new r(t.bounds.left,t.bounds.top+nt(t.styles.paddingTop,t.bounds.width),t.bounds.width,FA(n.lineHeight,n.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Xi(e.listValue,b),n.letterSpacing,FA(n.lineHeight,n.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),s.label=20;case 20:return[2]}}))}))},A.prototype.renderStackContent=function(e){return i(this,void 0,void 0,(function(){var t,A,i,n,r,o,l,a,d,c,h,u,p,g,m;return s(this,(function(s){switch(s.label){case 0:return ai(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:s.sent(),t=0,A=e.negativeZIndex,s.label=2;case 2:return t<A.length?(m=A[t],[4,this.renderStack(m)]):[3,5];case 3:s.sent(),s.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:s.sent(),i=0,n=e.nonInlineLevel,s.label=7;case 7:return i<n.length?(m=n[i],[4,this.renderNode(m)]):[3,10];case 8:s.sent(),s.label=9;case 9:return i++,[3,7];case 10:r=0,o=e.nonPositionedFloats,s.label=11;case 11:return r<o.length?(m=o[r],[4,this.renderStack(m)]):[3,14];case 12:s.sent(),s.label=13;case 13:return r++,[3,11];case 14:l=0,a=e.nonPositionedInlineLevel,s.label=15;case 15:return l<a.length?(m=a[l],[4,this.renderStack(m)]):[3,18];case 16:s.sent(),s.label=17;case 17:return l++,[3,15];case 18:d=0,c=e.inlineLevel,s.label=19;case 19:return d<c.length?(m=c[d],[4,this.renderNode(m)]):[3,22];case 20:s.sent(),s.label=21;case 21:return d++,[3,19];case 22:h=0,u=e.zeroOrAutoZIndexOrTransformedOrOpacity,s.label=23;case 23:return h<u.length?(m=u[h],[4,this.renderStack(m)]):[3,26];case 24:s.sent(),s.label=25;case 25:return h++,[3,23];case 26:p=0,g=e.positiveZIndex,s.label=27;case 27:return p<g.length?(m=g[p],[4,this.renderStack(m)]):[3,30];case 28:s.sent(),s.label=29;case 29:return p++,[3,27];case 30:return[2]}}))}))},A.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},A.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},A.prototype.formatPath=function(e){var t=this;e.forEach((function(e,A){var i=Mn(e)?e.start:e;0===A?t.ctx.moveTo(i.x,i.y):t.ctx.lineTo(i.x,i.y),Mn(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},A.prototype.renderRepeat=function(e,t,A,i){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(A,i),this.ctx.fill(),this.ctx.translate(-A,-i)},A.prototype.resizeImage=function(e,t,A){var i;if(e.width===t&&e.height===A)return e;var s=(null!==(i=this.canvas.ownerDocument)&&void 0!==i?i:document).createElement("canvas");return s.width=Math.max(1,t),s.height=Math.max(1,A),s.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,A),s},A.prototype.renderBackgroundImage=function(e){return i(this,void 0,void 0,(function(){var t,A,i,n,r,o;return s(this,(function(l){switch(l.label){case 0:t=e.styles.backgroundImage.length-1,A=function(A){var n,r,o,l,a,d,c,h,u,p,g,m,f,w,B,y,b,v,C,x,Q,F,U,E,k,I,H,S,T,_,D;return s(this,(function(s){switch(s.label){case 0:if(0!==A.type)return[3,5];n=void 0,r=A.url,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,i.context.cache.match(r)];case 2:return n=s.sent(),[3,4];case 3:return s.sent(),i.context.logger.error("Error loading background-image "+r),[3,4];case 4:return n&&(o=Ar(e,t,[n.width,n.height,n.width/n.height]),y=o[0],F=o[1],U=o[2],C=o[3],x=o[4],w=i.ctx.createPattern(i.resizeImage(n,C,x),"repeat"),i.renderRepeat(y,w,F,U)),[3,6];case 5:1===A.type?(l=Ar(e,t,[null,null,null]),y=l[0],F=l[1],U=l[2],C=l[3],x=l[4],a=Ut(A.angle,C,x),d=a[0],c=a[1],h=a[2],u=a[3],p=a[4],(g=document.createElement("canvas")).width=C,g.height=x,m=g.getContext("2d"),f=m.createLinearGradient(c,u,h,p),Ft(A.stops,d).forEach((function(e){return f.addColorStop(e.stop,pt(e.color))})),m.fillStyle=f,m.fillRect(0,0,C,x),C>0&&x>0&&(w=i.ctx.createPattern(g,"repeat"),i.renderRepeat(y,w,F,U))):function(e){return 2===e.type}(A)&&(B=Ar(e,t,[null,null,null]),y=B[0],b=B[1],v=B[2],C=B[3],x=B[4],Q=0===A.position.length?[At]:A.position,F=nt(Q[0],C),U=nt(Q[Q.length-1],x),E=function(e,t,A,i,s){var n=0,r=0;switch(e.size){case 0:0===e.shape?n=r=Math.min(Math.abs(t),Math.abs(t-i),Math.abs(A),Math.abs(A-s)):1===e.shape&&(n=Math.min(Math.abs(t),Math.abs(t-i)),r=Math.min(Math.abs(A),Math.abs(A-s)));break;case 2:if(0===e.shape)n=r=Math.min(Et(t,A),Et(t,A-s),Et(t-i,A),Et(t-i,A-s));else if(1===e.shape){var o=Math.min(Math.abs(A),Math.abs(A-s))/Math.min(Math.abs(t),Math.abs(t-i)),l=kt(i,s,t,A,!0),a=l[0],d=l[1];r=o*(n=Et(a-t,(d-A)/o))}break;case 1:0===e.shape?n=r=Math.max(Math.abs(t),Math.abs(t-i),Math.abs(A),Math.abs(A-s)):1===e.shape&&(n=Math.max(Math.abs(t),Math.abs(t-i)),r=Math.max(Math.abs(A),Math.abs(A-s)));break;case 3:if(0===e.shape)n=r=Math.max(Et(t,A),Et(t,A-s),Et(t-i,A),Et(t-i,A-s));else if(1===e.shape){o=Math.max(Math.abs(A),Math.abs(A-s))/Math.max(Math.abs(t),Math.abs(t-i));var c=kt(i,s,t,A,!1);a=c[0],d=c[1],r=o*(n=Et(a-t,(d-A)/o))}}return Array.isArray(e.size)&&(n=nt(e.size[0],i),r=2===e.size.length?nt(e.size[1],s):n),[n,r]}(A,F,U,C,x),k=E[0],I=E[1],k>0&&I>0&&(H=i.ctx.createRadialGradient(b+F,v+U,0,b+F,v+U,k),Ft(A.stops,2*k).forEach((function(e){return H.addColorStop(e.stop,pt(e.color))})),i.path(y),i.ctx.fillStyle=H,k!==I?(S=e.bounds.left+.5*e.bounds.width,T=e.bounds.top+.5*e.bounds.height,D=1/(_=I/k),i.ctx.save(),i.ctx.translate(S,T),i.ctx.transform(1,0,0,_,0,0),i.ctx.translate(-S,-T),i.ctx.fillRect(b,D*(v-T)+T,C,x*D),i.ctx.restore()):i.ctx.fill())),s.label=6;case 6:return t--,[2]}}))},i=this,n=0,r=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return n<r.length?(o=r[n],[5,A(o)]):[3,4];case 2:l.sent(),l.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},A.prototype.renderSolidBorder=function(e,t,A){return i(this,void 0,void 0,(function(){return s(this,(function(i){return this.path(Jn(A,t)),this.ctx.fillStyle=pt(e),this.ctx.fill(),[2]}))}))},A.prototype.renderDoubleBorder=function(e,t,A,n){return i(this,void 0,void 0,(function(){var i,r;return s(this,(function(s){switch(s.label){case 0:return t<3?[4,this.renderSolidBorder(e,A,n)]:[3,2];case 1:return s.sent(),[2];case 2:return i=function(e,t){switch(t){case 0:return qn(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return qn(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return qn(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return qn(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}}(n,A),this.path(i),this.ctx.fillStyle=pt(e),this.ctx.fill(),r=function(e,t){switch(t){case 0:return qn(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return qn(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return qn(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return qn(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}}(n,A),this.path(r),this.ctx.fill(),[2]}}))}))},A.prototype.renderNodeBackgroundAndBorders=function(e){return i(this,void 0,void 0,(function(){var t,A,i,n,r,o,l,a,d=this;return s(this,(function(s){switch(s.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,A=!ut(t.backgroundColor)||t.backgroundImage.length,i=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],n=ur(rr(t.backgroundClip,0),e.curves),A||t.boxShadow.length?(this.ctx.save(),this.path(n),this.ctx.clip(),ut(t.backgroundColor)||(this.ctx.fillStyle=pt(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:s.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){d.ctx.save();var A,i,s,n,r,o=Kn(e.curves),l=t.inset?0:1e4,a=(A=o,i=-l+(t.inset?1:-1)*t.spread.number,s=(t.inset?1:-1)*t.spread.number,n=t.spread.number*(t.inset?-2:2),r=t.spread.number*(t.inset?-2:2),A.map((function(e,t){switch(t){case 0:return e.add(i,s);case 1:return e.add(i+n,s);case 2:return e.add(i+n,s+r);case 3:return e.add(i,s+r)}return e})));t.inset?(d.path(o),d.ctx.clip(),d.mask(a)):(d.mask(o),d.ctx.clip(),d.path(a)),d.ctx.shadowOffsetX=t.offsetX.number+l,d.ctx.shadowOffsetY=t.offsetY.number,d.ctx.shadowColor=pt(t.color),d.ctx.shadowBlur=t.blur.number,d.ctx.fillStyle=t.inset?pt(t.color):"rgba(0,0,0,1)",d.ctx.fill(),d.ctx.restore()})),s.label=2;case 2:r=0,o=0,l=i,s.label=3;case 3:return o<l.length?0!==(a=l[o]).style&&!ut(a.color)&&a.width>0?2!==a.style?[3,5]:[4,this.renderDashedDottedBorder(a.color,a.width,r,e.curves,2)]:[3,11]:[3,13];case 4:return s.sent(),[3,11];case 5:return 3!==a.style?[3,7]:[4,this.renderDashedDottedBorder(a.color,a.width,r,e.curves,3)];case 6:return s.sent(),[3,11];case 7:return 4!==a.style?[3,9]:[4,this.renderDoubleBorder(a.color,a.width,r,e.curves)];case 8:return s.sent(),[3,11];case 9:return[4,this.renderSolidBorder(a.color,r,e.curves)];case 10:s.sent(),s.label=11;case 11:r++,s.label=12;case 12:return o++,[3,3];case 13:return[2]}}))}))},A.prototype.renderDashedDottedBorder=function(e,t,A,n,r){return i(this,void 0,void 0,(function(){var i,o,l,a,d,c,h,u,p,g,m,f,w,B,y,b;return s(this,(function(s){return this.ctx.save(),i=function(e,t){switch(t){case 0:return Zn(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return Zn(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return Zn(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return Zn(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}}(n,A),o=Jn(n,A),2===r&&(this.path(o),this.ctx.clip()),Mn(o[0])?(l=o[0].start.x,a=o[0].start.y):(l=o[0].x,a=o[0].y),Mn(o[1])?(d=o[1].end.x,c=o[1].end.y):(d=o[1].x,c=o[1].y),h=0===A||2===A?Math.abs(l-d):Math.abs(a-c),this.ctx.beginPath(),3===r?this.formatPath(i):this.formatPath(o.slice(0,2)),u=t<3?3*t:2*t,p=t<3?2*t:t,3===r&&(u=t,p=t),g=!0,h<=2*u?g=!1:h<=2*u+p?(u*=m=h/(2*u+p),p*=m):(f=Math.floor((h+p)/(u+p)),w=(h-f*u)/(f-1),p=(B=(h-(f+1)*u)/f)<=0||Math.abs(p-w)<Math.abs(p-B)?w:B),g&&(3===r?this.ctx.setLineDash([0,u+p]):this.ctx.setLineDash([u,p])),3===r?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=pt(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===r&&(Mn(o[0])&&(y=o[3],b=o[0],this.ctx.beginPath(),this.formatPath([new _n(y.end.x,y.end.y),new _n(b.start.x,b.start.y)]),this.ctx.stroke()),Mn(o[1])&&(y=o[1],b=o[2],this.ctx.beginPath(),this.formatPath([new _n(y.end.x,y.end.y),new _n(b.start.x,b.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},A.prototype.render=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=pt(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),i=new Wn(e,null),s=new jn(i),Xn(i,s,s,n=[]),Yn(i.container,n),t=s,[4,this.renderStack(t)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}var i,s,n}))}))},A}(dr),hr=function(e){return e instanceof Bs||e instanceof ws||e instanceof fs&&e.type!==ps&&e.type!==us},ur=function(e,t){switch(e){case 0:return Kn(t);case 2:return function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]}(t);default:return $n(t)}},pr=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},gr=["-apple-system","system-ui"],mr=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter((function(e){return-1===gr.indexOf(e)})):e},fr=function(e){function A(t,A){var i=e.call(this,t,A)||this;return i.canvas=A.canvas?A.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=A,i.canvas.width=Math.floor(A.width*A.scale),i.canvas.height=Math.floor(A.height*A.scale),i.canvas.style.width=A.width+"px",i.canvas.style.height=A.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-A.x,-A.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+A.width+"x"+A.height+" at "+A.x+","+A.y+") with scale "+A.scale),i}return t(A,e),A.prototype.render=function(e){return i(this,void 0,void 0,(function(){var t,A;return s(this,(function(i){switch(i.label){case 0:return t=Vi(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,wr(t)];case 1:return A=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=pt(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(A,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},A}(dr),wr=function(e){return new Promise((function(t,A){var i=new Image;i.onload=function(){t(i)},i.onerror=A,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Br=function(){function e(e){var t=e.id,A=e.enabled;this.id=t,this.enabled=A,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,n([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,n([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,n([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,n([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),yr=function(){function e(t,A){var i;this.windowBounds=A,this.instanceName="#"+e.instanceCount++,this.logger=new Br({id:this.instanceName,enabled:t.logging}),this.cache=null!==(i=t.cache)&&void 0!==i?i:new Qn(this,t)}return e.instanceCount=1,e}();"undefined"!=typeof window&&xn.setContext(window);var br=function(e,t){return i(void 0,void 0,void 0,(function(){var i,n,l,a,d,c,h,u,p,g,m,f,w,B,y,b,v,C,x,Q,F,U,E,k,I,H,S,T,_,D,L,M,O,R,K,$,N,G;return s(this,(function(s){switch(s.label){case 0:if(!e||"object"!=typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(i=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(n=i.defaultView))throw new Error("Document is not attached to a Window");return l={allowTaint:null!==(U=t.allowTaint)&&void 0!==U&&U,imageTimeout:null!==(E=t.imageTimeout)&&void 0!==E?E:15e3,proxy:t.proxy,useCORS:null!==(k=t.useCORS)&&void 0!==k&&k},a=A({logging:null===(I=t.logging)||void 0===I||I,cache:t.cache},l),d={windowWidth:null!==(H=t.windowWidth)&&void 0!==H?H:n.innerWidth,windowHeight:null!==(S=t.windowHeight)&&void 0!==S?S:n.innerHeight,scrollX:null!==(T=t.scrollX)&&void 0!==T?T:n.pageXOffset,scrollY:null!==(_=t.scrollY)&&void 0!==_?_:n.pageYOffset},c=new r(d.scrollX,d.scrollY,d.windowWidth,d.windowHeight),h=new yr(a,c),u=null!==(D=t.foreignObjectRendering)&&void 0!==D&&D,p={allowTaint:null!==(L=t.allowTaint)&&void 0!==L&&L,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:u,copyStyles:u},h.logger.debug("Starting document clone with size "+c.width+"x"+c.height+" scrolled to "+-c.left+","+-c.top),g=new ln(h,e,p),(m=g.clonedReferenceElement)?[4,g.toIFrame(i,c)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return f=s.sent(),w=Ds(m)||"HTML"===m.tagName?function(e){var t=e.body,A=e.documentElement;if(!t||!A)throw new Error("Unable to get document size");var i=Math.max(Math.max(t.scrollWidth,A.scrollWidth),Math.max(t.offsetWidth,A.offsetWidth),Math.max(t.clientWidth,A.clientWidth)),s=Math.max(Math.max(t.scrollHeight,A.scrollHeight),Math.max(t.offsetHeight,A.offsetHeight),Math.max(t.clientHeight,A.clientHeight));return new r(0,0,i,s)}(m.ownerDocument):o(h,m),B=w.width,y=w.height,b=w.left,v=w.top,C=vr(h,m,t.backgroundColor),x={canvas:t.canvas,backgroundColor:C,scale:null!==(O=null!==(M=t.scale)&&void 0!==M?M:n.devicePixelRatio)&&void 0!==O?O:1,x:(null!==(R=t.x)&&void 0!==R?R:0)+b,y:(null!==(K=t.y)&&void 0!==K?K:0)+v,width:null!==($=t.width)&&void 0!==$?$:Math.ceil(B),height:null!==(N=t.height)&&void 0!==N?N:Math.ceil(y)},u?(h.logger.debug("Document cloned, using foreign object rendering"),[4,new fr(h,x).render(m)]):[3,3];case 2:return Q=s.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+b+","+v+" with size "+B+"x"+y+" using computed rendering"),h.logger.debug("Starting DOM parsing"),F=xs(h,m),C===F.styles.backgroundColor&&(F.styles.backgroundColor=vt.TRANSPARENT),h.logger.debug("Starting renderer for element at "+x.x+","+x.y+" with size "+x.width+"x"+x.height),[4,new cr(h,x).render(F)];case 4:Q=s.sent(),s.label=5;case 5:return(null===(G=t.removeContainer)||void 0===G||G)&&(ln.destroy(f)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,Q]}}))}))},vr=function(e,t,A){var i=t.ownerDocument,s=i.documentElement?bt(e,getComputedStyle(i.documentElement).backgroundColor):vt.TRANSPARENT,n=i.body?bt(e,getComputedStyle(i.body).backgroundColor):vt.TRANSPARENT,r="string"==typeof A?bt(e,A):null===A?vt.TRANSPARENT:4294967295;return t===i.documentElement?ut(s)?ut(n)?r:n:s:r};return function(e,t){return void 0===t&&(t={}),br(e,t)}}()},402:(e,t,A)=>{"use strict";A.d(t,{A:()=>i});const i=new(A(675).Yw)({name:"EditorWindow",panels:[{type:"top",size:30,resizable:!1,content:"top",html:'<div style="padding: 10px;">Top</div>'},{type:"main",content:"main",html:'<div style="padding: 10px;">Main</div>'},{type:"bottom",size:30,resizable:!1,content:"bottom",html:'<div style="padding: 10px;">Bottom</div>'},{type:"left",size:200,resizable:!0,content:"left",html:'<div style="padding: 10px;">Left</div>'},{type:"right",size:200,resizable:!0,content:"right",html:'<div style="padding: 10px;">Right</div>'},{type:"preview",size:200,resizable:!0,content:"preview",html:'<div style="padding: 10px;">Preview</div>'}]})},840:(e,t,A)=>{"use strict";A.d(t,{A:()=>iA});var i=A(675);let s=[{field:"hp",type:"int",html:{label:"HP",attr:"",column:1}},{field:"str",type:"int",html:{label:"Strength",attr:"",column:1}},{field:"mag",type:"int",html:{label:"Magic",attr:"",column:1}},{field:"skl",type:"int",html:{label:"Skill",attr:"",column:1}},{field:"spd",type:"int",html:{label:"Speed",attr:"",column:1}},{field:"def",type:"int",html:{label:"Defense",attr:"",column:1}},{field:"res",type:"int",html:{label:"Resistance",attr:"",column:1}},{field:"mov",type:"int",html:{label:"Movement",attr:"",column:1}}];window.statsUseExtraStatWeight&&(s.push({field:"weight",type:"int",html:{label:"Weight",attr:"",column:1}}),s.push({field:"con",type:"int",html:{label:"Constitution",attr:"",column:1}})),window.statsUseExtraStatCharm&&s.push({field:"cha",type:"int",html:{label:"Charisma",attr:"",column:1}}),window.statsUseExtraStatLuck&&s.push({field:"lck",type:"int",html:{label:"Luck",attr:"",column:1}}),window.statsUseExtraStatAuthority&&s.push({field:"authority",type:"int",html:{label:"Authority",attr:"",column:1}}),window.globalStats=s;const n=s;let r=[];n.forEach((e=>{r.push(e.field)}));let o=0;const l={Avatar:{show:["orientation","canSSupport","canHaveChildren","height","birthdayDay","birthdayMonth","age","useAccentColors","growth-rates","base-stats-header"],hide:["canRecruit","isUnique","randomize-base-stats"],disable:["canSSupport"],enable:[],toolbarShow:["unit-editor-bottom-toolbar-relationship"]},NPC:{hide:["orientation","canSSupport","canHaveChildren","canRecruit","growth-rates","accentColor1","accentColor2","base-stats-header","randomize-base-stats","useAccentColors","height","birthdayDay","birthdayMonth","age"],show:["isUnique"],enable:[],disable:[],toolbarShow:[]},Friend:{show:["orientation","canSSupport","canHaveChildren","canRecruit","growth-rates","useAccentColors","base-stats-header","height","birthdayDay","birthdayMonth","randomize-base-stats","age","isUnique"],enable:["canSSupport"],hide:[],disable:[],toolbarShow:["unit-editor-bottom-toolbar-relationship","unit-editor-bottom-toolbar-behavior"]},Enemy:{hide:["canSSupport","orientation","canHaveChildren","growth-rates","height","birthdayDay","birthdayMonth","age"],enable:[],disable:[],show:["canRecruit","useAccentColors","randomize-base-stats","isUnique"],toolbarShow:["unit-editor-bottom-toolbar-behavior"]}};function a(e,t){["show","hide","enable","disable"].forEach((A=>{(t[A]||[]).forEach((t=>e[A](t)))})),n.forEach(((A,i)=>{e[t.hide.includes(A.field)?"hide":"show"](A.field)}));let A=i.GB["unit-editor-bottom-toolbar"];A.hide("unit-editor-bottom-toolbar-relationship"),A.hide("unit-editor-bottom-toolbar-behavior"),A.show("unit-editor-bottom-toolbar-basic"),t.toolbarShow.forEach((e=>A.show(e))),A.refresh()}const d=(e,t,A=!1)=>{let s=t.detail.field,n=t.detail.value;if(window.allUnits&&window.allUnits.forEach((e=>{"avatar"===e.which&&o++})),"name"===s){if(0===n.current.length)return n.current=n.previous,window.unitEditorBasicFields.record.name=n.previous,window.unitEditorBasicFields.refresh(),(0,i.mJ)("Name cannot be empty");window.UnitEditorLeftSidebar&&window.UnitEditorLeftSidebar.nodes.forEach((t=>{t.id===e.record.id&&(t.text=n.current+" "+e.record.id),window.UnitEditorLeftSidebar.refresh()}))}else if("useAccentColors"===s)!0===n.current?(e.show("accentColor1"),e.show("accentColor2")):(e.hide("accentColor1"),e.hide("accentColor2"));else if(r.includes(s)&&"mov"!==s){let t=i.GB["unit-editor-basic-fields"].get("base-stats-balance").el,A=0;r.forEach((t=>{A+=e.getValue(t)}));let s=function(e,t,A,i,s){return 180*(e-t)/(A-t)+0}(A,5.8*r.length,9.1*r.length)-90;t.querySelector(".balanceMeterNeedle").style.transform=`rotate(${s}deg)`,t.querySelector(".balanceMeterNeedle").style.opacity="1"}else if("canRecruit"===s)!0===n.current&&!1===e.get("isUnique").el.checked&&(e.setValue("isUnique",!0),e.record.isUnique=!0,(0,i.mJ)('A recruitable unit must be unique. The "isUnique" checkbox has been checked.'),e.show("randomize-base-stats"));else if("isUnique"===s&&!1===n.current&&!0===e.get("canRecruit").el.checked)!0===e.get("canRecruit").el.checked&&(e.setValue("canRecruit",!1),e.record.canRecruit=!1,(0,i.mJ)('A recruitable unit must be unique. The "canRecruit" checkbox has been unchecked.'),e.hide("randomize-base-stats"));else if("isUnique"===s)!0===n.current?e.hide("randomize-base-stats"):e.show("randomize-base-stats");else if("subtype"===s){if(e.lock("",!0),A)return a(e,l[n.current]),"Enemy"===n.current&&!0===e.record.canRecruit&&i.GB["unit-editor-bottom-toolbar"].show("unit-editor-bottom-toolbar-relationship"),void e.unlock();"Avatar"===n.current&&o>0?e.message({body:'<div class="w2ui-centered">You already have an Avatar unit. You cannot create another.</div>',width:400,height:200,actions:{OK(){e.setValue("subtype",n.previous),e.unlock(),e.message()}}}):e.message({body:'<div class="w2ui-centered">Do you want to change the subtype? This will significantly alter your unit.</div>',width:400,height:200,actions:{Yes(){"Avatar"===n.previous&&"Avatar"!==n.current&&o--,a(e,l[n.current]),e.unlock(),e.message()},No(){e.setValue("subtype",n.previous),e.record.subtype=n.previous,e.unlock(),e.message(),e.refresh()}}})}window.updateQueue("Person","updatePerson",e.record)};window.w2popup=i.yN;let c={},h={};const u=e=>{Object.keys(c).forEach((t=>{h[t]=0,e.record["baseStatsGrowthAmount"+t]=h[t]})),document.querySelectorAll(".baseStatGrowthNumberInput").forEach((e=>{e.value=0}))},p=(e,t,A)=>{h[e]=parseInt(t),A.record["baseStatsGrowthAmount"+e]=h[e]},g=(e,t)=>{c={...e},Object.keys(e).forEach((e=>{h[e]="hp"===e?100:0,t.record["baseStatsGrowthAmount"+e]=h[e]})),window.UnitEditorBaseStatGrowthChange=p,window.UnitEditorBaseStatGrowthReset=u,window.UnitEditorBaseStatGrowthPopup=g;let A=`\n    <h2>Set Stat Growths</h2>\n    <p>Set the growths for each stat. Each growth is the % chance that the stat will increase on level up- for example, a growth of 50 on a base stat Strength would mean a 50% chance that Strength will increase on level up.</p>\n    <table>\n        <tr>\n            <th>Stat</th>\n            <th>Original</th>\n            <th>Growth</th>\n        </tr>\n        ${Object.keys(e).map((t=>`\n            <tr>\n                <td>${t}</td>\n                <td>${e[t]}</td>\n                <td><input type="number" class="w2ui-input baseStatGrowthNumberInput" min="0" max="100" value="${h[t]}" onchange="window.UnitEditorBaseStatGrowthChange('${t}', this.value, window.unitEditorBasicFields)"></td>\n            </tr>\n            `)).join("")}\n        </table>\n    `;i.yN.open({body:A,width:700,height:540,showMax:!1,showClose:!1,modal:!1,actions:["Ok","Reset"]}).ok((e=>{i.yN.close()})).reset((e=>{u(t)}))},m=g;window.w2popup=i.yN;let f={},B={};const y=e=>{Object.keys(f).forEach((t=>{B[t]=0,e.record["baseStatsRandomizedAmount"+t]=B[t]})),document.querySelectorAll(".baseStatRandomizerNumberInput").forEach((e=>{e.value=0}))};window.UnitEditorBaseStatRandomizerChangeVariance=(e,t,A)=>{B[e]=parseInt(t),A.record["baseStatsRandomizedAmount"+e]=B[e]},window.UnitEditorBaseStatRandomizerDisableStatRandomization=(e,t)=>{t.record["baseStatsRandomizedEnabled"+e]=!t.record["baseStatsRandomizedEnabled"+e]},window.UnitEditorBaseStatRandomizerResetVariances=y;let b=((e,t,A,i)=>{let s=document.createElement("div");s.innerHTML='\n<div class="balanceMeterCircle">\n<div class="balanceMeterNeedle"></div>\n</div>\n</div>\n</div>\n';let n=document.createElement("style");n.innerHTML="\n.balanceMeterCircle {\n    height: 90px;\n    width: 180px;\n    background-size: 100% 100%;\n    background-position: 0px 0px;\n    background-color: var(--slider-0);\n    border-radius: 999rem 999rem 0rem 0rem;\n    mask-image: radial-gradient(circle at 50% 100%, transparent 40%, black 40%);\n    position:relative;\n}\n.balanceMeterNeedle{\n    height:100%;\n    position:absolute;\n    width:6px;\n    background-color:var(--node-title);\n    z-index:1492;\n    left:calc(50% - 3px);\n    transform-origin:bottom;\n    transition:all .25s ease-out;\n}\n",s.appendChild(n),s.querySelector(".balanceMeterNeedle").style.transform="rotate(0deg)",s.querySelector(".balanceMeterNeedle").style.opacity="0";let r=document.createElement("h3");r.innerText="Edit base stats to see balance";let o=document.createElement("p");return o.style.maxWidth="40ch",r.style.maxWidth="40ch",o.innerHTML="<small>Compares your base stat total against two existing-game examples.<br/>The left side is a bit lower than the avatar's base stats in <em>Fire Emblem: Awakening</em>, and the right side is a bit higher than the avatar's base stats in <em>Fire Emblem: Three Houses</em>. Most units should probably fall somewhere in between.<br/><br/>Mov is not included in the total</small>",s.appendChild(r),s.appendChild(o),s})(0,n.length);window.UnitEditorGlobalStats=n,window.unitEditorHandleStatsGrowthPopup=(e,t)=>{let A={};e.forEach((e=>{A[e.field]=t.record[e.field]})),m(A,t)},window.handleBaseStatRandomizerPopup=(e,t)=>{let A={};e.forEach((e=>{A[e.field]=t.record[e.field]})),((e,t)=>{f={...e},Object.keys(e).forEach((e=>{B[e]=0,t.record["baseStatsRandomizedEnabled"+e]=!0,t.record["baseStatsRandomizedAmount"+e]=B[e]}));let A=`\n    <h2>Randomize Base Stats</h2>\n    <p>When a non-unique unit is spawned, set the random variance for the base stats. Each variance is the min/max the stat could be increased by- for example, a variance of 3 on a base stat HP at 25 would mean a random spawn could have between 22-28 HP.</p>\n    <table>\n        <tr>\n            <th>Stat</th>\n            <th>Original</th>\n            <th>Randomized</th>\n            <th>Enabled</th>\n        </tr>\n        ${Object.keys(e).map((t=>`\n            <tr>\n                <td>${t}</td>\n                <td>${e[t]}</td>\n                <td><input type="number" class="w2ui-input baseStatRandomizerNumberInput" min="0" max="${Math.floor(e[t]/2)}" value="${B[t]}" onchange="UnitEditorBaseStatRandomizerChangeVariance('${t}', this.value, window.unitEditorBasicFields)"></td>\n                <td><input type="checkbox" checked onchange="UnitEditorBaseStatRandomizerDisableStatRandomization('${t}', window.unitEditorBasicFields)"></td>\n            </tr>\n            `)).join("")}\n        </table>\n    `;i.yN.open({body:A,width:700,height:550,showMax:!1,showClose:!1,modal:!1,actions:["Ok","Reset"]}).ok((e=>{i.yN.close()})).reset((e=>{y(t)}))})(A,t)};let v={name:"unit-editor-basic-fields",record:{id:"",name:"New Unit",fullName:"New Unit",title:"",pronouns:"they/them/their/theirs",subtype:"Avatar",notes:"",age:18,canSSupport:!0,canHaveChildren:!0,height:168,birthdayDay:1,birthdayMonth:1,shortBio:"",useAccentColors:!1},fields:[{field:"",type:"html",html:{html:"<h2>Basic Info</h2>",column:0}},{field:"id",type:"text",html:{label:"ID",attr:"readonly",column:0},hidden:!0},{field:"name",type:"text",html:{label:"Familiar name",attr:"",column:0}},{field:"fullName",type:"text",html:{label:"Full name",attr:"",column:0}},{field:"title",type:"text",html:{label:"Title",attr:"",column:0}},{type:"html",html:{html:'<small>A unit can have a title, familiar name, and full name. A unit could have "sir" as the title, "Fernand" as the familiar name, and "Sir Fernand van Ageer" as the full name. <strong>Many units, like "Rogue" or "Thief", will only need a familiar name.</strong></small>'}},{field:"pronouns",type:"select",html:{label:"Pronouns",attr:"",column:0},options:{items:["he/him/his/his","she/her/her/hers","they/them/their/theirs"]}},{field:"subtype",type:"radio",html:{label:"Subtype",attr:'style="max-width:200px;"',column:0},options:{items:["Avatar","NPC","Friend","Enemy"]}},{field:"age",type:"int",options:{min:0},html:{label:"Age",column:0}},{field:"canSSupport",type:"checkbox",disabled:!1,html:{label:"Can S-Support",column:0}},{field:"canHaveChildren",type:"checkbox",html:{label:"Can have children",column:0}},{field:"isUnique",type:"checkbox",hidden:!0,html:{label:"Unique (only one of this unit can exist in the game)",column:0}},{field:"canRecruit",type:"checkbox",hidden:!0,html:{label:"Can be recruited to join player's team",column:0}},{field:"height",type:"int",options:{min:32,max:214},html:{label:"Height (cm)",column:0}},{field:"base-stats-header",type:"html",html:{class:"no-label",html:"<h2>Base Stats</h2>",column:1}},{field:"birthdayDay",type:"int",options:{min:1,max:31},html:{label:"Birthday Day",column:0}},{field:"birthdayMonth",type:"int",options:{min:1,max:12},html:{label:"Birthday Month",column:0}}]};n.forEach(((e,t)=>{"hp"===e.field?(v.fields.push({field:e.field,type:"int",options:{min:1,value:20},html:{label:e.html.label,attr:'style="width:2rem"',column:1}}),v.record[e.field]=20):(v.fields.push({field:e.field,type:"int",options:{min:0,value:5},html:{label:e.html.label,attr:'style="width:2rem"',column:1}}),v.record[e.field]=5)})),v.fields.push({type:"html",field:"base-stats-balance",html:{class:"no-label",html:b.innerHTML,column:1,attr:'style="width:100%;margin-top:.5rem"'}}),v.fields.push({type:"html",field:"growth-rates",class:"no-label",html:{class:"no-label",html:"<button id='growth-rates-button' onclick='window.unitEditorHandleStatsGrowthPopup(window.UnitEditorGlobalStats, window.unitEditorBasicFields)' class='w2ui-btn'>Growth Rates</button>",column:1,attr:'style="width:100%;margin-top:.5rem"'}}),v.fields.push({type:"html",field:"randomize-base-stats",class:"no-label",hidden:!0,html:{class:"no-label",html:"<button id='randomize-base-stats-button' onclick='window.handleBaseStatRandomizerPopup(window.UnitEditorGlobalStats, window.unitEditorBasicFields)' class='w2ui-btn'>Randomize Base Stats</button><br/><small>Non-unique units can have randomized base stats.</small>",column:1,attr:'style="width:100%;margin-top:.5rem"'}}),v.fields.push({type:"textarea",field:"notes",html:{label:"Notes",attr:"",column:2}}),v.fields.push({type:"text",field:"shortBio",html:{label:"Short Bio",attr:"",column:2}}),v.fields.push({type:"html",html:{html:"<em><small>Color class sprites with unique unit colors</small></em>",column:2,attr:'style="width:100%;margin-top:.5rem"'}}),v.fields.push({type:"checkbox",field:"useAccentColors",html:{label:"Use accent colors",attr:"",column:2}}),window.UpdateaccentColor1=e=>{window.unitEditorBasicFields.record.accentColor1=e.target.value;try{window.unitEditorBasicFields.get("accentColor1").el.querySelector("input").value=e.target.value}catch(e){console.log(e)}},window.UpdateaccentColor2=e=>{window.unitEditorBasicFields.record.accentColor2=e.target.value;try{window.unitEditorBasicFields.get("accentColor2").el.querySelector("input").value=e.target.value}catch(e){console.log(e)}},v.fields.push({type:"html",field:"accentColor1",hidden:!0,html:{label:"Accent color 1",attr:"",column:2,html:'<input type="color" onchange="window.UpdateaccentColor1(event)">'}}),v.fields.push({type:"html",field:"accentColor2",hidden:!0,html:{label:"Accent color 2",attr:"",column:2,html:'<input type="color" onchange="window.UpdateaccentColor2(event)">'}});let C=new i.sk(v);C.on("change",(e=>{d(C,e)})),C.on("refresh",(e=>{try{C.get("accentColor1").el.querySelector("input").value=C.record.accentColor1,C.get("accentColor2").el.querySelector("input").value=C.record.accentColor2}catch(e){console.log(e)}})),C.updateGlobals=()=>{window.unitsCanHaveChildren?C.fields.find((e=>"canHaveChildren"===e.field)).hidden=!1:C.fields.find((e=>"canHaveChildren"===e.field)).hidden=!0,C.refresh()},window.unitEditorBasicFields=C,C.updateGlobals();const x=C,Q=(e,t)=>{let A=document.createElement("div");return e.forEach(((e,i)=>{let s=document.createElement("div");s.style.display="flex",s.style.gap="1rem";let n=document.createElement("h3");n.innerText=e.fieldLabel,s.appendChild(n);let r=document.createElement("div");r.className="w2ui-field",s.appendChild(r),e.fieldOptions.forEach(((A,i)=>{let s=document.createElement("label");s.className="w2ui-box-label",s.style.paddingLeft=".5rem",s.style.gap=".25rem";let n=document.createElement("input");n.type="radio",n.name=e.fieldLabel+t,n.id=A,n.setAttribute("data-value",A),n.setAttribute("data-index",i),n.style.maxWidth="12.5rem",s.appendChild(n),A===e.fieldValue&&(n.checked=!0,n.setAttribute("checked",""));let o=document.createElement("span");o.innerText=A,s.appendChild(o),r.appendChild(s)})),A.appendChild(s)})),A};let F=e=>e.charAt(0).toUpperCase()+e.slice(1);const U=async e=>{if(window.currentUnit=e,!window.currentUnit||void 0===window.currentUnit)return void console.log("no unit to update");console.log("updating current unit record ",e.id),e.useAccentColors&&(window.unitEditorBasicFields.show("accentColor1"),window.unitEditorBasicFields.show("accentColor2")),window.unitEditorBasicFields.record.fullName=e.fullName,window.unitEditorBasicFields.record.title=e.title,window.unitEditorBasicFields.record.name=e.name,window.unitEditorBasicFields.record.id=e.id,window.unitEditorBasicFields.record.subtype=F(e.which),d(window.unitEditorBasicFields,{detail:{field:"subtype",value:{current:F(e.which)}}},!0),window.unitEditorBasicFields.record.pronouns=e.pronouns.singular+"/"+e.pronouns.possessive+"/"+e.pronouns.object+"/"+e.pronouns.possessives,window.unitEditorBasicFields.record.age=e.age,window.unitEditorBasicFields.record.height=e.height,window.unitEditorBasicFields.record.canSSupport=e.canSSupport,window.unitEditorBasicFields.record.canHaveChildren=e.canHaveChildren,window.unitEditorBasicFields.record.isUnique=e.isUnique,window.unitEditorBasicFields.record.canRecruit=e.isRecruitable,window.unitEditorBasicFields.record.birthdayDay=e.birthdayDay,window.unitEditorBasicFields.record.birthdayMonth=e.birthdayMonth,window.unitEditorBasicFields.record.notes=e.Notes,window.unitEditorBasicFields.record.shortBio=e.shortDescription,window.unitEditorBasicFields.record.useAccentColors=e.useAccentColors,window.unitEditorBasicFields.record.accentColor1=e.accentColor1,window.unitEditorBasicFields.record.accentColor2=e.accentColor2,window.unitEditorBasicFields.refresh(),window.unitEditorRelationshipFields.record=e.MaxSupports?e.MaxSupports:{};let t=[],A=window.allUnits;if(A=A.filter((e=>e.id!==window.currentUnit.id&&!("enemy"===e.which&&!e.isRecruitable)&&"npc"!==e.which)),A.forEach((e=>{let A={};A.fieldLabel=e.name+" "+e.id,A.fieldOptions=e.canSSupport?["D","C","B","A","S"]:["D","C","B","A"],A.fieldValue="D",window.unitEditorRelationshipFields.record["max-Support-"+e.id]="D",t.push(A)})),0===t.length)window.unitEditorRelationshipFields.fields[2].html.html="<p>This unit cannot support any other units - make sure you've created other supportable units</p>",window.unitEditorRelationshipFields.fields[4].html.html="<p>This unit cannot support any other units - make sure you've created other supportable units</p>";else{let e=Q(t,"Max-support").innerHTML;window.unitEditorRelationshipFields.fields[2].html.html=e,window.unitEditorRelationshipFields.fields[2].field="dynamicRadios-Max-support";let i=[];A.forEach((e=>{let t={};t.fieldLabel=e.name+" "+e.id,t.fieldOptions=["Slow","Neutral","Fast"],t.fieldValue="Neutral",window.unitEditorRelationshipFields.record["support-Speed-"+e.id]="Neutral",i.push(t)}));let s=Q(i,"Support-speed").innerHTML;window.unitEditorRelationshipFields.fields[4].html.html=s,window.unitEditorRelationshipFields.fields[4].field="dynamicRadios-Support-speed"}window.currentUnit.canHaveChildren&&window.unitsCanHaveChildren?(window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-header").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-inheritances").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-child-header").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-child").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-child-below").hidden=!1):(window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-header").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-inheritances").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-child-header").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-child-below").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-child").hidden=!0),window.combatAdjutants?(window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-header").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-does").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-none-level-support").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-d-level-support").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-c-level-support").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-b-level-support").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-a-level-support").hidden=!1,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-s-level-support").hidden=!1):(window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-header").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-does").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-none-level-support").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-d-level-support").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-c-level-support").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-b-level-support").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-a-level-support").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-chance-s-level-support").hidden=!0),window.combatPairUp?window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-pairup-header").hidden=!1:window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-pairup-header").hidden=!0,window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-adjutant-does").options.items=[window.combatAdjutantAttack?"Attack":null,window.combatAdjutantGuard?"Guard":null,window.combatAdjutantHeal?"Heal":null].filter((e=>null!==e)),window.unitEditorRelationshipFields.get("unit-editor-relationship-fields-parenting-child").options.items=A.map((e=>({id:e.id,text:e.name+" "+e.id}))),window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-adjutant-does"]="Attack",window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-adjutant-chance-none-level-support"]=2,window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-adjutant-chance-d-level-support"]=4,window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-adjutant-chance-c-level-support"]=6,window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-adjutant-chance-b-level-support"]=8,window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-adjutant-chance-a-level-support"]=10,window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-adjutant-chance-s-level-support"]=12,window.unitEditorRelationshipFields.formHTML=window.unitEditorRelationshipFields.generateHTML(),window.unitEditorRelationshipFields.render(),window.unitEditorRelationshipFields.record["unit-editor-relationship-fields-parenting-inheritances"]=["Eye color","Hair color","Skin color","Height"],window.unitEditorRelationshipFields.on("change",(e=>{window.unitEditorRelationshipFields.record[e.detail.originalEvent.target.name]=e.detail.originalEvent.target.getAttribute("data-value")}))};let E=new i.kf({name:"UnitEditorLeft",flatButton:!1,nodes:[]});window.UnitEditorLeftSidebar=E,E.on("click",(function(e){e.done((()=>{let t=E.get(e.target);window.currentUnit=window.allUnits.find((e=>e.id===t.id)),i.GB["unit-editor-bottom-toolbar"].click("unit-editor-bottom-toolbar-basic"),U(window.currentUnit),t.selected=!0,E.nodes.forEach((e=>{e.id!==t.id&&(e.selected=!1)})),E.refresh()}))}));const k=E;let I=new Date,H=!1;const S=async()=>{console.log("getting all units");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"Person",method:"getPeople"}]})},t=new Date;if(t-I<1e4&&!0===H)return window.allUnits?window.allUnits:[];let A=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));return A.ok?(I=t,H=!0,A.json()):[]};window.UnitEditorCreateNewUnit=async(e,t)=>{console.log("creating new unit"),console.log(e);let A={};A.which=e,"avatar"===e&&(A.canSSupport=!0,A.canHaveChildren=!0),A.name=t,A.queue=[{model:"Person",method:"createPerson"}],console.log(A);let i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)},s=await fetch("http://localhost:26068/data",i).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));if(s.ok){let e=await s.json();return console.log(e),e}return w2alert("Error: invalid response from schemas server")},window.UnitEditorDeleteUnit=async e=>{console.log("deleting unit");let t={};t.id=e,t.queue=[{model:"Person",method:"deletePerson"}],console.log(t);let A={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},i=await fetch("http://localhost:26068/data",A).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));if(i.ok){let e=await i.json();return console.log(e),e}return w2alert("Error: invalid response from schemas server")};let T=[],_=new i.Hs({name:"UnitEditorTopMenu",tooltip:"bottom",items:[{type:"button",id:"new-unit",text:"New unit",class:"w2ui-btn accent",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>'},{type:"button",id:"unit-checklist",text:"Unit checklist",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list-checks"><path d="m3 17 2 2 4-4"/><path d="m3 7 2 2 4-4"/><path d="M13 6h8"/><path d="M13 12h8"/><path d="M13 18h8"/></svg>'},{type:"spacer"},{type:"button",id:"delete-unit",text:"Delete unit",class:"w2ui-btn slider1",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>'}]});_.on("click",(function(e){e.done((async()=>{if(window.turnrootEditorLogs.push(`${new Date}||info||Unit toolbar button clicked: ${JSON.stringify(e.target)}`),"new-unit"===e.detail.item.id)(0,i.iX)({title:"Create new unit",label:0===window.allUnits.length?'Enter the familiar name for your first unit. This unit will be the "avatar", or customizable player character. The player will be allowed to change this name if they want- this is just a default.':"Enter the familiar name of the new unit"}).ok((async e=>{if(""===e.detail.value)e.preventDefault();else{window.allUnits=await S();let t="avatar";window.allUnits.length>0&&(t="enemy"),await window.UnitEditorCreateNewUnit(t,e.detail.value).then((e=>(window.UnitEditor.html("main",window.unitEditorBasicFields),window.allUnits.push(e),window.currentUnit=e,U(e),window.allUnits.forEach((e=>{T.push({id:e.id,text:e.name+" "+e.id})})),T.forEach((t=>{t.id===e.id&&(t.selected=!0)})),window.allUnitsNodes=T,window.UnitEditorLeftSidebar.remove(),window.UnitEditorLeftSidebar.nodes=window.allUnitsNodes,window.UnitEditor.refresh(),window.UnitEditorLeftSidebar.refresh(),(0,i.mJ)("New unit created")))).catch((e=>{console.error(e)}))}}));else if("delete-unit"===e.detail.item.id){if(0===window.allUnits.length)return(0,i.mJ)("No units to delete");let e=window.currentUnit;(0,i.mW)({title:"Delete unit",body:`Are you sure you want to delete ${e.name}?`,width:300,height:200}).yes((async()=>{U(window.currentUnit),console.log(e,e.id),await window.UnitEditorDeleteUnit(e.id).then((()=>{let t=window.allUnits.findIndex((t=>t.id===e.id));return window.allUnits.splice(t,1),window.UnitEditorLeftSidebar.remove(),window.UnitEditorLeftSidebar.nodes=window.allUnits.map((e=>({id:e.id,text:e.name+" "+e.id}))),window.UnitEditorLeftSidebar.refresh(),window.currentUnit=window.allUnits[0],window.UnitEditor.html("main",window.unitEditorBasicFields),(0,i.mJ)("Unit deleted")})).catch((t=>(console.log(e),console.error(t),(0,i.mJ)("Error deleting unit"))))}))}}))}));const D=_;let L=new i.sk({name:"unit-editor-relationship-fields",fields:[{field:"",type:"html",html:{html:"<h1>Relationships</h1>"}},{field:"",type:"html",html:{html:"<h2>Max supports</h2>",column:0}},{field:"html",type:"html",html:{html:"",column:0}},{field:"",type:"html",html:{html:'<h2 style="margin-top:2.8rem;">Support speed</h2>',column:1}},{field:"html",type:"html",html:{html:"",column:1}},{field:"unit-editor-relationship-fields-parenting-header",type:"html",html:{html:'<h2 style="margin-top:3.4rem;">Parenting</h2><br/><h3>Passed-down traits</h3></br><p>Child units can inherit traits from their parents. If both parents have a traits checked, the child will have either one or the other or a mix<sup aria-label="There\'s a 40% chance of getting the trait from parent 1, 40% from parent 2, and 20% chance of a 50/50 mix. Yes, we know that\'s not how genetics work." data-balloon-pos="up" data-balloon-length="large"><highlight>*</highlight></sup>. If just one parent has a trait checked. the child will have their trait. If neither has a trait checked, the child will use their default trait.</br></br></p>',column:0,class:"no-label"}},{type:"checks",field:"unit-editor-relationship-fields-parenting-inheritances",html:{label:"",column:0,class:"check-row"},options:{items:["Eye color","Hair color","Skin color","Height"]}},{type:"html",field:"unit-editor-relationship-fields-parenting-child-header",html:{html:'<h3 style = "margin-top:6.8rem">Child Unit</h3>',column:1,class:"no-label"}},{type:"select",field:"unit-editor-relationship-fields-parenting-child",html:{class:"no-label",column:1}},{type:"html",field:"unit-editor-relationship-fields-parenting-child-below",html:{html:'<p><highlight>Important!</highlight> If two units with a set child unit S support and have a child, their child will be one of the two selected randomly.<sup aria-label="In traditional TTRPG games the child unit is always set on the mother. Turnroot allows same-sex couples to have children, which makes guaranteed child units impossible. " data-balloon-length="large" data-balloon-pos="up"><highlight>why?</highlight></sup> You should set a unique child unit on each parent and not worry about it. Just be aware that not all child units may be spawned in-game. Alternatively, you can have two children per couple so all child units are spawned.</p>',column:1,class:"no-label"}},{type:"html",field:"unit-editor-relationship-fields-adjutant-header",html:{html:'<h2 style="margin-top:2.8rem;">Adjutant</h2><br/><p>If this unit is assigned as an adjutant, it will:</p>',column:0,class:"no-label"}},{type:"radio",field:"unit-editor-relationship-fields-adjutant-does",options:{items:["Guard","Attack","Heal"]},html:{column:0}},{type:"number",field:"unit-editor-relationship-fields-adjutant-chance-none-level-support",html:{label:"% Chance at no support",column:0}},{type:"number",field:"unit-editor-relationship-fields-adjutant-chance-d-level-support",html:{label:"% Chance at D-level support",column:0}},{type:"number",field:"unit-editor-relationship-fields-adjutant-chance-c-level-support",html:{label:"% Chance at C-level support",column:0}},{type:"number",field:"unit-editor-relationship-fields-adjutant-chance-b-level-support",html:{label:"% Chance at B-level support",column:0}},{type:"number",field:"unit-editor-relationship-fields-adjutant-chance-a-level-support",html:{label:"% Chance at A-level support",column:0}},{type:"number",field:"unit-editor-relationship-fields-adjutant-chance-s-level-support",html:{label:"% Chance at S-level support",column:0}},{type:"html",field:"unit-editor-relationship-fields-pairup-header",html:{html:'<h2 style="margin-top:2.8rem;">Pair-up</h2>',column:1,class:"no-label"}}],record:{}});window.unitEditorRelationshipFields=L;const M=L;let O,R=[];if(O=window.useExperienceSublevels?{items:["E","E+","D","D+","C","C+","B","B+","A","A+","S"]}:{items:["E","D","C","B","A","S"]},window.statsAptitudesUseRiding&&R.push({field:"riding",type:"select",options:O,html:{label:"Riding",attr:"",column:0}}),window.statsAptitudesUseFlying&&R.push({field:"flying",type:"select",options:O,html:{label:"Flying",attr:"",column:0}}),window.statsAptitudesUseAuthority&&R.push({field:"authority",type:"select",options:O,html:{label:"Authority",attr:"",column:0}}),window.statsAptitudesUseArmor&&R.push({field:"armor",type:"select",options:O,html:{label:"Armor",attr:"",column:0}}),window.globalWeaponTypes)for(let e of globalWeaponTypes)R.push({field:e.type,type:"select",options:O,html:{label:e.html.label,attr:"",column:0}});window.turnrootEditorLogs.push(`${new Date}||info||Global experiences loaded`);const K=R;let $={name:"unit-editor-friend-fields",record:{},fields:[{type:"html",html:{html:"<div><h2>Uniques</h2><small>Set classes, items, and skills only this unit (or their children, if inheritance is on), can have. Personal skills and classes are set here.</br></br>If there are no classes, items, or skills available to select, you can create them by clicking Skills, Items, or Classes on the left sidebar.</small></div>"}},{type:"html",html:{html:"<h3>Unique skills</h3>"}},{field:"unique-skills",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Skill 1","Skill 2","Skill 3","Skill 4","Skill 5"]}},{type:"html",html:{html:"<h3>Unique classes</h3>"}},{field:"unique-classes",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Class 1","Class 2","Class 3","Class 4","Class 5"]}},{type:"html",html:{html:"<h3>Unique items</h3>"}},{field:"unique-items",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Item 1","Item 2","Item 3","Item 4","Item 5"]}},{type:"html",html:{html:"<h2>Base aptitudes</h2>",column:0}}]};$.fields.push({type:"html",html:{html:window.useExperienceAptitudes?"<small>Set this unit's starting aptitudes, as well as their affinity for them (positive, negative, or neutral).</br>A positive affinity means this unit will learn it faster, a negative means slower.</small>":"<small>Set this unit's starting aptitudes.</small>",column:0}}),K.forEach(((e,t)=>{e.field="friend-base-aptitudes-"+e.field.toLowerCase(),e.html.group=e.field,e.html.class="group-flex",$.fields.push(e),$.fields.push({type:"html",field:e.field+"-affinity-friend",html:{class:"no-label",attr:'style="width:max-content"',column:0,html:`<div style = "display:flex;align-items:center;flex-wrap:wrap;width:100%;"><p style = "margin-right:.25rem;">Affinity:</p><input type = "radio" name = "${e.field+"-affinity-radio"}" class="w2ui-input"><label style = "font-size:1.5rem;margin-right:.5rem;">-</label></input><input name = "${e.field+"-affinity-radio"}" type = "radio" class="w2ui-input" checked><label style = "font-size:1rem;margin-right:.5rem;">None</label></input><input name = "${e.field+"-affinity-radio"}" type = "radio" class="w2ui-input"><label style = "font-size:1.5rem;margin-right:.5rem;">+</label></input></div>`}}),$.record[e.field+"-affinity-friend"]="None",$.record[e.field]="E"}));let N=new i.sk($);N.updateGlobals=()=>{let e;window.useExperienceAptitudes?(e=N.fields.filter((e=>e.field?.includes("affinity"))),e.forEach((e=>e.html.hidden=!1))):(e=N.fields.filter((e=>e.field?.includes("affinity"))),e.forEach((e=>e.html.hidden=!0))),N.refresh()},N.updateGlobals(),N.on("change",(function(e){((e,t)=>{let A=e.detail.field,i=e.detail.value;window.currentUnit[A]=i.current})(e)}));const G=N;let z;localStorage.getItem("hairColors")?z=JSON.parse(localStorage.getItem("hairColors")):(z=["rgb(39, 31, 86)","rgb(218, 145, 32)","rgb(139, 69, 19)","rgb(84, 42, 2)","rgb(171, 33, 0)","rgb(34, 223, 154)","rgb(34, 162, 231)","rgb(255, 192, 208)","rgb(255, 222, 176)","rgb(255, 105, 180)"],localStorage.setItem("hairColors",JSON.stringify(z))),window.setDefaultHairColor=e=>{e.preventDefault(),document.querySelector("#unit-editor-avatar-hair-colors").querySelectorAll(".hidden-until-hover-wrapper").forEach((e=>e.style.border="")),e.target.style.border="2px solid var(--accent)",window.unitEditorAvatarDefaultHairColor=e.target.style.backgroundColor},window.unitEditorAvatarRemoveHairColor=e=>{e.preventDefault();let t=e.target.style.backgroundColor;z=z.filter((e=>e!==t)),window.turnrootEditorLogs.push(`${new Date}||info||Removed hair color: ${t}`);let A='<div id = "unit-editor-avatar-hair-colors">';for(let e of z)A+=`<div class="hidden-until-hover-wrapper" style="background-color:${e};width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;" oncontextmenu="setDefaultHairColor(event)" onclick="unitEditorAvatarRemoveHairColor(event)"></div>`;A+='<div style="display:flex;"><input type = "color" style = "width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"><button class= "w2ui-btn" onclick="unitEditorAvatarAddHairColor(event)">Add color</button></div></div>',document.querySelector("#unit-editor-avatar-hair-colors").innerHTML=A,localStorage.setItem("hairColors",JSON.stringify(z))},window.unitEditorAvatarAddHairColor=e=>{let t=(A=e.target.previousElementSibling.value,`rgb(${parseInt(A.substring(1,3),16)}, ${parseInt(A.substring(3,5),16)}, ${parseInt(A.substring(5,7),16)})`);var A;z.push(t),window.turnrootEditorLogs.push(`${new Date}||info||Added hair color: ${t}`);let i='<div id = "unit-editor-avatar-hair-colors">';for(let e of z)i+=`<div id="unit-editor-avatar-hair-colors" class="hidden-until-hover-wrapper" style="background-color:${e};width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;" oncontextmenu="setDefaultHairColor(event)" onclick="unitEditorAvatarRemoveHairColor(event)"></div>`;i+='<div style="display:flex;"><input type = "color" style = "width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"><button class= "w2ui-btn" onclick="unitEditorAvatarAddHairColor(event)">Add color</button></div></div>',document.querySelector("#unit-editor-avatar-hair-colors").innerHTML=i,localStorage.setItem("hairColors",JSON.stringify(z))};let P='<div id = "unit-editor-avatar-hair-colors">';for(let e of z)P+=`<div id="unit-editor-avatar-hair-colors" class="hidden-until-hover-wrapper" style="background-color:${e};width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"  oncontextmenu="setDefaultHairColor(event)" onclick="unitEditorAvatarRemoveHairColor(event)"></div>`;P+='<div style="display:flex;"><input type = "color" style = "width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"><button class= "w2ui-btn" onclick="unitEditorAvatarAddHairColor(event)">Add color</button></div></div>';const V=P;let j;localStorage.getItem("eyeColors")?j=JSON.parse(localStorage.getItem("eyeColors")):(j=["rgb(104, 52, 2)","rgb(124, 183, 74)","rgb(34, 132, 181)","rgb(130, 150, 210)"],localStorage.setItem("eyeColors",JSON.stringify(j))),window.setDefaultEyeColor=e=>{e.preventDefault(),document.querySelector("#unit-editor-avatar-eye-colors").querySelectorAll(".hidden-until-hover-wrapper").forEach((e=>e.style.border="")),e.target.style.border="2px solid var(--accent)",window.unitEditorAvatarDefaultEyeColor=e.target.style.backgroundColor},window.unitEditorAvatarRemoveEyeColor=e=>{e.preventDefault();let t=e.target.style.backgroundColor;j=j.filter((e=>e!==t)),window.turnrootEditorLogs.push(`${new Date}||info||Removed eye color: ${t}`);let A='<div id = "unit-editor-avatar-eye-colors">';for(let e of j)A+=`<div class="hidden-until-hover-wrapper" style="background-color:${e};width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;" oncontextmenu="setDefaultEyeColor(event)" onclick="unitEditorAvatarRemoveEyeColor(event)"></div>`;A+='<div style="display:flex;"><input type = "color" style = "width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"><button class= "w2ui-btn" onclick="unitEditorAvatarAddEyeColor(event)">Add color</button></div></div>',document.querySelector("#unit-editor-avatar-eye-colors").innerHTML=A,localStorage.setItem("eyeColors",JSON.stringify(j))},window.unitEditorAvatarAddEyeColor=e=>{let t=(A=e.target.previousElementSibling.value,`rgb(${parseInt(A.substring(1,3),16)}, ${parseInt(A.substring(3,5),16)}, ${parseInt(A.substring(5,7),16)})`);var A;j.push(t),window.turnrootEditorLogs.push(`${new Date}||info||Added eye color: ${t}`);let i='<div id = "unit-editor-avatar-eye-colors">';for(let e of j)i+=`<div id="unit-editor-avatar-eye-colors" class="hidden-until-hover-wrapper" style="background-color:${e};width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;" oncontextmenu="setDefaultEyeColor(event)" onclick="unitEditorAvatarRemoveEyeColor(event)"></div>`;i+='<div style="display:flex;"><input type = "color" style = "width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"><button class= "w2ui-btn" onclick="unitEditorAvatarAddEyeColor(event)">Add color</button></div></div>',document.querySelector("#unit-editor-avatar-eye-colors").innerHTML=i,localStorage.setItem("eyeColors",JSON.stringify(j))};let W='<div id = "unit-editor-avatar-eye-colors">';for(let e of j)W+=`<div id="unit-editor-avatar-eye-colors" class="hidden-until-hover-wrapper" style="background-color:${e};width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"  oncontextmenu="setDefaultEyeColor(event)" onclick="unitEditorAvatarRemoveEyeColor(event)"></div>`;W+='<div style="display:flex;"><input type = "color" style = "width:2rem;height:2rem;display:inline-block;margin:0.25rem;border-radius:.25rem;"><button class= "w2ui-btn" onclick="unitEditorAvatarAddEyeColor(event)">Add color</button></div></div>';const X=W;let Y={name:"unit-editor-avatar-fields",record:{},fields:[{type:"html",html:{html:"<div><h2>Uniques</h2><small>Set classes, items, and skills only this unit (or their children, if inheritance is on), can have. Personal skills and classes are set here.</br></br>If there are no classes, items, or skills available to select, you can create them by clicking Skills, Items, or Classes on the left sidebar.</small></div>"}},{type:"html",html:{html:"<h3>Unique skills</h3>"}},{field:"unique-skills",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Skill 1","Skill 2","Skill 3","Skill 4","Skill 5"]}},{type:"html",html:{html:"<h3>Unique classes</h3>"}},{field:"unique-classes",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Class 1","Class 2","Class 3","Class 4","Class 5"]}},{type:"html",html:{html:"<h3>Unique items</h3>"}},{field:"unique-items",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Item 1","Item 2","Item 3","Item 4","Item 5"]}},{type:"html",html:{html:"<h2>Base aptitudes</h2>",column:0}},{type:"html",html:{html:"<div><h2>Appearance</h2><small>Set the options that the player will have to customize their avatar's appearance. Right-click to set the default. Click to delete.</small></div>",column:1}},{type:"html",html:{html:`<div><h3>Hair colors</h3><small>Default: <span style = "width:2remheight:1rembackground-color:${window.unitEditorAvatarDefaultHairColor}display:inline-blockborder-radius:.25rem"</small></div>`,column:1}},{type:"html",field:"hair-colors",html:{class:"no-label",attr:'style="width:12rem"',column:1,html:V}},{type:"html",html:{html:`<div><h3>Eye colors</h3><small>Default: <span style = "width:2remheight:1rembackground-color:${window.unitEditorAvatarDefaultEyeColor}display:inline-blockborder-radius:.25rem"</small></div>`,column:1}},{type:"html",field:"eye-colors",html:{class:"no-label",attr:'style="width:12rem"',column:1,html:X}}]};Y.fields.push({type:"html",html:{html:window.useExperienceAptitudes?"<small>Set this unit's starting aptitudes, as well as their affinity for them (positive, negative, or neutral).</br>A positive affinity means this unit will learn it faster, a negative means slower.</small>":"<small>Set this unit's starting aptitudes.</small>",column:0}}),K.forEach(((e,t)=>{e.field="avatar-base-aptitudes-"+e.field.toLowerCase(),e.html.group=e.field,e.html.class="group-flex",Y.fields.push(e),Y.fields.push({type:"radio",field:e.field+"starting-affinity",options:{items:["None","-","+"]},html:{column:0}}),Y.record[e.field]="E",Y.record[e.field+"starting-affinity"]="None"}));let J=new i.sk(Y);J.updateGlobals=()=>{let e;window.useExperienceAptitudes?(e=J.fields.filter((e=>e.field?.includes("affinity"))),e.forEach((e=>e.html.hidden=!1))):(e=J.fields.filter((e=>e.field?.includes("affinity"))),e.forEach((e=>e.html.hidden=!0))),window.useExperienceSublevels?K.forEach(((e,t)=>{if(e.options){e.options.items=["E","E+","D","D+","C","C+","B","B+","A","A+","S"];let t=J.fields.filter((t=>t.field?.includes(e.field.toLowerCase())))[0];t=J.get(t.field),t.options.items=["E","E+","D","D+","C","C+","B","B+","A","A+","S"]}})):K.forEach(((e,t)=>{if(e.options){e.options.items=["E","D","C","B","A","S"];let t=J.fields.filter((t=>t.field?.includes(e.field.toLowerCase())))[0];t=J.get(t.field),t.options.items=["E","D","C","B","A","S"]}})),J.refresh()},window.UnitEditorAvatarFields=J,J.updateGlobals(),J.on("change",(function(e){((e,t)=>{let A=e.detail.field,i=e.detail.value;window.currentUnit[A]=i.current})(e)}));const Z=J;let q=new i.sk({name:"unit-editor-enemy-fields",record:{},fields:[{type:"html",html:{html:"<div><h2>Uniques</h2><small>Set classes, items, and skills only this unit can have. Personal skills and classes are set here.</br></br>If there are no classes, items, or skills available to select, you can create them by clicking Skills, Items, or Classes on the left sidebar.</small></div>"}},{type:"html",html:{html:"<h3>Unique skills</h3>"}},{field:"enemy-unique-skills",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Skill 1","Skill 2","Skill 3","Skill 4","Skill 5"]}},{type:"html",html:{html:"<h3>Unique classes</h3>"}},{field:"enemy-unique-classes",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Class 1","Class 2","Class 3","Class 4","Class 5"]}},{type:"html",html:{html:"<h3>Unique items</h3>"}},{field:"enemy-unique-items",type:"enum",html:{class:"no-label",attr:'style="width:10rem"',column:0},options:{max:3,items:["Item 1","Item 2","Item 3","Item 4","Item 5"]}}]});q.updateGlobals=()=>{window.turnrootEditorLogs.push(`${new Date}||info||Updating Enemy form globals`),q.refresh()},q.updateGlobals(),q.on("change",(function(e){((e,t)=>{let A=e.detail.field,i=e.detail.value;window.currentUnit[A]=i})(e)}));const ee=q;let te=new i.sk({name:"unit-editor-npc-fields",record:{},fields:[]});te.updateGlobals=()=>{window.turnrootEditorLogs.push(`${new Date}||info||Updating NPC form globals`),te.refresh()},te.updateGlobals(),te.on("change",(function(e){((e,t)=>{let A=e.detail.field,i=e.detail.value;window.currentUnit[A]=i.current})(e)}));const Ae=te;let ie=null;document.onmouseup=e=>{ie&&(ie.dragging=!1,ie.thumb.style.width="1.25rem",ie.thumb.style.height="1.25rem",ie=null)},document.onmousemove=e=>{if(ie?.dragging){e.preventDefault(),ie.thumb.style.width="1.4rem",ie.thumb.style.height="1.4rem";let t=ie.track.getBoundingClientRect(),A=(e.clientX-t.left)/t.width*100;A<10&&(A=10),A>100&&(A=100);let i=Math.ceil(1.1*A-10-1),s=`color-mix(in oklab,var(--slider-0) ${i}%,var(--slider-1))`;ie.thumb.style.right=100-A+"%",ie.thumb.style.backgroundColor=s,ie.onchange(i)}};const se=class{constructor(e,t="h",A=50){this.value=A,this.container=e,this.hv=t,this.onchange=e=>e,this.sliderDiv=document.createElement("div"),this.sliderDiv.style.width="100%",this.sliderDiv.style.height="min-content",this.container.appendChild(this.sliderDiv),this.thumb=void 0,this.track=void 0,this.coloredRange(),this.dragging=!1}setValue(e){this.value=parseInt(e),this.thumb.style.right=100-this.value+"%";let t=`color-mix(in oklab,var(--slider-0) ${Math.ceil(1.1*this.value-10-1)}%,var(--slider-1))`;this.thumb.style.backgroundColor=t}coloredRange(){let e=document.createElement("div");"h"===this.hv?(e.style.width="100%",e.style.height="1.5rem"):(e.style.width="1.5rem",e.style.height="100%"),e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center";let t=document.createElement("div");this.track=t,"h"===this.hv?(t.style.width="90%",t.style.height="3px"):(t.style.width="3px",t.style.height="90%"),t.style.backgroundColor="color-mix(in srgb,var(--window-background) 60%,var(--window-background-alt))",t.style.position="relative",e.appendChild(t);let A=document.createElement("div");this.thumb=A,A.className="no-transition",A.style.width="1.25rem",A.style.height="1.25rem",A.style.borderRadius=".25rem",A.style.position="relative",A.style.right=`${this.value}%`,A.style.backgroundColor="var(--slider-0)",A.onmousedown=e=>{e.preventDefault(),ie=this,ie.thumb=A,ie.sliderDiv=this.sliderDiv,ie.track=t,this.dragging=!0,A.style.width="1.4rem",A.style.height="1.4rem"},this.sliderDiv.onmousedown=e=>{e.preventDefault(),ie=this,ie.dragging=!0,ie.thumb=A;let i=A.getBoundingClientRect(),s=!1;if(e.clientX>=i.left&&e.clientX<=i.right&&e.clientY>=i.top&&e.clientY<=i.bottom&&(s=!0),!s){ie.sliderDiv=this.sliderDiv,ie.track=t;let i=""+(100-(e.clientX-t.getBoundingClientRect().left)/t.getBoundingClientRect().width*100-12);i<10&&(i=10),i>100&&(i=100);let s=Math.ceil(1.1*i-10-1);s>100&&(s=100);let n=`color-mix(in oklab,var(--slider-0) ${s}%,var(--slider-1))`;A.style.backgroundColor=n,ie.thumb.style.right=`${i}%`}},e.appendChild(A),this.sliderDiv.appendChild(e)}};let ne=document.createElement("div");ne.style.width="100%",ne.style.height="100%",ne.style.padding="1rem";let re=document.createElement("div");re.style.maxWidth="100ch",re.style.lineHeight="1.5rem",re.innerHTML="\n    <div><h2>How does all this work?</h2>\n    <em>As noted above, you should generally not worry about specific rules and just load a preset, then tweak the sliders.</em> \n    <h3>Sliders</h3>\n    The sliders control the priority of a rule. The higher the priority, the more likely that rule is to occur.\n    <h3>Customizing rules</h3>\n    You can customize any rule with the dropdowns. For example, you could change Move towards nearest foe (Mindless) to Move towards nearest foe (Lone Wolf) by selecting 'Lone Wolf' from the dropdown.<br/><br/>\n    The Priority and Target columns are customizable- the rule columns are set in stone. You can disable rules, but not add or change them. <br/><br/>",ne.appendChild(re);let oe=[],le=[];ne.innerHTML="<div><h2>Behavior</h2>\n<p>Units that move on their own have their behaviors controlled by these sliders, which in turn influence the priority of the rules below. The presets will cover most common cases- for specific units, you can tweak things as needed. Generally, you just need to load a preset.<br/><br/>For special behaviors, see the Specials tab.</p></div>\n";let ae=document.createElement("div");ae.style.display="flex",ae.style.flexWrap="wrap",ae.style.justifyContent="center",ae.style.gap=".25rem",ae.style.marginBottom="1rem",ae.style.width="100%";let de=document.createElement("button");de.innerHTML="Foot Soldier",de.className="w2ui-btn";let ce=document.createElement("button");ce.innerHTML="Mindless Creature",ce.className="w2ui-btn";let he=document.createElement("button");he.innerHTML="Cautious Healer",he.className="w2ui-btn";let ue=document.createElement("button");ue.innerHTML="Sniper",ue.className="w2ui-btn";let pe=document.createElement("button");pe.innerHTML="Steadfast Tank",pe.className="w2ui-btn";let ge=document.createElement("button");ge.innerHTML="Independent Assassin",ge.className="w2ui-btn";let me=document.createElement("button");me.innerHTML="Vengeful Demon",me.className="w2ui-btn";let fe=document.createElement("button");fe.innerHTML="Weak Coward",fe.className="w2ui-btn";let we=document.createElement("button");we.innerHTML="Looter",we.className="w2ui-btn";let Be=[de,ce,he,ue,pe,ge,me,fe,we],ye=[{left:"Move towards",center:"nearest foe",right:"Mindless"},{left:"Move towards",center:"disadvantaged foe",right:"Strategic"},{left:"Move towards",center:"last attacked foe",right:"Team Player"},{left:"Move towards",center:"safety",right:"Coward"},{left:"Move towards",center:"cover",right:"Coward"},{left:"Move towards",center:"hurt ally (can heal or rally)",right:"Selfless"},{left:"Move towards",center:"nearest objective tile",right:"Strategic"},{left:"Move towards",center:"chest (if can open)",right:"Greedy"},{left:"Move towards",center:"door (if can open)",right:"Lone Wolf"},{left:"Move towards",center:"fortress",right:"Strategic"},{left:"Move towards",center:"emplacement",right:"Lone Wolf"},{left:"Move towards",center:"minimize receiving attack count",right:"Team Player"},{left:"Move towards",center:"team leader",right:"Team Player"},{left:"Move towards",center:"furthest distance",right:"Lone Wolf"},{left:"Move towards",center:"player avatar",right:"Hero"}],be={Default:["Move towards nearest foe","Move towards last attacked foe","Move towards disadvantaged foe","Move towards nearest objective tile","Move towards team leader"],MindlessCreature:["Move towards nearest foe","Move towards last attacked foe","Move towards nearest objective tile","Move towards furthest distance"],CautiousHealer:["Move towards disadvantaged foe","Move towards minimize receiving attack count","Move towards safety","Move towards hurt ally (can heal or rally)","move towards fortress","Move towards cover"],Sniper:["Move towards disadvantaged foe","Move towards last attacked foe","Move towards furthest distance","Move towards minimize receiving attack count","move towards emplacement","Move towards safety","Move towards cover"],SteadfastTank:["Move towards nearest foe","Move towards last attacked foe","Move towards fortress","Move towards player avatar","Move towards disadvantaged foe","Move towards team leader","Move towards nearest objective tile"],IndependentAssassin:["Move towards disadvantaged foe","Move towards last attacked foe","Move towards furthest distance","Move towards minimize receiving attack count","Move towards safety","Move towards cover","Move towards player avatar"],WeakCoward:["Move towards safety","Move towards cover","Move towards hurt ally (can heal or rally)","Move towards nearest objective tile","Move towards team leader","Move towards minimize receiving attack count"],Looter:["Move towards chest (if can open)","Move towards door (if can open)","Move towards safety","Move towards disadvantaged foe","Move towards nearest objective tile","minimize receiving attack count"],VengefulDemon:["Move towards last attacked foe","Move towards disadvantaged foe","Move towards nearest foe","Move towards player avatar"]},ve={Default:{"unitEditorBehavior.TeamPlayer":20,"unitEditorBehavior.Hero":40,"unitEditorBehavior.Strategic":50,"unitEditorBehavior.Selfless":55,list:[20,40,50,55]},MindlessCreature:{"unitEditorBehavior.TeamPlayer":90,"unitEditorBehavior.Hero":50,"unitEditorBehavior.Strategic":90,"unitEditorBehavior.Selfless":50,list:[90,50,90,50]},CautiousHealer:{"unitEditorBehavior.TeamPlayer":20,"unitEditorBehavior.Hero":30,"unitEditorBehavior.Strategic":20,"unitEditorBehavior.Selfless":10,list:[20,30,20,10]},Sniper:{"unitEditorBehavior.TeamPlayer":90,"unitEditorBehavior.Hero":70,"unitEditorBehavior.Strategic":10,"unitEditorBehavior.Selfless":80,list:[90,70,10,80]},SteadfastTank:{"unitEditorBehavior.TeamPlayer":10,"unitEditorBehavior.Hero":10,"unitEditorBehavior.Strategic":60,"unitEditorBehavior.Selfless":50,list:[10,10,60,50]},IndependentAssassin:{"unitEditorBehavior.TeamPlayer":90,"unitEditorBehavior.Hero":90,"unitEditorBehavior.Strategic":10,"unitEditorBehavior.Selfless":90,list:[90,90,10,90]},WeakCoward:{"unitEditorBehavior.TeamPlayer":30,"unitEditorBehavior.Hero":90,"unitEditorBehavior.Strategic":40,"unitEditorBehavior.Selfless":70,list:[30,90,40,70]},Looter:{"unitEditorBehavior.TeamPlayer":90,"unitEditorBehavior.Hero":50,"unitEditorBehavior.Strategic":50,"unitEditorBehavior.Selfless":90,list:[90,50,50,90]},VengefulDemon:{"unitEditorBehavior.TeamPlayer":70,"unitEditorBehavior.Hero":10,"unitEditorBehavior.Strategic":50,"unitEditorBehavior.Selfless":30,list:[70,10,50,30]}};const Ce=e=>{ke.innerHTML="",oe.forEach(((t,A)=>{let i=ve[e].list[A];t.setValue(i)}));let t=be[e],A=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div");Ie(A,He),Ie(i,He),Ie(s,He),A.style.backgroundColor="var(--button-alt-text)",i.style.backgroundColor="var(--button-alt-text)",s.style.backgroundColor="var(--button-alt-text)",A.style.color="var(--window-background-alt)",i.style.color="var(--window-background-alt)",A.innerHTML="<strong>Rule</strong>",i.innerHTML="<strong>Target</strong>",s.innerHTML="<strong>Priority</strong>",ke.appendChild(A),ke.appendChild(i),ke.appendChild(s),ye.forEach((e=>{if(t.includes(e.left+" "+e.center)){let t=document.createElement("div"),A=document.createElement("div"),i=document.createElement("div");t.innerHTML=e.left,A.innerHTML=e.center,i.innerHTML=`\n            <select id="unitEditorBehaviorRule${e.left.replace(" ","")+e.center.replace(" ","")}" name="unitEditorBehaviorRule${e.left.replace(" ","")+e.center.replace(" ","")}" class="w2ui-input " tabindex="1" style = "width:100%;height:100%;margin:0;font-size:1rem;border-radius:0;" onchange='window.unitEditorBehaviorUpdateWindow()'>\n            <option value="Team Player" ${"Team Player"===e.right?"selected":""}>Team Player</option>\n            <option value="Lone Wolf" ${"Lone Wolf"===e.right?"selected":""}>Lone Wolf</option>\n            <option value="Hero" ${"Hero"===e.right?"selected":""}>Hero</option>\n            <option value="Coward" ${"Coward"===e.right?"selected":""}>Coward</option>\n            <option value="Strategic" ${"Strategic"===e.right?"selected":""}>Strategic</option>\n            <option value="Mindless" ${"Mindless"===e.right?"selected":""}>Mindless</option>\n            <option value="Selfless" ${"Selfless"===e.right?"selected":""}>Selfless</option>\n            <option value="Greedy" ${"Greedy"===e.right?"selected":""}>Greedy</option>\n            </select>`,Ie(t,He),Ie(A,He),Ie(i,He,!1),i.style.margin="0",i.style.padding="0px!important",t.style.backgroundColor="var(--node-text)",A.style.backgroundColor="var(--node-title)",ke.appendChild(t),ke.appendChild(A),ke.appendChild(i)}}))};de.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),de.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("Default"),window.unitEditorBehaviorUpdateWindow(ve.Default)},ce.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),ce.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("MindlessCreature"),window.unitEditorBehaviorUpdateWindow(ve.MindlessCreature)},he.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),he.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("CautiousHealer"),window.unitEditorBehaviorUpdateWindow(ve.CautiousHealer)},ue.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),ue.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("Sniper"),window.unitEditorBehaviorUpdateWindow(ve.Sniper)},pe.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),pe.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("SteadfastTank"),window.unitEditorBehaviorUpdateWindow(ve.SteadfastTank)},ge.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),ge.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("IndependentAssassin"),window.unitEditorBehaviorUpdateWindow(ve.IndependentAssassin)},fe.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),fe.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("WeakCoward"),window.unitEditorBehaviorUpdateWindow(ve.WeakCoward)},me.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),me.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("VengefulDemon"),window.unitEditorBehaviorUpdateWindow(ve.VengefulDemon)},we.onclick=()=>{Be.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),we.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ce("Looter"),window.unitEditorBehaviorUpdateWindow(ve.Looter)},Be.forEach((e=>{ae.appendChild(e)})),ne.appendChild(ae);let xe,Qe,Fe,Ue,Ee={"unitEditorBehavior.TeamPlayer":50,"unitEditorBehavior.Hero":50,"unitEditorBehavior.Strategic":50,"unitEditorBehavior.Selfless":50,list:[50,50,50,50]};[{left:"Team Player",right:"Lone Wolf"},{left:"Hero",right:"Coward"},{left:"Strategic",right:"Mindless"},{left:"Selfless",right:"Greedy"}].forEach((e=>{Qe=document.createElement("p"),Qe.innerHTML=e.left,Qe.style.width="12%",Fe=document.createElement("p"),Fe.innerHTML=e.right,Fe.style.width="12%",Ue=document.createElement("div"),Ue.style.flexGrow=2,xe=new se(Ue),xe.onchange=t=>{Ee[`unitEditorBehavior.${e.left.replace(" ","")}`]=t,De()},le.push([Qe,Ue,Fe]),oe.push(xe)})),le.forEach((e=>{let t=document.createElement("div");t.innerHTML="",t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center",t.appendChild(e[0]),t.appendChild(e[1]),t.appendChild(e[2]),ne.appendChild(t)}));let ke=document.createElement("div");function Ie(e,t,A=!0){Object.keys(t).forEach((i=>{A||"padding"!==i?e.style[i]=t[i]:e.style.padding="0"}))}ke.id="unitEditorBehaviorRules",ke.style.width="100%",ke.style.display="grid",ke.style.gridTemplateColumns="1fr 1fr 1fr";let He={padding:".5rem",border:"1px solid var(--window-background)",height:"2.5rem",color:"var(--window-background-alt)"},Se=document.createElement("div"),Te=document.createElement("div"),_e=document.createElement("div");Ie(Se,He),Ie(Te,He),Ie(_e,He),Se.style.backgroundColor="var(--button-alt-text)",Te.style.backgroundColor="var(--button-alt-text)",_e.style.backgroundColor="var(--button-alt-text)",Se.style.color="var(--window-background-alt)",Te.style.color="var(--window-background-alt)",Se.innerHTML="<strong>Rule</strong>",Te.innerHTML="<strong>Target</strong>",_e.innerHTML="<strong>Priority</strong>",ke.appendChild(Se),ke.appendChild(Te),ke.appendChild(_e);const De=(e=null)=>{e||(e=Ee),window.unitEditorBehaviorTeamPlayer=e["unitEditorBehavior.TeamPlayer"],window.unitEditorBehaviorHero=e["unitEditorBehavior.Hero"],window.unitEditorBehaviorStrategic=e["unitEditorBehavior.Strategic"],window.unitEditorBehaviorSelfless=e["unitEditorBehavior.Selfless"],e.list=[window.unitEditorBehaviorTeamPlayer,window.unitEditorBehaviorHero,window.unitEditorBehaviorStrategic,window.unitEditorBehaviorSelfless];let t=ke.children;for(let e=3;e<t.length;e+=3){let A=[t[e],t[e+1],t[e+2]],i=A[2].children[0].value;A[2].children[0].style.backgroundColor="Team Player"===i||"Lone Wolf"===i?`color-mix(in oklab,var(--slider-0) ${window.unitEditorBehaviorTeamPlayer}%,var(--slider-1))`:"Hero"===i||"Coward"===i?`color-mix(in oklab,var(--slider-0) ${window.unitEditorBehaviorHero}%,var(--slider-1))`:"Strategic"===i||"Mindless"===i?`color-mix(in oklab,var(--slider-0) ${window.unitEditorBehaviorStrategic}%,var(--slider-1))`:"Selfless"===i||"Greedy"===i?`color-mix(in oklab,var(--slider-0) ${window.unitEditorBehaviorSelfless}%,var(--slider-1))`:"var(--node-text)"}};window.unitEditorBehaviorUpdateWindow=De,oe.forEach(((e,t)=>{let A=Ee.list[t];e.setValue(A)})),De(),ne.appendChild(ke),_e.style.backgroundColor="var(--button-alt-text)";const Le=ne;let Me=document.createElement("div");Me.style.width="100%",Me.style.height="100%",Me.style.padding="1rem",Me.innerHTML="<div><h2>Tile rules</h2>\nUnits that move on their own get their tile interaction rules from here. Exercise extreme caution here- you can very easily break your game with a single misclick here. There are no guardrails. Pick a preset and do not modify specifics unless you're confident in what you're doing! The default tile rules are correct for 99% of units, including riding and infantry units. You should use the \"Flier\" tile preset for all flying units.\n<h3>What are the presets?</h3>\n<ul>\n    <li><highlight>Default</highlight>: The default tile rules for most units.</li>\n    <li><highlight>Flier</highlight>: The tile rules for flying units.</li>\n    <li><highlight>Pirate</highlight>: Tile rules for units that are agile in water.</li>\n    <li><highlight>Beast</highlight>: Tile rules for units that are agile in forests and unaffected by fog or mist.</li>\n</ul>\nIf you're not sure which preset to use, use the Default preset. \n</div>\n";let Oe=document.createElement("div");Oe.style.display="flex",Oe.style.justifyContent="center",Oe.style.gap=".25rem",Oe.style.marginBottom="1rem",Oe.style.width="100%";let Re=document.createElement("button");Re.innerHTML="Default",Re.className="w2ui-btn";let Ke=document.createElement("button");Ke.innerHTML="Flier",Ke.className="w2ui-btn";let $e=document.createElement("button");$e.innerHTML="Pirate",$e.className="w2ui-btn";let Ne=document.createElement("button");Ne.innerHTML="Beast",Ne.className="w2ui-btn";let Ge=[Re,Ke,$e,Ne],ze=[{left:"ground",right:["move","see"]},{left:"wall",right:["stop","see"]},{left:"cliff",right:["stop","blind"]},{left:"chasm",right:["stop","see"]},{left:"trap",right:["hurt immediately","hurt on turn start","move","see"]},{left:"fire",right:["hurt on turn start","move","see"]},{left:"sand",right:["move","slow*1","slow horse*2","see"]},{left:"stairs",right:["move","slow*.5","slow horse*1","see"]},{left:"ice",right:["move","slow*1.25","see"]},{left:"snow",right:["move","slow*2","blind*.5"]},{left:"shallow_water",right:["move","slow*1.5","slow horse*.5","see"]},{left:"deep_water",right:["stop","see"]},{left:"locked_door",right:["stop","blind","open"]},{left:"open_door",right:["move","see"]},{left:"teleporter",right:["move","see","warp"]},{left:"lever",right:["move","see","use"]},{left:"switch",right:["move","see","use"]},{left:"locked_chest",right:["stop","see"]},{left:"open_chest",right:["move","see"]},{left:"lava",right:["stop","see"]},{left:"acid",right:["stop","see"]},{left:"ranged_emplacement",right:["move","see","arms"]},{left:"magic_emplacement",right:["move","see","arms"]},{left:"heal",right:["move","see","heal"]},{left:"stronghold",right:["move","see","heal*1.5","guard*1.5","avoid*1"]},{left:"guard",right:["move","see","guard*1"]},{left:"avoid",right:["move","see","avoid*1"]},{left:"roof",right:["stop","see"]},{left:"tallwall",right:["stop","blind"]},{left:"shrubs",right:["move","see","avoid*.5"]},{left:"bushes",right:["move","slow*.5","see","avoid*1"]},{left:"trees",right:["move","slow*1.5","see","avoid*1.5"]},{left:"boulder",right:["stop","see"]},{left:"fence",right:["stop","see"]},{left:"forest",right:["move","slow*1.5","slow horse*2","blind*.5","avoid*2","hidden"]},{left:"fog",right:["move","blind","stop if enemy","hidden"]},{left:"mist",right:["move","blind*.5","stop if enemy"]}],Pe=[{left:"ground",right:["move","see"]},{left:"wall",right:["move","see"]},{left:"cliff",right:["move","see"]},{left:"chasm",right:["stop","see"]},{left:"trap",right:["move","see"]},{left:"fire",right:["move","see"]},{left:"sand",right:["move","see"]},{left:"stairs",right:["move","see"]},{left:"ice",right:["move","see"]},{left:"snow",right:["move","blind*.5"]},{left:"shallow_water",right:["move","see"]},{left:"deep_water",right:["stop","see"]},{left:"locked_door",right:["stop","blind"]},{left:"open_door",right:["move","see"]},{left:"teleporter",right:["move","see","warp"]},{left:"lever",right:["move","see","use"]},{left:"switch",right:["move","see","use"]},{left:"locked_chest",right:["stop","see"]},{left:"open_chest",right:["move","see"]},{left:"lava",right:["stop","see"]},{left:"acid",right:["stop","see"]},{left:"ranged_emplacement",right:["move","see"]},{left:"magic_emplacement",right:["move","see"]},{left:"heal",right:["move","see"]},{left:"stronghold",right:["move","see","heal*1.5","guard*1.5","avoid*1"]},{left:"guard",right:["move","see"]},{left:"avoid",right:["move","see"]},{left:"roof",right:["move","see"]},{left:"tallwall",right:["stop","blind"]},{left:"shrubs",right:["move","see"]},{left:"bushes",right:["move","see"]},{left:"trees",right:["move","see"]},{left:"boulder",right:["move","see"]},{left:"fence",right:["move","see"]},{left:"forest",right:["move","see"]},{left:"fog",right:["move","blind","stop if enemy","hidden"]},{left:"mist",right:["move","blind*.5","stop if enemy"]}],Ve=[{left:"ground",right:["move","see"]},{left:"wall",right:["stop","see"]},{left:"cliff",right:["stop","blind"]},{left:"chasm",right:["stop","see"]},{left:"trap",right:["hurt immediately","hurt on turn start","move","see"]},{left:"fire",right:["hurt on turn start","move","see"]},{left:"sand",right:["move","slow*1","slow horse*2","see"]},{left:"stairs",right:["move","slow*.5","slow horse*1","see"]},{left:"ice",right:["move","slow*1.25","see"]},{left:"snow",right:["move","slow*2","blind*.5"]},{left:"shallow_water",right:["move","see"]},{left:"deep_water",right:["stop","see"]},{left:"locked_door",right:["stop","blind","open"]},{left:"open_door",right:["move","see"]},{left:"teleporter",right:["move","see","warp"]},{left:"lever",right:["move","see","use"]},{left:"switch",right:["move","see","use"]},{left:"locked_chest",right:["stop","see"]},{left:"open_chest",right:["move","see"]},{left:"lava",right:["stop","see"]},{left:"acid",right:["stop","see"]},{left:"ranged_emplacement",right:["move","see","arms"]},{left:"magic_emplacement",right:["move","see","arms"]},{left:"heal",right:["move","see","heal"]},{left:"stronghold",right:["move","see","heal*1.5","guard*1.5","avoid*1"]},{left:"guard",right:["move","see","guard*1"]},{left:"avoid",right:["move","see","avoid*1"]},{left:"roof",right:["stop","see"]},{left:"tallwall",right:["stop","blind"]},{left:"shrubs",right:["move","see","avoid*.5"]},{left:"bushes",right:["move","slow*.5","see","avoid*1"]},{left:"trees",right:["move","slow*1.5","see","avoid*1.5"]},{left:"boulder",right:["stop","see"]},{left:"fence",right:["stop","see"]},{left:"forest",right:["move","slow*1.5","slow horse*2","blind*.5","avoid*2","hidden"]},{left:"fog",right:["move","blind","stop if enemy","hidden"]},{left:"mist",right:["move","blind*.5","stop if enemy"]}],je=[{left:"ground",right:["move","see"]},{left:"wall",right:["stop","see"]},{left:"cliff",right:["stop","blind"]},{left:"chasm",right:["stop","see"]},{left:"trap",right:["hurt immediately","hurt on turn start","move","see"]},{left:"fire",right:["hurt on turn start","move","see"]},{left:"sand",right:["move","slow*1","slow horse*2","see"]},{left:"stairs",right:["move","slow*.5","slow horse*1","see"]},{left:"ice",right:["move","slow*1.25","see"]},{left:"snow",right:["move","slow*2","see"]},{left:"shallow_water",right:["move","slow*1.5","slow horse*.5","see"]},{left:"deep_water",right:["stop","see"]},{left:"locked_door",right:["stop","blind","open"]},{left:"open_door",right:["move","see"]},{left:"teleporter",right:["move","see","warp"]},{left:"lever",right:["move","see","use"]},{left:"switch",right:["move","see","use"]},{left:"locked_chest",right:["stop","see"]},{left:"open_chest",right:["move","see"]},{left:"lava",right:["stop","see"]},{left:"acid",right:["stop","see"]},{left:"ranged_emplacement",right:["move","see","arms"]},{left:"magic_emplacement",right:["move","see","arms"]},{left:"heal",right:["move","see","heal"]},{left:"stronghold",right:["move","see","heal*1.5","guard*1.5","avoid*1"]},{left:"guard",right:["move","see","guard*1"]},{left:"avoid",right:["move","see","avoid*1"]},{left:"roof",right:["stop","see"]},{left:"tallwall",right:["stop","blind"]},{left:"shrubs",right:["move","see","avoid*.5"]},{left:"bushes",right:["move","see","avoid*1"]},{left:"trees",right:["move","see","avoid*1.5"]},{left:"boulder",right:["stop","see"]},{left:"fence",right:["stop","see"]},{left:"forest",right:["move","avoid*2","hidden"]},{left:"fog",right:["move","see","hidden"]},{left:"mist",right:["move","see","hidden"]}];Re.onclick=()=>{Ge.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),Re.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ze(ze)},Ke.onclick=()=>{Ge.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),Ke.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ze(Pe)},$e.onclick=()=>{Ge.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),$e.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ze(Ve)},Ne.onclick=()=>{Ge.forEach((e=>{e.style.backgroundColor="color-mix(in srgb,var(--node-background) 80%,var(--slider-1))"})),Ne.style.backgroundColor="color-mix(in srgb,var(--node-background) 40%,var(--slider-1))",Ze(je)},Oe.appendChild(Re),Oe.appendChild(Ke),Oe.appendChild($e),Oe.appendChild(Ne),Me.appendChild(Oe);let We=document.createElement("div");function Xe(e,t){Object.keys(t).forEach((A=>{e.style[A]=t[A]}))}We.id="unitEditorBehaviorRules",We.style.width="100%",We.style.display="grid",We.style.gridTemplateColumns="1fr 1fr";let Ye={padding:".5rem",backgroundColor:"var(--list-background)",border:"1px solid var(--window-background)",height:"4rem",color:"var(--node-title)"},Je=["move","see","stop","blind","hurt immediately","hurt on turn start","slow*1","slow horse*2","slow*.5","slow horse*1","slow*1.25","slow*2","blind*.5","slow*1.5","slow horse*.5","warp","use","heal","heal*1.5","guard*1.5","avoid*1","guard*1","avoid*.5","avoid*1.5","avoid*2","hidden","stop if enemy","arms","hidden","open"];const Ze=e=>{We.innerHTML="",e.forEach((e=>{let t=document.createElement("div");t.innerHTML=e.left,Xe(t,Ye),We.appendChild(t);let A=document.createElement("div");Xe(A,Ye),A.style.padding="0";let s=document.createElement("div");s.className="w2ui-field expand",s.style.backgroundColor="var(--node-title-background)",s.style.color="var(--node-title)";let n=document.createElement("input");n.id="unitEditorBehaviorTiles"+e.left.replace(" ",""),s.appendChild(n),new i.aG("enum",{items:Je,selected:e.right,el:n,renderDrop:!1,renderMulti:!0,renderInline:!0,renderItems:!0}),A.appendChild(s),We.appendChild(A)}))};Me.appendChild(We),Re.click();const qe=Me;let et=document.createElement("div");et.style.width="100%",et.style.height="100%",et.style.padding="1rem",et.innerHTML="<div><h2>Specials</h2>\nSpecials are a way to add unique behaviors to units.\n";let tt=document.createElement("div");function At(e,t){Object.keys(t).forEach((A=>{e.style[A]=t[A]}))}tt.style.width="100%",tt.style.display="grid",tt.style.gridTemplateColumns="6fr 9fr 1fr";let it={padding:".5rem",backgroundColor:"var(--list-background)",border:"1px solid var(--window-background)",height:"4rem",color:"var(--node-title)"};[{left:"Flees",right:"The unit will flee, avoid enemies, and refuse to attack or counterattack."},{left:"Invincible",right:"The unit is immune to all damage."},{left:"Here to steal",right:"The unit will only approach units with items to steal or chests."},{left:"Will not move",right:"The unit will not move from its starting position."},{left:"Will not attack first",right:"The unit will not attack first."},{left:"Can't be targeted",right:"The unit cannot be targeted by enemies."},{left:"Suicidal",right:"The unit will seek their own death."},{left:"Here for the objective",right:"The unit will only move towards objective tiles, ignoring enemies."},{left:"Protect the leader",right:"The unit will stay adjacent to the leader."},{left:"Will not move until attacked",right:"The unit will not move until attacked."},{left:"Will not move until enemy in range",right:"The unit will not move until an enemy is in range."},{left:"Ignores terrain",right:"The unit can move through any terrain."},{left:"Move through units",right:"The unit can move through other units."},{left:"Kill the avatar",right:"The unit will always attack the avatar."}].forEach((e=>{let t=document.createElement("div");t.innerHTML=e.left,At(t,it),tt.appendChild(t);let A=document.createElement("div");A.innerHTML=e.right,At(A,it),A.style.backgroundColor="var(--node-title)",A.style.color="var(--window-background-alt)",tt.appendChild(A);let i=document.createElement("div");i.innerHTML=`<input type="checkbox" class="w2ui-input" style="width:2rem;height:2rem;" id = "unitEditorBehaviorSpecials${e.left.replace(/ /g,"").replace(/'/g,"")}">`,At(i,it),i.style.backgroundColor="var(--node-title)",i.style.color="var(--window-background-alt)",tt.appendChild(i)})),et.appendChild(tt);const st=et;let nt=new i.Hs({name:"unit-editor-behavior-container-bottom-toolbar",items:[{type:"radio",group:"1",id:"unit-editor-behavior-container-bottom-toolbar-sliders",text:"Sliders",class:"panel-tabs",checked:!0},{type:"radio",group:"1",id:"unit-editor-behavior-container-bottom-toolbar-tiles",text:"Tiles",class:"panel-tabs"},{type:"radio",group:"1",id:"unit-editor-behavior-container-bottom-toolbar-specials",text:"Specials",class:"panel-tabs"}]});nt.on("click",(function(e){e.done((()=>{((e,t)=>{let A=i.GB["unit-editor-behavior-container"];"unit-editor-behavior-container-bottom-toolbar-sliders"===e.detail.item.id?A.html("main",Le):"unit-editor-behavior-container-bottom-toolbar-tiles"===e.detail.item.id?A.html("main",qe):"unit-editor-behavior-container-bottom-toolbar-specials"===e.detail.item.id&&A.html("main",st)})(e)}))}));const rt=new i.Yw({name:"unit-editor-behavior-container",panels:[{type:"main",content:"main",html:Le,style:"overflow-x: hidden"},{type:"bottom",size:30,resizable:!1,content:"bottom",style:"overflow-y: hidden;",html:nt}]});let ot=new i.Hs({name:"unit-editor-bottom-toolbar",items:[{type:"radio",group:"1",id:"unit-editor-bottom-toolbar-basic",text:"Basic Info",class:"panel-tabs",checked:!0},{type:"radio",group:"1",id:"unit-editor-bottom-toolbar-subtype",text:"Subtype",class:"panel-tabs"},{type:"radio",group:"1",id:"unit-editor-bottom-toolbar-behavior",text:"Behavior",class:"panel-tabs",hidden:!0},{type:"radio",group:"1",id:"unit-editor-bottom-toolbar-relationship",text:"Relationships",class:"panel-tabs",hidden:!1}]});ot.on("click",(function(e){e.done((()=>{((e,t)=>{U(window.currentUnit);let A=i.GB.UnitEditor;if("unit-editor-bottom-toolbar-basic"===e.detail.item.id)A.html("main",x),window.UnitEditorActiveTab="basic";else if("unit-editor-bottom-toolbar-subtype"===e.detail.item.id){window.UnitEditorActiveTab="subtype";let e=i.GB["unit-editor-basic-fields"].record.subtype;"Friend"===e?A.html("main",G):"Avatar"===e?A.html("main",Z):"Enemy"===e?A.html("main",ee):"NPC"===e&&A.html("main",Ae)}else"unit-editor-bottom-toolbar-behavior"===e.detail.item.id?(A.html("main",rt),window.UnitEditorActiveTab="behavior"):"unit-editor-bottom-toolbar-relationship"===e.detail.item.id&&(A.html("main",M),window.UnitEditorActiveTab="relationship")})(e)}))}));const lt=ot;let at=new i.Yw({name:"UnitEditor",panels:[{type:"top",size:30,resizable:!1,content:"top",html:D,style:"overflow-y: hidden;"},{type:"main",content:"main",html:x},{type:"left",size:200,resizable:!0,content:"left",html:k},{type:"bottom",size:30,resizable:!1,content:"bottom",html:lt,style:"overflow-y: hidden;"}]});at.on("render",(async function(e){at.html("main",'<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:150%"><h2>Loading units...</h2></div>'),window.allUnits=await S(),window.allUnits.length>0?(window.currentUnit=window.allUnits[0],U(window.currentUnit),at.html("main",x),k.nodes=window.allUnits.map((e=>({id:e.id,text:e.name+" "+e.id}))),k.nodes[0].selected=!0,k.refresh(),window.UnitEditorActiveTab="basic"):at.html("main",'<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:150%"><h2>No units</h2><p>Create a new unit to get started</p><img src = "http://localhost:26068/style/img/nu.png" style="position: fixed;width: 256px;left: 17%;top: 33%;"></div>')}));const dt=at,ct=new i.Yw({name:"ClassEditor",panels:[{type:"top",size:30,resizable:!1,content:"top",html:'<div style="padding: 10px;">Top</div>'},{type:"main",content:"main",html:'<div style="padding: 10px;">Main Class Editor</div>'}]});window.w2popup=i.yN;let ht={};window.GameEditorWeaponTypesAddType=()=>{let e=document.getElementById("weapon-types-table"),t=document.createElement("tr");t.id=Math.floor(1e5*Math.random()),t.innerHTML=`\n    <td><input type = "text" class = "w2ui-input" value="" id = "global-weapon-type-${t.id}-name" onchange = "GameEditorWeaponTypesUpdateType(${w.id})"></td>\n    <td><input type = "text" class = "w2ui-input" value="" id = "global-weapon-type-${t.id}-icon"></td>\n    <td>\n        <div>\n            <input type = "checkbox" id = "global-weapon-type-${t.id}-range-1" onchange = "GameEditorWeaponTypesUpdateType(${w.id})">\n            <label for = "global-weapon-type-${t.id}-range-1">1</label>\n            <input type = "checkbox" id = "global-weapon-type-${t.id}-range-2" onchange = "GameEditorWeaponTypesUpdateType(${w.id})">\n            <label for = "global-weapon-type-${t.id}-range-2">2</label>\n            <input type = "checkbox" id = "global-weapon-type-${t.id}-range-3" onchange = "GameEditorWeaponTypesUpdateType(${w.id})">\n            <label for = "global-weapon-type-${t.id}-range-3">3</label>\n            <input type = "checkbox" id = "global-weapon-type-${t.id}-range-4" onchange = "GameEditorWeaponTypesUpdateType(${w.id})">\n            <label for = "global-weapon-type-${t.id}-range-4">4</label>\n            <input type = "checkbox" id = "global-weapon-type-${t.id}-range-5" onchange = "GameEditorWeaponTypesUpdateType(${w.id})">\n            <label for = "global-weapon-type-${t.id}-range-5">5</label>\n        </div>\n    </td>\n    <td>\n        <select id = "global-weapon-type-${t.id}-default-range" class = "w2ui-input" onchange = "GameEditorWeaponTypesUpdateType(${w.id})">\n        <option value = "1">1</option>\n        <option value = "2">2</option>\n        <option value = "3">3</option>\n        <option value = "4">4</option>\n        <option value = "5">5</option>\n        </select>\n    </td>\n    <td>\n        <button class = "w2ui-btn accent" onclick = "GameEditorWeaponTypesDeleteType(${t.id})"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>\n    </td>\n    `,e.appendChild(t)},window.GameEditorWeaponTypesDeleteType=e=>{if(!window.globalWeaponTypes)return;let t=window.globalWeaponsTypes[0];t.types=t.types.filter((t=>t.id!==e)),globalWeaponsTypes=window.weaponTypes,localStorage.setItem("globalWeaponsTypes",JSON.stringify(t)),document.getElementById(e).remove()},window.GameEditorWeaponTypesUpdateType=e=>{let t=e.id,A=document.getElementById(`global-weapon-type-${t}-name`).value,i=t,s=A.toLowerCase().replace(/ /g,"-"),n=[];for(let e=1;e<=5;e++)document.getElementById(`global-weapon-type-${t}-range-${e}`).checked?n.push(e):n=n.filter((t=>t!==e));let r=document.getElementById(`global-weapon-type-${t}-default-range`).value;if(!window.globalWeaponTypes)return;let o=window.globalWeaponsTypes[0];o.types=o.types.map((e=>(e.id===i&&(e.id=s,e.name=A,e.ranges=n,e.defaultRange=r),e))),window.globalWeaponsTypes=o,localStorage.setItem("globalWeaponsTypes",JSON.stringify(o))};window.GameEditorWeaponTypesPopup=()=>{let e=window.globalWeaponsTypes[0];ht=[JSON.parse(JSON.stringify(e))];let t='<div style = "overflow-y:auto;height:350px;"><table id = "weapon-types-table">',A="<tbody>";e.types.forEach((e=>{A+=`\n    <tr id = "${e.id}">\n    <td><input type = "text" class = "w2ui-input" value=${e.name} id = "global-weapon-type-${e.id}-name" onchange = "GameEditorWeaponTypesUpdateType(${e.id})"></td>\n    <td>${""===e.icon?"no icon":e.icon}</td>\n    <td>\n        <div>\n            <input type = "checkbox" onchange = "GameEditorWeaponTypesUpdateType(${e.id})" id = "global-weapon-type-${e.id}-range-1" ${e.ranges.includes(1)?"checked":""}>\n            <label for = "global-weapon-type-${e.id}-range-1">1</label>\n            <input type = "checkbox" onchange = "GameEditorWeaponTypesUpdateType(${e.id})" id = "global-weapon-type-${e.id}-range-2" ${e.ranges.includes(2)?"checked":""}>\n            <label for = "global-weapon-type-${e.id}-range-2">2</label>\n            <input type = "checkbox" onchange = "GameEditorWeaponTypesUpdateType(${e.id})" id = "global-weapon-type-${e.id}-range-3" ${e.ranges.includes(3)?"checked":""}>\n            <label for = "global-weapon-type-${e.id}-range-3">3</label>\n            <input type = "checkbox"  onchange = "GameEditorWeaponTypesUpdateType(${e.id})" id = "global-weapon-type-${e.id}-range-4" ${e.ranges.includes(4)?"checked":""}>\n            <label for = "global-weapon-type-${e.id}-range-4">4</label>\n            <input type = "checkbox" onchange = "GameEditorWeaponTypesUpdateType(${e.id})" id = "global-weapon-type-${e.id}-range-5" ${e.ranges.includes(5)?"checked":""}>\n            <label for = "global-weapon-type-${e.id}-range-5">5</label>\n        </div>\n    </td>\n    <td>\n        <select id = "global-weapon-type-${e.id}-default-range" class = "w2ui-input" onchange = "GameEditorWeaponTypesUpdateType(${e.id})">\n            <option value = "1" ${1===e.defaultRange?"selected":""}>1</option>\n            <option value = "2" ${2===e.defaultRange?"selected":""}>2</option>\n            <option value = "3" ${3===e.defaultRange?"selected":""}>3</option>\n            <option value = "4" ${4===e.defaultRange?"selected":""}>4</option>\n            <option value = "5" ${5===e.defaultRange?"selected":""}>5</option>\n        </select>\n    </td>\n    <td>\n        <button class = "w2ui-btn accent" onclick = "GameEditorWeaponTypesDeleteType(${e.id})"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>\n    </td>\n    </tr>\n    `})),t+='<thead style = "font-weight:bold;margin-bottom:.5rem;text-align:center;"><tr><td>Name</td><td>Icon</td><td>Ranges</td><td>Default</td><td>Delete</td></tr>',t+="</thead>",t+=A,t+='</tbody></table><button class = "w2ui-btn" style = "margin-top:1rem;margin-bottom:1rem;" onclick = "GameEditorWeaponTypesAddType()">Add type</button></div>',i.yN.open({title:"Weapon Types",body:t,height:480,width:700,actions:["Ok","Cancel"]}).ok((e=>{document.getElementById("weapon-types-table").querySelectorAll("tr").forEach((e=>{""!==e.id&&e.id&&GameEditorWeaponTypesUpdateType(e)}));let t={...globalWeaponsTypes[0]};t.id=globalWeaponsTypes[0].id,window.updateQueue("globalWeaponsTypes","update",t),i.yN.close()})).cancel((e=>{globalWeaponsTypes=ht,i.yN.close()}))};const ut=(e,t,A,i)=>{let s=document.createElement("div"),n=e,r=document.createElement("div");r.className="Triangle-outerTriangle";let o=document.createElement("div");o.className="Triangle-innerTriangle";let l=document.createElement("select");l.multiple=!0,l.className="Triangle-box1";let a=document.createElement("select");a.className="Triangle-box2",a.multiple=!0;let d=document.createElement("select");d.className="Triangle-box3",d.multiple=!0;let c=document.createElement("div");c.className="Triangle-box4";let h=document.createElement("div");h.className="Triangle-box5";let u=document.createElement("div");u.className="Triangle-box6",c.innerHTML='<svg style = "transform:rotate(58deg)" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-move-right"><path d="M18 8L22 12L18 16"/><path d="M2 12H22"/></svg>',h.innerHTML='<svg style = "transform:rotate(-238deg)" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-move-left"><path d="M6 8L2 12L6 16"/><path d="M2 12H22"/></svg>',u.innerHTML='<svg style = "transform:rotate(180deg)" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-move-right"><path d="M18 8L22 12L18 16"/><path d="M2 12H22"/></svg>';let p={topCorner:l,leftCorner:a,rightCorner:d};Object.keys(p).forEach((e=>{let t=i.find((t=>t.el===e));if(!t)return;p[e].id=t.id,t.options.forEach((A=>{let i=document.createElement("option");i.value=A.id,i.innerText=A.text,i.selected=t.selected.includes(A.id),p[e].appendChild(i)}));let A=()=>{t.options=Array.from(p[e].children).map((e=>({id:e.value,text:e.innerText,selected:e.selected}))),t.selected=t.options.filter((e=>e.selected)).map((e=>e.id))};A(),p[e].onclick=()=>{A()}}));let g=document.createElement("style"),m=`\n    .Triangle-innerTriangle,.Triangle-outerTriangle{width:0;height:0;border-style:solid;transform:rotate(0deg)}.Triangle-outerTriangle{border-width:0 calc(50px*${n}) calc(75px*${n});border-color:transparent transparent ${A}}.Triangle-innerTriangle{position:relative;margin-left:calc(-46px*${n});top:calc(3px*${n});border-width:0 calc(46px*${n}) calc(70px*${n});border-color:transparent transparent ${t}}.Triangle-box1,.Triangle-box2,.Triangle-box3,.Triangle-box4,.Triangle-box5,.Triangle-box6{position:absolute;width:min-content;padding:1rem}.Triangle-box1{top:0;left:calc(50%);transform:translateX(-50%)}.Triangle-box2,.Triangle-box3{top:calc(75px*${n});transform:translateY(-50%)}.Triangle-box2{left:calc(${n}*-50px)}.Triangle-box3{right:calc(${n}*-50px)}.Triangle-box4{right:calc(${n}*-27px);top:calc(37.5px*${n});transform:translateY(-50%) translateX(50%)}.Triangle-box5,.Triangle-box6{transform:translateY(-50%) translateX(-50%)}.Triangle-box5{left:calc(${n}*-27px);top:calc(37.5px*${n})}.Triangle-box6{top:calc(75px*${n})}`;return g.innerText=m,s.appendChild(g),r.appendChild(o),r.appendChild(l),r.appendChild(a),r.appendChild(d),r.appendChild(c),r.appendChild(h),r.appendChild(u),s.appendChild(r),{html:s,fields:i}};window.w2popup=i.yN;window.GameEditorWeaponTrianglesPopup=()=>{globalWeaponsTypes&&0!==globalWeaponsTypes.length&&globalWeaponsTypes[0].types||(localStorage.clear(),window.location.reload());let e=document.createElement("div");e.style.height="100%",e.style.width="100%";let t=new i.Yw({name:"GameEditorWeaponMagicTrianglesPopupLayout",panels:[{type:"main",content:"main",toolbar:{items:[{type:"radio",group:"1",id:"game-editor-weapon-magic-triangles-popup-weapons",text:"Weapons",class:"panel-tabs",checked:!0},{type:"radio",group:"1",id:"game-editor-weapon-magic-triangles-popup-magic",text:"Magic",class:"panel-tabs"}],onClick(e){console.log(e.target)}}}],style:"height:100%"}),A=[{id:"GameEditorWeaponTriangleFieldsTopCorner",el:"topCorner",type:"select",options:globalWeaponsTypes[0].types.map((e=>({id:e.id,text:e.name}))),selected:GameEditorWeaponTriangleFieldsTopCorner&&GameEditorWeaponTriangleFieldsTopCorner.length>0?GameEditorWeaponTriangleFieldsTopCorner:[]},{id:"GameEditorWeaponTriangleFieldsLeftCorner",el:"leftCorner",type:"select",options:globalWeaponsTypes[0].types.map((e=>({id:e.id,text:e.name}))),selected:GameEditorWeaponTriangleFieldsLeftCorner&&GameEditorWeaponTriangleFieldsLeftCorner?GameEditorWeaponTriangleFieldsLeftCorner:[]},{id:"GameEditorWeaponTriangleFieldsRightCorner",el:"rightCorner",type:"select",options:globalWeaponsTypes[0].types.map((e=>({id:e.id,text:e.name}))),selected:GameEditorWeaponTriangleFieldsRightCorner&&GameEditorWeaponTriangleFieldsRightCorner.length>0?GameEditorWeaponTriangleFieldsRightCorner:[]}],s=[{id:"GameEditorMagicTriangleFieldsTopCorner",el:"topCorner",type:"select",options:globalMagicTypes[0].types.map((e=>({id:e.id,text:e.name}))),selected:GameEditorMagicTriangleFieldsTopCorner&&GameEditorMagicTriangleFieldsTopCorner.length>0?GameEditorMagicTriangleFieldsTopCorner:[]},{id:"GameEditorMagicTriangleFieldsLeftCorner",el:"leftCorner",type:"select",options:globalMagicTypes[0].types.map((e=>({id:e.id,text:e.name}))),selected:GameEditorMagicTriangleFieldsLeftCorner&&GameEditorMagicTriangleFieldsLeftCorner?GameEditorMagicTriangleFieldsLeftCorner:[]},{id:"GameEditorMagicTriangleFieldsRightCorner",el:"rightCorner",type:"select",options:globalMagicTypes[0].types.map((e=>({id:e.id,text:e.name}))),selected:GameEditorMagicTriangleFieldsRightCorner&&GameEditorMagicTriangleFieldsRightCorner.length>0?GameEditorMagicTriangleFieldsRightCorner:[]}],n=ut(3.5,"var(--window-background)","var(--window-background-alt)",A),r=ut(3.5,"var(--window-background)","var(--window-background-alt)",s),o=n.html;t.html("main",o),t.render(e),window.GameEditorWeaponMagicTrianglesPopupLayout=t;let l=n.fields;GameEditorWeaponMagicTrianglesPopupLayout.panels[0].toolbar.items[0].onClick=()=>{let A=n.html;t.html("main",A),t.render(e),l=n.fields,t.refresh()},GameEditorWeaponMagicTrianglesPopupLayout.panels[0].toolbar.items[1].onClick=()=>{let A=r.html;t.html("main",A),t.render(e),l=r.fields,t.refresh()},i.yN.open({title:"Weapon/magic triangles",body:e,actions:["Ok","Cancel"],height:500,width:500}).ok((e=>{console.log(l),l.some((e=>0===e.selected.length))?(0,i.mJ)("All corners must have at least one type selected."):3===new Set(l.flatMap((e=>e.selected))).size?(i.yN.close(),l.forEach((e=>{window[e.id]=e.options.filter((e=>e.selected)).map((e=>e.id)),e.selected=e.options.filter((e=>e.selected)).map((e=>e.id)),console.log(e.selected)}))):(0,i.mJ)("All corners must have different types selected")})).cancel((e=>{i.yN.close()})).then((()=>{GameEditorWeaponMagicTrianglesPopupLayout.panels[0].toolbar.refresh()}))},window.w2popup=i.yN;let pt={};window.GameEditorMagicTypesAddType=()=>{let e=document.getElementById("magic-types-table"),t=document.createElement("tr");t.id=Math.floor(1e5*Math.random()),t.innerHTML=`\n    <td><input type = "text" class = "w2ui-input" value="" id = "global-magic-type-${t.id}-name" onchange = "GameEditorMagicTypesUpdateType(${w.id})"></td>\n    <td><input type = "text" class = "w2ui-input" value="" id = "global-magic-type-${t.id}-icon"></td>\n    <td>\n        <button class = "w2ui-btn accent" onclick = "GameEditorMagicTypesDeleteType(${t.id})"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>\n    </td>\n    `,e.appendChild(t)},window.GameEditorMagicTypesDeleteType=e=>{if(!window.globalMagicTypes)return;let t=window.globalMagicTypes[0];t.types=t.types.filter((t=>t.id!==e)),globalMagicTypes=[t],document.getElementById(e).remove()},window.GameEditorMagicTypesUpdateType=e=>{let t=e.id,A=document.getElementById(`global-magic-type-${t}-name`).value,i=t,s=A.toLowerCase().replace(/ /g,"-");if(!window.globalMagicTypes)return;let n=window.globalMagicTypes[0];n.types=n.types.map((e=>(e.id===i&&(e.id=s,e.name=A),e))),window.globalMagicTypes=[n]};window.GameEditorMagicTypesPopup=()=>{let e=window.globalMagicTypes[0];pt=[JSON.parse(JSON.stringify(e))];let t='<div style = "overflow-y:auto;height:350px;"><table id = "magic-types-table">',A="<tbody>";e.types.forEach((e=>{A+=`\n    <tr id = "${e.id}">\n    <td><input type = "text" class = "w2ui-input" value=${e.name} id = "global-magic-type-${e.id}-name" onchange = "GameEditorMagicTypesUpdateType(${e.id})"></td>\n    <td>${""===e.icon?"no icon":e.icon}</td>\n    <td>\n        <button class = "w2ui-btn accent" onclick = "GameEditorMagicTypesDeleteType(${e.id})"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>\n    </td>\n    </tr>\n    `})),t+='<thead style = "font-weight:bold;margin-bottom:.5rem;text-align:center;"><tr><td>Name</td><td>Icon</td><td>Delete</td></tr>',t+="</thead>",t+=A,t+='</tbody></table><button class = "w2ui-btn" style = "margin-top:1rem;margin-bottom:1rem;" onclick = "GameEditorMagicTypesAddType()">Add type</button></div>',i.yN.open({title:"Magic Types",body:t,height:400,width:400,actions:["Ok","Cancel"]}).ok((e=>{document.getElementById("magic-types-table").querySelectorAll("tr").forEach((e=>{""!==e.id&&e.id&&GameEditorMagicTypesUpdateType(e)}));let t={...globalMagicTypes[0]};t.id=globalMagicTypes[0].id,window.updateQueue("globalMagicTypes","update",t),i.yN.close()})).cancel((e=>{globalMagicTypes=pt,i.yN.close()}))};var gt=A(947);const mt={weaponsCanBeForged:"Weapons can be forged",weaponsCanBeRepaired:"Weapons can be repaired",unitsCanHaveChildren:"Units can have children",useExperienceSublevels:"Use experience sublevels",useExperienceAptitudes:"Use experience aptitudes",combatCombatArts:"Combat arts",combatWeaponTriangle:"Weapon triangle",combatExpandedWeaponTriangle:"Expanded weapon triangle",combatMagicTriangle:"Magic triangle",combatBattalions:"Battalions",combatBattalionEndurance:"Battalion endurance",combatPairUp:"Pair up",combatAdjutants:"Adjutants",combatAdjutantHeal:"Adjutant heal",combatAdjutantGuard:"Adjutant guard",combatAdjutantAttack:"Adjutant attack",statsUseExtraStatWeight:"Use extra stat weight",statsExtraStatWeightAffectsMovement:"Extra stat weight affects movement",statsUseExtraStatLuck:"Use extra stat luck",combatSeparateCritAvoid:"Separate crit avoid",statsUseExtraStatAuthority:"Use extra stat authority",statsUseExtraStatCharm:"Use extra stat charm",statsAptitudesUseRiding:"Aptitudes use riding",statsAptitudesUseFlying:"Aptitudes use flying",statsAptitudesUseAuthority:"Aptitudes use authority",statsAptitudesUseArmor:"Aptitudes use armor",combatCombatArtLimit:"Combat art limit",combatWeaponTriangleAdvantage:"Weapon triangle advantage",combatWeaponTriangleDisadvantage:"Weapon triangle disadvantage",combatMagicTriangleAdvantage:"Magic triangle advantage",combatMagicTriangleDisadvantage:"Magic triangle disadvantage",combatBattalionLimit:"Battalion limit",unitEditorAvatarDefaultHairColor:"Avatar default hair color",unitEditorAvatarDefaultEyeColor:"Avatar default eye color",combatTriangleMapping:"Combat triangle mapping",combatMagicTriangleMapping:"Combat magic triangle mapping",globalWeaponsTypes:"Global weapons types",combatTriangleTypes:"Combat triangle types",combatNeutralTypes:"Combat neutral types",combatMagicTriangleTypes:"Combat magic triangle types",combatNeutralMagicTypes:"Combat neutral magic types",aptitudeGoals:"(Friendly/avatar) units have aptitude goals",UseWeatherOnLevels:"Use weather on levels",unitEditorAvatarDefaultSkinColor:"Avatar default skin color",unitEditorAvatarDefaultHairStyle:"Avatar default hair style"},ft={useExperienceSublevels:"Use experience sublevels",useExperienceAptitudes:"Use experience aptitudes",combatCombatArts:"Combat arts",combatWeaponTriangle:"Weapon triangle",combatExpandedWeaponTriangle:"Expanded weapon triangle",combatMagicTriangle:"Magic triangle",combatBattalions:"Battalions",combatBattalionEndurance:"Battalion endurance",combatPairUp:"Pair up",combatAdjutants:"Adjutants",statsExtraStatWeightAffectsMovement:"Extra stat weight affects movement",combatSeparateCritAvoid:"Separate crit avoid",combatWeaponTriangleAdvantage:"Weapon triangle advantage",combatWeaponTriangleDisadvantage:"Weapon triangle disadvantage",combatMagicTriangleAdvantage:"Magic triangle advantage",combatMagicTriangleDisadvantage:"Magic triangle disadvantage",combatTriangleMapping:"Combat triangle mapping",combatMagicTriangleMapping:"Combat magic triangle mapping",globalWeaponsTypes:"Global weapons types",combatTriangleTypes:"Combat triangle types",combatNeutralTypes:"Combat neutral types",combatMagicTriangleTypes:"Combat magic triangle types",combatNeutralMagicTypes:"Combat neutral magic types",UseWeatherOnLevels:"Use weather on levels"};let wt={name:"game-editor-global-fields",record:{},fields:[{type:"html",html:{html:'<h3 style = "margin-top:2rem;padding-top:.5rem;">General</h3>'}}]};wt.fields.push({field:"UseWeatherOnLevels",type:"checkbox",attr:'style="width:100%"',html:{text:ft.UseWeatherOnLevels?mt.UseWeatherOnLevels+'<sup><highlight class="tooltip" aria-label="'+ft.UseWeatherOnLevels+'" data-balloon-pos="up">?</highlight></sup>':mt.UseWeatherOnLevels,class:"no-label",style:"width:100%;",column:0}}),wt.record.UseWeatherOnLevels=window.UseWeatherOnLevels;let Bt={useExperienceAptitudes:"Combat",combatAdjutantAttack:"Unit stats",statsUseExtraStatCharm:"Aptitudes"},yt={combatBattalionLimit:"Avatar defaults"},bt={unitEditorAvatarDefaultHairStyle:"Weapons"};gt.S4.forEach((e=>{wt.fields.push({field:e,type:"checkbox",attr:'style="width:100%"',html:{text:ft[e]?mt[e]+'<sup><highlight class="tooltip" aria-label="'+ft[e]+'" data-balloon-pos="up">?</highlight></sup>':mt[e],class:"no-label",style:"width:100%;",column:0}}),wt.record[e]=window[e],Bt[e]&&wt.fields.push({type:"html",html:{html:`<h3 style = "margin-top:2rem;padding-top:.5rem;">${Bt[e]}</h3>`,class:"no-label",column:0}})})),wt.fields.push({type:"html",html:{html:'<h3 style = "margin-top:2rem;padding-top:.5rem;">Combat</h3>',class:"no-label",column:1}}),gt.mp.forEach((e=>{wt.fields.push({field:e,type:"int",html:{text:ft[e]?mt[e]+'<sup><highlight class="tooltip" aria-label="'+ft[e]+'" data-balloon-pos="up">?</highlight></sup>':mt[e],class:"no-label",column:1}}),wt.record[e]=window[e],yt[e]&&wt.fields.push({type:"html",html:{html:`<h3 style = "margin-top:2rem;padding-top:.5rem;">${yt[e]}</h3>`,class:"no-label",column:1}})})),gt.P$.forEach((e=>{wt.fields.push({field:e,type:"text",html:{text:ft[e]?mt[e]+'<sup><highlight class="tooltip" aria-label="'+ft[e]+'" data-balloon-pos="up">?</highlight></sup>':mt[e],class:"no-label",column:1}}),wt.record[e]=window[e],bt[e]&&wt.fields.push({type:"html",html:{html:`<h3 style = "margin-top:2rem;padding-top:.5rem;">${bt[e]}</h3>`,class:"no-label",column:1}})})),wt.fields.push({type:"html",html:{html:'<button class="w2ui-btn accent big" onclick="window.GameEditorWeaponTypesPopup()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-swords"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" x2="19" y1="19" y2="13"/><line x1="16" x2="20" y1="16" y2="20"/><line x1="19" x2="21" y1="21" y2="19"/><polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5"/><line x1="5" x2="9" y1="14" y2="18"/><line x1="7" x2="4" y1="17" y2="20"/><line x1="3" x2="5" y1="19" y2="21"/></svg>Weapon types</button>',column:1}}),wt.fields.push({type:"html",html:{html:'<button class="w2ui-btn accent big" onclick="window.GameEditorMagicTypesPopup()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/></svg>Magic types</button>',column:1}}),wt.fields.push({field:"weaponTrianglesButton",type:"html",html:{html:'<button class="w2ui-btn accent big" onclick="window.GameEditorWeaponTrianglesPopup()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle"><path d="M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/></svg>Weapon/magic triangles</button>',class:"no-label",column:1},hidden:!1});let vt=new i.sk(wt);window.GameEditorGlobalFields=vt,vt.on("change",(function(e){((e,t)=>{"combatAdjutants"===e.detail.field&&!0===e.detail.value.current&&!0===t.record.combatPairUp?((0,i.mJ)("You cannot have combat adjutants and pair up. Pair up has been disabled."),t.record.combatPairUp=!1,t.record.combatAdjutantHeal=!0,t.record.combatAdjutantAttack=!0,t.record.combatAdjutantGuard=!0,t.refresh()):"combatPairUp"===e.detail.field&&!0===e.detail.value.current&&!0===t.record.combatAdjutants?((0,i.mJ)("You cannot have combat adjutants and pair up. Combat adjutants have been disabled."),t.record.combatAdjutants=!1,t.record.combatAdjutantHeal=!1,t.record.combatAdjutantAttack=!1,t.record.combatAdjutantGuard=!1,t.refresh()):"combatWeaponTriangle"===e.detail.field?!0===e.detail.value.current?(t.show("combatExpandedWeaponTriangle"),t.show("combatMagicTriangle"),t.show("weaponTrianglesButton")):(t.hide("combatExpandedWeaponTriangle"),t.hide("combatMagicTriangle"),t.hide("weaponTrianglesButton")):"weaponsCanBeForged"!==e.detail.field&&"weaponsCanBeRepaired"!==e.detail.field||window.objectEditorBottomToolbar&&window.objectEditorBottomToolbar.refresh(),window[e.detail.field]=e.detail.value.current,(0,gt.iH)(),window.updateQueue("generalSettings","update",t.record),window.updateQueue("CombatExtras","update",t.record)})(e,vt)}));const Ct=vt;window.newUserOnboardingGameDetails="true"===sessionStorage.getItem("newUserOnboardingGameDetails"),sessionStorage.getItem("newUserOnboardingGameDetails")||(sessionStorage.setItem("newUserOnboardingGameDetails",!0),window.newUserOnboardingGameDetails=!0),window.gameEditorGameDetailsFinishInitialAndNext=()=>{let e=i.GB.GameEditor,t=i.GB["game-editor-bottom-toolbar"];t.show("game-editor-bottom-toolbar-game-settings"),t.show("game-editor-bottom-toolbar-assets"),t.show("game-editor-bottom-toolbar-build-and-export"),t.click("game-editor-bottom-toolbar-game-settings");let A=i.GB.EditorWindowStatusBar;A.set("status-bar-project-status",{text:"game details saved"}),setTimeout((()=>{A.set("status-bar-project-status",{text:""}),A.hide("status-bar-project-status")}),5e3),e.html("main",Ct);let s=i.GB.EditorWindowSidebar;s.get("sidebar-editors-list").nodes.forEach((e=>{s.enable(e.id)})),window.newUserOnboardingGameDetails&&((0,i.mJ)('<p>You can now access the other editors in the left sidebar, as well as more advanced game settings. Please see <a href = "https://docs.turnroot.com/getting-started/your-first-hour-in-the-turnroot-editor" style = "display:inline;color:var(--accent)">your first hour</a> for a guided tour on what to do next and where everything is.</p> <div style = "height:2rem;"/>',"<h3>Game details saved</h3>"),window.newUserOnboardingGameDetails=!1,sessionStorage.setItem("newUserOnboardingGameDetails",!1))};let xt=new i.sk({name:"gameEditorRequiredGameDetails",record:{gameDifficulty:["Normal","Easy","Hard"],gameMode:["Casual","Classic"],gameAuthorDisplayName:"Game Creator: your username\nGame Artist: a username\nGame Musician: another username\nGame Designer: yet another username\nGame Tester: a fifth username\n"},fields:[{type:"html",html:{html:"<h2>Basic Game Details</h2><p>You must fill out these fields before any other editors are available.</p>",style:"text-align:left;font-size:150%;overflow:hidden;margin:auto;margin-bottom:2rem;"}},{field:"gameName",type:"text",required:!0,html:{label:"Game Name",attr:'style="width: 100%;font-size:150%;"',class:"emphasized-field full-width-field"}},{field:"gameSubtitle",type:"text",required:!0,html:{label:"Game Subtitle",attr:'style="width: 100%;font-size:150%;"',class:"emphasized-field full-width-field"}},{type:"html",html:{html:'<p style = "width:100%;max-width:100%!important;">The game subtitle is for long, multi-part titles<sup aria-label="Say you wanted to name your game something like Icy Shield: Lineage of the Evil War - Heirs of Photonic Rays.  \'Heirs of Photonic Rays\' would be your subtitle" data-balloon-length="large" data-balloon-pos="up"><highlight>?</highlight></sup>. A subtitle is optional.</p>',class:"full-width-field"}},{field:"gameDescription",type:"text",required:!0,html:{label:"Description",attr:'style="width: 100%;"',class:"emphasized-field full-width-field"}},{field:"gameAuthorDisplayName",type:"textarea",required:!0,html:{label:"Game Creator Credits",attr:'style="width: 100%;"',class:"emphasized-field full-width-field"}},{type:"html",html:{html:"<p style = \"width:100%;max-width:100%!important;\">Put one credit per line. If you're not sure of all credits yet, that's fine, just list yourself. You can edit this later.</small>",class:"full-width-field"}},{type:"file",field:"gameIcon",required:!1,html:{label:"Game Icon",class:"emphasized-field full-width-field"}},{type:"html",html:{html:'<p style = "width:100%;max-width:100%!important;">The game icon should be a square image, at least 200px on each side. If you don\'t provide one, a default will be used. You can replace this later.</p>',class:"full-width-field"}},{type:"checks",field:"gameDifficulty",required:!0,options:{items:["Beginner","Easy","Normal","Hard","Insane","Maddening"]},html:{label:"Game Difficulties",class:"emphasized-field full-width-field"}},{type:"html",html:{html:'<p style = "width:100%;max-width:100%!important;"><highlight>Important!</highlight> When working on units or other game components, you will have the option to change things by difficulty (i.e., add reinforcements to a level on Hard or above), but the base stats, growth rates, etc, you will be setting are for Normal difficulty.<sup aria-label="You can set scalars that impact these stats for different difficulty levels- just bear in mind that if, for example, you\'re using stats on a wiki for an existing game as a guide, you should use the Normal stats." data-balloon-length="large" data-balloon-pos="up"><highlight>so...?</highlight></sup></p>'}},{type:"checks",field:"gameMode",required:!0,options:{items:["Casual","Classic","Casual (Lose Items)","Casual (Stat Penalty)"]},html:{label:"Game Modes",class:"emphasized-field full-width-field"}},{type:"html",html:{html:'<ul><li>Casual: "dead" units retreat and rejoin you in the next battle</li><li>Classic: dead units are gone forever</li><li>Casual (Lose Items): "dead" units retreat and rejoin, but lose their inventory at time of death</li><li>Casual (Stat Penalty): "dead" units retreat and rejoin, but come back with lowered stats.</li></ul>',class:"full-width-field"}},{type:"html",html:{html:'<div><p>When you\'re happy with the settings above, click Next to move on to more advanced game settings. Clicking Next will also unlock the other editors.</p><button class="w2ui-btn" onclick="window.gameEditorGameDetailsFinishInitialAndNext()" style="width:100%;font-size:150%;">Next</button></div>'}}]});xt.on("change",(function(e){((e,t)=>{console.log(e),window[e.detail.field]=e.detail.value.current,(0,gt.iH)(),window.updateQueue("gameDetails","update",t.record)})(e,xt)})),window.GameEditorRequiredGameDetails=xt;const Qt=xt;let Ft=new i.Hs({name:"game-editor-bottom-toolbar",items:[{type:"radio",group:"1",id:"game-editor-bottom-toolbar-game-details",text:"Game details",class:"panel-tabs",checked:!0},{type:"radio",group:"1",id:"game-editor-bottom-toolbar-game-settings",text:"Game settings",class:"panel-tabs",hidden:!0},{type:"radio",group:"1",id:"game-editor-bottom-toolbar-assets",text:"Assets",class:"panel-tabs",hidden:!0},{type:"radio",group:"1",id:"game-editor-bottom-toolbar-build-and-export",text:"Build and export",class:"panel-tabs",hidden:!0}]});Ft.on("click",(function(e){e.done((()=>{((e,t)=>{window.turnrootEditorLogs.push(`${new Date}||info||GameEditor bottom toolbar button clicked: ${e.detail.item.id}`);let A=i.GB.GameEditor;"game-editor-bottom-toolbar-game-details"===e.detail.item.id?A.html("main",Qt):"game-editor-bottom-toolbar-game-settings"===e.detail.item.id&&A.html("main",Ct)})(e)}))})),Ft.on("render",(function(e){!1===window.newUserOnboardingGameDetails&&(Ft.show("game-editor-bottom-toolbar-game-settings"),Ft.show("game-editor-bottom-toolbar-assets"),Ft.show("game-editor-bottom-toolbar-build-and-export"))}));const Ut=Ft;let Et=new i.Yw({name:"GameEditor",panels:[{type:"main",content:"main",html:Qt},{type:"bottom",size:30,resizable:!1,content:"bottom",html:Ut,style:"overflow-y: hidden;"}]});Et.on("render",(async function(e){window.globalWeaponsTypes&&0!==window.globalWeaponsTypes.length&&window.globalWeaponsTypes[0].types||(window.globalWeaponsTypes=await(async()=>{console.log("getting all weapon types");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"globalWeaponsTypes",method:"get"}]})},t=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));return t.ok?t.json():[]})()),window.globalMagicTypes&&0!==window.globalMagicTypes.length&&window.globalMagicTypes[0].types||(window.globalMagicTypes=await(async()=>{console.log("getting all magic types");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"globalMagicTypes",method:"get"}]})},t=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));return t.ok?t.json():[]})()),window.globalGameDetails?(window.GameEditorRequiredGameDetails.record=window.globalGameDetails[0],window.GameEditorRequiredGameDetails.refresh()):(window.globalGameDetails=await(async()=>{console.log("getting game details");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"gameDetails",method:"get"}]})},t=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));return t.ok?t.json():[]})(),window.GameEditorRequiredGameDetails.record=window.globalGameDetails[0],window.GameEditorRequiredGameDetails.refresh()),window.globalGeneralSettings||(window.globalGeneralSettings=await(async()=>{console.log("getting game general settings");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"generalSettings",method:"get"}]})},t=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));return t.ok?t.json():[]})(),window.globalGeneralSettings.forEach((e=>{window[e.setting]=e.value,window.GameEditorGlobalFields.record[e.setting]=e.value})),window.GameEditorGlobalFields.refresh())}));const kt=Et;let It,Ht=[{name:"backgroundRim",x:0,y:0,width:200,height:200,url:"/style/img/placeholder-circle.png",transform:"",transparent:!1},{name:"backgroundColor",x:0,y:0,width:200,height:200,url:"",transform:"",transparent:!1},{name:"graphic1",x:0,y:0,width:200,height:200,url:"",transform:"",transparent:!1},{name:"graphic2",x:0,y:0,width:200,height:200,url:"",transform:"",transparent:!0},{name:"graphic3",x:0,y:0,width:200,height:200,url:"",transform:"",transparent:!0},{name:"graphic4",x:0,y:0,width:200,height:200,url:"",transform:"",transparent:!0}],St={topLeft:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>',topCenter:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-move-up"><path d="M8 6L12 2L16 6"/><path d="M12 2V22"/></svg>',topRight:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-cw"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>',centerLeft:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-move-left"><path d="M6 8L2 12L6 16"/><path d="M2 12H22"/></svg>',center:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-locate-off"><line x1="2" x2="5" y1="12" y2="12"/><line x1="19" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="5"/><line x1="12" x2="12" y1="19" y2="22"/><path d="M7.11 7.11C5.83 8.39 5 10.1 5 12c0 3.87 3.13 7 7 7 1.9 0 3.61-.83 4.89-2.11"/><path d="M18.71 13.96c.19-.63.29-1.29.29-1.96 0-3.87-3.13-7-7-7-.67 0-1.33.1-1.96.29"/><line x1="2" x2="22" y1="2" y2="22"/></svg>',centerRight:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-move-right"><path d="M18 8L22 12L18 16"/><path d="M2 12H22"/></svg>',bottomLeft:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-minimize-2"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" x2="21" y1="10" y2="3"/><line x1="3" x2="10" y1="21" y2="14"/></svg>',bottom:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-move-down"><path d="M8 18L12 22L16 18"/><path d="M12 2V22"/></svg>',bottomRight:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize-2"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>'};var Tt=A(354);const _t=class{constructor(e,t="icon"){this.layers=[],this.htmlObjects=[],this.box=e,this.box.style.position="relative",this.box.style.overflow="hidden"}addLayer(e){e.x||(e.x=0),e.y||(e.y=0),this.layers.push(e);let t=document.createElement("div"),A=document.createElement("div");t.style.position="absolute",A.style.position="absolute",t.style.width=e.width+"px",t.style.height=e.height+"px",A.style.width=e.width+"px",A.style.height=e.height+"px",A.style.backgroundSize="cover",t.style.backgroundSize="cover",t.style.top=e.y+8+"px",t.style.left=e.x+8+"px",t.style.zIndex=8e3+this.layers.length,e.transparent||(A.style.backgroundImage="url("+e.url+")"),t.appendChild(A),this.box.appendChild(t),this.htmlObjects.push(t)}updateLayer(e,t){this.htmlObjects[e].childNodes[0].style.backgroundImage="url("+t.url+")",this.layers[e].url=t.url}removeLayer(e){this.layers.splice(e,1),this.htmlObjects.splice(e,1),this.box.removeChild(this.box.childNodes[layer])}clear(){this.layers=[],this.box.innerHTML=""}transform(e,t){let A=this.htmlObjects[e],i=A.childNodes[0],s=t.split(" "),n="";s.forEach((e=>{if(e.includes("rotate")){let t=e.replace("rotate(","").replace("deg)","");i.style.transform="rotate("+t+"deg)"}else n+=e+" "})),A.style.transform=n,this.layers[e].transform=t}render(){return this.box}async flatten(){return(async e=>(await Tt(e,{backgroundColor:null,allowTaint:!0})).toDataURL("image/png"))(this.box)}};let Dt=new i.Yw({name:"iconEditorEditor",panels:[{type:"right",content:"right",size:"400",style:"overflow: hidden;",html:"icon editor left"},{type:"main",content:"main",resizable:!0,style:"padding:1rem;"}]});const Lt=(e,t)=>{e.innerHTML=t.innerHTML,e.style.transform="scale(0.25)",e.style.backgroundColor="var(--window-background-alt)",e.style.borderRadius="99rem",e.style.marginTop="1rem",e.style.width="216px",e.style.height="216px",e.style.overflow="hidden",e.style.position="relative",e.style.left="-80px",e.style.top="-92px"};Dt.html("main",(()=>{const e=document.createElement("div"),t=document.createElement("div");t.style.cssText="display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr 1fr; gap: 0.25rem .15rem; width: 6rem; margin-top: 1rem";const A=document.createElement("div");A.style.cssText="background-color: var(--window-background-alt); padding: 1rem; border-radius: 0.5rem";const i=document.createElement("h2");i.innerHTML="Layers",Object.entries(St).forEach((([e,A])=>{t.appendChild((e=>{const t=document.createElement("button");t.innerHTML=e.svg,t.className="w2ui-btn",t.style.cssText="width: 2rem; height: 4rem; padding: 0",t.setAttribute("button-is-held-down","false");const A=()=>{if(""===window.IconEditorGraphicStacksCurrentLayer.transform&&(window.IconEditorGraphicStacksCurrentLayer.transform="rotate(0deg) translateY(0px) translateX(0px) scale(1)"),console.log(window.IconEditorGraphicStacksCurrentLayer.transform),"topLeft"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/rotate\(([^)]+)\)/),t=`rotate(${(e?parseFloat(e[1]):0)-1}deg)`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/rotate\(([^)]+)\)/,t)}else if("topCenter"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/translateY\(([^)]+)\)/),t=`translateY(${(e?parseFloat(e[1]):0)-1}%)`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/translateY\(([^)]+)\)/,t)}else if("topRight"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/rotate\(([^)]+)\)/),t=`rotate(${(e?parseFloat(e[1]):0)+1}deg)`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/rotate\(([^)]+)\)/,t)}else if("centerLeft"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/translateX\(([^)]+)\)/),t=`translateX(${(e?parseFloat(e[1]):0)-1}%)`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/translateX\(([^)]+)\)/,t)}else if("center"===e.key)window.IconEditorGraphicStacksCurrentLayer.transform="rotate(0deg) translateY(0px) translateX(0px) scale(1)";else if("centerRight"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/translateX\(([^)]+)\)/),t=`translateX(${(e?parseFloat(e[1]):0)+1}%)`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/translateX\(([^)]+)\)/,t)}else if("bottomLeft"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/scale\(([^)]+)\)/),t=`scale(${(e?parseFloat(e[1]):1)-.01})`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/scale\(([^)]+)\)/,t)}else if("bottom"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/translateY\(([^)]+)\)/),t=`translateY(${(e?parseFloat(e[1]):0)+1}%)`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/translateY\(([^)]+)\)/,t)}else if("bottomRight"===e.key){let e=window.IconEditorGraphicStacksCurrentLayer.transform.match(/scale\(([^)]+)\)/),t=`scale(${(e?parseFloat(e[1]):1)+.01})`;window.IconEditorGraphicStacksCurrentLayer.transform=window.IconEditorGraphicStacksCurrentLayer.transform.replace(/scale\(([^)]+)\)/,t)}window.IconEditorStacksTransform(Ht.indexOf(window.IconEditorGraphicStacksCurrentLayer),window.IconEditorGraphicStacksCurrentLayer.transform)};return t.addEventListener("mousedown",(()=>{t.setAttribute("button-is-held-down","true"),"true"===t.getAttribute("button-is-held-down")&&(It=setInterval(A,25))})),t.addEventListener("mouseup",(async()=>{window.currentIcon.components=window.IconEditorGraphicStack.layers,t.setAttribute("button-is-held-down","false"),clearInterval(It),window.currentIcon.compositeImage=await window.IconEditorGraphicStack.flatten(),console.log(window.currentIcon),window.updateQueue("Icon","update",window.currentIcon)})),t})({key:e,svg:A}))}));const s=document.createElement("div");s.style.cssText="grid-column: 1 / span 3",t.appendChild(s);let n=document.createElement("button");n.innerHTML='<div style = "display:flex;align-items:center;justify-content:center;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-image"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><circle cx="10" cy="12" r="2"/><path d="m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"/></svg><p>Set layer image</p></div>',n.className="w2ui-btn",n.style.cssText="width: 99.5%; height: 4rem; padding: 0",n.addEventListener("click",(async e=>{if(void 0===window.IconEditorGraphicStacksCurrentLayer)return window.w2alert("Please select an icon layer");window.currentIcon.components=window.IconEditorGraphicStack.layers,window.ImageIconComponentPicker.coords={x:e.clientX,y:e.clientY-200},window.ImageIconComponentPicker.show();let t=await window.ImageIconComponentPicker.icon();window.IconEditorGraphicStacksCurrentLayer.url=t.url,window.IconEditorStacksUpdateLayer(Ht.indexOf(window.IconEditorGraphicStacksCurrentLayer),window.IconEditorGraphicStacksCurrentLayer),window.currentIcon.compositeImage=await window.IconEditorGraphicStack.flatten(),window.updateQueue("Icon","update",window.currentIcon)})),s.appendChild(n);let r=document.createElement("div");r.innerHTML='<small style = "width:100%"><h3>Keyboard shortcuts</h3>\n    <ul>\n    <li>Arrow keys (Left, Right, Up, down): move the layer</li>\n    <li>Q and E rotate the layer</li>\n    <li>W increases the size of the layer</li>\n    <li>D decreases the size of the layer</li>\n    <li>A or S select an image for the layer</li>\n    <li>C resets the position, scale, and rotation</li>\n    </ul>\n    </small>';const o=document.createElement("div");return o.innerHTML="<h2>Layer Controls</h2>",Ht.forEach((e=>A.appendChild(((e,t)=>{const A=document.createElement("div");A.style.transition="all 0.2s",A.style.display="flex",A.style.justifyContent="space-between";const i=document.createElement("span");i.innerHTML=e.name,i.style.color=e.transparent?"var(--button-alt-text)":"unset",i.style.cursor=e.transparent?"default":"pointer",A.appendChild(i);const s=document.createElement("div"),n=document.createElement("input");return n.type="checkbox",n.checked=!e.transparent,n.addEventListener("change",(async()=>{e.transparent=!n.checked,i.style.color=e.transparent?"var(--button-alt-text)":"unset",i.style.cursor=e.transparent?"default":"pointer",window.currentIcon.components=window.IconEditorGraphicStack.layers,window.currentIcon.compositeImage=await window.IconEditorGraphicStack.flatten(),window.updateQueue("Icon","update",window.currentIcon)})),s.appendChild(n),A.appendChild(s),A.addEventListener("click",(()=>{e.transparent||(A.style.backgroundColor="var(--slider-1)"),Array.from(t.childNodes).forEach(((t,A)=>{Ht[A].name!==e.name&&(t.style.backgroundColor="var(--window-background-alt)")})),window.IconEditorGraphicStacksCurrentLayer=e})),A.addEventListener("mouseenter",(()=>{window.IconEditorGraphicStacksCurrentLayer===e||e.transparent||(A.style.backgroundColor="var(--window-background)")})),A.addEventListener("mouseleave",(()=>{window.IconEditorGraphicStacksCurrentLayer===e||e.transparent||(A.style.backgroundColor="var(--window-background-alt)")})),A})(e,A)))),e.append(i,A,o,t,r),e})()),Dt.on("render",(async function(e){let t=document.createElement("div");t.style.padding="1rem";let A=document.createElement("h2");A.innerHTML="Icon Preview",t.appendChild(A);let i=document.createElement("div");i.style="padding:1rem; width:216px; height:216px;",i.style.backgroundColor="var(--window-background-alt)",i.style.borderRadius="99rem",t.appendChild(i);let s=new _t(i),n=document.createElement("div");Lt(n,i),t.appendChild(n),window.IconEditorGraphicStack=s,window.IconEditorStacksAddLayer=e=>{window.IconEditorGraphicStack.addLayer(e),n.innerHTML=i.innerHTML},window.IconEditorStacksUpdateLayer=(e,t)=>{window.IconEditorGraphicStack.updateLayer(e,t),Lt(n,i)},window.IconEditorStacksRemoveLayer=e=>{window.IconEditorGraphicStack.removeLayer(e),Lt(n,i)},window.IconEditorStacksClear=()=>{window.IconEditorGraphicStack.clear(),Lt(n,i)},window.IconEditorStacksTransform=(e,t)=>{window.IconEditorGraphicStack.transform(e,t),Lt(n,i)},Ht.forEach((e=>{window.IconEditorGraphicStack.addLayer(e),Lt(n,i)})),Dt.html("right",t)})),window.iconEditorEditor=Dt;const Mt=Dt,Ot=async e=>{window.currentIcon=e,window.currentIcon&&void 0!==window.currentIcon?console.log("updating current icon record ",e._id):console.log("no icon to update")};window.IconEditorCreateNewIcon=async()=>{console.log("creating new icon");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"Icon",method:"create"}]})},t=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));if(t.ok){let e=await t.json();return console.log(e),e}return w2alert("Error: invalid response from schemas server")},window.IconEditorDeleteIcon=async e=>{console.log("deleting object");let t={};console.log(t);let A={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},i=await fetch("http://localhost:26068/data",A).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));if(i.ok){let e=await i.json();return console.log(e),e}return w2alert("Error: invalid response from schemas server")};let Rt=new i.Hs({name:"IconEditorTopMenu",tooltip:"bottom",items:[{type:"button",id:"new-icon",text:"New icon",class:"w2ui-btn accent",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>'},{type:"button",id:"search-icon",text:"Choose icon",class:"w2ui-btn",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mouse-pointer-click"><path d="m9 9 5 12 1.8-5.2L21 14Z"/><path d="M7.2 2.2 8 5.1"/><path d="m5.1 8-2.9-.8"/><path d="M14 4.1 12 6"/><path d="m6 12-1.9 2"/></svg>'},{type:"spacer"},{type:"button",id:"delete-icon",text:"Delete icon",class:"w2ui-btn slider1",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>'}]});Rt.on("click",(function(e){e.done((async()=>{if("new-icon"===e.detail.item.id)await window.IconEditorCreateNewIcon().then((e=>(window.IconEditor.html("main",window.iconEditorEditor),window.allIcons.push(e),window.currentIcon=e,Ot(e),(0,i.mJ)("New icon created")))).catch((e=>{console.error(e)}));else if("search-icon"===e.detail.item.id){if(console.log(e),!window.IconPicker)return(0,i.mJ)("Error loading IconPicker");window.IconPicker.coords={x:e.detail.originalEvent.clientX,y:e.detail.originalEvent.clientY},window.IconPicker.show(),window.currentIcon=await window.IconPicker.icon(),Ot(window.currentIcon),window.IconEditor.refresh()}else if("delete-icon"===e.detail.item.id){if(0===window.allIcons.length)return(0,i.mJ)("No icons to delete");let e=window.currentIcon;(0,i.mW)({title:"Delete icon",body:`Are you sure you want to delete ${e.name}?`,width:300,height:200}).yes((async()=>{Ot(window.currentIcon),await window.IconEditorDeleteIcon(e.id).then((()=>(0,i.mJ)("Icon deleted"))).catch((e=>(0,i.mJ)("Error deleting icon")))}))}}))}));const Kt=Rt;var $t=A(229);let Nt=new Date,Gt=!1;let zt=new i.Yw({name:"IconEditor",panels:[{type:"top",size:30,resizable:!1,content:"top",html:Kt,style:"overflow-y: hidden;"},{type:"main",content:"main",html:Mt}]});zt.on("render",(async function(e){zt.html("main",'<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:150%"><h2>Loading icons...</h2></div>'),window.ImagesIconComponents=await(async()=>{console.log("getting all images:iconComponents");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"Images",method:"getImagesByType"}],type:"iconComponents"})},t=new Date;if(t-Nt<1e4&&!0===Gt)return window.allIcons?window.allIcons:[];let A=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));return A.ok?(Nt=t,Gt=!0,A.json()):(console.error(A),[])})(),window.DefaultImagesIconComponents=await(async()=>{let e=await fetch("/style/img/defaultAssets/iconComponents/images.json").catch((e=>{console.error(e)}));return(await e.json()).images.iconComponent})(),window.ImageIconComponentPicker.icons=window.ImagesIconComponents.concat(window.DefaultImagesIconComponents),console.log(window.ImageIconComponentPicker.icons),window.allIcons=await(0,$t.A)(),window.allIcons.length>0?(window.currentIcon=window.allIcons[0],Ot(window.currentIcon),zt.html("main",Mt)):zt.html("main",'<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:150%"><h2>No icons</h2><p>Create a new icon to get started</p><img src = "http://localhost:26068/style/img/nu.png" style="position: fixed;width: 256px;left: 17%;top: 33%;"></div>')}));const Pt=zt,Vt=class{constructor(e,t,A,i){this.x=e,this.y=t,this.width=A,this.height=i,this.filled=!1,this.tileGlyph=null,this.active=!1,this.opacity=1,this.div=null,this.layer=null}initializeTile(e,t,A,i){let s=document.createElement("div");s.style.position="absolute",s.style.left=A*e+"px",s.style.top=i*t+"px",s.style.width=`${A}px`,s.style.height=`${i}px`,s.style.backgroundColor=e%2==0?t%2==0?"#222":"black":t%2==0?"black":"#222",this.div=s}hover(){this.div.style.border="2px solid var(--accent)",this.tileInfoDiv.innerHTML=`<div style = "display:flex;align-items:center">${this.tileInfoDiv.permanentContent} <p>${this.x}, ${this.y}</p></div>`}click(e,t){if(this.active=!0,"brush"===t)this.div.style.border="2px solid var(--accent)",this.tileGlyph=e.glyph,this.filled=!0;else if("erase"===t)this.tileGlyph=null,this.filled=!1;else if("fill"===t){let{pre:t,post:A}=((e,t,A,i)=>{let s=JSON.parse(JSON.stringify(A.tiles)),n=A.tiles[e][t],r=new Set([n]),o=new Set;for(;r.size>0;)r.forEach((e=>{let t={north:A.tiles[e.x][e.y-1],south:A.tiles[e.x][e.y+1],east:A.tiles[e.x+1][e.y],west:A.tiles[e.x-1][e.y]};!t.north||t.north.filled||o.has(t.north)||r.add(t.north),!t.south||t.south.filled||o.has(t.south)||r.add(t.south),!t.east||t.east.filled||o.has(t.east)||r.add(t.east),!t.west||t.west.filled||o.has(t.west)||r.add(t.west),e.fill(i),o.add(e),r.delete(e)}));return{currentState:s,finalState:JSON.parse(JSON.stringify(A.tiles))}})(this.x,this.y,this.layer,e),i=document.createElement("div");i.style.position="absolute",i.style.left="50%",i.style.bottom="2rem",i.style.zIndex=98,i.id="battlefieldEditor-applyFill",i.style.backgroundColor="var(--node-title)",i.style.paddingLeft=".25rem",i.style.paddingRight=".25rem",i.style.borderRadius="5px",i.style.color="var(--node-title-background)",i.innerHTML='<button class = "w2ui-btn" id = "battlefieldEditor-applyFill-buttonApply">Apply</button><button class = "w2ui-btn slider1" id = "battlefieldEditor-applyFill-buttonCancel">Cancel</button>',this.layer.container.appendChild(i),document.getElementById("battlefieldEditor-applyFill-buttonApply").addEventListener("click",(()=>{this.layer.container.removeChild(i),this.layer.tiles=A,this.layer.tiles.forEach((t=>{t.forEach((t=>{t.filled?t.fill(e):t.clear()}))}))})),document.getElementById("battlefieldEditor-applyFill-buttonCancel").addEventListener("click",(()=>{this.layer.container.removeChild(i),this.layer.tiles=t,this.layer.tiles.forEach((t=>{t.forEach((t=>{t.filled?t.fill(e):t.clear()}))}))}))}}fill(e){this.tileGlyph=e.glyph,this.filled=!0}clear(){this.tileGlyph=null,this.filled=!1}unhover(){this.div.style.border="none"}div(){return this.div}},jt=class{constructor(e,t,A,i){this.name=e,this.x=t,this.y=A,this.rows=t,this.columns=A,this.tiles=[],this.active=!1,this.currentTile=null,this.locked=!1,this.container=null,this.resolution=i,this.layers=[],this.container=document.createElement("div");for(let e=0;e<this.x;e++){this.tiles[e]=[];for(let t=0;t<this.y;t++)this.tiles[e][t]=new Vt(e,t,this.resolution,this.resolution),this.tiles[e][t].initializeTile(e,t,this.resolution,this.resolution),this.tiles[e][t].tileInfoDiv=this.tileInfoDiv,this.tiles[e][t].layer=this.name,this.container.appendChild(this.tiles[e][t].div),document.addEventListener("mouseover",(A=>{"battlefield-editor"===window.activeEditor&&A.target===this.tiles[e][t].div&&this.tiles[e][t].hover()})),document.addEventListener("mouseout",(A=>{"battlefield-editor"===window.activeEditor&&A.target===this.tiles[e][t].div&&this.tiles[e][t].unhover()})),document.addEventListener("contextmenu",(A=>{"battlefield-editor"===window.activeEditor&&A.target===this.tiles[e][t].div&&A.preventDefault()})),document.addEventListener("mousedown",(A=>{if("battlefield-editor"===window.activeEditor&&(A.preventDefault(),!this.locked&&A.target===this.tiles[e][t].div)){let i=this.layers.find((e=>e.active)).tiles[e][t];i.hover(),0===A.button?(console.log(i,window.BattlefieldEditorTileInfo,window.BattlefieldEditorBrush),i.click(window.BattlefieldEditorTileInfo,window.BattlefieldEditorBrush)):2===A.button&&(console.log(i,window.BattlefieldEditorTileInfo,"erase"),i.click(window.BattlefieldEditorTileInfo,"erase"))}})),document.addEventListener("mouseup",(A=>{A.target===this.tiles[e][t].div&&this.layers.find((e=>e.active)).tiles[e][t].unhover()}))}}setLayers(e){this.layers=e}lock(){this.locked=!0}unlock(){this.locked=!1}fill(e,t,A,i,s){if(!this.locked)for(let n=e;n<A;n++)for(let e=t;e<i;e++)this.tiles[n][e]=s}clear(){if(!this.locked){this.tiles=[];for(let e=0;e<this.x;e++){this.tiles[e]=[];for(let t=0;t<this.y;t++)this.tiles[e][t]=null}}}clearArea(e,t,A,i){if(!this.locked)for(let s=e;s<A;s++)for(let e=t;e<i;e++)this.tiles[s][e]=null}getTile(e,t){return this.tiles[e][t]}setTile(e,t,A){this.locked||(this.tiles[e][t]=A,this.currentTile=this.tiles[e][t])}setActive(e){this.active=e}};let Wt=document.createElement("div");Wt.style.position="fixed",Wt.style.right=".5rem",Wt.style.bottom="2rem",Wt.style.zIndex=98,Wt.style.backgroundColor="var(--node-title)",Wt.style.paddingLeft=".25rem",Wt.style.paddingRight=".25rem",Wt.style.borderRadius="5px",Wt.style.color="var(--node-title-background)",Wt.style.fontWeight="bold",Wt.style.fontSize=".75rem",window.moveBattlefieldEditorToZeroZero=()=>{console.log("moveBattlefieldEditorToZeroZero"),document.querySelector("#layout_BattlefieldEditor_panel_main").querySelector(".w2ui-panel-content").scrollTo(0,0)},Wt.permanentContent='<div style = "display:flex;align-items:center;margin-right:.5rem;height:100%;"><button onclick = "window.moveBattlefieldEditorToZeroZero()" class = "w2ui-btn" style = "min-width:0!important;margin-right:.5rem">0,0</button>|</div>';const Xt=Wt;let Yt=document.createElement("div");Yt.style.position="fixed",Yt.style.right=".5rem",Yt.style.top="5rem",Yt.style.zIndex=98,Yt.style.backgroundColor="rgba(0,0,0,.25)",Yt.style.paddingLeft=".25rem",Yt.style.paddingRight=".25rem",Yt.style.borderRadius="5px",Yt.style.color="var(--node-title)",Yt.pre='<div><div style = "display:flex;justify-content:space-between;align-items:center;"><p style = "margin:none;"><strong>LAYERS</strong></p><div style = "display:flex;align-items:center;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-right-close"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M15 3v18"/><path d="m8 9 3 3-3 3"/></svg></div></div>',Yt.inner="",Yt.post="</div>";const Jt=Yt,Zt=new i.kf({name:"EditorWindowSidebar",icon:{text:e=>"battlefield-editor-sidebar-brush"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-brush"><path d="m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08"/><path d="M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z"/></svg>':"battlefield-editor-sidebar-select"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-box-select"><path d="M5 3a2 2 0 0 0-2 2"/><path d="M19 3a2 2 0 0 1 2 2"/><path d="M21 19a2 2 0 0 1-2 2"/><path d="M5 21a2 2 0 0 1-2-2"/><path d="M9 3h1"/><path d="M9 21h1"/><path d="M14 3h1"/><path d="M14 21h1"/><path d="M3 9v1"/><path d="M21 9v1"/><path d="M3 14v1"/><path d="M21 14v1"/></svg>':"battlefield-editor-sidebar-fill"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-paint-bucket"><path d="m19 11-8-8-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0L19 11Z"/><path d="m5 2 5 5"/><path d="M2 13h15"/><path d="M22 20a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4 .3 1.6 2 2.4 2 4Z"/></svg>':"battlefield-editor-sidebar-clear"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grid-2x2-x"><path d="M12 3v17a1 1 0 0 1-1 1H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v6a1 1 0 0 1-1 1H3"/><path d="m16 16 5 5"/><path d="m16 21 5-5"/></svg>':"battlefield-editor-sidebar-weather"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cloud-sun"><path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M20 12h2"/><path d="m19.07 4.93-1.41 1.41"/><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"/><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"/></svg>':"battlefield-editor-sidebar-resize"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scaling"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M14 15H9v-5"/><path d="M16 3h5v5"/><path d="M21 3 9 15"/></svg>':void 0},nodes:[{id:"battlefield-editor-sidebar-brush",style:"height:2rem;",selected:!0},{id:"battlefield-editor-sidebar-select",style:"height:2rem;"},{id:"battlefield-editor-sidebar-fill",style:"height:2rem;"},{id:"battlefield-editor-sidebar-clear",style:"height:2rem;"},{id:"battlefield-editor-sidebar-spacer-2",disabled:!0,style:"margin:0;margin-top:1rem;margin-bottom:.25rem;height:1px;pointer-events:none!important;border-top:solid 1px var(--list-background);width:100%;"},{id:"battlefield-editor-sidebar-weather",style:"height:2rem;"},{id:"battlefield-editor-sidebar-resize",style:"height:2rem;"}]});let qt=new class{constructor(e,t,A){this.layers=[],this.x=e,this.y=t,this.container=document.createElement("div"),this.resolution=A}setTileInfoDiv(e){this.container.appendChild(e),this.tileInfoDiv=e;for(let t of this.layers){t.tileInfoDiv=e;for(let A of t.tiles)for(let t of A)t.tileInfoDiv=e}}setLayersDiv(e){this.container.appendChild(e),this.layersDiv=e;for(let t of this.layers)t.layersDiv=e}addLayer(e){let t=new jt(e,this.x,this.y,this.resolution);return this.layers.push(t),t.setLayers(this.layers),1===this.layers.length&&(t.active=!0,console.log(t)),this.container.appendChild(t.container),this.layersDiv.inner+=`\n        <div style = "display:flex;justify-content:space-between;align-items:center;${t.active?"background-color:var(--node-text)":""}">\n        <input type = "checkbox" checked class = "w2ui-input">\n        <p style = "font-size:.75rem;margin:0;min-width:14ch">${e}</p>\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock-open"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>\n        </div>\n        `,this.layersDiv.innerHTML=this.layersDiv.pre+this.layersDiv.inner+this.layersDiv.post,t}getLayer(e){return this.layers.find((t=>t.name===e))}removeLayer(e){this.layers=this.layers.filter((t=>t.name!==e))}clear(){this.layers=[]}lockLayer(e){this.getLayer(e).lock()}unlockLayer(e){this.getLayer(e).unlock()}setActiveLayer(e){this.layers.forEach((t=>{t.name===e?t.active=!0:t.active=!1}))}}(35,40,80);qt.setLayersDiv(Jt),qt.addLayer("terrain"),qt.addLayer("details"),qt.addLayer("special tiles"),qt.addLayer("decorations"),qt.setTileInfoDiv(Xt);let eA=new i.Yw({name:"BattlefieldEditor",panels:[{type:"left",size:32,content:"left",html:Zt},{type:"top",size:32,content:"top"},{type:"main",content:"main",html:qt.container}]});window.BattlefieldEditorLayers=qt;const tA=eA;window.UnitEditor=dt,window.ClassEditor=ct,window.GameEditor=kt,window.IconEditor=Pt,window.BattlefieldEditor=tA;let AA=new i.kf({name:"EditorWindowSidebar",flatButton:!0,icon:{text:e=>"sidebar-editors-unit-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>':"sidebar-editors-class-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-drama"><path d="M10 11h.01"/><path d="M14 6h.01"/><path d="M18 6h.01"/><path d="M6.5 13.1h.01"/><path d="M22 5c0 9-4 12-6 12s-6-3-6-12c0-2 2-3 6-3s6 1 6 3"/><path d="M17.4 9.9c-.8.8-2 .8-2.8 0"/><path d="M10.1 7.1C9 7.2 7.7 7.7 6 8.6c-3.5 2-4.7 3.9-3.7 5.6 4.5 7.8 9.5 8.4 11.2 7.4.9-.5 1.9-2.1 1.9-4.7"/><path d="M9.1 16.5c.3-1.1 1.4-1.7 2.4-1.4"/></svg>':"sidebar-editors-game-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings-2"><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg>':"sidebar-editors-object-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sword"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" x2="19" y1="19" y2="13"/><line x1="16" x2="20" y1="16" y2="20"/><line x1="19" x2="21" y1="21" y2="19"/></svg>':"sidebar-editors-level-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grid-3x3"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/></svg>':"sidebar-editors-map-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map"><path d="M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z"/><path d="M15 5.764v15"/><path d="M9 3.236v15"/></svg>':"sidebar-editors-skill-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-check"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>':"sidebar-editors-battalion-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-component"><path d="M5.5 8.5 9 12l-3.5 3.5L2 12l3.5-3.5Z"/><path d="m12 2 3.5 3.5L12 9 8.5 5.5 12 2Z"/><path d="M18.5 8.5 22 12l-3.5 3.5L15 12l3.5-3.5Z"/><path d="m12 15 3.5 3.5L12 22l-3.5-3.5L12 15Z"/></svg>':"sidebar-editors-combatarts-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target-arrow"><path d="M19 2v3h3"/><path d="M13.4 10.6 22 2"/><circle cx="12" cy="12" r="2"/><path d="M12.3 6H12a6 6 0 1 0 6 6v-.3"/><path d="M15 2.5A9.93 9.93 0 1 0 21.5 9"/><path d="M5.3 19.4 4 22"/><path d="M18.7 19.4 20 22"/></svg>':"sidebar-editors-shop-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-store"><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7"/></svg>':"sidebar-editors-cutscenes-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-video"><path d="m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5"/><rect x="2" y="6" width="14" height="12" rx="2"/></svg>':"sidebar-editors-gameflow-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-workflow"><rect width="8" height="8" x="3" y="3" rx="2"/><path d="M7 11v4a2 2 0 0 0 2 2h4"/><rect width="8" height="8" x="13" y="13" rx="2"/></svg>':"sidebar-editors-dialogue-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2z"/><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"/></svg>':"sidebar-editors-menus-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-menu"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 8h10"/><path d="M7 12h10"/><path d="M7 16h10"/></svg>':"sidebar-editors-activities-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bath-bubble"><path d="M15 3h.01"/><circle cx="11.5" cy="6.5" r=".5"/><circle cx="16.5" cy="7.5" r=".5"/><path d="M2 12h6"/><path d="M13 15H8v-3c0-.6.4-1 1-1h3c.6 0 1 .4 1 1Z"/><path d="M13 12h9"/><path d="M4 12v5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5"/><path d="M7 19v2"/><path d="M17 19v2"/></svg>':"sidebar-editors-portraits-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-user"><rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="12" cy="10" r="3"/><path d="M7 21v-2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2"/></svg>':"sidebar-editors-icons-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dot"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/></svg>':"sidebar-editors-visual-effects-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>':"sidebar-editors-music-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-audio-lines"><path d="M2 10v3"/><path d="M6 6v11"/><path d="M10 3v18"/><path d="M14 8v7"/><path d="M18 5v13"/><path d="M22 10v3"/></svg>':"sidebar-editors-sound-effects-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-drum"><path d="m2 2 8 8"/><path d="m22 2-8 8"/><ellipse cx="12" cy="9" rx="10" ry="5"/><path d="M7 13.4v7.9"/><path d="M12 14v8"/><path d="M17 13.4v7.9"/><path d="M2 9v8a10 5 0 0 0 20 0V9"/></svg>':"sidebar-editors-animations-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-person-standing"><circle cx="12" cy="5" r="1"/><path d="m9 20 3-6 3 6"/><path d="m6 8 6 2 6-2"/><path d="M12 10v4"/></svg>':"sidebar-editors-sprites-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pac-man-ghost"><path d="M9 10h.01"/><path d="M15 10h.01"/><path d="M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"/></svg>':"sidebar-editors-tiles-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trees-forest"><path d="m9 5 3-3 3 3"/><path d="m9 10 3-3 3 3"/><path d="M12 12V2"/><path d="m2 15 3-3 3 3"/><path d="m2 20 3-3 3 3"/><path d="M5 22V12"/><path d="m16 15 3-3 3 3"/><path d="m16 20 3-3 3 3"/><path d="M19 22V12"/></svg>':"sidebar-editors-models-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-box"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>':"sidebar-editors-filters-editor"===e.id?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/></svg>':void 0},nodes:[{id:"sidebar-editors-list",text:"Simple Editors",expanded:!0,group:!0,groupShowHide:!0,nodes:[{id:"sidebar-editors-game-editor",text:"Project"},{id:"sidebar-editors-unit-editor",text:"Units",disabled:!0},{id:"sidebar-editors-class-editor",text:"Classes",disabled:!0},{id:"sidebar-editors-object-editor",text:"Objects",disabled:!0},{id:"sidebar-editors-skill-editor",text:"Skills",disabled:!0},{id:"sidebar-editors-battalion-editor",text:"Battalions",disabled:!0},{id:"sidebar-editors-combatarts-editor",text:"Combat Arts",disabled:!0}]},{id:"sidebar-map-editors-list",text:"Map Editors",expanded:!1,group:!0,groupShowHide:!0,nodes:[{id:"sidebar-editors-level-editor",text:"Battlefields",disabled:!0},{id:"sidebar-editors-map-editor",text:"World Map",disabled:!0},{id:"sidebar-editors-shop-editor",text:"Shops",disabled:!0}]},{id:"sidebar-editors-flow-list",text:"Flow Editors",expanded:!1,group:!0,groupShowHide:!0,nodes:[{id:"sidebar-editors-cutscenes-editor",text:"Cutscenes",disabled:!0},{id:"sidebar-editors-gameflow-editor",text:"Game Flow",disabled:!0},{id:"sidebar-editors-dialogue-editor",text:"Dialogue",disabled:!0},{id:"sidebar-editors-menus-editor",text:"Menus",disabled:!0},{id:"sidebar-editors-activities-editor",text:"Activities",disabled:!0}]},{id:"sidebar-editors-visuals-list",text:"Image Creators",expanded:!1,group:!0,groupShowHide:!0,nodes:[{id:"sidebar-editors-portraits-editor",text:"Portraits",disabled:!0},{id:"sidebar-editors-icons-editor",text:"Icons",disabled:!0}]},{id:"sidebar-editors-presentation-list",text:"Presentation",expanded:!1,group:!0,groupShowHide:!0,nodes:[{id:"sidebar-editors-visual-effects-editor",text:"Visual Effects",disabled:!0},{id:"sidebar-editors-music-editor",text:"Music",disabled:!0},{id:"sidebar-editors-sound-effects-editor",text:"Sound Effects",disabled:!0},{id:"sidebar-editors-animations-editor",text:"Animations",disabled:!0},{id:"sidebar-editors-sprites-editor",text:"Sprites",disabled:!0},{id:"sidebar-editors-tiles-editor",text:"Tiles",disabled:!0},{id:"sidebar-editors-models-editor",text:"Models",disabled:!0},{id:"sidebar-editors-filters-editor",text:"Filters",disabled:!0}]}],onFlat(e){i.GB.EditorWindowLayout.sizeTo("left",e.detail.goFlat?"4rem":"12%",!0)}});AA.on("render:after",(function(e){if(!1===window.newUserOnboardingGameDetails&&(AA.enable("sidebar-editors-unit-editor"),AA.enable("sidebar-editors-class-editor"),AA.enable("sidebar-editors-object-editor"),AA.enable("sidebar-editors-level-editor"),AA.enable("sidebar-editors-map-editor"),AA.enable("sidebar-editors-skill-editor"),AA.enable("sidebar-editors-cutscenes-editor"),AA.enable("sidebar-editors-gameflow-editor"),AA.enable("sidebar-editors-dialogue-editor"),AA.enable("sidebar-editors-shop-editor"),AA.enable("sidebar-editors-menus-editor"),AA.enable("sidebar-editors-activities-editor"),AA.enable("sidebar-editors-sound-effects-editor"),AA.enable("sidebar-editors-music-editor"),AA.enable("sidebar-editors-portraits-editor"),AA.enable("sidebar-editors-icons-editor"),AA.enable("sidebar-editors-visual-effects-editor"),AA.enable("sidebar-editors-filters-editor"),AA.enable("sidebar-editors-animations-editor"),AA.enable("sidebar-editors-sprites-editor"),AA.enable("sidebar-editors-tiles-editor"),AA.enable("sidebar-editors-models-editor"),AA.enable("sidebar-editors-battalion-editor"),AA.enable("sidebar-editors-combatarts-editor")),combatCombatArts?AA.show("sidebar-editors-combatarts-editor"):AA.hide("sidebar-editors-combatarts-editor"),combatBattalions?AA.show("sidebar-editors-battalion-editor"):AA.hide("sidebar-editors-battalion-editor"),sessionStorage.getItem("startupView")){let e=sessionStorage.getItem("startupView");"default-editor-unit-editor"===e?AA.click("sidebar-editors-unit-editor"):"default-editor-class-editor"===e?AA.click("sidebar-editors-class-editor"):"default-editor-object-editor"===e?AA.click("sidebar-editors-object-editor"):AA.click("sidebar-editors-game-editor")}AA.refresh()})),AA.on("click",(function(e){if(!1===window.newUserOnboardingGameDetails&&(AA.enable("sidebar-editors-unit-editor"),AA.enable("sidebar-editors-class-editor"),AA.enable("sidebar-editors-object-editor"),AA.enable("sidebar-editors-level-editor"),AA.enable("sidebar-editors-map-editor"),AA.enable("sidebar-editors-skill-editor"),AA.enable("sidebar-editors-cutscenes-editor"),AA.enable("sidebar-editors-gameflow-editor"),AA.enable("sidebar-editors-dialogue-editor"),AA.enable("sidebar-editors-shop-editor"),AA.enable("sidebar-editors-menus-editor"),AA.enable("sidebar-editors-activities-editor"),AA.enable("sidebar-editors-sound-effects-editor"),AA.enable("sidebar-editors-music-editor"),AA.enable("sidebar-editors-portraits-editor"),AA.enable("sidebar-editors-icons-editor"),AA.enable("sidebar-editors-visual-effects-editor"),AA.enable("sidebar-editors-filters-editor"),AA.enable("sidebar-editors-animations-editor"),AA.enable("sidebar-editors-sprites-editor"),AA.enable("sidebar-editors-tiles-editor"),AA.enable("sidebar-editors-models-editor"),AA.enable("sidebar-editors-battalion-editor"),AA.enable("sidebar-editors-combatarts-editor")),combatCombatArts||AA.disable("sidebar-editors-combatarts-editor"),combatBattalions||AA.disable("sidebar-editors-battalion-editor"),e.object.disabled)return;let t=i.GB.EditorWindowLayout;"sidebar-editors-unit-editor"===e.target?(i.GB["unit-editor-bottom-toolbar"].click("unit-editor-bottom-toolbar-basic"),t.html("main",dt).removed(),window.activeEditor="unit-editor"):"sidebar-editors-class-editor"===e.target?(i.GB["unit-editor-bottom-toolbar"].click("class-editor-bottom-toolbar-basic"),t.html("main",ct).removed(),window.activeEditor="class-editor"):"sidebar-editors-game-editor"===e.target?(i.GB["unit-editor-bottom-toolbar"].click("game-editor-bottom-toolbar-game-settings"),t.html("main",kt).removed(),window.activeEditor="game-editor"):"sidebar-editors-icons-editor"===e.target?(t.html("main",Pt).removed(),window.activeEditor="icon-editor"):"sidebar-editors-level-editor"===e.target&&(t.html("main",tA).removed(),window.activeEditor="battlefield-editor")})),window.goFlat=function(){AA.goFlat()};const iA=AA},715:(e,t,A)=>{"use strict";A.d(t,{A:()=>n});var i=A(675);let s=new i.Hs({name:"EditorWindowStatusBar",tooltip:"top",items:[{type:"label",id:"status-bar-project-status",text:"Required project settings missing",class:"status-bar"},{type:"break"},{type:"label",id:"status-bar-autosave-status",class:"status-bar",icon:'<div style="margin-top:-.5rem; margin-right:.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-check"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="m9 15 2 2 4-4"/></svg></div>'},{type:"spacer"},{type:"label",id:"status-bar-turnroot-version",class:"status-bar",text:"Turnroot Editor v0.0.11 Weekly"},{type:"spacer"},{type:"label",id:"status-bar-report-issue",class:"status-bar report-issue",text:"Report an issue",style:"margin:0!important;padding:0!important;"}]});s.on("render",(function(e){!1===window.newUserOnboardingGameDetails&&s.hide("status-bar-project-status")})),s.on("click",(function(e){e.done((()=>{window.turnrootEditorLogs.push(`${new Date}||info||Status bar button clicked: ${JSON.stringify(e.target)}`),"status-bar-report-issue"===e.target?window.open("https://community.turnroot.com/c/turnroot-editor/editor-support/6","_blank"):"status-bar-project-status"===e.target&&i.GB.EditorWindowSidebar.click("sidebar-editors-game-editor")}))}));const n=s},80:(e,t,A)=>{"use strict";A.d(t,{A:()=>a});var i=A(675);let s=["settings:default-editor-welcome-message","settings:default-editor-unit-editor","settings:default-editor-object-editor","settings:default-editor-class-editor"];const n=(e,t)=>{if(s.includes(e.target)){let A=e.target.split(":")[1];sessionStorage.setItem("startupView",A),t.get("settings").get("default-editor").items.forEach((e=>{e.id===A?e.style="background-color: var(--window-background-alt);":e.style=""}))}else if("collapseSidebar"===e.detail.item.id)window.goFlat();else if("forums"===e.detail.item.id)window.open("https://community.turnroot.com","_blank");else if("help"===e.detail.item.id)window.open("https://docs.turnroot.com","_blank");else if("show-status-bar"===e.detail.item.id){i.GB.EditorWindowStatusBar;let t=i.GB.EditorWindowLayout;e.detail.item.checked?(t.show("bottom"),t.sizeTo("bottom","24",!0)):(t.hide("bottom"),t.sizeTo("bottom","0",!0))}e.detail.subItem&&("font-family-fira-sans"===e.detail.subItem.id?(window.sessionStorage.setItem("font-family","Fira Sans"),document.documentElement.style.setProperty("--font-family","Fira Sans"),t.get("settings").get("font-family").items.forEach((e=>{"font-family-fira-sans"===e.id?e.style="background-color: var(--window-background-alt);":e.style=""}))):"font-family-lexend"===e.detail.subItem.id?(window.sessionStorage.setItem("font-family","Lexend"),document.documentElement.style.setProperty("--font-family","Lexend"),t.get("settings").get("font-family").items.forEach((e=>{"font-family-lexend"===e.id?e.style="background-color: var(--window-background-alt);":e.style=""}))):"font-family-clean-sans"===e.detail.subItem.id?(window.sessionStorage.setItem("font-family","Clear Sans"),document.documentElement.style.setProperty("--font-family","Clear Sans"),t.get("settings").get("font-family").items.forEach((e=>{"font-family-clean-sans"===e.id?e.style="background-color: var(--window-background-alt);":e.style=""}))):"font-family-figtree"===e.detail.subItem.id?(window.sessionStorage.setItem("font-family","Figtree"),document.documentElement.style.setProperty("--font-family","Figtree"),t.get("settings").get("font-family").items.forEach((e=>{"font-family-figtree"===e.id?e.style="background-color: var(--window-background-alt);":e.style=""}))):"font-family-hyperlegible"===e.detail.subItem.id?(window.sessionStorage.setItem("font-family","Hyperlegible"),document.documentElement.style.setProperty("--font-family","Hyperlegible"),t.get("settings").get("font-family").items.forEach((e=>{"font-family-hyperlegible"===e.id?e.style="background-color: var(--window-background-alt);":e.style=""}))):t.get("settings").get("themes").items.map((e=>e.id)).includes(e.detail.subItem.id)&&((e=>{const t=document.querySelector("#main");t.classList.remove("ocean_waves","turnroot","charcoal","charcoal_blue","charcoal_green","chocolate","midnight_spark","snowdrift","tokyo_night","pink_dream","forest_mist","sunset_glow","pine_coast"),t.classList.add(e),t.dataset.theme=e,window.MainEditorWindow.refresh(),window.EditorWindowSidebar.refresh(),sessionStorage.setItem("theme",e)})(e.detail.subItem.id),t.get("settings").get("themes").items.forEach((t=>{t.id===e.detail.subItem.id?t.style="background-color: var(--window-background-alt);":t.style=""}))))};let r=sessionStorage.getItem("startupView")?sessionStorage.getItem("startupView"):"welcome-message",o=new i.Hs({name:"EditorWindowTopMenu",tooltip:"bottom",items:[{type:"menu",id:"settings",text:"Settings",items:[{type:"menu",id:"themes",text:"Themes",items:[{text:"Ocean Waves",id:"ocean_waves"},{text:"Turnroot",id:"turnroot"},{text:"Charcoal",id:"charcoal"},{text:"Charcoal Blue",id:"charcoal_blue"},{text:"Charcoal Green",id:"charcoal_green"},{text:"Chocolate",id:"chocolate"},{text:"Snowdrift",id:"snowdrift"},{text:"Tokyo Night",id:"tokyo_night"},{text:"Pink Dream",id:"pink_dream"},{text:"Sunset Glow",id:"sunset_glow"},{text:"Pine Coast",id:"pine_coast"}]},{type:"menu-radio",id:"default-editor",text:"Startup view",items:[{text:"Welcome message",id:"default-editor-welcome-message",style:"background-color: var(--window-background-alt);",checked:"welcome-message"===r,hidden:"welcome-message"!==r},{text:"Unit Editor",id:"default-editor-unit-editor",checked:"default-editor-unit-editor"===r},{text:"Class Editor",checked:"default-editor-class-editor"===r,id:"default-editor-class-editor"},{text:"Object Editor",id:"default-editor-object-editor",checked:"default-editor-object-editor"===r}]},{type:"menu-radio",id:"font-family",text:"Font",items:[{text:"Fira Sans",id:"font-family-fira-sans",style:"background-color: var(--window-background-alt);",checked:"Fira Sans"===sessionStorage.getItem("font-family")},{text:"Lexend",id:"font-family-lexend",checked:"Lexend"===sessionStorage.getItem("font-family")},{text:"Clean Sans",checked:"Clear Sans"===sessionStorage.getItem("font-family"),id:"font-family-clean-sans"},{text:"Figtree",id:"font-family-figtree",checked:"Figtree"===sessionStorage.getItem("font-family")},{text:"Hyperlegible",id:"font-family-hyperlegible",checked:"Hyperlegible"===sessionStorage.getItem("font-family")}]}]},{type:"check",id:"collapseSidebar",text:"Collapse sidebar",class:"w2ui-tb-check"},{type:"check",id:"show-status-bar",text:"Status bar",checked:!0,class:"w2ui-tb-check"},{type:"spacer"},{type:"menu",id:"import-menu",text:"Import assets",tooltip:"Import graphics, models, music, sound effects, tilesets, or other assets",items:[{text:"Import from file",id:"import-file"}]},{type:"button",id:"check-build",text:"Check for issues",style:"margin:0!important;",icon:'<div style="width:100%;height:100%;display:flex;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bug-play"><path d="M12.765 21.522a.5.5 0 0 1-.765-.424v-8.196a.5.5 0 0 1 .765-.424l5.878 3.674a1 1 0 0 1 0 1.696z"/><path d="M14.12 3.88 16 2"/><path d="M18 11a4 4 0 0 0-4-4h-4a4 4 0 0 0-4 4v3a6.1 6.1 0 0 0 2 4.5"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M6 13H2"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="m8 2 1.88 1.88"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/></svg></div>'},{type:"spacer"},{type:"button",id:"account",style:"margin:0!important;",icon:'<div style="width:100%;height:100%;display:flex;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>'},{type:"break"},{type:"button",id:"help",text:"Help",style:"margin:0!important;",icon:'<div style="width:100%;height:100%;display:flex;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-help"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg></div>'},{type:"button",id:"forums",text:"Forums",style:"margin:0!important;",icon:'<div style="width:100%;height:100%;display:flex;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-speech"><path d="M8.8 20v-4.1l1.9.2a2.3 2.3 0 0 0 2.164-2.1V8.3A5.37 5.37 0 0 0 2 8.25c0 2.8.656 3.054 1 4.55a5.77 5.77 0 0 1 .029 2.758L2 20"/><path d="M19.8 17.8a7.5 7.5 0 0 0 .003-10.603"/><path d="M17 15a3.5 3.5 0 0 0-.025-4.975"/></svg></div>'}]});o.on("click",(function(e){e.done((()=>{n(e,o)}))}));let l=sessionStorage.getItem("theme");l&&o.get("settings:themes").items.forEach((e=>{e.id===l?(main.classList.remove("ocean_waves","turnroot","charcoal","charcoal_blue","charcoal_green","chocolate","midnight_spark","forest_mist","snowdrift","tokyo_night","pink_dream","sunset_glow","pine_coast"),main.classList.add(l),main.dataset.theme=l,e.style="background-color: var(--window-background-alt);"):e.style=""}));const a=o},830:(e,t,A)=>{"use strict";A.d(t,{A:()=>i});const i='\n<div style = "width:100%;height:100%;overflow:hidden;display:flex;justify-content:center;align-items:center;">\n    <div style = "display:flex;justify-content:center;align-items:center;flex-direction:column;width:70ch">\n    <h1>Welcome to the Turnroot Editor!</h1>\n    <p style = "text-align:justify">Check out the <a href = "" style = "text-decoration:none;font-weight:bold;color:var(--slider-0);">Getting Started</a> guide to get familiar with Turnroot. Choose an editor from the sidebar to dismiss this message. If this is your first time starting Turnroot, start with the Project editor.<br/><br/>Please do yourself a favor and keep the <a href = "" style = "text-decoration:none;font-weight:bold;color:var(--slider-0);">Docs</a> open, there\'s a lot to take in and it may be overwhelming without help. Use the docs, I beg you, I wrote them just for you!</p>\n    <small><em>Your next step? Change the default homepage in the Settings menu so you never see this again ;)</em></small>\n</div>\n</div>\n'},972:(e,t,A)=>{"use strict";A.d(t,{A:()=>i});const i=class{constructor(e,t,A=!0){this.coords=e,this.icons=t,this.images=[],this.selectedIcon=null,this.add=A}show(){this.iconPromise=new Promise((e=>{this.resolveIcon=e}));let e=document.createElement("div");e.id="IconPicker-overlay",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.zIndex="9998",e.style.display="block",document.body.appendChild(e),e.addEventListener("click",(()=>{this.close()}));let t=document.createElement("div");t.id="IconPicker-display",t.style.width="450px",t.style.height="500px",t.style.position="fixed",t.style.zIndex="9999",t.style.top=this.coords.y+"px",t.style.left=this.coords.x+"px",t.style.backgroundColor="var(--node-title-background)",t.style.overflowX="hidden",t.style.overflowY="auto",t.style.borderRadius="5px";let A=document.createElement("input");A.className="w2ui-input",A.type="text",A.placeholder="Search icons",A.style.marginBottom="10px",A.style.width="calc(100% - 20px)",A.style.margin="10px",A.style.borderRadius="5px",A.style.color="var(--node-title)",t.appendChild(A);let i=document.createElement("div");i.style.display="grid",i.style.gridTemplateColumns="repeat(4, 1fr)",i.style.gap="10px",i.style.padding="10px",t.appendChild(i);let s=document.createElement("button");s.style.width="100px",s.style.border="none",s.style.borderRadius="5px",s.style.fontSize="4rem",s.style.fontWeight="bold",s.style.appearance="none",s.style.cursor="pointer",s.style.outline="none",s.style.height="100px",s.style.backgroundColor="var(--accent)",s.style.color="white",s.innerText="+",s.style.transition="filter .2s",s.ariaLabel="Create new icon",s.setAttribute("data-balloon-pos","right"),s.addEventListener("mouseenter",(()=>{s.style.filter="brightness(.9)"})),s.addEventListener("mouseleave",(()=>{s.style.filter="unset"})),s.addEventListener("click",(()=>{this.close(),!1===window.EditorWindowSidebar.get("sidebar-editors-visuals-list").expanded&&(window.EditorWindowSidebar.get("sidebar-editors-visuals-list").expanded=!0,window.EditorWindowSidebar.refresh()),window.EditorWindowSidebar.click("sidebar-editors-icons-editor")})),this.add&&i.appendChild(s);for(let e of this.icons){let t=document.createElement("img");t.src=e.src?e.src:e.url?e.url:e.compositeImage,t.alt=e.name?e.name:e._id.slice(0,8),t.style.width="100px",t.style.height="100px",this.images.push(t),i.appendChild(t),t.addEventListener("click",(()=>{this.selectedIcon=e,this.close(),this.resolveIcon(e)}))}A.addEventListener("input",(()=>{let e=A.value.toLowerCase();if(""===e)for(let e of this.images)i.contains(e)||i.appendChild(e);for(let t of this.images)t.alt.replace(/\s+/g,"").toLowerCase().includes(e.replace(/\s+/g,""))?i.contains(t)||i.appendChild(t):i.removeChild(t)})),document.body.appendChild(t)}close(){this.selectedIcon=null;let e=document.getElementById("IconPicker-display");if(e){e.remove();let t=document.getElementById("IconPicker-overlay");t&&t.remove()}}icon(){return this.iconPromise}}},71:(e,t,A)=>{"use strict";A.d(t,{C$:()=>i,df:()=>s,oU:()=>a});const i=()=>{window.editsQueue={saved_at:Date.now(),queue:[]}},s=(e,t,A)=>{const i=A.id;let s=window.editsQueue.queue.find((e=>e.body.id===i));s?s.body=A:window.editsQueue.queue.push({model:e,method:t,body:A})},n='<div style="margin-top:-.5rem; margin-right:.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-check"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="m9 15 2 2 4-4"/></svg></div>',r='<div style="margin-top:-.5rem; margin-right:.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-up"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M12 12v6"/><path d="m15 15-3-3-3 3"/></svg></div>';let o,l;const a=async()=>{let e=window.editsQueue.saved_at;if(o=Date.now(),o-e<12e3){try{window.EditorWindowStatusBar.set("status-bar-autosave-status",{icon:r,text:"Saving changes"})}catch(e){console.error(e),window.EditorWindowStatusBar.set("status-bar-autosave-status",{icon:n,text:"Changes saved"})}return void setTimeout((()=>{window.EditorWindowStatusBar.set("status-bar-autosave-status",{icon:n,text:"Changes saved"})}),500)}window.EditorWindowStatusBar.set("status-bar-autosave-status",{icon:r,text:"Saving changes"});let t={actions:window.editsQueue.queue||[]},A={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},i=await fetch("/queue",A).catch((e=>console.error(e)));try{let e=await i.json();if(e||console.error("Error: invalid response, not JSON"),"success"===e.status){window.editsQueue.saved_at=Date.now(),window.editsQueue.queue=[],l=Date.now();let e=l-o;e<300&&setTimeout((()=>{window.EditorWindowStatusBar.set("status-bar-autosave-status",{icon:n,text:"Changes saved"})}),300-e)}else console.error("Error: invalid response "+e);return console.log("Data saved to schema server"),window.UnitEditor.refresh(),e}catch(e){return"Error: invalid response "+e}}},229:(e,t,A)=>{"use strict";A.d(t,{A:()=>n});let i=new Date,s=!1;const n=async()=>{console.log("getting all icons");let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queue:[{model:"Icon",method:"get"}]})},t=new Date;if(t-i<1e4&&!0===s)return window.allIcons?window.allIcons:[];let A=await fetch("http://localhost:26068/data",e).catch((e=>(console.error(e),w2alert("Error: invalid response from schemas server"))));return A.ok?(i=t,s=!0,A.json()):(console.error(A),[])}},947:(e,t,A)=>{"use strict";A.d(t,{S4:()=>n,mp:()=>r,P$:()=>o,iH:()=>a});const i={weaponsCanBeForged:!0,weaponsCanBeRepaired:!0,unitsCanHaveChildren:!0,useExperienceSublevels:!1,useExperienceAptitudes:!0,unitEditorAvatarDefaultHairColor:"rgb(39, 31, 86)",unitEditorAvatarDefaultEyeColor:"rgb(34, 132, 181)",unitEditorAvatarDefaultSkinColor:"rgb(255, 232, 207)",unitEditorAvatarDefaultHairStyle:0,combatCombatArts:!1,combatCombatArtLimit:3,combatWeaponTriangle:!0,combatTriangleTypes:["Sword","Lance","Axe","Bow","Gauntlet","Dagger"],combatNeutralTypes:[],combatTriangleMapping:{},combatExpandedWeaponTriangle:!1,combatWeaponTriangleAdvantage:20,combatWeaponTriangleDisadvantage:-20,combatMagicTriangle:!1,combatMagicTriangleAdvantage:20,combatMagicTriangleDisadvantage:-20,combatMagicTriangleTypes:[],combatNeutralMagicTypes:[],combatMagicTriangleMapping:{},combatBattalions:!0,combatBattalionLimit:1,combatBattalionEndurance:!0,combatPairUp:!1,combatAdjutants:!0,combatAdjutantHeal:!0,combatAdjutantGuard:!0,combatAdjutantAttack:!0,aptitudeGoals:!1,statsUseExtraStatWeight:!1,statsExtraStatWeightAffectsMovement:!1,statsUseExtraStatLuck:!0,combatSeparateCritAvoid:!1,statsUseExtraStatAuthority:!1,statsUseExtraStatCharm:!0,statsAptitudesUseRiding:!0,statsAptitudesUseFlying:!0,statsAptitudesUseAuthority:!1,statsAptitudesUseArmor:!1,globalMagicTypes:[],globalWeaponsTypes:[],GameEditorWeaponTriangleFieldsTopCorner:[],GameEditorWeaponTriangleFieldsLeftCorner:[],GameEditorWeaponTriangleFieldsRightCorner:[],GameEditorMagicTriangleFieldsTopCorner:[],GameEditorMagicTriangleFieldsLeftCorner:[],GameEditorMagicTriangleFieldsRightCorner:[],UseWeatherOnLevels:!1};var s=A(675);const n=["weaponsCanBeForged","weaponsCanBeRepaired","unitsCanHaveChildren","useExperienceSublevels","useExperienceAptitudes","combatCombatArts","combatWeaponTriangle","combatExpandedWeaponTriangle","combatMagicTriangle","combatBattalions","combatBattalionEndurance","combatPairUp","combatAdjutants","combatAdjutantHeal","combatAdjutantGuard","combatAdjutantAttack","aptitudeGoals","statsUseExtraStatWeight","statsExtraStatWeightAffectsMovement","statsUseExtraStatLuck","combatSeparateCritAvoid","statsUseExtraStatAuthority","statsUseExtraStatCharm","statsAptitudesUseRiding","statsAptitudesUseFlying","statsAptitudesUseAuthority","statsAptitudesUseArmor"],r=["combatCombatArtLimit","combatWeaponTriangleAdvantage","combatWeaponTriangleDisadvantage","combatMagicTriangleAdvantage","combatMagicTriangleDisadvantage","combatBattalionLimit"],o=["unitEditorAvatarDefaultHairColor","unitEditorAvatarDefaultEyeColor","unitEditorAvatarDefaultSkinColor","unitEditorAvatarDefaultHairStyle"],l=["unit-editor-basic-fields","unit-editor-friend-fields","unit-editor-avatar-fields","unit-editor-enemy-fields","unit-editor-npc-fields"];n.forEach((e=>{Object.defineProperty(window,e,{get:function(){return"true"===localStorage.getItem(e)},set:function(t){localStorage.setItem(e,t)}}),localStorage.getItem(e)||(window[e]=i[e])})),r.forEach((e=>{Object.defineProperty(window,e,{get:function(){const t=localStorage.getItem(e);return t?parseInt(t,10):null},set:function(t){localStorage.setItem(e,t)}}),localStorage.getItem(e)||(window[e]=i[e])})),o.forEach((e=>{Object.defineProperty(window,e,{get:function(){return localStorage.getItem(e)},set:function(t){localStorage.setItem(e,t)}}),localStorage.getItem(e)||(window[e]=i[e])})),["GameEditorWeaponTriangleFieldsTopCorner","GameEditorWeaponTriangleFieldsLeftCorner","GameEditorWeaponTriangleFieldsRightCorner","GameEditorMagicTriangleFieldsLeftCorner","GameEditorMagicTriangleFieldsRightCorner","GameEditorMagicTriangleFieldsTopCorner","UseWeatherOnLevels"].forEach((e=>{Object.defineProperty(window,e,{get:function(){return localStorage.getItem(e)},set:function(t){localStorage.setItem(e,t)}})})),["combatTriangleMapping","combatMagicTriangleMapping","globalWeaponsTypes","globalMagicTypes"].forEach((e=>{Object.defineProperty(window,e,{get:function(){return JSON.parse(localStorage.getItem(e))},set:function(t){localStorage.setItem(e,JSON.stringify(t))}}),localStorage.getItem(e)||(window[e]=i[e])})),["combatTriangleTypes","combatNeutralTypes","combatMagicTriangleTypes","combatNeutralMagicTypes"].forEach((e=>{Object.defineProperty(window,e,{get:function(){return localStorage.getItem(e).split(",")},set:function(t){localStorage.setItem(e,t.join(","))}}),localStorage.getItem(e)||(window[e]=i[e])}));const a=()=>{l.forEach((e=>{s.GB[e]?s.GB[e].updateGlobals():window.turnrootEditorLogs.push(`${new Date}||error||Form ${e} not found`)}))}},675:(e,t,A)=>{"use strict";A.d(t,{A$:()=>x,GB:()=>l,Hs:()=>B,P:()=>o,Yw:()=>C,aG:()=>F,iX:()=>h,kf:()=>y,mJ:()=>d,mW:()=>c,sk:()=>Q,yN:()=>u});class i{constructor(e,t){Object.assign(this,{type:t.type??null,detail:t,owner:e,target:t.target??null,phase:t.phase??"before",object:t.object??null,execute:null,isStopped:!1,isCancelled:!1,onComplete:null,listeners:[]}),delete t.type,delete t.target,delete t.object,this.complete=new Promise(((e,t)=>{this._resolve=e,this._reject=t})),this.complete.catch((()=>{}))}finish(e){e&&a.extend(this.detail,e),this.phase="after",this.owner.trigger.call(this.owner,this)}done(e){this.listeners.push(e)}preventDefault(){this._reject(),this.isCancelled=!0}stopPropagation(){this.isStopped=!0}}class s{constructor(e){if(this.activeEvents=[],this.listeners=[],void 0!==e){if(!a.checkName(e))return;l[e]=this}this.debug=!1}on(e,t){return(e="string"==typeof e?e.split(/[,\s]+/):[e]).forEach((e=>{var A,i,s,n="string"==typeof e?e:e.type+":"+e.execute+"."+e.scope;"string"==typeof e&&([i,A]=e.split("."),[i,s]=i.replace(":complete",":after").replace(":done",":after").split(":"),e={type:i,execute:s??"before",scope:A}),(e=a.extend({type:null,execute:"before",onComplete:null},e)).type?t?(Array.isArray(this.listeners)||(this.listeners=[]),this.listeners.push({name:n,edata:e,handler:t}),this.debug&&console.log("w2base: add event",{name:n,edata:e,handler:t})):console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):console.log("ERROR: You must specify event type when calling .on() method of "+this.name)})),this}off(e,t){return(e="string"==typeof e?e.split(/[,\s]+/):[e]).forEach((e=>{var A,i,s,n="string"==typeof e?e:e.type+":"+e.execute+"."+e.scope;if("string"==typeof e&&([i,A]=e.split("."),[i,s]=i.replace(":complete",":after").replace(":done",":after").split(":"),e={type:i||"*",execute:s||"",scope:A||""}),(e=a.extend({type:null,execute:null,onComplete:null},e)).type||e.scope){t=t||null;let A=0;this.listeners=this.listeners.filter((t=>"*"!==e.type&&e.type!==t.edata.type||""!==e.execute&&e.execute!==t.edata.execute||""!==e.scope&&e.scope!==t.edata.scope||null!=e.handler&&e.handler!==t.edata.handler||(A++,!1))),this.debug&&console.log(`w2base: remove event (${A})`,{name:n,edata:e,handler:t})}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)})),this}trigger(e,t){if(1==arguments.length?t="string"==typeof e?{type:e,target:this}:e:(t.type=e,t.target=t.target??this),a.isPlainObject(t)&&"after"==t.phase){if(!(t=this.activeEvents.find((e=>e.type==t.type&&e.target==t.target))))return void console.log(`ERROR: Cannot find even handler for "${t.type}" on "${t.target}".`);console.log("NOTICE: This syntax \"edata.trigger({ phase: 'after' })\" is outdated. Use edata.finish() instead.")}else t instanceof i||(t=new i(this,t),this.activeEvents.push(t));let A,s,n;Array.isArray(this.listeners)||(this.listeners=[]),this.debug&&console.log(`w2base: trigger "${t.type}:${t.phase}"`,t);for(let e=this.listeners.length-1;0<=e;e--){let i=this.listeners[e];if(!(null==i||i.edata.type!==t.type&&"*"!==i.edata.type||i.edata.target!==t.target&&null!=i.edata.target||i.edata.execute!==t.phase&&"*"!==i.edata.execute&&"*"!==i.edata.phase)&&(Object.keys(i.edata).forEach((e=>{null==t[e]&&null!=i.edata[e]&&(t[e]=i.edata[e])})),A=[],n=new RegExp(/\((.*?)\)/).exec(String(i.handler).split("=>")[0]),2===(A=n?n[1].split(/\s*,\s*/):A).length?(i.handler.call(this,t.target,t),this.debug&&console.log(" - call (old)",i.handler)):(i.handler.call(this,t),this.debug&&console.log(" - call",i.handler)),!0===t.isStopped||!0===t.stop))return t}if(e="on"+t.type.substr(0,1).toUpperCase()+t.type.substr(1),!("before"===t.phase&&"function"==typeof this[e]&&(s=this[e],A=[],n=new RegExp(/\((.*?)\)/).exec(String(s).split("=>")[0]),2===(A=n?n[1].split(/\s*,\s*/):A).length?(s.call(this,t.target,t),this.debug&&console.log(" - call: on[Event] (old)",s)):(s.call(this,t),this.debug&&console.log(" - call: on[Event]",s)),!0===t.isStopped||!0===t.stop)||null!=t.object&&"before"===t.phase&&"function"==typeof t.object[e]&&(s=t.object[e],A=[],n=new RegExp(/\((.*?)\)/).exec(String(s).split("=>")[0]),2===(A=n?n[1].split(/\s*,\s*/):A).length?(s.call(this,t.target,t),this.debug&&console.log(" - call: edata.object (old)",s)):(s.call(this,t),this.debug&&console.log(" - call: edata.object",s)),!0===t.isStopped||!0===t.stop)||"after"!==t.phase)){"function"==typeof t.onComplete&&t.onComplete.call(this,t);for(let e=0;e<t.listeners.length;e++)"function"==typeof t.listeners[e]&&(t.listeners[e].call(this,t),this.debug)&&console.log(" - call: done",s);t._resolve(t),this.debug&&console.log(`w2base: trigger "${t.type}:${t.phase}"`,t),-1!==(e=this.activeEvents.indexOf(t))&&this.activeEvents.splice(e,1)}return t}render(e){}unmount(){var e=this.trigger("unmount",{target:this.name});if(!e.isCancelled){let t=[];this.box instanceof HTMLElement&&this.box.classList.forEach((e=>{e.startsWith("w2ui-")&&t.push(e)})),o(this.box).off().removeClass(t).removeAttr("name").html(""),this.box=null,e.finish()}}}const n={locale:"en-US",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"S",phrases:{"${count} letters or more...":"---","Add new record":"---","Add New":"---","Advanced Search":"---",after:"---","AJAX error. See console for more details.":"---","All Fields":"---",All:"---",Any:"---","Are you sure you want to delete ${count} ${records}?":"---","Attach files by dragging and dropping or Click to Select":"---",before:"---","begins with":"---",begins:"---",between:"---",buffered:"---",Cancel:"---",Close:"---",Column:"---",Confirmation:"---",contains:"---",Copied:"---","Copy to clipboard":"---","Current Date & Time":"---","Delete selected records":"---",Delete:"---",'Do you want to delete search item "${item}"?':"---","Edit selected record":"---",Edit:"---","Empty list":"---","ends with":"---",ends:"---","Field should be at least ${count} characters.":"---",Hide:"---",in:"---","is not":"---",is:"---","less than":"---","Line #":"---","Load ${count} more...":"---","Loading...":"---","Maximum number of files is ${count}":"---","Maximum total size is ${count}":"---",Modified:"---","more than":"---","Multiple Fields":"---",Name:"---","No items found":"---","No matches":"---",No:"---",none:"---","Not a float":"---","Not a hex number":"---","Not a valid date":"---","Not a valid email":"---","Not alpha-numeric":"---","Not an integer":"---","Not in money format":"---","not in":"---",Notification:"---",of:"---",Ok:"---",Opacity:"---","Record ID":"---",record:"---",records:"---","Refreshing...":"---","Reload data in the list":"---",Remove:"---","Remove This Field":"---","Request aborted.":"---","Required field":"---",Reset:"---","Restore Default State":"---","Returned data is not in valid JSON format.":"---","Save changed records":"---","Save Grid State":"---",Save:"---","Saved Searches":"---","Saving...":"---","Search took ${count} seconds":"---",Search:"---","Select Hour":"---","Select Minute":"---",selected:"---","Server Response ${count} seconds":"---","Show/hide columns":"---",Show:"---",Size:"---",Skip:"---","Sorting took ${count} seconds":"---","Type to search...":"---",Type:"---",Yes:"---",Yesterday:"---","Your remote data source record count has changed, reloading from the first record.":"---"}};class r{static version=.8;constructor(e,t){this.context=t??document;let A=[];if(Array.isArray(e))A=e;else if(e instanceof Node||e instanceof Window)A=[e];else if(e instanceof r)A=e.nodes;else if("string"==typeof e){if("function"!=typeof this.context.querySelector)throw new Error("Invalid context");A=Array.from(this.context.querySelectorAll(e))}else if(null==e)A=[];else{if(t=Array.from(e??[]),"object"!=typeof e||!Array.isArray(t))throw new Error(`Invalid selector "${e}"`);A=t}this.nodes=A,this.length=A.length,this.each(((e,t)=>{this[t]=e}))}static _fragment(e){let t=document.createElement("template");return t.innerHTML=e,t.content.childNodes.forEach((e=>{var A=r._scriptConvert(e);A!=e&&t.content.replaceChild(A,e)})),t.content}static _scriptConvert(e){let t=e=>{var t=e.ownerDocument.createElement("script"),A=(t.text=e.text,e.attributes);for(let e=0;e<A.length;e++)t.setAttribute(A[e].name,A[e].value);return t};return(e="SCRIPT"==e.tagName?t(e):e).querySelectorAll&&e.querySelectorAll("script").forEach((e=>{e.parentNode.replaceChild(t(e),e)})),e}static _fixProp(e){return{cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",colspan:"colSpan",contenteditable:"contentEditable",for:"htmlFor",frameborder:"frameBorder",maxlength:"maxLength",readonly:"readOnly",rowspan:"rowSpan",tabindex:"tabIndex",usemap:"useMap"}[e]||e}_insert(e,t){let A=[],i=this.length;if(!(i<1)){let s=this;if("string"==typeof t)this.each((i=>{var s=r._fragment(t);A.push(...s.childNodes),i[e](s)}));else if(t instanceof r){let s=1==i;t.each((t=>{this.each((i=>{var n=s?t:t.cloneNode(!0);A.push(n),i[e](n),r._scriptConvert(n)}))})),s||t.remove()}else{if(!(t instanceof Node))throw new Error(`Incorrect argument for "${e}(html)". It expects one string argument.`);this.each((s=>{var n=1===i?t:r._fragment(t.outerHTML);A.push(...1===i?[t]:n.childNodes),s[e](n)})),1<i&&t.remove()}return s="replaceWith"==e?new r(A,this.context):s}}_save(e,t,A){e._mQuery=e._mQuery??{},Array.isArray(A)?(e._mQuery[t]=e._mQuery[t]??[],e._mQuery[t].push(...A)):null!=A?e._mQuery[t]=A:delete e._mQuery[t]}get(e){return this[e=e<0?this.length+e:e]||(null!=e?null:this.nodes)}eq(e){let t=[this[e=e<0?this.length+e:e]];return null==t[0]&&(t=[]),new r(t,this.context)}then(e){return null!=(e=e(this))?e:this}find(e){let t=[];return this.each((A=>{0<(A=Array.from(A.querySelectorAll(e))).length&&t.push(...A)})),new r(t,this.context)}filter(e){let t=[];return this.each((A=>{(A===e||"string"==typeof e&&A.matches&&A.matches(e)||"function"==typeof e&&e(A))&&t.push(A)})),new r(t,this.context)}next(){let e=[];return this.each((t=>{(t=t.nextElementSibling)&&e.push(t)})),new r(e,this.context)}prev(){let e=[];return this.each((t=>{(t=t.previousElementSibling)&&e.push(t)})),new r(e,this.context)}shadow(e){let t=[];this.each((e=>{e.shadowRoot&&t.push(e.shadowRoot)}));var A=new r(t,this.context);return e?A.find(e):A}closest(e){let t=[];return this.each((A=>{(A=A.closest(e))&&t.push(A)})),new r(t,this.context)}host(e){let t=[],A=e=>e.parentNode?A(e.parentNode):e,i=s=>{s=A(s),t.push(s.host||s),s.host&&e&&i(s.host)};return this.each((e=>{i(e)})),new r(t,this.context)}parent(e){return this.parents(e,!0)}parents(e,t){let A=[],i=e=>{if(-1==A.indexOf(e)&&A.push(e),!t&&e.parentNode)return i(e.parentNode)};this.each((e=>{e.parentNode&&i(e.parentNode)}));var s=new r(A,this.context);return e?s.filter(e):s}add(e){return e=e instanceof r?e.nodes:Array.isArray(e)?e:[e],new r(this.nodes.concat(e),this.context)}each(e){return this.nodes.forEach(((t,A)=>{e(t,A,this)})),this}append(e){return this._insert("append",e)}prepend(e){return this._insert("prepend",e)}after(e){return this._insert("after",e)}before(e){return this._insert("before",e)}replace(e){return this._insert("replaceWith",e)}remove(){return this.each((e=>{e.remove()})),this}css(e,t){let A=e;var i,s=arguments.length;return 0===s||1===s&&"string"==typeof e?this[0]?(s=this[0].style,"string"==typeof e?(i=s.getPropertyPriority(e),s.getPropertyValue(e)+(i?"!"+i:"")):Object.fromEntries(this[0].style.cssText.split(";").filter((e=>!!e)).map((e=>e.split(":").map((e=>e.trim())))))):void 0:("object"!=typeof e&&((A={})[e]=t),this.each(((e,t)=>{Object.keys(A).forEach((t=>{var i=String(A[t]).toLowerCase().includes("!important")?"important":"";e.style.setProperty(t,String(A[t]).replace(/\!important/i,""),i)}))})),this)}addClass(e){return this.toggleClass(e,!0),this}removeClass(e){return this.toggleClass(e,!1),this}toggleClass(e,t){return"string"==typeof e&&(e=e.split(/[,\s]+/)),this.each((A=>{let i=e;(i=null==i&&!1===t?Array.from(A.classList):i).forEach((e=>{if(""!==e){let i=null!=t?t?"add":"remove":"toggle";A.classList[i](e)}}))})),this}hasClass(e){if(null==(e="string"==typeof e?e.split(/[,\s]+/):e)&&0<this.length)return Array.from(this[0].classList);let t=!1;return this.each((A=>{t=t||e.every((e=>Array.from(A.classList??[]).includes(e)))})),t}on(e,t,A){let i;return"function"==typeof t&&(A=t,t=void 0),t?.delegate&&(i=t.delegate,delete t.delegate),(e=e.split(/[,\s]+/)).forEach((e=>{let[s,n]=String(e).toLowerCase().split(".");if(i){let e=A;A=t=>{var A=o(t.target).parents(i);0<A.length?t.delegate=A[0]:t.delegate=t.target,(t.target.matches(i)||0<A.length)&&e(t)}}this.each((e=>{this._save(e,"events",[{event:s,scope:n,callback:A,options:t}]),e.addEventListener(s,A,t)}))})),this}off(e,t,A){return"function"==typeof t&&(A=t,t=void 0),(e=(e??"").split(/[,\s]+/)).forEach((e=>{let[t,i]=String(e).toLowerCase().split(".");this.each((e=>{if(Array.isArray(e._mQuery?.events))for(let n=e._mQuery.events.length-1;0<=n;n--){var s=e._mQuery.events[n];null==i||""===i?s.event!=t&&""!==t||s.callback!=A&&null!=A||(e.removeEventListener(s.event,s.callback,s.options),e._mQuery.events.splice(n,1)):s.event!=t&&""!==t||s.scope!=i||(e.removeEventListener(s.event,s.callback,s.options),e._mQuery.events.splice(n,1))}}))})),this}trigger(e,t){let A;return A=e instanceof Event||e instanceof CustomEvent?e:new(["click","dblclick","mousedown","mouseup","mousemove"].includes(e)?MouseEvent:["keydown","keyup","keypress"].includes(e)?KeyboardEvent:Event)(e,t),this.each((e=>{e.dispatchEvent(A)})),this}attr(e,t){if(void 0===t&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;{let A={};return"object"==typeof e?A=e:A[e]=t,this.each((e=>{Object.entries(A).forEach((([t,A])=>{e.setAttribute(t,A)}))})),this}}removeAttr(){return this.each((e=>{Array.from(arguments).forEach((t=>{e.removeAttribute(t)}))})),this}prop(e,t){if(void 0===t&&"string"==typeof e)return this[0]?this[0][e]:void 0;{let A={};return"object"==typeof e?A=e:A[e]=t,this.each((e=>{Object.entries(A).forEach((([t,A])=>{t=r._fixProp(t),e[t]=A,"innerHTML"==t&&r._scriptConvert(e)}))})),this}}removeProp(){return this.each((e=>{Array.from(arguments).forEach((t=>{delete e[r._fixProp(t)]}))})),this}data(e,t){if(e instanceof Object)Object.entries(e).forEach((e=>{this.data(e[0],e[1])}));else{if(e&&-1!=e.indexOf("-")&&console.error(`Key "${e}" contains "-" (dash). Dashes are not allowed in property names. Use camelCase instead.`),!(arguments.length<2))return this.each((A=>{null!=t?A.dataset[e]=t instanceof Object?JSON.stringify(t):t:delete A.dataset[e]})),this;if(this[0]){let t=Object.assign({},this[0].dataset);return Object.keys(t).forEach((e=>{if(t[e].startsWith("[")||t[e].startsWith("{"))try{t[e]=JSON.parse(t[e])}catch(e){}})),e?t[e]:t}}}removeData(e){return"string"==typeof e&&(e=e.split(/[,\s]+/)),this.each((t=>{e.forEach((e=>{delete t.dataset[e]}))})),this}show(){return this.toggle(!0)}hide(){return this.toggle(!1)}toggle(e){return this.each((t=>{var A,i=t.style.display,s=getComputedStyle(t).display,n="none"==i||"none"==s;!n||null!=e&&!0!==e||(A=t instanceof HTMLTableRowElement?"table-row":t instanceof HTMLTableCellElement?"table-cell":"block",t.style.display=t._mQuery?.prevDisplay??(i==s&&"none"!=s?"":A),this._save(t,"prevDisplay",null)),n||null!=e&&!1!==e||("none"!=s&&this._save(t,"prevDisplay",s),t.style.setProperty("display","none"))}))}empty(){return this.html("")}html(e){return e instanceof HTMLElement?this.empty().append(e):this.prop("innerHTML",e)}text(e){return this.prop("textContent",e)}val(e){return this.prop("value",e)}change(){return this.trigger("change")}click(){return this.trigger("click")}}let o=function(e,t){if("function"!=typeof e)return new r(e,t);"complete"==document.readyState?e():window.addEventListener("load",e)},l=(o.html=e=>(e=r._fragment(e),o(e.children,e)),o.version=r.version,{});var a=new class{constructor(){this.version="2.0.x",this.tmp={},this.settings=this.extend({},{dataType:"HTTPJSON",dateStartYear:1950,dateEndYear:2030,macButtonOrder:!1,warnNoPhrase:!1},n,{phrases:null}),this.i18nCompare=Intl.Collator().compare,this.hasLocalStorage=function(){var e="w2ui_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}(),this.isMac=/Mac/i.test(navigator.platform),this.isMobile=/(iphone|ipod|mobile|android)/i.test(navigator.userAgent),this.isIOS=/(iphone|ipod|ipad)/i.test(navigator.platform),this.isAndroid=/(android)/i.test(navigator.userAgent),this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isFirefox=/(Firefox)/i.test(navigator.userAgent),this.formatters={number:(e,t)=>(20<parseInt(t)&&(t=20),parseInt(t)<0&&(t=0),null==e||""===e?"":a.formatNumber(parseFloat(e),t,!0)),float:(e,t)=>a.formatters.number(e,t),int:(e,t)=>a.formatters.number(e,0),money:(e,t)=>null==e||""===e?"":(e=a.formatNumber(Number(e),a.settings.currencyPrecision),(a.settings.currencyPrefix||"")+e+(a.settings.currencySuffix||"")),currency:(e,t)=>a.formatters.money(e,t),percent:(e,t)=>null==e||""===e?"":a.formatNumber(e,t||1)+"%",size:(e,t)=>null==e||""===e?"":a.formatSize(parseInt(e)),date(e,t){if(""===t&&(t=a.settings.dateFormat),null==e||0===e||""===e)return"";let A=a.isDateTime(e,t,!0);return'<span title="'+(A=!1===A?a.isDate(e,t,!0):A)+'">'+a.formatDate(A,t)+"</span>"},datetime(e,t){if(""===t&&(t=a.settings.datetimeFormat),null==e||0===e||""===e)return"";let A=a.isDateTime(e,t,!0);return'<span title="'+(A=!1===A?a.isDate(e,t,!0):A)+'">'+a.formatDateTime(A,t)+"</span>"},time(e,t){if(""===t&&(t=a.settings.timeFormat),null==e||0===e||""===e)return"";let A=a.isDateTime(e,t="h24"===(t="h12"===t?"hh:mi pm":t)?"h24:mi":t,!0);return'<span title="'+(A=!1===A?a.isDate(e,t,!0):A)+'">'+a.formatTime(e,t)+"</span>"},timestamp(e,t){if(""===t&&(t=a.settings.datetimeFormat),null==e||0===e||""===e)return"";let A=a.isDateTime(e,t,!0);return(A=!1===A?a.isDate(e,t,!0):A).toString?A.toString():""},gmt(e,t){if(""===t&&(t=a.settings.datetimeFormat),null==e||0===e||""===e)return"";let A=a.isDateTime(e,t,!0);return(A=!1===A?a.isDate(e,t,!0):A).toUTCString?A.toUTCString():""},age(e,t){if(null==e||0===e||""===e)return"";let A=a.isDateTime(e,null,!0);return'<span title="'+(A=!1===A?a.isDate(e,null,!0):A)+'">'+a.age(e)+(t?" "+t:"")+"</span>"},interval:(e,t)=>null==e||0===e||""===e?"":a.interval(e)+(t?" "+t:""),toggle:(e,t)=>e?a.lang("Yes"):"",password(e,t){let A="";if(e)for(let t=0;t<e.length;t++)A+="*";return A}}}isBin(e){return/^[0-1]+$/.test(e)}isInt(e){return/^[-+]?[0-9]+$/.test(e)}isFloat(e){return("number"==typeof(e="string"==typeof e?e.replace(this.settings.groupSymbol,"").replace(this.settings.decimalSymbol,"."):e)||"string"==typeof e&&""!==e)&&!isNaN(Number(e))}isMoney(e){var t,A;return"object"!=typeof e&&""!==e&&(!!this.isFloat(e)||(t=this.settings,A=new RegExp("^"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[-+]?"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[0-9]*[\\"+t.decimalSymbol+"]?[0-9]+"+(t.currencySuffix?"\\"+t.currencySuffix+"?":"")+"$","i"),"string"==typeof e&&(e=e.replace(new RegExp(t.groupSymbol,"g"),"")),A.test(e)))}isHex(e){return/^(0x)?[0-9a-fA-F]+$/.test(e)}isAlphaNumeric(e){return/^[a-zA-Z0-9_-]+$/.test(e)}isEmail(e){return/^[a-zA-Z0-9._%\-+]+@[а-яА-Яa-zA-Z0-9.-]+\.[а-яА-Яa-zA-Z]+$/.test(e)}isIpAddress(e){return new RegExp("^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$").test(e)}isDate(e,t,A){if(!e)return!1;var i="Invalid Date";let s,n,r;if(null==t&&(t=this.settings.dateFormat),"function"==typeof e.getFullYear)r=e.getFullYear(),s=e.getMonth()+1,n=e.getDate();else if(parseInt(e)==e&&0<parseInt(e))r=(e=new Date(parseInt(e))).getFullYear(),s=e.getMonth()+1,n=e.getDate();else{if(e=String(e),new RegExp("mon","ig").test(t)){t=t.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),e=e.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(let t=0,A=this.settings.fullmonths.length;t<A;t++){var o=this.settings.fullmonths[t];e=e.replace(new RegExp(o,"ig"),parseInt(t)+1).replace(new RegExp(o.substr(0,3),"ig"),parseInt(t)+1)}}var l=e.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/");"mm/dd/yyyy"===(t=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase())&&(s=l[0],n=l[1],r=l[2]),"m/d/yyyy"===t&&(s=l[0],n=l[1],r=l[2]),"dd/mm/yyyy"===t&&(s=l[1],n=l[0],r=l[2]),"d/m/yyyy"===t&&(s=l[1],n=l[0],r=l[2]),"yyyy/dd/mm"===t&&(s=l[2],n=l[1],r=l[0]),"yyyy/d/m"===t&&(s=l[2],n=l[1],r=l[0]),"yyyy/mm/dd"===t&&(s=l[1],n=l[2],r=l[0]),"yyyy/m/d"===t&&(s=l[1],n=l[2],r=l[0]),"mm/dd/yy"===t&&(s=l[0],n=l[1],r=l[2]),"m/d/yy"===t&&(s=l[0],n=l[1],r=parseInt(l[2])+1900),"dd/mm/yy"===t&&(s=l[1],n=l[0],r=parseInt(l[2])+1900),"d/m/yy"===t&&(s=l[1],n=l[0],r=parseInt(l[2])+1900),"yy/dd/mm"===t&&(s=l[2],n=l[1],r=parseInt(l[0])+1900),"yy/d/m"===t&&(s=l[2],n=l[1],r=parseInt(l[0])+1900),"yy/mm/dd"===t&&(s=l[1],n=l[2],r=parseInt(l[0])+1900),"yy/m/d"===t&&(s=l[1],n=l[2],r=parseInt(l[0])+1900)}return!!this.isInt(r)&&!!this.isInt(s)&&!!this.isInt(n)&&(r=+r,s=+s,n=+n,(i=new Date(r,s-1,n)).setFullYear(r),null!=s)&&"Invalid Date"!==String(i)&&i.getMonth()+1===s&&i.getDate()===n&&i.getFullYear()===r&&(!0!==A||i)}isTime(e,t){if(null==e)return!1;let A,i,s;i=0<=(e=(e=String(e)).toUpperCase()).indexOf("AM");var n=(s=0<=e.indexOf("PM"))||i;A=n?12:24,e=(e=e.replace("AM","").replace("PM","").trim()).split(":");let r=parseInt(e[0]||0),o=parseInt(e[1]||0),l=parseInt(e[2]||0);return(n&&1===e.length||2===e.length||3===e.length)&&!(""===e[0]||r<0||r>A||!this.isInt(e[0])||2<e[0].length||1<e.length&&(""===e[1]||o<0||59<o||!this.isInt(e[1])||2!==e[1].length)||2<e.length&&(""===e[2]||l<0||59<l||!this.isInt(e[2])||2!==e[2].length)||!(n||A!==r||0===o&&0===l)||n&&1===e.length&&0===r)&&(!0!==t||(s&&12!==r&&(r+=12),i&&12===r&&(r+=12),{hours:r,minutes:o,seconds:l}))}isDateTime(e,t,A){var i;return"function"==typeof e.getFullYear?!0!==A||e:(i=parseInt(e))===e?!(i<0)&&(!0!==A||new Date(i)):(i=String(e).indexOf(" "))<0?!(String(e).indexOf("T")<0||"Invalid Date"==String(new Date(e)))&&(!0!==A||new Date(e)):(t=(t=null==t?this.settings.datetimeFormat:t).split("|"),e=[e.substr(0,i),e.substr(i).trim()],t[0]=t[0].trim(),t[1]&&(t[1]=t[1].trim()),i=this.isDate(e[0],t[0],!0),t=this.isTime(e[1],!0),!1!==i&&!1!==t&&(!0!==A||(i.setHours(t.hours),i.setMinutes(t.minutes),i.setSeconds(t.seconds),i)))}age(e){let t;if(""===e||null==e)return"";if(t="function"==typeof e.getFullYear?e:parseInt(e)==e&&0<parseInt(e)?new Date(parseInt(e)):new Date(e),"Invalid Date"===String(t))return"";let A="",i="";return(e=((new Date).getTime()-t.getTime())/1e3)<0?(A=0,i="sec"):e<60?(A=Math.floor(e),i="sec",e<0&&(A=0,i="sec")):e<3600?(A=Math.floor(e/60),i="min"):e<86400?(A=Math.floor(e/60/60),i="hour"):e<2592e3?(A=Math.floor(e/24/60/60),i="day"):e<31536e3?(A=Math.floor(e/30/24/60/60*10)/10,i="month"):e<126144e3?(A=Math.floor(e/365/24/60/60*10)/10,i="year"):126144e3<=e&&(A=Math.floor(e/365.25/24/60/60*10)/10,i="year"),A+" "+i+(1<A?"s":"")}interval(e){return e<100?"< 0.01 sec":e<1e3?Math.floor(e/10)/100+" sec":e<1e4?Math.floor(e/100)/10+" sec":e<6e4?Math.floor(e/1e3)+" secs":e<36e5?Math.floor(e/6e4)+" mins":e<864e5?Math.floor(e/36e5*10)/10+" hours":e<2628e6?Math.floor(e/864e5*10)/10+" days":e<31536e6?Math.floor(e/2628e6*10)/10+" months":Math.floor(e/31536e5)/10+" years"}date(e){if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";let t=new Date(e);if(this.isInt(e)&&(t=new Date(Number(e))),"Invalid Date"===String(t))return"";e=this.settings.shortmonths;var A=new Date,i=((s=new Date).setTime(s.getTime()-864e5),e[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()),s=(A=e[A.getMonth()]+" "+A.getDate()+", "+A.getFullYear(),e=e[s.getMonth()]+" "+s.getDate()+", "+s.getFullYear(),t.getHours()-(12<t.getHours()?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(12<=t.getHours()?"pm":"am"));let n=i==A?s:i;return'<span title="'+i+" "+(t.getHours()-(12<t.getHours()?12:0))+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(12<=t.getHours()?"pm":"am")+'">'+(n=i==e?this.lang("Yesterday"):n)+"</span>"}formatSize(e){var t;return this.isFloat(e)&&""!==e?0===(e=parseFloat(e))?0:(t=parseInt(Math.floor(Math.log(e)/Math.log(1024))),(Math.floor(e/Math.pow(1024,t)*10)/10).toFixed(0===t?0:1)+" "+(["Bt","KB","MB","GB","TB","PB","EB","ZB"][t]||"??")):""}formatNumber(e,t,A){return null==e||""===e||"object"==typeof e?"":(A={minimumFractionDigits:parseInt(t),maximumFractionDigits:parseInt(t),useGrouping:!!A},(null==t||t<0)&&(A.minimumFractionDigits=0,A.maximumFractionDigits=20),parseFloat(e).toLocaleString(this.settings.locale,A))}formatDate(e,t){if(t=t||this.settings.dateFormat,""===e||null==e||"object"==typeof e&&!e.getMonth)return"";let A=new Date(e);var i,s;return this.isInt(e)&&(A=new Date(Number(e))),"Invalid Date"===String(A)?"":(e=A.getFullYear(),i=A.getMonth(),s=A.getDate(),t.toLowerCase().replace("month",this.settings.fullmonths[i]).replace("mon",this.settings.shortmonths[i]).replace(/yyyy/g,("000"+e).slice(-4)).replace(/yyy/g,("000"+e).slice(-4)).replace(/yy/g,("0"+e).slice(-2)).replace(/(^|[^a-z$])y/g,"$1"+e).replace(/mm/g,("0"+(i+1)).slice(-2)).replace(/dd/g,("0"+s).slice(-2)).replace(/th/g,1==s?"st":"th").replace(/th/g,2==s?"nd":"th").replace(/th/g,3==s?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(i+1)).replace(/(^|[^a-z$])d/g,"$1"+s))}formatTime(e,t){if(t=t||this.settings.timeFormat,""===e||null==e||"object"==typeof e&&!e.getMonth)return"";let A=new Date(e);if(this.isInt(e)&&(A=new Date(Number(e))),this.isTime(e)&&(e=this.isTime(e,!0),(A=new Date).setHours(e.hours),A.setMinutes(e.minutes)),"Invalid Date"===String(A))return"";"h12"==t&&(t="hh:mi pm");let i="am",s=A.getHours();e=A.getHours();let n=A.getMinutes(),r=A.getSeconds();return n<10&&(n="0"+n),r<10&&(r="0"+r),-1===t.indexOf("am")&&-1===t.indexOf("pm")||(12<=s&&(i="pm"),12<s&&(s-=12),0===s&&(s=12)),t.toLowerCase().replace("am",i).replace("pm",i).replace("hhh",s<10?"0"+s:s).replace("hh24",e<10?"0"+e:e).replace("h24",e).replace("hh",s).replace("mm",n).replace("mi",n).replace("ss",r).replace(/(^|[^a-z$])h/g,"$1"+s).replace(/(^|[^a-z$])m/g,"$1"+n).replace(/(^|[^a-z$])s/g,"$1"+r)}formatDateTime(e,t){let A;return""===e||null==e||"object"==typeof e&&!e.getMonth?"":("string"!=typeof t?A=[this.settings.dateFormat,this.settings.timeFormat]:((A=t.split("|"))[0]=A[0].trim(),A[1]=1<A.length?A[1].trim():this.settings.timeFormat),"h12"===A[1]&&(A[1]="h:m pm"),"h24"===A[1]&&(A[1]="h24:m"),this.formatDate(e,A[0])+" "+this.formatTime(e,A[1]))}stripSpaces(e){if(null!=e)switch(typeof e){case"number":break;case"string":e=String(e).replace(/(?:\r\n|\r|\n)/g," ").replace(/\s\s+/g," ").trim();break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach(((t,A)=>{e[A]=this.stripSpaces(t)})):(e=this.extend({},e),Object.keys(e).forEach((t=>{e[t]=this.stripSpaces(e[t])})))}return e}stripTags(e){if(null!=e)switch(typeof e){case"number":break;case"string":e=String(e).replace(/<(?:[^>=]|='[^']*'|="[^"]*"|=[^'"][^\s>]*)*>/gi,"");break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach(((t,A)=>{e[A]=this.stripTags(t)})):(e=this.extend({},e),Object.keys(e).forEach((t=>{e[t]=this.stripTags(e[t])})))}return e}encodeTags(e){if(null!=e)switch(typeof e){case"number":break;case"string":e=String(e).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach(((t,A)=>{e[A]=this.encodeTags(t)})):(e=this.extend({},e),Object.keys(e).forEach((t=>{e[t]=this.encodeTags(e[t])})))}return e}decodeTags(e){if(null!=e)switch(typeof e){case"number":break;case"string":e=String(e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":Array.isArray(e)?(e=this.extend([],e)).forEach(((t,A)=>{e[A]=this.decodeTags(t)})):(e=this.extend({},e),Object.keys(e).forEach((t=>{e[t]=this.decodeTags(e[t])})))}return e}escapeId(e){return""===e||null==e?"":(e+"").replace(/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,((e,t)=>t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e))}unescapeId(e){return""===e||null==e?"":e.replace(/\\[\da-fA-F]{1,6}[\x20\t\r\n\f]?|\\([^\r\n\f])/g,((e,t)=>(e="0x"+e.slice(1)-65536,t||(e<0?String.fromCharCode(65536+e):String.fromCharCode(e>>10|55296,1023&e|56320)))))}base64encode(e){return btoa(e)}base64decode(e){return atob(e)}async sha256(e){return e=(new TextEncoder).encode(e),crypto.subtle.digest("SHA-256",e).then((e=>Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")))}transition(e,t,A,i){return new Promise(((s,n)=>{var r=getComputedStyle(e);let l=parseInt(r.width),a=parseInt(r.height);if(e&&t){switch(e.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",e.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",t.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",A){case"slide-left":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d("+l+"px, 0, 0)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(-"+l+"px, 0, 0)"}),1);break;case"slide-right":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(-"+l+"px, 0, 0)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d("+l+"px, 0, 0)"}),1);break;case"slide-down":e.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(0, "+a+"px, 0)"}),1);break;case"slide-up":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(0, "+a+"px, 0)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",e.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"}),1);break;case"flip-left":e.style.cssText+="overflow: hidden; transform: rotateY(0deg)",t.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"}),1);break;case"flip-right":e.style.cssText+="overflow: hidden; transform: rotateY(0deg)",t.style.cssText+="overflow: hidden; transform: rotateY(180deg)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"}),1);break;case"flip-down":e.style.cssText+="overflow: hidden; transform: rotateX(0deg)",t.style.cssText+="overflow: hidden; transform: rotateX(180deg)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"}),1);break;case"flip-up":e.style.cssText+="overflow: hidden; transform: rotateX(0deg)",t.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",e.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"}),1);break;case"pop-in":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;",e.style.cssText+="transition: 0.5s;"}),1);break;case"pop-out":e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; opacity: 1;",e.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"}),1);break;default:e.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",t.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",o(t).show(),setTimeout((()=>{t.style.cssText+="transition: 0.5s; opacity: 1;",e.style.cssText+="transition: 0.5s"}),1)}setTimeout((()=>{"slide-down"===A&&(o(e).css("z-index","1019"),o(t).css("z-index","1020")),t&&o(t).css({opacity:"1"}).css({transition:"",transform:""}),e&&o(e).css({opacity:"1"}).css({transition:"",transform:""}),"function"==typeof i&&i(),s()}),500)}else console.log("ERROR: Cannot do transition when one of the divs is null")}))}lock(e,t={}){if(null!=e){"string"==typeof t&&(t={msg:t}),arguments[2]&&(t.spinner=arguments[2]),t=this.extend({spinner:!1},t),e?.[0]instanceof Node&&(e=Array.isArray(e)?e:e.get()),t.msg||0===t.msg||(t.msg=""),this.unlock(e);var A=o(e).get(0),i=A.scrollWidth;let s=`height: ${A.scrollHeight}px; width: ${i}px`,n=("BODY"==A.tagName&&(s="position: fixed; right: 0; bottom: 0;"),o(e).prepend(`<div class="w2ui-lock" style="${s}"></div><div class="w2ui-lock-msg"></div>`),o(e).find(".w2ui-lock"));i=o(e).find(".w2ui-lock-msg"),t.msg||i.css({"background-color":"transparent","background-image":"none",border:"0px","box-shadow":"none"}),!0===t.spinner&&(t.msg=`<div class="w2ui-spinner" ${t.msg?"":'style="width: 35px; height: 35px"'}></div>`+t.msg),t.msg?i.html(t.msg).css("display","block"):i.remove(),null!=t.opacity&&n.css("opacity",t.opacity),n.css({display:"block"}),t.bgColor&&n.css({"background-color":t.bgColor});let r=(A=getComputedStyle(n.get(0))).opacity??.15;n.on("mousedown",(function(){"function"==typeof t.onClick?t.onClick():n.css({transition:".2s",opacity:1.5*r})})).on("mouseup",(function(){"function"!=typeof t.onClick&&n.css({transition:".2s",opacity:r})})).on("mousewheel",(function(e){e&&(e.stopPropagation(),e.preventDefault())}))}}unlock(e,t){var A;null!=e&&(clearTimeout(e._prevUnlock),e?.[0]instanceof Node&&(e=Array.isArray(e)?e:e.get()),this.isInt(t)&&0<t?(o(e).find(".w2ui-lock").css({transition:t/1e3+"s",opacity:0}),A=o(e).get(0),clearTimeout(A._prevUnlock),A._prevUnlock=setTimeout((()=>{o(e).find(".w2ui-lock").remove()}),t)):o(e).find(".w2ui-lock").remove(),o(e).find(".w2ui-lock-msg").remove())}message(e,t){let A,i,n;var r=()=>{var A=o(e?.box).find(".w2ui-message");0!=A.length&&"function"==typeof(t=A.get(0)._msg_options||{})?.close&&t.close()};let l=t=>{var A,i=t.box._msg_prevFocus;o(e.box).find(".w2ui-message").length<=1?e.owner?e.owner.unlock(e.param,150):this.unlock(e.box,150):o(e.box).find(`#w2ui-message-${e.owner?.name}-`+(t.msgIndex-1)).css("z-index",1500),i?0<(A=o(i).closest(".w2ui-message")).length?A.get(0)._msg_options.setFocus(i):i.focus():"function"==typeof e.owner?.focus&&e.owner.focus(),o(t.box).remove(),0===t.msgIndex&&(g.css("z-index",t.tmp.zIndex),o(e.box).css("overflow",t.tmp.overflow)),t.trigger&&n.finish()};if("object"!=typeof(t="string"!=typeof t&&"number"!=typeof t?t:{width:String(t).length<300?350:550,height:String(t).length<300?170:250,text:String(t)}))return void r();null!=t.text&&(t.body=`<div class="w2ui-centered w2ui-msg-text">${t.text}</div>`),null==t.width&&(t.width=350),null==t.height&&(t.height=170),null==t.hideOn&&(t.hideOn=["esc"]),null==t.on&&(h=t,t=new s,a.extend(t,h)),t.on("open",(e=>{a.bindEvents(o(t.box).find(".w2ui-eaction"),t),o(e.detail.box).find("button, input, textarea, [name=hidden-first]").off(".message").on("keydown.message",(function(e){27==e.keyCode&&t.hideOn.includes("esc")&&(t.cancelAction?t.action(t.cancelAction):t.close())})),setTimeout((()=>t.setFocus(t.focus)),300)})),t.off(".prom");let d={self:t,action:e=>(t.on("action.prom",e),d),close:e=>(t.on("close.prom",e),d),open:e=>(t.on("open.prom",e),d),then:e=>(t.on("open:after.prom",e),d)},c=(null==t.actions&&null==t.buttons&&null==t.html&&(t.actions={Ok(e){e.detail.self.close()}}),t.off(".buttons"),null!=t.actions&&(t.buttons="",Object.keys(t.actions).forEach((e=>{var A=t.actions[e];let i=e;"function"==typeof A&&(t.buttons+=`<button class="w2ui-btn w2ui-eaction" data-click='["action","${e}","event"]' name="${e}">${e}</button>`),"object"==typeof A&&(t.buttons+=`<button class="w2ui-btn w2ui-eaction ${A.class||""}" name="${e}" data-click='["action","${e}","event"]'\n                        style="${A.style??""}" ${A.attrs??""}>${A.text||e}</button>`,i=Array.isArray(t.actions)?A.text:e),"string"==typeof A&&(t.buttons+=`<button class="w2ui-btn w2ui-eaction" name="${A}" data-click='["action","${A}","event"]'>${A}</button>`,i=A),"string"==typeof i&&(i=i[0].toLowerCase()+i.substr(1).replace(/\s+/g,"")),d[i]=function(e){return t.on("action.buttons",(t=>{t.detail.action[0].toLowerCase()+t.detail.action.substr(1).replace(/\s+/g,"")==i&&e(t)})),d}}))),Array("html","body","buttons").forEach((e=>{t[e]=String(t[e]??"").trim()})),""===t.body&&""===t.buttons||(t.html=`\n                <div class="w2ui-message-body">${t.body||""}</div>\n                <div class="w2ui-message-buttons">${t.buttons||""}</div>\n            `),getComputedStyle(o(e.box).get(0)));var h=parseFloat(c.width),u=parseFloat(c.height);let p=0,g=(0<o(e.after).length&&(c=getComputedStyle(o(e.after).get(0)),p=parseInt("none"!=c.display?parseInt(c.height):0)),t.width>h&&(t.width=h-10),t.height>u-p&&(t.height=u-10-p),t.originalWidth=t.width,t.originalHeight=t.height,parseInt(t.width)<0&&(t.width=h+t.width),parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<0&&(t.height=u+t.height-p),parseInt(t.height)<10&&(t.height=10),t.originalHeight<0&&(t.height=u+t.originalHeight-p),t.originalWidth<0&&(t.width=h+2*t.originalWidth),o(e.box).find(e.after));return t.tmp||(t.tmp={zIndex:g.css("z-index"),overflow:c.overflow}),""===t.html&&""===t.body&&""===t.buttons?r():(t.msgIndex=o(e.box).find(".w2ui-message").length,0===t.msgIndex&&"function"==typeof this.lock&&(o(e.box).css("overflow","hidden"),e.owner?e.owner.lock(e.param):this.lock(e.box)),o(e.box).find(".w2ui-message").css("z-index",1390),g.css("z-index",1501),u=`\n                <div id="w2ui-message-${e.owner?.name}-${t.msgIndex}" class="w2ui-message" data-mousedown="stop"\n                    style="z-index: 1500; left: ${(h-t.width)/2}px; top: ${p}px;\n                        width: ${t.width}px; height: ${t.height}px; transform: translateY(-${t.height}px)"\n                    ${t.hideOn.includes("click")?e.param?`data-click='["message", "${e.param}"]`:'data-click="message"':""}>\n                    <span name="hidden-first" tabindex="0" style="position: absolute; top: 0; outline: none"></span>\n                    ${t.html}\n                    <span name="hidden-last" tabindex="0" style="position: absolute; top: 0; outline: none"></span>\n                </div>`,0<o(e.after).length?o(e.box).find(e.after).after(u):o(e.box).prepend(u),t.box=o(e.box).find(`#w2ui-message-${e.owner?.name}-`+t.msgIndex)[0],a.bindEvents(t.box,this),o(t.box).addClass("animating"),(t.box._msg_options=t).box._msg_prevFocus=document.activeElement,setTimeout((()=>{!0===(n=t.trigger("open",{target:this.name,box:t.box,self:t})).isCancelled?(o(e.box).find(`#w2ui-message-${e.owner?.name}-`+t.msgIndex).remove(),0===t.msgIndex&&(g.css("z-index",t.tmp.zIndex),o(e.box).css("overflow",t.tmp.overflow))):o(t.box).css({transition:"0.3s",transform:"translateY(0px)"})}),0),i=setTimeout((()=>{o(e.box).find(`#w2ui-message-${e.owner?.name}-`+t.msgIndex).removeClass("animating").css({transition:"0s"}),n.finish()}),300)),t.action=(e,A)=>{let i=t.actions[e];i instanceof Object&&i.onClick&&(i=i.onClick),!0!==(e=t.trigger("action",{target:this.name,action:e,self:t,originalEvent:A,value:t.input?t.input.value:null})).isCancelled&&("function"==typeof i&&i(e),e.finish())},t.close=()=>{!0!==(n=t.trigger("close",{target:"self",box:t.box,self:t})).isCancelled&&(clearTimeout(i),o(t.box).hasClass("animating")?(clearTimeout(A),l(t)):(o(t.box).addClass("w2ui-closing animating").css({transition:"0.15s",transform:"translateY(-"+t.height+"px)"}),0!==t.msgIndex&&o(e.box).find(`#w2ui-message-${e.owner?.name}-`+(t.msgIndex-1)).css("z-index",1499),A=setTimeout((()=>{l(t)}),150)))},t.setFocus=t=>{var A=o(e.box).find(".w2ui-message").length-1;let i=o(e.box).find(`#w2ui-message-${e.owner?.name}-`+A),s="input, button, select, textarea, [contentEditable], .w2ui-input";(null!=t?isNaN(t)?i.find(s).filter(t).get(0):i.find(s).get(t):i.find("[name=hidden-first]").get(0))?.focus(),o(e.box).find(".w2ui-message").find(s+",[name=hidden-first],[name=hidden-last]").off(".keep-focus"),o(i).find(s+",[name=hidden-first],[name=hidden-last]").on("blur.keep-focus",(function(e){setTimeout((()=>{var e=document.activeElement,t=0<o(i).find(s).filter(e).length,A=o(e).attr("name");!t&&e&&e!==document.body&&o(i).find(s).get(0)?.focus(),"hidden-last"==A&&o(i).find(s).get(0)?.focus(),"hidden-first"==A&&o(i).find(s).get(-1)?.focus()}),1)}))},d}notify(e,t){return new Promise((A=>{if("object"==typeof e&&(e=(t=e).text),(t=t||{}).where=t.where??document.body,t.timeout=t.timeout??15e3,"function"==typeof this.tmp.notify_resolve&&(this.tmp.notify_resolve(),o(this.tmp.notify_where).find("#w2ui-notify").remove()),this.tmp.notify_resolve=A,this.tmp.notify_where=t.where,clearTimeout(this.tmp.notify_timer),e){if("object"==typeof t.actions){let A={};Object.keys(t.actions).forEach((e=>{A[e]=`<a class="w2ui-notify-link" value="${e}">${e}</a>`})),e=this.execTemplate(e,A)}var i=`\n                    <div id="w2ui-notify">\n                        <div class="${t.class} ${t.error?"w2ui-notify-error":""}">\n                            ${e}\n                            <span class="w2ui-notify-close w2ui-icon-cross"></span>\n                        </div>\n                    </div>`;o(t.where).append(i),o(t.where).find("#w2ui-notify").find(".w2ui-notify-close").on("click",(e=>{o(t.where).find("#w2ui-notify").remove(),A()})),t.actions&&o(t.where).find("#w2ui-notify .w2ui-notify-link").on("click",(e=>{e=o(e.target).attr("value"),t.actions[e](),o(t.where).find("#w2ui-notify").remove(),A()})),0<t.timeout&&(this.tmp.notify_timer=setTimeout((()=>{o(t.where).find("#w2ui-notify").remove(),A()}),t.timeout))}}))}confirm(e,t){return a.normButtons(t="string"==typeof t?{text:t}:t,{yes:"Yes",no:"No"}),(e=a.message(e,t))&&e.action((e=>{e.detail.self.close()})),e}normButtons(e,t){e.actions=e.actions??{};var A=Object.keys(t);return A.forEach((A=>{var i=e["btn_"+A];i&&(t[A]={text:a.lang(i.text??t[A]??""),class:i.class??"",style:i.style??"",attrs:i.attrs??""},delete e["btn_"+A]),Array("text","class","style","attrs").forEach((i=>{e[A+"_"+i]&&("string"==typeof t[A]&&(t[A]={text:t[A]}),t[A][i]=e[A+"_"+i],delete e[A+"_"+i])}))})),A.includes("yes")&&A.includes("no")&&(a.settings.macButtonOrder?a.extend(e.actions,{no:t.no,yes:t.yes}):a.extend(e.actions,{yes:t.yes,no:t.no})),A.includes("ok")&&A.includes("cancel")&&(a.settings.macButtonOrder?a.extend(e.actions,{cancel:t.cancel,ok:t.ok}):a.extend(e.actions,{ok:t.ok,cancel:t.cancel})),e}getSize(e,t){let A=0;if(0<(e=o(e)).length){e=e[0];var i=getComputedStyle(e);switch(t){case"width":A=parseFloat(i.width),"auto"===i.width&&(A=0);break;case"height":A=parseFloat(i.height),"auto"===i.height&&(A=0);break;default:A=parseFloat(i[t]??0)||0}}return A}getStrWidth(e,t,A){let i=o("body > #_tmp_width");return 0===i.length&&(o("body").append('<div id="_tmp_width" style="position: absolute; top: -9000px;"></div>'),i=o("body > #_tmp_width")),i.html(A?e:this.encodeTags(e)).attr("style","position: absolute; top: -9000px; "+(t||"")),i[0].clientWidth}execTemplate(e,t){return"string"==typeof e&&t&&"object"==typeof t?e.replace(/\${([^}]+)?}/g,(function(e,A){return t[A]||A})):e}marker(e,t,A={onlyFirst:!1,wholeWord:!1}){Array.isArray(t)||(t=null!=t&&""!==t?[t]:[]);let i=A.wholeWord;o(e).each((e=>{for(var s=e,n=/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi;-1!==s.innerHTML.indexOf('<span class="w2ui-marker"');)s.innerHTML=s.innerHTML.replace(n,"$1");t.forEach((t=>{t=(t="string"!=typeof t?String(t):t).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;"),t=new RegExp((i?"\\b":"")+t+(i?"\\b":"")+"(?!([^<]+)?>)","i"+(A.onlyFirst?"":"g")),e.innerHTML=e.innerHTML.replace(t,(e=>'<span class="w2ui-marker">'+e+"</span>"))}))}))}lang(e,t){if(!e||null==this.settings.phrases||"string"!=typeof e||"<=>=".includes(e))return this.execTemplate(e,t);let A=this.settings.phrases[e];return null==A?(A=e,this.settings.warnNoPhrase&&(this.settings.missing||(this.settings.missing={}),this.settings.missing[e]="---",this.settings.phrases[e]="---",console.log(`Missing translation for "%c${e}%c", see %c w2utils.settings.phrases %c with value "---"`,"color: orange","","color: #999",""))):"---"!==A||this.settings.warnNoPhrase||(A=e),"---"===A&&(A=`<span ${this.tooltip(e)}>---</span>`),this.execTemplate(A,t)}locale(e,t,A){return new Promise(((i,s)=>{if(Array.isArray(e)){this.settings.phrases={};let t=[],A={};e.forEach(((A,i)=>{5===A.length&&(A="locale/"+A.toLowerCase()+".json",e[i]=A),t.push(this.locale(A,!0,!1))})),Promise.allSettled(t).then((t=>{t.forEach((e=>{e.value&&(A[e.value.file]=e.value.data)})),e.forEach((e=>{this.settings=this.extend({},this.settings,A[e])})),i()}))}else(e=e||"en-us")instanceof Object?this.settings=this.extend({},this.settings,n,e):(5===e.length&&(e="locale/"+e.toLowerCase()+".json"),fetch(e,{method:"GET"}).then((e=>e.json())).then((s=>{!0!==A&&(this.settings=t?this.extend({},this.settings,s):this.extend({},this.settings,n,{phrases:{}},s)),i({file:e,data:s})})).catch((t=>{console.log("ERROR: Cannot load locale "+e),s(t)})))}))}scrollBarSize(){return this.tmp.scrollBarSize||(o("body").append('\n            <div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">\n                <div style="height: 120px">1</div>\n            </div>\n        '),this.tmp.scrollBarSize=100-o("#_scrollbar_width > div")[0].clientWidth,o("#_scrollbar_width").remove()),this.tmp.scrollBarSize}checkName(e){return null==e?(console.log('ERROR: Property "name" is required but not supplied.'),!1):null!=l[e]?(console.log(`ERROR: Object named "${e}" is already registered as w2ui.${e}.`),!1):!!this.isAlphaNumeric(e)||(console.log('ERROR: Property "name" has to be alpha-numeric (a-z, 0-9, dash and underscore).'),!1)}checkUniqueId(e,t,A,i){Array.isArray(t)||(t=[t]);let s=!0;return t.forEach((n=>{n.id===e&&(console.log(`ERROR: The item id="${e}" is not unique within the ${A} "${i}".`,t),s=!1)})),s}encodeParams(e,t=""){let A="";return Object.keys(e).forEach((i=>{""!=A&&(A+="&"),"object"==typeof e[i]?A+=this.encodeParams(e[i],t+i+(t?"]":"")+"["):A+=""+t+i+(t?"]":"")+"="+e[i]})),A}parseRoute(e){let t=[];return e=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,((e,A,i,s,n,r)=>(t.push({name:s,optional:!!r}),A=A||"",(r?"":A)+"(?:"+(r?A:"")+(i||"")+(n||(i?"([^/.]+?)":"([^/]+?)"))+")"+(r||"")))).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),{path:new RegExp("^"+e+"$","i"),keys:t}}getCursorPosition(e){if(null==e)return null;let t=0;var A,i=e.ownerDocument||e.document,s=i.defaultView||i.parentWindow;let n;return["INPUT","TEXTAREA"].includes(e.tagName)?t=e.selectionStart:s.getSelection?0<(n=s.getSelection()).rangeCount&&((A=(s=n.getRangeAt(0)).cloneRange()).selectNodeContents(e),A.setEnd(s.endContainer,s.endOffset),t=A.toString().length):(n=i.selection)&&"Control"!==n.type&&(s=n.createRange(),(A=i.body.createTextRange()).moveToElementText(e),A.setEndPoint("EndToEnd",s),t=A.text.length),t}setCursorPosition(e,t,A){if(null!=e){var i=document.createRange();let s,n=window.getSelection();if(["INPUT","TEXTAREA"].includes(e.tagName))e.setSelectionRange(t,A??t);else{for(let A=0;A<e.childNodes.length;A++){let i=o(e.childNodes[A]).text();if(t<=(i=e.childNodes[A].tagName?(i=o(e.childNodes[A]).html()).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," "):i).length){(s=(s=e.childNodes[A]).childNodes&&0<s.childNodes.length?s.childNodes[0]:s).childNodes&&0<s.childNodes.length&&(s=s.childNodes[0]);break}t-=i.length}null!=s&&(t>s.length&&(t=s.length),i.setStart(s,t),A?i.setEnd(s,A):i.collapse(!0),n.removeAllRanges(),n.addRange(i))}}}parseColor(e){if("string"!=typeof e)return null;let t={};if(3===(e="#"===(e=e.trim().toUpperCase())[0]?e.substr(1):e).length)t={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:1};else if(6===e.length)t={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:1};else if(8===e.length)t={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:Math.round(parseInt(e.substr(6,2),16)/255*100)/100};else if(4<e.length&&"RGB("===e.substr(0,4)){var A=e.replace("RGB","").replace(/\(/g,"").replace(/\)/g,"").split(",");t={r:parseInt(A[0],10),g:parseInt(A[1],10),b:parseInt(A[2],10),a:1}}else{if(!(5<e.length&&"RGBA("===e.substr(0,5)))return null;A=e.replace("RGBA","").replace(/\(/g,"").replace(/\)/g,"").split(","),t={r:parseInt(A[0],10),g:parseInt(A[1],10),b:parseInt(A[2],10),a:parseFloat(A[3])}}return t}colorContrast(e,t){return e=A(e),t=A(t),((Math.max(e,t)+.05)/(Math.min(e,t)+.05)).toFixed(2);function A(e){var{r:e,g:t,b:A}=a.parseColor(e)??{r:0,g:0,b:0},t=t/255,A=A/255;return.2126*((e/=255)<=.03928?e/12.92:Math.pow((.055+e)/1.055,2.2))+.7152*(t<=.03928?t/12.92:Math.pow((.055+t)/1.055,2.2))+.0722*(A<=.03928?A/12.92:Math.pow((.055+A)/1.055,2.2))}}hsv2rgb(e,t,A,i){let s,n,r,o,l,a,d,c;switch(1===arguments.length&&(t=e.s,A=e.v,i=e.a,e=e.h),a=(A/=100)*(1-(t/=100)),d=A*(1-(l=6*(e/=360)-(o=Math.floor(6*e)))*t),c=A*(1-(1-l)*t),o%6){case 0:s=A,n=c,r=a;break;case 1:s=d,n=A,r=a;break;case 2:s=a,n=A,r=c;break;case 3:s=a,n=d,r=A;break;case 4:s=c,n=a,r=A;break;case 5:s=A,n=a,r=d}return{r:Math.round(255*s),g:Math.round(255*n),b:Math.round(255*r),a:null!=i?i:1}}rgb2hsv(e,t,A,i){1===arguments.length&&(t=e.g,A=e.b,i=e.a,e=e.r);let s,n=Math.max(e,t,A),r=Math.min(e,t,A),o=n-r,l=0===n?0:o/n,a=n/255;switch(n){case r:s=0;break;case e:s=t-A+o*(t<A?6:0),s/=6*o;break;case t:s=A-e+2*o,s/=6*o;break;case A:s=e-t+4*o,s/=6*o}return{h:Math.round(360*s),s:Math.round(100*l),v:Math.round(100*a),a:null!=i?i:1}}tooltip(e,t){let A="mouseenter",i="mouseleave";return t=(t="object"==typeof e?e:t)||{},"string"==typeof e&&(t.html=e),t.showOn&&(A=t.showOn,delete t.showOn),t.hideOn&&(i=t.hideOn,delete t.hideOn),t.name||(t.name="no-name"),` on${A}="w2tooltip.show(this, JSON.parse(w2utils.base64decode('${this.base64encode(JSON.stringify(t))}')))" on${i}="w2tooltip.hide('${t.name}')"`}isPlainObject(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)&&(void 0===e.constructor||null===(e=Object.getPrototypeOf(e))||e===Object.prototype)}clone(e,t){let A;return t=Object.assign({functions:!0,elements:!0,events:!0,exclude:[]},t??{}),Array.isArray(e)?(A=Array.from(e)).forEach(((e,i)=>{A[i]=this.clone(e,t)})):this.isPlainObject(e)?(A={},Object.assign(A,e),t.exclude&&t.exclude.forEach((e=>{delete A[e]})),Object.keys(A).forEach((e=>{A[e]=this.clone(A[e],t),void 0===A[e]&&delete A[e]}))):e instanceof Function&&!t.functions||e instanceof Node&&!t.elements||e instanceof Event&&!t.events||(A=e),A}extend(e,t){if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Arrays can be extended with arrays only");e.splice(0,e.length),t.forEach((t=>{e.push(this.clone(t))}))}else{if(e instanceof Node||e instanceof Event)throw new Error("HTML elmenents and events cannot be extended");if(e&&"object"==typeof e&&null!=t){if("object"!=typeof t)throw new Error("Object can be extended with other objects only.");Object.keys(t).forEach((A=>{var i;null!=e[A]&&"object"==typeof e[A]&&null!=t[A]&&"object"==typeof t[A]?(i=this.clone(t[A]),e[A]instanceof Node||e[A]instanceof Event?e[A]=i:(Array.isArray(e[A])&&this.isPlainObject(i)&&(e[A]={}),this.extend(e[A],i))):e[A]=this.clone(t[A])}))}else if(null!=t)throw new Error("Object is not extendable, only {} or [] can be extended.")}if(2<arguments.length)for(let t=2;t<arguments.length;t++)this.extend(e,arguments[t]);return e}naturalCompare(e,t){let A,i,s=1,n=0,r=0,o=String.alphabet;function l(e,t,i){if(i){for(A=t;(i=l(e,A))<76&&65<i;)++A;return+e.slice(t-1,A)}return-1<(i=o&&o.indexOf(e.charAt(t)))?i+76:(i=e.charCodeAt(t)||0)<45||127<i?i:i<46?65:i<48?i-1:i<58?i+18:i<65?i-11:i<91?i+11:i<97?i-37:i<123?i+5:i-63}if((e+="")!=(t+=""))for(;s;)if(i=l(e,n++),s=l(t,r++),i<76&&s<76&&66<i&&66<s&&(i=l(e,n,n),s=l(t,r,n=A),r=A),i!=s)return i<s?-1:1;return 0}normMenu(e,t){return Array.isArray(e)?(e.forEach(((t,A)=>{"string"==typeof t||"number"==typeof t?e[A]={id:t,text:String(t)}:null!=t?(null!=t.caption&&null==t.text&&(t.text=t.caption),null!=t.text&&null==t.id&&(t.id=t.text),null==t.text&&null!=t.id&&(t.text=t.id)):e[A]={id:null,text:"null"}})),e):"function"==typeof e?(t=e.call(this,e,t),a.normMenu.call(this,t)):"object"==typeof e?Object.keys(e).map((t=>({id:t,text:e[t]}))):void 0}prepareParams(e,t,A){A=A??a.settings.dataType;let i=t.body;switch(A){case"HTTPJSON":i={request:i},["PUT","DELETE"].includes(t.method)&&(t.method="POST"),s();break;case"HTTP":["PUT","DELETE"].includes(t.method)&&(t.method="POST"),s();break;case"RESTFULL":["PUT","DELETE"].includes(t.method)?t.headers["Content-Type"]="application/json":s();break;case"JSON":"GET"==t.method?(i={request:i},s()):(t.headers["Content-Type"]="application/json",t.method="POST")}return t.body="string"==typeof t.body?t.body:JSON.stringify(t.body),t;function s(){Object.keys(i).forEach((t=>{let A=i[t];"object"==typeof A&&(A=JSON.stringify(A)),e.searchParams.append(t,A)})),delete t.body}}bindEvents(e,t){0!=e.length&&(e?.[0]instanceof Node&&(e=Array.isArray(e)?e:e.get()),o(e).each((e=>{let A=o(e).data();Object.keys(A).forEach((i=>{if(-1!=["click","dblclick","mouseenter","mouseleave","mouseover","mouseout","mousedown","mousemove","mouseup","contextmenu","focus","focusin","focusout","blur","input","change","keydown","keyup","keypress"].indexOf(String(i).toLowerCase())){let s=A[i],n=(s="string"==typeof s?s.split("|").map((e=>{"null"===(e="undefined"===(e="false"!==(e="true"===e||e)&&e)?void 0:e)&&(e=null);var t=["'",'"',"`"];return"string"==typeof(e=parseFloat(e)==e?parseFloat(e):e)&&t.includes(e[0])&&t.includes(e[e.length-1])?e.substring(1,e.length-1):e})):s)[0];s=s.slice(1),o(e).off(i+".w2utils-bind").on(i+".w2utils-bind",(function(e){switch(n){case"alert":alert(s[0]);break;case"stop":e.stopPropagation();break;case"prevent":e.preventDefault();break;case"stopPrevent":return e.stopPropagation(),e.preventDefault(),!1;default:if(null==t[n])throw new Error(`Cannot dispatch event as the method "${n}" does not exist.`);t[n].apply(t,s.map(((t,A)=>{switch(String(t).toLowerCase()){case"event":return e;case"this":return this;default:return t}})))}}))}}))})))}debounce(e,t=250){let A;return(...i)=>{clearTimeout(A),A=setTimeout((()=>{e(...i)}),t)}}};function d(e,t,A){let i;return t={title:a.lang(t??"Notification"),body:`<div class="w2ui-centered w2ui-msg-text">${e}</div>`,showClose:!1,actions:{ok:"Ok"},cancelAction:"ok"},(i=0<o("#w2ui-popup").length&&"closing"!=u.status?u.message(t):u.open(t)).ok((e=>{"function"==typeof e.detail.self?.close&&e.detail.self.close(),"function"==typeof A&&A()})),i}function c(e,t,A){let i,s=e;return(s=["string","number"].includes(typeof s)?{msg:s}:s).msg&&(s.body=`<div class="w2ui-centered w2ui-msg-text">${s.msg}</div>`,delete s.msg),"function"==typeof t&&null==A&&(A=t,t=void 0),a.extend(s,{title:a.lang(t??s.title??"Confirmation"),showClose:!1,modal:!0,cancelAction:"no"}),null==A&&null!=s.callBack&&(A=s.callBack),a.normButtons(s,{yes:"Yes",no:"No"}),(i=0<o("#w2ui-popup").length&&"closing"!=u.status?u.message(s):u.open(s)).self.off(".confirm").on("action:after.confirm",(e=>{"function"==typeof e.detail.self?.close&&e.detail.self.close(),"function"==typeof A&&A(e.detail.action)})),i}function h(e,t,A){let i,s=e;return(s=["string","number"].includes(typeof s)?{label:s}:s).label&&(s.focus=1,s.body=s.textarea?`<div class="w2ui-prompt textarea">\n                 <div>${s.label}</div>\n                 <textarea id="w2prompt" class="w2ui-input" ${s.attrs??""}\n                    data-keydown="keydown|event" data-keyup="change|event">${s.value??""}</textarea>\n               </div>`:`<div class="w2ui-prompt w2ui-centered">\n                 <label>${s.label}</label>\n                 <input id="w2prompt" class="w2ui-input" ${s.attrs??""}\n                    data-keydown="keydown|event" data-keyup="change|event" value="${s.value??""}">\n               </div>`),a.extend(s,{title:a.lang(t??s.title??"Notification"),showClose:!1,modal:!0,cancelAction:"cancel"}),a.normButtons(s,{ok:"Ok",cancel:"Cancel"}),(i=0<o("#w2ui-popup").length&&"closing"!=u.status?u.message(s):u.open(s)).self.box?i.self.input=o(i.self.box).find("#w2prompt").get(0):i.self.input=o("#w2ui-popup .w2ui-popup-body #w2prompt").get(0),null!==s.value&&i.self.input.select(),i.change=function(e){return i.self.on("change",e),this},i.self.off(".prompt").on("open:after.prompt",(e=>{e=e.detail.box||o("#w2ui-popup .w2ui-popup-body").get(0),a.bindEvents(o(e).find("#w2prompt"),{keydown(e){27==e.keyCode&&e.stopPropagation()},change(e){var t=i.self.trigger("change",{target:"prompt",originalEvent:e});!0!==t.isCancelled&&(13==e.keyCode&&(e.ctrlKey||e.metaKey||"TEXTAREA"!=e.target.tagName)&&i.self.action("Ok",e),27==e.keyCode&&i.self.action("Cancel",e),t.finish())}}),o(e).find(".w2ui-eaction").trigger("keyup")})).on("action:after.prompt",(e=>{"function"==typeof e.detail.self?.close&&e.detail.self.close(),"function"==typeof A&&A(e.detail.action)})),i}let u=new class extends s{constructor(){super(),this.defaults={title:"",text:"",body:"",buttons:"",width:450,height:250,focus:null,actions:null,style:"",speed:.3,blockPage:!0,modal:!1,maximized:!1,keyboard:!0,showClose:!0,showMax:!1,resizable:!1,transition:null,openMaximized:!1,moved:!1},this.name="popup",this.status="closed",this.onOpen=null,this.onClose=null,this.onMax=null,this.onMin=null,this.onToggle=null,this.onKeydown=null,this.onAction=null,this.onMove=null,this.tmp={},this.handleResize=e=>{this.options.moved||this.center(void 0,void 0,!0)}}open(e){let t=this;"closing"!=this.status&&!o("#w2ui-popup").hasClass("animating")||this.close(!0);var A=this.options;let i,s,n;null!=(e=["string","number"].includes(typeof e)?a.extend({title:"Notification",body:`<div class="w2ui-centered">${e}</div>`,actions:{Ok(){t.close()}},cancelAction:"ok"},arguments[1]??{}):e).text&&(e.body=`<div class="w2ui-centered w2ui-msg-text">${e.text}</div>`),e=Object.assign({},this.defaults,A,{title:"",body:""},e,{maximized:!1}),this.options=e,0===o("#w2ui-popup").length&&(this.off("*"),Object.keys(this).forEach((e=>{e.startsWith("on")&&"on"!=e&&(this[e]=null)}))),Object.keys(e).forEach((t=>{t.startsWith("on")&&"on"!=t&&e[t]&&(this[t]=e[t])})),e.width=parseInt(e.width),e.height=parseInt(e.height);var{top:r,left:l}=this.center();let d={self:this,action:e=>(t.on("action.prom",e),d),close:e=>(t.on("close.prom",e),d),then:e=>(t.on("open:after.prom",e),d)},c=(null==e.actions||e.buttons||(e.buttons="",Object.keys(e.actions).forEach((A=>{var i=e.actions[A];let s=A;"function"==typeof i&&(e.buttons+=`<button class="w2ui-btn w2ui-eaction" name="${A}" data-click='["action","${A}","event"]'>${A}</button>`),"object"==typeof i&&(e.buttons+=`<button class="w2ui-btn w2ui-eaction ${i.class||""}" name="${A}" data-click='["action","${A}","event"]'\n                        style="${i.style}" ${i.attrs}>${i.text||A}</button>`,s=Array.isArray(e.actions)?i.text:A),"string"==typeof i&&(s=i[0].toLowerCase()+i.substr(1).replace(/\s+/g,""),e.buttons+=`<button class="w2ui-btn w2ui-eaction" name="${A}" data-click='["action","${s}","event"]'>${i}</button>`),"string"==typeof s&&(s=s[0].toLowerCase()+s.substr(1).replace(/\s+/g,"")),d[s]=function(e){return t.on("action.buttons",(t=>{t.detail.action[0].toLowerCase()+t.detail.action.substr(1).replace(/\s+/g,"")==s&&e(t)})),d}}))),"");if(e.showClose&&(c+='<div class="w2ui-popup-button w2ui-popup-close">\n                        <span class="w2ui-icon w2ui-icon-cross w2ui-eaction" data-mousedown="stop" data-click="close"></span>\n                    </div>'),e.showMax&&(c+='<div class="w2ui-popup-button w2ui-popup-max">\n                        <span class="w2ui-icon w2ui-icon-box w2ui-eaction" data-mousedown="stop" data-click="toggle"></span>\n                    </div>'),0===o("#w2ui-popup").length){if(!0===(i=this.trigger("open",{target:"popup",present:!1})).isCancelled)return;this.status="opening",e.blockPage&&a.lock(document.body,{opacity:.3,onClick:e.modal?null:()=>{this.close()}}),l=`\n                left: ${l}px;\n                top: ${r}px;\n                width: ${parseInt(e.width)}px;\n                height: ${parseInt(e.height)}px;\n                transition: ${e.speed}s\n            `,s=`<div id="w2ui-popup" class="w2ui-popup w2ui-anim-open animating ${e.blockPage?"":"w2ui-non-blocking"}" style="${a.stripSpaces(l)}"></div>`,o("body").append(s),o("#w2ui-popup")[0]._w2popup={self:this,created:new Promise((e=>{this._promCreated=e})),opened:new Promise((e=>{this._promOpened=e})),closing:new Promise((e=>{this._promClosing=e})),closed:new Promise((e=>{this._promClosed=e}))},l=(e.title?"":"top: 0px !important;")+" "+(e.buttons?"":"bottom: 0px !important;"),s=`\n                <span name="hidden-first" tabindex="0" style="position: absolute; top: -100px"></span>\n                <div class="w2ui-popup-title-btns">${c}</div>\n                <div class="w2ui-popup-title" style="${e.title?"":"display: none"}"></div>\n                <div class="w2ui-box" style="${l}">\n                    <div class="w2ui-popup-body ${!e.title||" w2ui-popup-no-title"}\n                        ${!e.buttons||" w2ui-popup-no-buttons"}" style="${e.style}">\n                    </div>\n                </div>\n                <div class="w2ui-popup-buttons" style="${e.buttons?"":"display: none"}"></div>\n                <div class="w2ui-popup-resizer resize-point resize-icon"></div>\n                <span name="hidden-last" tabindex="0" style="position: absolute; top: -100px"></span>\n            `,o("#w2ui-popup").html(s),e.title&&o("#w2ui-popup .w2ui-popup-title").append(a.lang(e.title)),e.buttons&&o("#w2ui-popup .w2ui-popup-buttons").append(e.buttons),e.body&&o("#w2ui-popup .w2ui-popup-body").append(e.body),setTimeout((()=>{o("#w2ui-popup").css("transition",e.speed+"s").removeClass("w2ui-anim-open"),a.bindEvents("#w2ui-popup .w2ui-eaction",this),o("#w2ui-popup").find(".w2ui-popup-body").show(),this._promCreated()}),1),clearTimeout(this._timer),this._timer=setTimeout((()=>{this.status="open",t.setFocus(e.focus),i.finish(),this._promOpened(),o("#w2ui-popup").removeClass("animating")}),1e3*e.speed)}else{if(!0===(i=this.trigger("open",{target:"popup",present:!0})).isCancelled)return;this.status="opening",null!=A&&(A.maximized||A.width==e.width&&A.height==e.height||this.resize(e.width,e.height),e.prevSize=e.width+"px:"+e.height+"px",e.maximized=A.maximized),r=o("#w2ui-popup .w2ui-box").get(0).cloneNode(!0),o(r).removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(e.body),o("#w2ui-popup .w2ui-box").after(r),e.buttons?(o("#w2ui-popup .w2ui-popup-buttons").show().html("").append(e.buttons),o("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),o("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(o("#w2ui-popup .w2ui-popup-buttons").hide().html(""),o("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),o("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),e.title?(o("#w2ui-popup .w2ui-popup-title").show().html(a.lang(e.title)),o("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),o("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):(o("#w2ui-popup .w2ui-popup-title").hide().html(""),o("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),o("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px")),c?o("#w2ui-popup .w2ui-popup-title-btns").show().html(c):o("#w2ui-popup .w2ui-popup-title-btns").hide();let s=o("#w2ui-popup .w2ui-box")[0],n=o("#w2ui-popup .w2ui-box-temp")[0];o("#w2ui-popup").addClass("animating"),a.transition(s,n,e.transition,(()=>{o(s).remove(),o(n).removeClass("w2ui-box-temp").addClass("w2ui-box");var A=o(n).find(".w2ui-popup-body");1==A.length&&(A[0].style.cssText=e.style,A.show()),t.setFocus(e.focus),o("#w2ui-popup").removeClass("animating")})),this.status="open",i.finish(),a.bindEvents("#w2ui-popup .w2ui-eaction",this),o("#w2ui-popup").find(".w2ui-popup-body").show()}return e.openMaximized&&this.max(),e._last_focus=document.activeElement,e.keyboard&&o(document.body).off(".w2popup").on("keydown.w2popup",(e=>{this.keydown(e)})),o(window).on("resize",this.handleResize),n={changing:!1,mvMove:function(e){1==n.changing&&(e=e||window.event,n.div_x=e.screenX-n.x,n.div_y=e.screenY-n.y,!0!==(e=t.trigger("move",{target:"popup",div_x:n.div_x,div_y:n.div_y,originalEvent:e})).isCancelled)&&("moving"==t.status?(o("#w2ui-popup").css({transition:"none",transform:"translate3d("+n.div_x+"px, "+n.div_y+"px, 0px)"}),t.options.moved=!0):o("#w2ui-popup").css({transition:"none",width:n.width+n.div_x+"px",height:n.height+n.div_y+"px"}),e.finish())},mvStop:function(e){1!=n.changing||(e=e||window.event,n.div_x=e.screenX-n.x,n.div_y=e.screenY-n.y,"moving"==t.status?o("#w2ui-popup").css({left:n.pos_x+n.div_x+"px",top:n.pos_y+n.div_y+"px"}).css({transition:"none",transform:"translate3d(0px, 0px, 0px)"}):(o("#w2ui-popup").css({transition:"none",width:n.width+n.div_x+"px",height:n.height+n.div_y+"px"}),t.resizeMessages()),n.changing=!1,t.status="open",o(document.body).off(".w2ui-popup"),n.isLocked)||t.unlock()}},o("#w2ui-popup .w2ui-popup-title").off("mousedown").on("mousedown",(function(e){t.options.maximized||h(e)})),e.resizable?(o("#w2ui-popup .w2ui-popup-resizer").show(),o("#w2ui-popup .w2ui-popup-resizer").off("mousedown").on("mousedown",(e=>{h(e,!0)}))):o("#w2ui-popup .w2ui-popup-resizer").hide(),d;function h(e,A){e=e||window.event,t.status=A?"resizing":"moving",A=o("#w2ui-popup").get(0).getBoundingClientRect(),Object.assign(n,{changing:!0,isLocked:1==o("#w2ui-popup > .w2ui-lock").length,x:e.screenX,y:e.screenY,pos_x:A.x,pos_y:A.y,width:A.width,height:A.height}),n.isLocked||t.lock({opacity:0}),o(document.body).on("mousemove.w2ui-popup",n.mvMove).on("mouseup.w2ui-popup",n.mvStop),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault()}}load(e){return new Promise(((t,A)=>{if(null==(e="string"==typeof e?{url:e}:e).url)console.log("ERROR: The url is not defined."),A("The url is not defined");else{this.status="loading";let[A,i]=String(e.url).split("#");A&&fetch(A).then((e=>e.text())).then((A=>{t(this.template(A,i,e))}))}}))}template(e,t,A={}){let i;try{i=o(e)}catch(t){i=o.html(e)}return t&&(i=i.filter("#"+t)),Object.assign(A,{width:parseInt(o(i).css("width")),height:parseInt(o(i).css("height")),title:o(i).find("[rel=title]").html(),body:o(i).find("[rel=body]").html(),buttons:o(i).find("[rel=buttons]").html(),style:o(i).find("[rel=body]").get(0).style.cssText}),this.open(A)}action(e,t){let A=this.options.actions[e];A instanceof Object&&A.onClick&&(A=A.onClick),!0!==(e=this.trigger("action",{action:e,target:"popup",self:this,originalEvent:t,value:this.input?this.input.value:null})).isCancelled&&("function"==typeof A&&A.call(this,t),e.finish())}keydown(e){var t;this.options&&!this.options.keyboard||!0!==(t=this.trigger("keydown",{target:"popup",originalEvent:e})).isCancelled&&(27===e.keyCode&&(e.preventDefault(),0==o("#w2ui-popup .w2ui-message").length)&&(this.options.cancelAction?this.action(this.options.cancelAction):this.close()),t.finish())}close(e){let t=this.trigger("close",{target:"popup"});var A;!0!==t.isCancelled&&(A=()=>{o("#w2ui-popup").remove(),this.options._last_focus&&0<this.options._last_focus.length&&this.options._last_focus.focus(),this.status="closed",this.options={},t.finish(),this._promClosed()},0!==o("#w2ui-popup").length)&&"closed"!=this.status&&("opening"==this.status&&(e=!0),"closing"==this.status&&!0===e?(A(),clearTimeout(this.tmp.closingTimer),a.unlock(document.body,0)):(this.status="closing",o("#w2ui-popup").css("transition",this.options.speed+"s").addClass("w2ui-anim-close animating"),a.unlock(document.body,300),this._promClosing(),e?A():this.tmp.closingTimer=setTimeout(A,1e3*this.options.speed),this.options.keyboard&&o(document.body).off("keydown",this.keydown),o(window).off("resize",this.handleResize)))}toggle(){let e=this.trigger("toggle",{target:"popup"});!0!==e.isCancelled&&(!0===this.options.maximized?this.min():this.max(),setTimeout((()=>{e.finish()}),1e3*this.options.speed+50))}max(){if(!0!==this.options.maximized){let t=this.trigger("max",{target:"popup"});var e;!0!==t.isCancelled&&(this.status="resizing",e=o("#w2ui-popup").get(0).getBoundingClientRect(),this.options.prevSize=e.width+":"+e.height,this.resize(1e4,1e4,(()=>{this.status="open",this.options.maximized=!0,t.finish()})))}}min(){if(!0===this.options.maximized){var e=this.options.prevSize.split(":");let t=this.trigger("min",{target:"popup"});!0!==t.isCancelled&&(this.status="resizing",this.options.maximized=!1,this.resize(parseInt(e[0]),parseInt(e[1]),(()=>{this.status="open",this.options.prevSize=null,t.finish()})))}}clear(){o("#w2ui-popup .w2ui-popup-title").html(""),o("#w2ui-popup .w2ui-popup-body").html(""),o("#w2ui-popup .w2ui-popup-buttons").html("")}reset(){this.open(this.defaults)}message(e){return a.message({owner:this,box:o("#w2ui-popup").get(0),after:".w2ui-popup-title"},e)}confirm(e){return a.confirm({owner:this,box:o("#w2ui-popup"),after:".w2ui-popup-title"},e)}setFocus(e){let t=o("#w2ui-popup"),A="input, button, select, textarea, [contentEditable], [tabindex], .w2ui-input";null!=e?(isNaN(e)?t.find(A).filter(e).get(0):t.find(A).get(e))?.focus():(e=t.find("[name=hidden-first]").get(0))&&e.focus(),o(t).find(A).off(".keep-focus").on("blur.keep-focus",(function(e){setTimeout((()=>{var e=document.activeElement,i=0<o(t).find(A).filter(e).length,s=o(e).attr("name");!i&&e&&e!==document.body&&o(t).find(A).get(0)?.focus(),"hidden-last"==s&&o(t).find(A).get(1)?.focus(),"hidden-first"==s&&o(t).find(A).get(-2)?.focus()}),1)}))}lock(e,t){var A=Array.from(arguments);A.unshift(o("#w2ui-popup")),a.lock(...A)}unlock(e){a.unlock(o("#w2ui-popup"),e)}center(e,t,A){let i,s;s=null==window.innerHeight?(i=parseInt(document.documentElement.offsetWidth),parseInt(document.documentElement.offsetHeight)):(i=parseInt(window.innerWidth),parseInt(window.innerHeight)),e=parseInt(e??this.options.width),t=parseInt(t??this.options.height),!0===this.options.maximized&&(e=i,t=s),i-10<e&&(e=i-10),s-10<t&&(t=s-10);var n=(s-t)/3,r=(i-e)/2;return A&&(o("#w2ui-popup").css({transition:"none",top:n+"px",left:r+"px",width:e+"px",height:t+"px"}),this.resizeMessages()),{top:n,left:r,width:e,height:t}}resize(e,t,A){let i=this;null==this.options.speed&&(this.options.speed=0);var{top:e,left:t,width:s,height:n}=this.center(e,t),r=this.options.speed;o("#w2ui-popup").css({transition:r+`s width, ${r}s height, ${r}s left, ${r}s top`,top:e+"px",left:t+"px",width:s+"px",height:n+"px"});let l=setInterval((()=>{i.resizeMessages()}),10);setTimeout((()=>{clearInterval(l),i.resizeMessages(),"function"==typeof A&&A()}),1e3*this.options.speed+50)}resizeMessages(){o("#w2ui-popup .w2ui-message").each((e=>{var t=e._msg_options,A=o("#w2ui-popup"),i=(parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10),A[0].getBoundingClientRect()),s=(A=parseInt(A.find(".w2ui-popup-title")[0].clientHeight),parseInt(i.width));i=parseInt(i.height),t.width=t.originalWidth,t.width>s-10&&(t.width=s-10),t.height=t.originalHeight,t.height>i-A-5&&(t.height=i-A-5),t.originalHeight<0&&(t.height=i+t.originalHeight-A),t.originalWidth<0&&(t.width=s+2*t.originalWidth),o(e).css({left:(s-t.width)/2+"px",width:t.width+"px",height:t.height+"px"})}))}};class p{static active={};constructor(){this.defaults={name:null,html:"",style:"",class:"",position:"top|bottom",align:"",anchor:null,contextMenu:!1,anchorClass:"",anchorStyle:"",autoShow:!1,autoShowOn:null,autoHideOn:null,arrowSize:8,screenMargin:2,autoResize:!0,margin:1,offsetX:0,offsetY:0,maxWidth:null,maxHeight:null,watchScroll:null,watchResize:null,hideOn:null,onThen:null,onShow:null,onHide:null,onUpdate:null,onMove:null}}static observeRemove=new MutationObserver((e=>{let t=0;Object.keys(p.active).forEach((e=>{(e=p.active[e]).displayed&&(e.anchor&&e.anchor.isConnected?t++:e.hide())})),0===t&&p.observeRemove.disconnect()}));trigger(e,t){var A;if(2==arguments.length&&(A=e,(e=t).type=A),e.overlay)return e.overlay.trigger(e);console.log("ERROR: cannot find overlay where to trigger events")}get(e){return 0==arguments.length?Object.keys(p.active):!0===e?p.active:p.active[e.replace(/[\s\.#]/g,"_")]}attach(e,t){let A,i,n=this;if(0!=arguments.length){1==arguments.length&&e instanceof Object?e=(A=e).anchor:2===arguments.length&&"string"==typeof t?t=(A={anchor:e,html:t}).html:2===arguments.length&&null!=t&&"object"==typeof t&&(t=(A=t).html),A=a.extend({},this.defaults,A||{}),!(t=!t&&A.text?A.text:t)&&A.html&&(t=A.html),delete A.anchor;let r=A.name||e?.id;e!=document&&null!=e||(e=document.body),A.contextMenu&&(e=document.body,r=r??"context-menu"),r||(r="noname-"+Object.keys(p.active).length,console.log("NOTICE: name property is not defined for tooltip, could lead to too many instances")),r=r.replace(/[\s\.#]/g,"_"),p.active[r]?((i=p.active[r]).prevOptions=i.options,i.options=A,i.anchor=e,i.prevOptions.html==i.options.html&&i.prevOptions.class==i.options.class&&i.prevOptions.style==i.options.style||(i.needsUpdate=!0),A=i.options,Object.keys(i).forEach((e=>{var t=i[e];e.startsWith("on")&&"function"==typeof t&&delete i[e]}))):(i=new s,Object.assign(i,{id:"w2overlay-"+r,name:r,options:A,anchor:e,self:n,displayed:!1,tmp:{observeResize:new ResizeObserver((()=>{this.resize(i.name)}))},hide(){n.hide(r)}}),p.active[r]=i),Object.keys(i.options).forEach((e=>{var t=i.options[e];e.startsWith("on")&&"function"==typeof t&&(i[e]=t,delete i.options[e])})),!0===A.autoShow&&(A.autoShowOn=A.autoShowOn??"mouseenter",A.autoHideOn=A.autoHideOn??"mouseleave",A.autoShow=!1,A._keep=!0),A.autoShowOn&&(t="autoShow-"+i.name,o(e).off("."+t).on(A.autoShowOn+"."+t,(e=>{n.show(i.name),e.stopPropagation()})),delete A.autoShowOn,A._keep=!0),A.autoHideOn&&(t="autoHide-"+i.name,o(e).off("."+t).on(A.autoHideOn+"."+t,(e=>{n.hide(i.name),e.stopPropagation()})),delete A.autoHideOn,A._keep=!0),i.off(".attach");let l={overlay:i,then:e=>(i.on("show:after.attach",(t=>{e(t)})),l),show:e=>(i.on("show.attach",(t=>{e(t)})),l),hide:e=>(i.on("hide.attach",(t=>{e(t)})),l),update:e=>(i.on("update.attach",(t=>{e(t)})),l),move:e=>(i.on("move.attach",(t=>{e(t)})),l)};return l}}update(e,t){var A=p.active[e];A?(A.needsUpdate=!0,A.options.html=t,this.show(e)):console.log(`Tooltip "${e}" is not displayed. Cannot update it.`)}show(e){if(e instanceof HTMLElement||e instanceof Object){let t=e,A=(e instanceof HTMLElement&&((t=arguments[1]||{}).anchor=e),this.attach(t));return A.overlay.tmp.hidden=!1,o(A.overlay.anchor).off(".autoShow-"+A.overlay.name).off(".autoHide-"+A.overlay.name),setTimeout((()=>{A.overlay.tmp.hidden||(this.show(A.overlay.name),this.initControls&&this.initControls(A.overlay))}),1),A}let t,A=this,i=p.active[e.replace(/[\s\.#]/g,"_")];if(i){let r=i.options;if(!i||i.displayed&&!i.needsUpdate)this.resize(i?.name);else{var s=r.position.split("|");s=["top","bottom"].includes(s[0]);let l="both"==r.align&&s?"":"white-space: nowrap;";if(r.maxWidth&&a.getStrWidth(r.html,"")>r.maxWidth&&(l="width: "+r.maxWidth+"px; white-space: inherit; overflow: auto;"),l+=" max-height: "+(r.maxHeight||window.innerHeight-4)+"px;",""!==r.html&&null!=r.html){if(i.box){if(!0===(t=this.trigger("update",{target:e,overlay:i})).isCancelled)return void(i.prevOptions&&(i.options=i.prevOptions,delete i.prevOptions));o(i.box).find(".w2ui-overlay-body").attr("style",(r.style||"")+"; "+l).removeClass().addClass("w2ui-overlay-body "+r.class).html(r.html)}else{if(!0===(t=this.trigger("show",{target:e,overlay:i})).isCancelled)return;o("body").append(`<div id="${i.id}" name="${e}" style="display: none; pointer-events: none" class="w2ui-overlay"\n                        data-click="stop" data-focusin="stop">\n                    <style></style>\n                    <div class="w2ui-overlay-body ${r.class}" style="${r.style||""}; ${l}">\n                        ${r.html}\n                    </div>\n                </div>`),i.box=o("#"+a.escapeId(i.id))[0],i.displayed=!0,(s=o(i.anchor).data("tooltipName")??[]).push(e),o(i.anchor).data("tooltipName",s),a.bindEvents(i.box,{}),i.tmp.originalCSS="",0<o(i.anchor).length&&(i.tmp.originalCSS=o(i.anchor)[0].style.cssText)}this.resize(i.name),r.anchorStyle&&(i.anchor.style.cssText+=";"+r.anchorStyle),!r.anchorClass||"w2ui-focus"==r.anchorClass&&i.anchor==document.body||o(i.anchor).addClass(r.anchorClass),"string"==typeof r.hideOn&&(r.hideOn=[r.hideOn]),Array.isArray(r.hideOn)||(r.hideOn=[]),Object.assign(i.tmp,{scrollLeft:document.body.scrollLeft,scrollTop:document.body.scrollTop});{let e=e=>{A.hide(i.name)},t=o(i.anchor),s="tooltip-"+i.name;o("html").off("."+s),r.hideOn.includes("doc-click")&&(["INPUT","TEXTAREA"].includes(i.anchor.tagName)&&t.off(`.${s}-doc`).on(`click.${s}-doc`,(e=>{e.stopPropagation()})),o("html").on("click."+s,e)),r.hideOn.includes("focus-change")&&o("html").on("focusin."+s,(e=>{document.activeElement!=i.anchor&&A.hide(i.name)})),["INPUT","TEXTAREA"].includes(i.anchor.tagName)&&(t.off("."+s),r.hideOn.forEach((A=>{-1==["doc-click","focus-change"].indexOf(A)&&t.on(A+"."+s,{once:!0},e)})))}{var n=document.body;let e="tooltip-"+i.name,t=n;"BODY"==n.tagName&&(t=n.ownerDocument),o(t).off("."+e).on("scroll."+e,(e=>{Object.assign(i.tmp,{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}),A.resize(i.name)}))}return o(i.box).show(),i.tmp.observeResize.observe(i.box),p.observeRemove.observe(document.body,{subtree:!0,childList:!0}),o(i.box).css("opacity",1).find(".w2ui-overlay-body").html(r.html),setTimeout((()=>{o(i.box).css({"pointer-events":"auto"}).data("ready","yes")}),100),delete i.needsUpdate,i.box.overlay=i,t&&t.finish(),{overlay:i}}A.hide(e)}}}hide(e){let t;if(0==arguments.length)Object.keys(p.active).forEach((e=>{this.hide(e)}));else if(e instanceof HTMLElement)(o(e).data("tooltipName")??[]).forEach((e=>{this.hide(e)}));else if("string"==typeof e&&(e=e.replace(/[\s\.#]/g,"_"),t=p.active[e]),t?.tmp&&(t.tmp.hidden=!0),t&&t.box){var A=this.trigger("hide",{target:e,overlay:t});if(!0!==A.isCancelled){t.options._keep||delete p.active[e],e="tooltip-"+t.name,t.tmp.observeResize?.disconnect(),t.options.watchScroll&&o(t.options.watchScroll).off(".w2scroll-"+t.name);let s=0;Object.keys(p.active).forEach((e=>{p.active[e].displayed&&s++})),0==s&&p.observeRemove.disconnect(),o("html").off("."+e),o(document).off("."+e),t.box?.remove(),t.box=null,t.displayed=!1;var i=o(t.anchor).data("tooltipName")??[];-1!=i.indexOf(t.name)&&i.splice(i.indexOf(t.name),1),0==i.length?o(t.anchor).removeData("tooltipName"):o(t.anchor).data("tooltipName",i),t.options.anchorStyle&&(t.anchor.style.cssText=t.tmp.originalCSS),o(t.anchor).off("."+e).removeClass(t.options.anchorClass),t.options.url&&(t.options.items.splice(0),t.tmp.remote.hasMore=!0,t.tmp.remote.search=null),A.finish()}}}resize(e){if(0==arguments.length)Object.keys(p.active).forEach((e=>{(e=p.active[e]).displayed&&this.resize(e.name)}));else{var t=p.active[e.replace(/[\s\.#]/g,"_")];let i=this.getPosition(t.name);var A=i.left+"x"+i.top;let s;t.tmp.lastPos!=A&&(s=this.trigger("move",{target:e,overlay:t,pos:i})),o(t.box).css({left:i.left+"px",top:i.top+"px"}).then((e=>{null!=i.width&&e.css("width",i.width+"px").find(".w2ui-overlay-body").css("width","100%"),null!=i.height&&e.css("height",i.height+"px").find(".w2ui-overlay-body").css("height","100%")})).find(".w2ui-overlay-body").removeClass("w2ui-arrow-right w2ui-arrow-left w2ui-arrow-top w2ui-arrow-bottom").addClass(i.arrow.class).closest(".w2ui-overlay").find("style").text(i.arrow.style),t.tmp.lastPos!=A&&s&&(t.tmp.lastPos=A,s.finish())}}getPosition(e){let t=p.active[e.replace(/[\s\.#]/g,"_")];if(t&&t.box){let h=t.options;(t.tmp.resizedY||t.tmp.resizedX)&&o(t.box).css({width:"",height:"",scroll:"auto"}),e=a.scrollBarSize();var A=!(document.body.scrollWidth==document.body.clientWidth),i=!(document.body.scrollHeight==document.body.clientHeight);let u={width:window.innerWidth-(i?e:0),height:window.innerHeight-(A?e:0)};var s,n="auto"==h.position?"top|bottom|right|left".split("|"):Array.isArray(h.position)?h.position:h.position.split("|");let p=["top","bottom"].includes(n[0]),g=t.box.getBoundingClientRect(),m=t.anchor?.getBoundingClientRect?.();if(t.anchor==document.body){let e=h.originalEvent;for(;e?.originalEvent;)e=e.originalEvent;var{x:r,y:l,width:d,height:c}=e??{x:h.x,y:h.y,width:0,height:10};m={left:r-(h.contextMenu?4:0),top:l-(h.contextMenu?4:0),width:d??0,height:c??10,arrow:h.contextMenu?"none":null}}let f=h.arrowSize,w=("none"==m.arrow&&(f=0),{top:m.top-f,bottom:u.height-f-(m.top+m.height)-(A?e:0)-2,left:m.left,right:u.width-(m.left+m.width)+(i?e:0)});g.width<22&&(g.width=22),g.height<14&&(g.height=14);let B,y,b,v,C="",x={offset:0,class:"",style:`#${t.id} { --tip-size: ${f}px; }`},Q={left:0,top:0},F={posX:"",x:0,posY:"",y:0};switch(n.forEach((e=>{["top","bottom"].includes(e)&&(!C&&g.height+f/1.893<w[e]&&(C=e),w[e]>F.y)&&Object.assign(F,{posY:e,y:w[e]}),["left","right"].includes(e)&&(!C&&g.width+f/1.893<w[e]&&(C=e),w[e]>F.x)&&Object.assign(F,{posX:e,x:w[e]})})),C=C||(p?F.posY:F.posX),h.autoResize&&(["top","bottom"].includes(C)&&(g.height>w[C]?(v=w[C],t.tmp.resizedY=!0):t.tmp.resizedY=!1),["left","right"].includes(C))&&(g.width>w[C]?(b=w[C],t.tmp.resizedX=!0):t.tmp.resizedX=!1),r=C,x.class=m.arrow||"w2ui-arrow-"+r,r){case"top":B=m.left+(m.width-(b??g.width))/2,y=m.top-(v??g.height)-f/1.5+1;break;case"bottom":B=m.left+(m.width-(b??g.width))/2,y=m.top+m.height+f/1.25+1;break;case"left":B=m.left-(b??g.width)-f/1.2-1,y=m.top+(m.height-(v??g.height))/2;break;case"right":B=m.left+m.width+f/1.2+1,y=m.top+(m.height-(v??g.height))/2}p&&("left"==h.align&&(Q.left=m.left-B,B=m.left),"right"==h.align&&(Q.left=m.left+m.width-(b??g.width)-B,B=m.left+m.width-(b??g.width)),["top","bottom"].includes(C)&&h.align.startsWith("both")&&(s=h.align.split(":")[1]??50,m.width>=s)&&(B=m.left,b=m.width),"top"==h.align&&(Q.top=m.top-y,y=m.top),"bottom"==h.align&&(Q.top=m.top+m.height-(v??g.height)-y,y=m.top+m.height-(v??g.height)),["left","right"].includes(C)&&h.align.startsWith("both")&&(s=h.align.split(":")[1]??50,m.height>=s)&&(y=m.top,v=m.height)),y+=parseFloat(h.offsetY*("top"==C?-1:1)),B+=parseFloat(h.offsetX*("left"==C?-1:1));{let e;(["left","right"].includes(h.align)&&m.width<(b??g.width)||["top","bottom"].includes(h.align)&&m.height<(v??g.height))&&(e=!0),l="right"==C?f:h.screenMargin,d="bottom"==C?f:h.screenMargin,c=u.width-(b??g.width)-("left"==C?f:h.screenMargin),A=u.height-(v??g.height)-("top"==C?f:h.screenMargin)+3,(["top","bottom"].includes(C)||h.autoResize)&&(B<l&&(e=!0,Q.left-=B,B=l),B>c)&&(e=!0,Q.left-=B-c,B+=c-B),(["left","right"].includes(C)||h.autoResize)&&(y<d&&(e=!0,Q.top-=y,y=d),y>A)&&(e=!0,Q.top-=y-A,y+=A-y),e&&(l=p?"left":"top",c=p?"width":"height",x.offset=-Q[l],d=g[c]/2-f,Math.abs(x.offset)>d+f&&(x.class=""),Math.abs(x.offset)>d&&(x.offset=x.offset<0?-d:d),x.style=a.stripSpaces(`#${t.id} .w2ui-overlay-body:after,\n                            #${t.id} .w2ui-overlay-body:before {\n                                --tip-size: ${f}px;\n                                margin-${l}: ${x.offset}px;\n                            }`))}return i="top"==C?-h.margin:"bottom"==C?h.margin:0,e="left"==C?-h.margin:"right"==C?h.margin:0,y=Math.floor(100*(y+parseFloat(i)))/100,{left:B=Math.floor(100*(B+parseFloat(e)))/100,top:y,arrow:x,adjust:Q,width:b,height:v,pos:C}}}}let g=new p,m=new class extends p{constructor(){super(),this.defaults=a.extend({},this.defaults,{type:"normal",items:[],index:null,render:null,spinner:!1,msgNoItems:a.lang("No items found"),topHTML:"",menuStyle:"",filter:!1,markSearch:!1,prefilter:!1,match:"contains",search:!1,altRows:!1,arrowSize:10,align:"left",position:"bottom|top",class:"w2ui-white",anchorClass:"w2ui-focus",autoShowOn:"focus",hideOn:["doc-click","focus-change","select"],onSelect:null,onSubMenu:null,onRemove:null})}attach(e,t){let A;1==arguments.length&&e instanceof Object?e=(A=e).anchor:2===arguments.length&&null!=t&&"object"==typeof t&&((A=t).anchor=e),t=A.hideOn,A=a.extend({},this.defaults,A||{}),t&&(A.hideOn=t),A.style+="; padding: 0;",null==A.items&&(A.items=[]),A.cacheMax<=0&&console.log(`The option "cacheMax" is ${A.cacheMax} but should be more than 0`),A.items=a.normMenu(A.items),A.html=this.getMenuHTML(A);let i=super.attach(A),s=i.overlay;return s.on("show:after.attach, update:after.attach",(e=>{if(i.overlay?.box){let e="";s.selected=null,["INPUT","TEXTAREA"].includes(s.anchor.tagName)&&(e=s.anchor.value,s.selected=s.anchor.dataset.selectedIndex);var t=o(i.overlay.box).find(".w2ui-eaction");a.bindEvents(t,this),this.applyFilter(s.name,null,e).then((e=>{p.active[s.name].displayed&&(s.tmp.searchCount=e.count,s.tmp.search=e.search,A.prefilter&&this.refreshSearch(s.name),this.initControls(i.overlay),this.refreshIndex(s.name,!0))}))}})),s.next=()=>{var e,t=this.getActiveChain(s.name);null==s.selected||0==s.selected?.length?s.selected=t[0]:(-1==(e=t.indexOf(s.selected))&&(s.selected=t[0]),e<t.length-1&&(s.selected=t[e+1])),this.refreshIndex(s.name)},s.prev=()=>{var e,t=this.getActiveChain(s.name);null==s.selected||0==s.selected?.length?s.selected=t[t.length-1]:(-1==(e=t.indexOf(s.selected))&&(s.selected=t[t.length-1]),0<e&&(s.selected=t[e-1])),this.refreshIndex(s.name)},s.click=()=>{$(s.box).find(".w2ui-selected").click()},s.on("hide:after.attach",(e=>{g.hide(s.name+"-tooltip")})),i.select=e=>(s.on("select.attach",(t=>{e(t)})),i),i.remove=e=>(s.on("remove.attach",(t=>{e(t)})),i),i.subMenu=e=>(s.on("subMenu.attach",(t=>{e(t)})),i),i}update(e,t){var A,i=p.active[e];i?((A=i.options).items!=t&&(A.items=t),t=this.getMenuHTML(A),A.html!=t&&(A.html=t,i.needsUpdate=!0,this.show(e))):console.log(`Tooltip "${e}" is not displayed. Cannot update it.`)}initControls(e){let t="mousedown",A="click";a.isMobile&&(t="touchstart",A="touchend"),o(e.box).find(".w2ui-menu:not(.w2ui-sub-menu)").off(".w2menu").on("contextmenu.w2menu",(e=>{e.preventDefault()})).on(t+".w2menu",{delegate:".w2ui-menu-item"},(t=>{var A=t.delegate.dataset;this.menuDown(e,t,A.index,A.parents)})).on(A+".w2menu",{delegate:".w2ui-menu-item"},(t=>{var A=t.delegate.dataset;this.menuClick(e,t,parseInt(A.index),A.parents)})).find(".w2ui-menu-item").off(".w2menu").on("mouseEnter.w2menu",(t=>{var A=t.target.dataset,i=e.options.items[A.index]?.tooltip;(i&&g.show({name:e.name+"-tooltip",anchor:t.target,html:i,position:"right|left",hideOn:["doc-click"]}),i=o(t.target).closest(".w2ui-menu").get(0))._evt&&i._evt.target!=t.target&&this.closeSubMenu(i._evt),"yes"==A.hassubmenu&&(A={index:parseInt(A.index),parents:""!==i.dataset.parents?i.dataset.parents.split("-").map((e=>parseInt(e))):[],target:t.target,originalEvent:t,overlay:e},i._evt=A,this.openSubMenu(A))})).on("mouseLeave.w2menu",(t=>{g.hide(e.name+"-tooltip")})).find(".menu-help").off(".w2menu").on("mouseEnter.w2menu",(t=>{var A=t.target.parentNode.parentNode.dataset;A=e.options.items[A.index]?.help,A&&g.show({name:e.name+"-help-tp",anchor:t.target,html:A,position:"right|left",hideOn:["doc-click"]})})).on("mouseLeave.w2menu",(t=>{g.hide(e.name+"-help-tp")})),["INPUT","TEXTAREA"].includes(e.anchor.tagName)&&o(e.anchor).off(".w2menu").on("input.w2menu",(e=>{})).on("keyup.w2menu",(t=>{t._searchType="filter",this.keyUp(e,t)})),e.options.search&&o(e.box).find("#menu-search").off(".w2menu").on("keyup.w2menu",(t=>{t._searchType="search",this.keyUp(e,t)}))}getCurrent(e,t){var A=(e=p.active[e.replace(/[\s\.#]/g,"_")]).options;let i=(t||(e.selected??"")).split("-");t=i.length-1,e=i[t];var s=i.slice(0,i.length-1).join("-");e=a.isInt(e)?parseInt(e):0;let n=A.items;return i.forEach(((e,t)=>{t<i.length-1&&(n=n[e].items)})),{last:t,index:e,items:n,item:n[e],parents:s}}getMenuHTML(e){if(e.spinner)return`\n            <div class="w2ui-menu">\n                <div class="w2ui-no-items">\n                    <div class="w2ui-spinner"></div>\n                    ${a.lang("Loading...")}\n                </div>\n            </div>`;let t=e.parents??[],A=e.items,i=(Array.isArray(A)||(A=[]),0),s=null,n="",r=(e.search&&(n+='\n                <div class="w2ui-menu-search">\n                    <span class="w2ui-icon w2ui-icon-search"></span>\n                    <input id="menu-search" class="w2ui-input" type="text"/>\n                </div>',A.forEach((e=>e.hidden=!1))),e.topHTML&&(n+=`<div class="w2ui-menu-top">${e.topHTML}</div>`),`\n            ${n}\n            <div class="w2ui-menu" style="${e.menuStyle}" data-parents="${t.join("-")}">\n        `);if(A.forEach(((n,o)=>{s=n.icon;var l=(0<t.length?t.join("-")+"-":"")+o;if(null==s&&(s=null),-1==["radio","check"].indexOf(e.type)||Array.isArray(n.items)||!1===n.group||(s=!0===n.checked?"w2ui-icon-check":"w2ui-icon-empty"),!0!==n.hidden){let t=n.text,A="";if("function"==typeof(t="function"==typeof e.render?e.render(n,e):t)&&(t=t(n,e)),s&&("<"!==String(s).slice(0,1)&&(s=`<span class="w2ui-icon ${s}"></span>`),A=`<div class="menu-icon">${s}</span></div>`),null==n.removable&&null!=n.remove&&(n.removable=n.remove),"break"!==n.type&&null!=t&&""!==t&&"--"!=String(t).substr(0,2)){var d=["w2ui-menu-item"];1==e.altRows&&d.push(i%2==0?"w2ui-even":"w2ui-odd");let s=1,c=(""===A&&s++,null==n.count&&null==n.hotkey&&!0!==n.removable&&null==n.items&&s++,null==n.tooltip&&null!=n.hint&&(n.tooltip=n.hint),"");!0===n.removable?c='<span class="menu-remove">x</span>':null!=n.items?(d.push("has-sub-menu"),c='<span style="background-color: transparent; border: transparent; box-shadow: none;"></span>'):(null!=n.count&&(c+="<span>"+n.count+"</span>"),null!=n.hotkey&&(c+='<span class="menu-hotkey">'+n.hotkey+"</span>"),null!=n.help&&(c+='<span class="menu-help">?</span>')),!0===n.disabled&&d.push("w2ui-disabled"),!0===n._noSearchInside&&d.push("w2ui-no-search-inside"),r+=`\n                        <div index="${l}" class="${d.join(" ")}" style="${n.style||""}"\n                            data-index="${o}" data-hasSubmenu="${null!=n.items?"yes":""}">\n                                <div style="width: ${parseInt(n.indent??0)}px"></div>\n                                ${A}\n                                <div class="menu-text" colspan="${s}">${a.lang(t)}</div>\n                                <div class="menu-extra">${c}</div>\n                        </div>`,i++}else d=(t??"").replace(/^-+/g,""),r+=`\n                        <div index="${l}" class="w2ui-menu-divider ${""!=d?"has-text":""}">\n                            <div class="line"></div>\n                            ${d?`<div class="text">${d}</div>`:""}\n                        </div>`}A[o]=n})),0===i&&e.msgNoItems){var o=p.active[e.name.replace(/[\s\.#]/g,"_")]?.tmp.remote;let t=e.msgNoItems;e.url&&(t=0==i&&!1===o?.hasMore?e.msgNoItems:e.msgSearch),r+=`\n                <div class="w2ui-no-items">\n                    ${a.lang(t)}\n                </div>`}return r+="</div>"}openSubMenu(e){var t=o(e.originalEvent.target).get(0);let A=e.overlay;var i;let s=[];"function"==typeof(i=(i=A.options.items)[e.index]).items?s=i.items(i):Array.isArray(i.items)&&(s=i.items),(i=m.get(A.name+"-submenu"))&&i.hide(),o(e.target).addClass("expanded"),m.show({name:A.name+"-submenu",anchor:t,items:s,class:A.options.class,offsetX:-7,arrowSize:0,parentOverlay:A,parents:[...e.parents,e.index],position:"right|left",hideOn:["doc-click"]}).hide((t=>{o(e.target).removeClass("expanded")})).select((e=>{var t=e.detail.overlay.options.parents;let i=A;for(;i.options.parentOverlay;)i=i.options.parentOverlay;this.menuClick(i,e.detail.originalEvent,parseInt(e.detail.index),t)})),setTimeout((()=>{o("#w2overlay-"+A.name+"-submenu").on("mouseenter",(e=>{e.target._keepSubOpen=!0})).on("mouseleave",(e=>{e.target._keepSubOpen=!1}))}),10)}closeSubMenu(e){var t=e.overlay;!0!==e.target._keepSubOpen&&(e=m.get(t.name+"-submenu"))&&e.hide()}refreshIndex(e,t){var A,i;(e=p.active[e.replace(/[\s\.#]/g,"_")])&&(e.displayed||this.show(e.name),A=o(e.box).find(".w2ui-overlay-body").get(0),i=o(e.box).find(".w2ui-menu-search, .w2ui-menu-top").get(0),o(e.box).find(".w2ui-menu-item.w2ui-selected").removeClass("w2ui-selected"),e=o(e.box).find(`.w2ui-menu-item[index="${e.selected}"]`).addClass("w2ui-selected").get(0))&&(e.offsetTop+e.clientHeight>A.clientHeight+A.scrollTop&&e.scrollIntoView({behavior:t?"instant":"smooth",block:t?"center":"start",inline:t?"center":"start"}),e.offsetTop<A.scrollTop+(i?i.clientHeight:0))&&e.scrollIntoView({behavior:t?"instant":"smooth",block:t?"center":"end",inline:t?"center":"end"})}refreshSearch(e){let t=p.active[e.replace(/[\s\.#]/g,"_")];t&&(t.displayed||this.show(t.name),o(t.box).find(".w2ui-no-items").hide(),o(t.box).find(".w2ui-menu-item, .w2ui-menu-divider").each((A=>{var i;this.getCurrent(e,A.getAttribute("index")).item?.hidden?o(A).hide():(i=t.tmp?.search,t.options.markSearch&&a.marker(A,i,{onlyFirst:"begins"==t.options.match}),o(A).show())})),o(t.box).find(".w2ui-sub-menu").each((t=>{var A=o(t).find(".w2ui-menu-item").get().some((e=>"none"!=e.style.display));this.getCurrent(e,t.dataset.parent).item.expanded&&(A?o(t).parent().show():o(t).parent().hide())})),0!=t.tmp.searchCount&&0!=t.options?.items?.length||(0==o(t.box).find(".w2ui-no-items").length&&o(t.box).find(".w2ui-menu:not(.w2ui-sub-menu)").append(`\n                    <div class="w2ui-no-items">\n                        ${a.lang(t.options.msgNoItems)}\n                    </div>`),o(t.box).find(".w2ui-no-items").show()))}applyFilter(e,t,A,i){let s=0;var n=p.active[e.replace(/[\s\.#]/g,"_")];let r,l,d=n.options;var c=new Promise(((e,t)=>{r=e,l=t}));null==A&&(A=["INPUT","TEXTAREA"].includes(n.anchor.tagName)?n.anchor.value:"");let h=[];d.selected&&(Array.isArray(d.selected)?h=d.selected.map((e=>e?.id??e)):d.selected?.id&&(h=[d.selected.id])),n.tmp.activeChain=null;var u,g=n.tmp.remote??{hasMore:!0,emptySet:!1,search:null,cached:-1};if(0==g.hasMore&&(u=g.hasMore_search.length,A.substr(0,u)!=g.hasMore_search)&&(g.hasMore=!0),null==t&&d.url&&g.hasMore&&g.search!==A){let t=!0,s=a.lang("Loading...");A.length<d.minLength&&!0!==g.emptySet&&(s=a.lang("${count} letters or more...",{count:d.minLength}),t=!1,""===A&&(s=a.lang(d.msgSearch)),0<d.items?.length)&&(this.update(e,[]),this.applyFilter(e,null,A)),o(n.box).find(".w2ui-no-items").html(s),g.search=A,d.items=[],n.tmp.remote=g,t&&this.request(n,A,i).then((t=>{this.update(e,t),this.applyFilter(e,null,A).then((e=>{r(e)}))})).catch((e=>{console.log("Server Request error",e)}))}else{let i;null==t&&!0===(i=this.trigger("search",{search:A,overlay:n,prom:c,resolve:r,reject:l})).isCancelled||(null==t&&(t=n.options.items),!1===d.filter?r({count:-1,search:A}):(t.forEach((t=>{let i="",n="";-1!==["is","begins","begins with"].indexOf(d.match)&&(i="^"),-1!==["is","ends","ends with"].indexOf(d.match)&&(n="$");try{new RegExp(i+A+n,"i").test(t.text)||"..."===t.text?t.hidden=!1:t.hidden=!0}catch(i){}d.hideSelected&&h.includes(t.id)&&(t.hidden=!0),Array.isArray(t.items)&&0<t.items.length&&(delete t._noSearchInside,this.applyFilter(e,t.items,A).then((e=>{0<(e=e.count)&&(s+=e,t.hidden&&(t._noSearchInside=!0),A&&(t.expanded=!0),t.hidden=!1)}))),!0!==t.hidden&&s++})),r({count:s,search:A}),i?.finish()))}return c}request(e,t,A){let i,s,n=e.options,r=e.tmp.remote;return(0===n.items.length&&0!==r.cached||r.cached==n.cacheMax&&t.length>r.search.length||t.length>=r.search.length&&t.substr(0,r.search.length)!==r.search||t.length<r.search.length)&&(r.controller&&r.controller.abort(),r.loading=!0,clearTimeout(r.timeout),r.timeout=setTimeout((()=>{var A=n.url;let o={search:t,max:n.cacheMax};Object.assign(o,n.postData);var l,d=this.trigger("request",{search:t,overlay:e,url:A,postData:o,httpMethod:n.method??"GET",httpHeaders:{}});!0!==d.isCancelled&&(A=new URL(d.detail.url,location),l=a.prepareParams(A,{method:d.detail.httpMethod,headers:d.detail.httpHeaders,body:d.detail.postData}),r.controller=new AbortController,l.signal=r.controller.signal,fetch(A,l).then((e=>e.json())).then((A=>{r.controller=null;var s=e.trigger("load",{search:o.search,overlay:e,data:A});!0!==s.isCancelled&&("string"==typeof(A=s.detail.data)&&(A=JSON.parse(A)),null==(A=Array.isArray(A)?{records:A}:A).records&&null!=A.items&&(A.records=A.items,delete A.items),A.error||null!=A.records||(A.records=[]),Array.isArray(A.records)?(A.records.length>=n.cacheMax?(A.records.splice(n.cacheMax,A.records.length),r.hasMore=!0):(r.hasMore=!1,r.hasMore_search=t),null==n.recId&&null!=n.recid&&(n.recId=n.recid),(n.recId||n.recText)&&A.records.forEach((e=>{"string"==typeof n.recId&&(e.id=e[n.recId]),"function"==typeof n.recId&&(e.id=n.recId(e)),"string"==typeof n.recText&&(e.text=e[n.recText]),"function"==typeof n.recText&&(e.text=n.recText(e))})),r.loading=!1,r.search=t,r.cached=0==A.records.length?-1:A.records.length,r.lastError="",r.emptySet=""===t&&0===A.records.length,s.finish(),i(a.normMenu(A.records))):console.error("ERROR: server did not return proper data structure","\n"," - it should return",{records:[{id:1,text:"item"}]},"\n"," - or just an array ",[{id:1,text:"item"}],"\n"," - or if errorr ",{error:!0,message:"error message"}))})).catch((A=>{var i=this.trigger("error",{overlay:e,search:t,error:A});!0!==i.isCancelled&&("AbortError"!==A?.name&&console.error("ERROR: Server communication failed.","\n"," - it should return",{records:[{id:1,text:"item"}]},"\n"," - or just an array ",[{id:1,text:"item"}],"\n"," - or if errorr ",{error:!0,message:"error message"}),r.loading=!1,r.search="",r.cached=-1,r.emptySet=!0,r.lastError=i.detail.error||"Server communication failed",n.items=[],i.finish(),s())})),d.finish())}),A?n.debounce??350:0)),new Promise(((e,t)=>{i=e,s=t}))}getActiveChain(e,t,A=[],i=[],s){var n=p.active[e.replace(/[\s\.#]/g,"_")];return null!=n.tmp.activeChain?n.tmp.activeChain:((t=null==t?n.options.items:t).forEach(((t,s)=>{t.hidden||t.disabled||t?.text?.startsWith("--")||(i.push(A.concat([s]).join("-")),Array.isArray(t.items)&&0<t.items.length&&t.expanded&&(A.push(s),this.getActiveChain(e,t.items,A,i,!0),A.pop()))})),null==s&&(n.tmp.activeChain=i),i)}menuDown(e,t,A,i){var s=e.options;let n=s.items;var r=o(t.delegate).find(".w2ui-icon");let l=o(t.target).closest(".w2ui-menu:not(.w2ui-sub-menu)"),a=("string"==typeof i&&""!==i&&i.split("-").forEach((e=>{n=n[e].items})),(n="function"==typeof n?n({overlay:e,index:A,parents:i,event:t}):n)[A]);if(null!=a&&!a.disabled){let e=(t,A)=>{t.forEach(((i,s)=>{i.id!=a.id&&(i.group===a.group&&i.checked&&(l.find(`.w2ui-menu-item[index="${(A?A+"-":"")+s}"] .w2ui-icon`).removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),t[s].checked=!1),Array.isArray(i.items))&&e(i.items,s)}))};"check"!==s.type&&"radio"!==s.type||!1===a.group||o(t.target).hasClass("menu-remove")||o(t.target).hasClass("menu-help")||o(t.target).closest(".w2ui-menu-item").hasClass("has-sub-menu")||(a.checked="radio"==s.type||!a.checked,a.checked?("radio"===s.type&&o(t.target).closest(".w2ui-menu").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),"check"===s.type&&null!=a.group&&e(s.items),r.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"===s.type&&r.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")),o(t.target).hasClass("menu-remove")||o(t.target).hasClass("menu-help")||(l.find(".w2ui-menu-item").removeClass("w2ui-selected"),o(t.delegate).hasClass("has-sub-menu"))||o(t.delegate).addClass("w2ui-selected")}}menuClick(e,t,A,i){var s=e.options;let n=s.items;var r=o(t.delegate).closest(".w2ui-menu-item");let l=!s.hideOn.includes("select");(t.shiftKey||t.metaKey||t.ctrlKey)&&(l=!0),"string"==typeof i&&""!==i?i=i.split("-"):Array.isArray(i)||(i=null),i&&i.forEach((e=>{n=n[e].items}));var a=(n="function"==typeof n?n({overlay:e,index:A,parents:i,event:t}):n)[A];if(a&&(!a.disabled||o(t.target).hasClass("menu-remove"))){let n;if(o(t.target).hasClass("menu-remove")){if(!0===(n=this.trigger("remove",{originalEvent:t,target:e.name,overlay:e,item:a,index:A,parents:i,el:r[0]})).isCancelled)return;l=!s.hideOn.includes("item-remove"),r.remove()}else if(r.hasClass("has-sub-menu")){if(!0===(n=this.trigger("subMenu",{originalEvent:t,target:e.name,overlay:e,item:a,index:A,parents:i,el:r[0]})).isCancelled)return;l=!0}else{if(s=this.findChecked(s.items),e.selected=parseInt(r.attr("index")),!0===(n=this.trigger("select",{originalEvent:t,target:e.name,overlay:e,item:a,index:A,parents:i,selected:s,keepOpen:l,el:r[0]})).isCancelled)return;null!=a.keepOpen&&(l=a.keepOpen),["INPUT","TEXTAREA"].includes(e.anchor.tagName)&&(e.anchor.dataset.selected=a.id,e.anchor.dataset.selectedIndex=e.selected)}l||this.hide(e.name),n.finish()}}findChecked(e){let t=[];return e.forEach((e=>{e.checked&&t.push(e),Array.isArray(e.items)&&(t=t.concat(this.findChecked(e.items)))})),t}keyUp(e,t){var A=e.options,i=t.target.value;let s=!0,n=!1;switch(t.keyCode){case 46:case 8:""!==i||e.displayed||(s=!1);break;case 13:if(!e.displayed||!e.selected)return;var{index:r,parents:l}=this.getCurrent(e.name);t.delegate=o(e.box).find(".w2ui-selected").get(0),this.menuClick(e,t,parseInt(r),l),s=!1;break;case 27:s=!1,e.displayed?this.hide(e.name):(r=e.anchor,["INPUT","TEXTAREA"].includes(r.tagName)&&(r.value="",delete r.dataset.selected,delete r.dataset.selectedIndex));break;case 37:{if(!e.displayed)return;let{item:i,index:r,parents:l}=this.getCurrent(e.name);l&&(i=A.items[l],r=parseInt(l),l="",n=!0),Array.isArray(i?.items)&&0<i.items.length&&i.expanded&&(t.delegate=o(e.box).find(`.w2ui-menu-item[index="${r}"]`).get(0),e.selected=r,this.menuClick(e,t,parseInt(r),l)),s=!1;break}case 39:if(!e.displayed)return;var{item:l,index:r,parents:a}=this.getCurrent(e.name);Array.isArray(l?.items)&&0<l.items.length&&!l.expanded&&(t.delegate=o(e.box).find(".w2ui-selected").get(0),this.menuClick(e,t,parseInt(r),a)),s=!1;break;case 38:e.displayed&&(e.prev(),s=!1,t.preventDefault());break;case 40:e.displayed&&(e.next(),s=!1,t.preventDefault())}s&&e.displayed&&(A.filter&&"filter"==t._searchType||A.search&&"search"==t._searchType)&&this.applyFilter(e.name,null,i,!0).then((t=>{e.tmp.searchCount=t.count,e.tmp.search=t.search,0!==t.count&&this.getActiveChain(e.name).includes(e.selected)||(e.selected=null),this.refreshSearch(e.name)})),n&&this.refreshIndex(e.name)}},f=new class extends p{constructor(){super(),this.palette=[["000000","333333","555555","777777","888888","999999","AAAAAA","CCCCCC","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFC300","FFFD59","86FF14","14FF7A","2EFFFC","2693FF","006CE7","9B24F4","FF21F5","FF0099"],["FFEAEA","FCEFE1","FCF4DC","FFFECF","EBFFD9","D9FFE9","E0FFFF","E8F4FF","ECF4FC","EAE6F4","FFF5FE","FCF0F7"],["F4CCCC","FCE5CD","FFF1C2","FFFDA1","D5FCB1","B5F7D0","BFFFFF","D6ECFF","CFE2F3","D9D1E9","FFE3FD","FFD9F0"],["EA9899","F9CB9C","FFE48C","F7F56F","B9F77E","84F0B1","83F7F7","B5DAFF","9FC5E8","B4A7D6","FAB9F6","FFADDE"],["E06666","F6B26B","DEB737","E0DE51","8FDB48","52D189","4EDEDB","76ACE3","6FA8DC","8E7CC3","E07EDA","F26DBD"],["CC0814","E69138","AB8816","B5B20E","6BAB30","27A85F","1BA8A6","3C81C7","3D85C6","674EA7","A14F9D","BF4990"],["99050C","B45F17","80650E","737103","395E14","10783D","13615E","094785","0A5394","351C75","780172","782C5A"]],this.defaults=a.extend({},this.defaults,{advanced:!1,transparent:!0,position:"top|bottom",class:"w2ui-white",color:"",updateInput:!0,arrowSize:12,autoResize:!1,anchorClass:"w2ui-focus",autoShowOn:"focus",hideOn:["doc-click","focus-change"],onSelect:null,onLiveUpdate:null})}attach(e,t){let A;1==arguments.length&&e instanceof Object?e=(A=e).anchor:2===arguments.length&&null!=t&&"object"==typeof t&&((A=t).anchor=e),t=A.hideOn,A=a.extend({},this.defaults,A||{}),t&&(A.hideOn=t),A.style+="; padding: 0;",A.transparent&&"333333"==this.palette[0][1]&&(this.palette[0].splice(1,1),this.palette[0].push("TRANSPARENT")),A.transparent||"333333"==this.palette[0][1]||(this.palette[0].splice(1,0,"333333"),this.palette[0].pop()),A.color&&(A.color=String(A.color).toUpperCase()),"string"==typeof A.color&&"#"===A.color.substr(0,1)&&(A.color=A.color.substr(1)),this.index=[-1,-1];let i=super.attach(A),s=i.overlay;return s.options.html=this.getColorHTML(s.name,A),s.on("show.attach",(e=>{var t=(e=e.detail.overlay).anchor,A=e.options;["INPUT","TEXTAREA"].includes(t.tagName)&&!A.color&&t.value&&(e.tmp.initColor=t.value),delete e.newColor})),s.on("show:after.attach",(e=>{var t;i.overlay?.box&&(t=o(i.overlay.box).find(".w2ui-eaction"),a.bindEvents(t,this),this.initControls(i.overlay))})),s.on("update:after.attach",(e=>{var t;i.overlay?.box&&(t=o(i.overlay.box).find(".w2ui-eaction"),a.bindEvents(t,this),this.initControls(i.overlay))})),s.on("hide.attach",(e=>{var t=(e=e.detail.overlay).anchor,A=e.newColor??e.options.color??"";""!==A&&(["INPUT","TEXTAREA"].includes(t.tagName)&&t.value!=A&&e.options.updateInput&&(t.value=A),!0!==(t=this.trigger("select",{color:A,target:e.name,overlay:e})).isCancelled)&&t.finish()})),i.liveUpdate=e=>(s.on("liveUpdate.attach",(t=>{e(t)})),i),i.select=e=>(s.on("select.attach",(t=>{e(t)})),i),i}select(e,t){let A;this.index=[-1,-1],"string"!=typeof t&&(A=t.target,this.index=o(A).attr("index").split(":"),t=o(A).closest(".w2ui-overlay").attr("name"));var i=this.get(t);!0!==(t=this.trigger("liveUpdate",{color:e,target:t,overlay:i,param:arguments[1]})).isCancelled&&(["INPUT","TEXTAREA"].includes(i.anchor.tagName)&&i.options.updateInput&&o(i.anchor).val(e),i.newColor=e,o(i.box).find(".w2ui-color.w2ui-selected").removeClass("w2ui-selected"),A&&o(A).addClass("w2ui-selected"),t.finish())}nextColor(e){var t=this.palette;switch(e){case"up":this.index[0]--;break;case"down":this.index[0]++;break;case"right":this.index[1]++;break;case"left":this.index[1]--}return this.index[0]<0&&(this.index[0]=0),this.index[0]>t.length-2&&(this.index[0]=t.length-2),this.index[1]<0&&(this.index[1]=0),this.index[1]>t[0].length-1&&(this.index[1]=t[0].length-1),t[this.index[0]][this.index[1]]}tabClick(e,t){"string"!=typeof t&&(t=o(t.target).closest(".w2ui-overlay").attr("name")),t=this.get(t);var A=o(t.box).find(`.w2ui-color-tab:nth-child(${e})`);o(t.box).find(".w2ui-color-tab").removeClass("w2ui-selected"),o(A).addClass("w2ui-selected"),o(t.box).find(".w2ui-tab-content").hide().closest(".w2ui-colors").find(".tab-"+e).show()}getColorHTML(e,t){let A='\n            <div class="w2ui-colors">\n                <div class="w2ui-tab-content tab-1">';for(let s=0;s<this.palette.length;s++){A+='<div class="w2ui-color-row">';for(let n=0;n<this.palette[s].length;n++){var i=this.palette[s][n];let r="FFFFFF"===i?"; border: 1px solid #efefef":"";A+=`\n                    <div class="w2ui-color w2ui-eaction ${"TRANSPARENT"===i?"w2ui-no-color":""} ${t.color==i?"w2ui-selected":""}"\n                        style="background-color: #${i+r};" name="${i}" index="${s}:${n}"\n                        data-mousedown="select|'${i}'|event" data-mouseup="hide|${e}">&nbsp;\n                    </div>`}A+="</div>",s<2&&(A+='<div style="height: 8px"></div>')}return(A=(A+="</div>")+`\n            <div class="w2ui-tab-content tab-2" style="display: none">\n                <div class="color-info">\n                    <div class="color-preview-bg"><div class="color-preview"></div><div class="color-original"></div></div>\n                    <div class="color-part">\n                        <span>H</span> <input class="w2ui-input" name="h" maxlength="3" max="360" tabindex="101">\n                        <span>R</span> <input class="w2ui-input" name="r" maxlength="3" max="255" tabindex="104">\n                    </div>\n                    <div class="color-part">\n                        <span>S</span> <input class="w2ui-input" name="s" maxlength="3" max="100" tabindex="102">\n                        <span>G</span> <input class="w2ui-input" name="g" maxlength="3" max="255" tabindex="105">\n                    </div>\n                    <div class="color-part">\n                        <span>V</span> <input class="w2ui-input" name="v" maxlength="3" max="100" tabindex="103">\n                        <span>B</span> <input class="w2ui-input" name="b" maxlength="3" max="255" tabindex="106">\n                    </div>\n                    <div class="color-part opacity">\n                        <span>${a.lang("Opacity")}</span>\n                        <input class="w2ui-input" name="a" maxlength="5" max="1" tabindex="107">\n                    </div>\n                </div>\n                <div class="palette" name="palette">\n                    <div class="palette-bg"></div>\n                    <div class="value1 move-x move-y"></div>\n                </div>\n                <div class="rainbow" name="rainbow">\n                    <div class="value2 move-x"></div>\n                </div>\n                <div class="alpha" name="alpha">\n                    <div class="alpha-bg"></div>\n                    <div class="value2 move-x"></div>\n                </div>\n            </div>`)+`\n            <div class="w2ui-color-tabs">\n                <div class="w2ui-color-tab w2ui-selected w2ui-eaction" data-click="tabClick|1|event|this"><span class="w2ui-icon w2ui-icon-colors"></span></div>\n                <div class="w2ui-color-tab w2ui-eaction" data-click="tabClick|2|event|this"><span class="w2ui-icon w2ui-icon-settings"></span></div>\n                <div style="padding: 5px; width: 100%; text-align: right;">\n                    ${"string"==typeof t.html?t.html:""}\n                </div>\n            </div>`}initControls(e){let t,A=this;var i=e.options,s=i.color||e.tmp.initColor;let n=a.parseColor(s),r=(null==n&&(n={r:140,g:150,b:160,a:1}),a.rgb2hsv(n));!0===i.advanced&&this.tabClick(2,e.name),c(r,!0,s??""),o(e.box).off(".w2color").on("contextmenu.w2color",(e=>{e.preventDefault()})).find("input").off(".w2color").on("change.w2color",(e=>{e=o(e.target);let t=parseFloat(e.val());var A=parseFloat(e.attr("max"));isNaN(t)&&(t=0,e.val(0)),1<A&&(t=parseInt(t)),0<A&&t>A&&(e.val(A),t=A),t<0&&(e.val(0),t=0),A=e.attr("name"),e={},-1!==["r","g","b","a"].indexOf(A)?(n[A]=t,r=a.rgb2hsv(n)):-1!==["h","s","v"].indexOf(A)&&(e[A]=t),c(e,!0)})),o(e.box).find(".color-original").off(".w2color").on("click.w2color",(e=>{null!=(e=a.parseColor(o(e.target).css("background-color")))&&(n=e,c(r=a.rgb2hsv(n),!0))})),i=(a.isMobile?"touchstart":"mousedown")+".w2color";let l=(a.isMobile?"touchend":"mouseup")+".w2color",d=(a.isMobile?"touchmove":"mousemove")+".w2color";function c(t,i,s){null!=t.h&&(r.h=t.h),null!=t.s&&(r.s=t.s),null!=t.v&&(r.v=t.v),null!=t.a&&(n.a=t.a,r.a=t.a);let l="rgba("+(n=a.hsv2rgb(r)).r+","+n.g+","+n.b+","+n.a+")",d=[Number(n.r).toString(16).toUpperCase(),Number(n.g).toString(16).toUpperCase(),Number(n.b).toString(16).toUpperCase(),Math.round(255*Number(n.a)).toString(16).toUpperCase()];var c,u;d.forEach(((e,t)=>{1===e.length&&(d[t]="0"+e)})),l=d[0]+d[1]+d[2]+d[3],1===n.a&&(l=d[0]+d[1]+d[2]),o(e.box).find(".color-preview").css("background-color","#"+l),o(e.box).find("input").each((e=>{e.name&&(null!=n[e.name]&&(e.value=n[e.name]),null!=r[e.name]&&(e.value=r[e.name]),"a"===e.name)&&(e.value=n.a)})),null!=s?(t=e.tmp.initColor||l,o(e.box).find(".color-original").css("background-color","#"+t),o(e.box).find(".w2ui-color.w2ui-selected").removeClass("w2ui-selected"),o(e.box).find(`.w2ui-colors [name="${t}"], .w2ui-colors [name="${s}"]`).addClass("w2ui-selected"),8==l.length&&A.tabClick(2,e.name)):A.select(l,e.name),i&&(t=o(e.box).find(".palette .value1"),s=o(e.box).find(".rainbow .value2"),i=o(e.box).find(".alpha .value2"),t[0]&&s[0]&&i[0]&&(c=parseInt(t[0].clientWidth)/2,u=parseInt(s[0].clientWidth)/2,t.css({left:150*r.s/100-c+"px",top:125*(100-r.v)/100-c+"px"}),s.css("left",r.h/2.4-u+"px"),i.css("left",150*n.a-u+"px")),h())}function h(){var t=`${(t=a.hsv2rgb(r.h,100,100)).r},${t.g},`+t.b;o(e.box).find(".palette").css("background-image",`linear-gradient(90deg, rgba(${t},0) 0%, rgba(${t},1) 100%)`)}function u(e){o("html").off(".w2color")}function p(e){var A=t.el,i=e.pageX-t.x;e=e.pageY-t.y;let s=t.left+i,n=t.top+e;s<-(i=parseInt(A.prop("clientWidth"))/2)&&(s=-i),n<-i&&(n=-i),s>t.width-i&&(s=t.width-i),n>t.height-i&&(n=t.height-i),A.hasClass("move-x")&&A.css({left:s+"px"}),A.hasClass("move-y")&&A.css({top:n+"px"}),e=o(A.get(0).parentNode).attr("name");var r=parseInt(A.css("left"))+i;A=parseInt(A.css("top"))+i,"palette"===e&&c({s:Math.round(r/t.width*100),v:Math.round(100-A/t.height*100)}),"rainbow"===e&&(c({h:Math.round(2.4*r)}),h()),"alpha"===e&&c({a:parseFloat(Number(r/150).toFixed(2))})}o(e.box).find(".palette, .rainbow, .alpha").off(".w2color").on(i+".w2color",(function(e){var A=o(this).find(".value1, .value2"),i=parseInt(A.prop("clientWidth"))/2;A.hasClass("move-x")&&A.css({left:e.offsetX-i+"px"}),A.hasClass("move-y")&&A.css({top:e.offsetY-i+"px"}),t={el:A,x:e.pageX,y:e.pageY,width:A.prop("parentNode").clientWidth,height:A.prop("parentNode").clientHeight,left:parseInt(A.css("left")),top:parseInt(A.css("top"))},p(e),o("html").off(".w2color").on(d,p).on(l,u)}))}},w=new class extends p{constructor(){super();var e=new Date;this.daysCount=[31,28,31,30,31,30,31,31,30,31,30,31],this.today=e.getFullYear()+"/"+(Number(e.getMonth())+1)+"/"+e.getDate(),this.defaults=a.extend({},this.defaults,{position:"top|bottom",class:"w2ui-calendar",type:"date",value:"",format:"",start:null,end:null,btnNow:!1,blockDates:[],blockWeekdays:[],colored:{},arrowSize:12,autoResize:!1,anchorClass:"w2ui-focus",autoShowOn:"focus",hideOn:["doc-click","focus-change"],onSelect:null})}attach(e,t){let A;1==arguments.length&&e instanceof Object?e=(A=e).anchor:2===arguments.length&&null!=t&&"object"==typeof t&&((A=t).anchor=e),t=A.hideOn,A=a.extend({},this.defaults,A||{}),t&&(A.hideOn=t),A.format||(e=a.settings.dateFormat,t=a.settings.timeFormat,"date"==A.type?A.format=e:"time"==A.type?A.format=t:A.format=e+"|"+t),e="time"==A.type?this.getHourHTML(A):this.getMonthHTML(A),A.style+="; padding: 0;",A.html=e.html;let i=super.attach(A),s=i.overlay;return Object.assign(s.tmp,e),s.on("show.attach",(e=>{var t=(e=e.detail.overlay).anchor,A=e.options;["INPUT","TEXTAREA"].includes(t.tagName)&&!A.value&&t.value&&(e.tmp.initValue=t.value),delete e.newValue,delete e.newDate})),s.on("show:after.attach",(e=>{i.overlay?.box&&this.initControls(i.overlay)})),s.on("update:after.attach",(e=>{i.overlay?.box&&this.initControls(i.overlay)})),s.on("hide.attach",(e=>{var t=(e=e.detail.overlay).anchor;null!=e.newValue&&(e.newDate&&(e.newValue=e.newDate+" "+e.newValue),["INPUT","TEXTAREA"].includes(t.tagName)&&t.value!=e.newValue&&(t.value=e.newValue),!0!==(t=this.trigger("select",{date:e.newValue,target:e.name,overlay:e})).isCancelled)&&t.finish()})),i.select=e=>(s.on("select.attach",(t=>{e(t)})),i),i}initControls(e){let t=e.options,A=A=>{let{month:i,year:s}=e.tmp;12<(i+=A)&&(i=1,s++),i<1&&(i=12,s--),A=this.getMonthHTML(t,i,s),Object.assign(e.tmp,A),o(e.box).find(".w2ui-overlay-body").html(A.html),this.initControls(e)},i=(A,i)=>{o(A.target).parent().find(".w2ui-jump-month, .w2ui-jump-year").removeClass("w2ui-selected"),o(A.target).addClass("w2ui-selected"),A=new Date;let{jumpMonth:s,jumpYear:n}=e.tmp;(s=i&&(null==n&&(n=A.getFullYear()),null==s)?A.getMonth()+1:s)&&n&&(i=this.getMonthHTML(t,s,n),Object.assign(e.tmp,i),o(e.box).find(".w2ui-overlay-body").html(i.html),e.tmp.jump=!1,this.initControls(e))};o(e.box).find(".w2ui-cal-title").off(".calendar").on("click.calendar",(A=>{var i,s;Object.assign(e.tmp,{jumpYear:null,jumpMonth:null}),e.tmp.jump?(({month:i,year:s}=e.tmp),i=this.getMonthHTML(t,i,s),o(e.box).find(".w2ui-overlay-body").html(i.html),e.tmp.jump=!1):(o(e.box).find(".w2ui-overlay-body .w2ui-cal-days").replace(this.getYearHTML()),(s=o(e.box).find(`[name="${e.tmp.year}"]`).get(0))&&s.scrollIntoView(!0),e.tmp.jump=!0),this.initControls(e),A.stopPropagation()})).find(".w2ui-cal-previous").off(".calendar").on("click.calendar",(e=>{A(-1),e.stopPropagation()})).parent().find(".w2ui-cal-next").off(".calendar").on("click.calendar",(e=>{A(1),e.stopPropagation()})),o(e.box).find(".w2ui-cal-now").off(".calendar").on("click.calendar",(A=>{"datetime"==t.type?e.newDate?e.newValue=a.formatTime(new Date,t.format.split("|")[1]):e.newValue=a.formatDateTime(new Date,t.format):"date"==t.type?e.newValue=a.formatDate(new Date,t.format):"time"==t.type&&(e.newValue=a.formatTime(new Date,t.format)),this.hide(e.name)})),o(e.box).off(".calendar").on("contextmenu.calendar",(e=>{e.preventDefault()})).on("click.calendar",{delegate:".w2ui-day.w2ui-date"},(A=>{"datetime"==t.type?(e.newDate=o(A.target).attr("date"),o(e.box).find(".w2ui-overlay-body").html(this.getHourHTML(e.options).html),this.initControls(e)):(e.newValue=o(A.target).attr("date"),this.hide(e.name))})).on("click.calendar",{delegate:".w2ui-jump-month"},(t=>{e.tmp.jumpMonth=parseInt(o(t.target).attr("name")),i(t)})).on("dblclick.calendar",{delegate:".w2ui-jump-month"},(t=>{e.tmp.jumpMonth=parseInt(o(t.target).attr("name")),i(t,!0)})).on("click.calendar",{delegate:".w2ui-jump-year"},(t=>{e.tmp.jumpYear=parseInt(o(t.target).attr("name")),i(t)})).on("dblclick.calendar",{delegate:".w2ui-jump-year"},(t=>{e.tmp.jumpYear=parseInt(o(t.target).attr("name")),i(t,!0)})).on("click.calendar",{delegate:".w2ui-time.hour"},(A=>{A=o(A.target).attr("hour");let i=this.str2min(t.value)%60;e.tmp.initValue&&!t.value&&(i=this.str2min(e.tmp.initValue)%60),t.noMinutes?(e.newValue=this.min2str(60*A,t.format),this.hide(e.name)):(e.newValue=A+":"+i,A=this.getMinHTML(A,t).html,o(e.box).find(".w2ui-overlay-body").html(A),this.initControls(e))})).on("click.calendar",{delegate:".w2ui-time.min"},(A=>{A=60*Math.floor(this.str2min(e.newValue)/60)+parseInt(o(A.target).attr("min")),e.newValue=this.min2str(A,t.format),this.hide(e.name)}))}getMonthHTML(e,t,A){var i=a.settings.fulldays.slice(),s=a.settings.shortdays.slice();"M"!==a.settings.weekStarts&&(i.unshift(i.pop()),s.unshift(s.pop()));let n=new Date;i="datetime"===e.type?a.isDateTime(e.value,e.format,!0):a.isDate(e.value,e.format,!0);var r=a.formatDate(i);null!=t&&null!=A||(A=(i||n).getFullYear(),t=i?i.getMonth()+1:n.getMonth()+1),12<t&&(t-=12,A++),(t<1||0===t)&&(t+=12,A--),A/4==Math.floor(A/4)?this.daysCount[1]=29:this.daysCount[1]=28,e.current=t+"/"+A;let o=(n=new Date(A,t-1,1)).getDay(),l="";var d=a.settings.weekStarts;for(let e=0;e<s.length;e++)l+=`<div class="w2ui-day w2ui-weekday ${"M"==d&&5==e||"M"!=d&&6==e?"w2ui-sunday":""} ${"M"==d&&6==e||"M"!=d&&0==e?"w2ui-saturday":""}">${s[e]}</div>`;let c=`\n            <div class="w2ui-cal-title">\n                <div class="w2ui-cal-previous">\n                    <div></div>\n                </div>\n                <div class="w2ui-cal-next">\n                    <div></div>\n                </div>\n                ${a.settings.fullmonths[t-1]}, ${A}\n                <span class="arrow-down"></span>\n            </div>\n            <div class="w2ui-cal-days">\n                ${l}\n        `,h=new Date(A+`/${t}/1`);i=(h=new Date(h.getTime()+432e5)).getDay(),"M"==a.settings.weekStarts&&o--;let u=6,p=0;0<i?h=new Date(h.getTime()-864e5*o):(u+=o,p+=o,u<0&&(u=6+u+1),p<0&&(p=6+p+1));for(let A=0;A<42;A++){var g=[],m=`${h.getFullYear()}/${h.getMonth()+1}/`+h.getDate(),f=(h.getDay()===u&&g.push("w2ui-saturday"),h.getDay()===p&&g.push("w2ui-sunday"),h.getMonth()+1!==t&&g.push("outside"),m==this.today&&g.push("w2ui-today"),h.getDate());let A,i,s="",n="";i="datetime"===e.type?(A=a.formatDateTime(m,e.format),a.formatDate(m,a.settings.dateFormat)):A=a.formatDate(m,e.format),e.colored&&void 0!==e.colored[i]&&(n="background-color: "+(m=e.colored[i].split("|"))[0]+";",s="color: "+m[1]+";"),c+=`<div class="w2ui-day ${this.inRange(A,e,!0)?"w2ui-date "+(i==r?"w2ui-selected":""):"w2ui-blocked"} ${g.join(" ")}"\n                       style="${s+n}" date="${i}" data-date="${h.getTime()}">\n                            ${f}\n                    </div>`,h=new Date(h.getTime()+864e5)}return c+="</div>",e.btnNow&&(c+=`<div class="w2ui-cal-now">${i=a.lang("Today"+("datetime"==e.type?" & Now":""))}</div>`),{html:c,month:t,year:A}}getYearHTML(){let e="",t="";for(let t=0;t<a.settings.fullmonths.length;t++)e+=`<div class="w2ui-jump-month" name="${t+1}">${a.settings.shortmonths[t]}</div>`;for(let e=a.settings.dateStartYear;e<=a.settings.dateEndYear;e++)t+=`<div class="w2ui-jump-year" name="${e}">${e}</div>`;return`<div class="w2ui-cal-jump">\n            <div id="w2ui-jump-month">${e}</div>\n            <div id="w2ui-jump-year">${t}</div>\n        </div>`}getHourHTML(e){(e=e??{}).format||(e.format=a.settings.timeFormat);var t=-1<e.format.indexOf("h24"),A=e.value||(e.anchor?e.anchor.value:""),i=[];for(let r=0;r<24;r++){let o=(12<=r&&!t?r-12:r)+":00"+(t?"":r<12?" am":" pm"),l=(12!=r||t||(o="12:00 pm"),i[Math.floor(r/8)]||(i[Math.floor(r/8)]=""),this.min2str(this.str2min(o))),d=this.min2str(this.str2min(o)+59);"datetime"===e.type&&(n=a.isDateTime(A,e.format,!0),s=e.format.split("|")[0].trim(),l=a.formatDate(n,s)+" "+l,d=a.formatDate(n,s)+" "+d);var s,n=this.inRange(l,e)||this.inRange(d,e);i[Math.floor(r/8)]+=`<span hour="${r}"\n                class="hour ${n?"w2ui-time ":"w2ui-blocked"}">${o}</span>`}return{html:`<div class="w2ui-calendar">\n            <div class="w2ui-time-title">${a.lang("Select Hour")}</div>\n            <div class="w2ui-cal-time">\n                <div class="w2ui-cal-column">${i[0]}</div>\n                <div class="w2ui-cal-column">${i[1]}</div>\n                <div class="w2ui-cal-column">${i[2]}</div>\n            </div>\n            ${e.btnNow?`<div class="w2ui-cal-now">${a.lang("Now")}</div>`:""}\n        </div>`}}getMinHTML(e,t){null==e&&(e=0),(t=t??{}).format||(t.format=a.settings.timeFormat);var A=-1<t.format.indexOf("h24"),i=t.value||(t.anchor?t.anchor.value:""),s=[];for(let d=0;d<60;d+=5){var n=(12<e&&!A?e-12:e)+":"+(d<10?0:"")+d+" "+(A?"":e<12?"am":"pm");let c=n;var r,o,l=d<20?0:d<40?1:2;s[l]||(s[l]=""),"datetime"===t.type&&(r=a.isDateTime(i,t.format,!0),o=t.format.split("|")[0].trim(),c=a.formatDate(r,o)+" "+c),s[l]+=`<span min="${d}" class="min ${this.inRange(c,t)?"w2ui-time ":"w2ui-blocked"}">${n}</span>`}return{html:`<div class="w2ui-calendar">\n            <div class="w2ui-time-title">${a.lang("Select Minute")}</div>\n            <div class="w2ui-cal-time">\n                <div class="w2ui-cal-column">${s[0]}</div>\n                <div class="w2ui-cal-column">${s[1]}</div>\n                <div class="w2ui-cal-column">${s[2]}</div>\n            </div>\n            ${t.btnNow?`<div class="w2ui-cal-now">${a.lang("Now")}</div>`:""}\n        </div>`}}inRange(e,t,A){let i=!1;if("date"===t.type){var s=a.isDate(e,t.format,!0);if(s){if(t.start||t.end){var n="string"==typeof t.start?t.start:o(t.start).val(),r="string"==typeof t.end?t.end:o(t.end).val();let e=a.isDate(n,t.format,!0),A=a.isDate(r,t.format,!0);n=new Date(s),e=e||n,A=A||n,n>=e&&n<=A&&(i=!0)}else i=!0;Array.isArray(t.blockDates)&&t.blockDates.includes(e)&&(i=!1),Array.isArray(t.blockWeekdays)&&t.blockWeekdays.includes(s.getDay())&&(i=!1)}}else if("time"===t.type)if(t.start||t.end){r=this.str2min(e);let A=this.str2min(t.start),s=this.str2min(t.end);A=A||r,s=s||r,r>=A&&r<=s&&(i=!0)}else i=!0;else"datetime"===t.type&&(n=a.isDateTime(e,t.format,!0))&&(s=t.format.split("|").map((e=>e.trim())),A?(r=a.formatDate(n,s[0]),e=a.extend({},t,{type:"date",format:s[0]}),this.inRange(r,e)&&(i=!0)):(A=a.formatTime(n,s[1]),r={type:"time",format:s[1],start:t.startTime,end:t.endTime},this.inRange(A,r)&&(i=!0)));return i}str2min(e){var t;return"string"!=typeof e||2!==(t=e.split(":")).length?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),-1!==e.indexOf("pm")&&12!==t[0]&&(t[0]+=12),e.includes("am")&&12==t[0]&&(t[0]=0),60*t[0]+t[1])}min2str(e,t){1440<=e&&(e%=1440),e<0&&(e=1440+e);var A=Math.floor(e/60);return e=(e%60<10?"0":"")+e%60,-1!==(t=t||a.settings.timeFormat).indexOf("h24")?A+":"+e:(A<=12?A:A-12)+":"+e+" "+(12<=A?"pm":"am")}};class B extends s{constructor(e){super(e.name),this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",this.onClick=null,this.onChange=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseEnter=null,this.onMouseLeave=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.item_template={id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,icon:null,route:null,arrow:null,style:null,group:null,items:null,selected:null,color:null,backColor:null,overlay:{anchorClass:""},onClick:null,onRefresh:null},this.last={badge:{},pendingRefresh:{}},this._refresh=({effected:e,resize:t,refreshTooltip:A})=>{var i=this.last.pendingRefresh;i.ids??=[],i.ids.push(...e),Object.assign(i,{resize:t,refreshTooltip:A}),this._refreshDebounced()},this._refreshDebounced=a.debounce((()=>{let e=this.last.pendingRefresh;new Set(e.ids).forEach((t=>{this.refresh(t),e.hideTooltip&&this.tooltipHide(t)})),e.resize&&this.resize(),this.last.pendingRefresh={}}),15);var t=e.items;delete e.items,Object.assign(this,e),Array.isArray(t)&&this.add(t,!0),e.items=t,"string"==typeof this.box&&(this.box=o(this.box).get(0)),this.box&&this.render(this.box)}add(e,t){this.insert(null,e,t)}insert(e,t,A){(t=Array.isArray(t)?t:[t]).forEach(((t,i,s)=>{"string"==typeof t&&(t=s[i]={id:t,text:t});var n,r=["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","html","label","input","group","break","spacer","new-line"];if(r.includes(String(t.type)))if(null!=t.id||["break","spacer","new-line"].includes(t.type)){if(null==t.type)console.log('ERROR: The parameter "type" is required but not supplied.',t);else if(a.checkUniqueId(t.id,this.items,"toolbar",this.name)){let r=a.extend({},this.item_template,t);"group"==r.type&&Array.isArray(r.items)&&r.items.forEach(((e,t)=>{r.items[t]=a.extend({},this.item_template,r.items[t])})),"menu-check"==r.type?(Array.isArray(r.selected)||(r.selected=[]),Array.isArray(r.items)&&r.items.forEach((e=>{(e="string"==typeof e?s[i]={id:e,text:e}:e).checked&&!r.selected.includes(e.id)&&r.selected.push(e.id),!e.checked&&r.selected.includes(e.id)&&(e.checked=!0),null==e.checked&&(e.checked=!1)}))):"menu-radio"==r.type&&Array.isArray(r.items)&&r.items.forEach(((e,t,A)=>{(e="string"==typeof e?A[t]={id:e,text:e}:e).checked&&null==r.selected?r.selected=e.id:e.checked=!1,e.checked||r.selected!=e.id||(e.checked=!0),null==e.checked&&(e.checked=!1)})),null==e?this.items.push(r):(n=this.get(e,!0),this.items=this.items.slice(0,n).concat([r],this.items.slice(n))),r.line=r.line??1,!0!==A&&this.refresh(r.id)}}else console.log('ERROR: The parameter "id" is required but not supplied.',t);else console.log('ERROR: The parameter "type" should be one of the following:',r,`, but ${t.type} is supplied.`,t)})),!0!==A&&this.resize()}remove(){let e=0;return Array.from(arguments).forEach((t=>{var A=this.get(t);A&&-1==String(t).indexOf(":")&&(e++,o(this.box).find("#tb_"+this.name+"_item_"+a.escapeId(A.id)).remove(),null!=(t=this.get(A.id,!0)))&&this.items.splice(t,1)})),this.resize(),e}set(e,t){var A=this.get(e);return null!=A&&(Object.assign(A,t),this.refresh(String(e).split(":")[0]),!0)}get(e,t,A){if(0===arguments.length){var i=[];for(let e=0;e<this.items.length;e++){var s=this.items[e];if(null!=s.id&&i.push(s.id),"group"==s.type)for(let e=0;e<s.items.length;e++)null!=s.items[e].id&&i.push(s.items[e].id)}return i}var n=String(e).split(":");null==A&&(A=this.items);for(let i=0;i<A.length;i++){var r=A[i];if(["menu","menu-radio","menu-check"].includes(r.type)&&2==n.length&&r.id==n[0]){let e=r.items;"function"==typeof e&&(e=e(this));for(let A=0;A<e.length;A++){var o=e[A];if(o.id==n[1]||null==o.id&&o.text==n[1])return 1==t?A:o;if(Array.isArray(o.items))for(let e=0;e<o.items.length;e++)if(o.items[e].id==n[1]||null==o.items[e].id&&o.items[e].text==n[1])return 1==t?A:o.items[e]}}else{if(r.id==n[0])return 1==t?i:r;if("group"==r.type&&null!=(r=this.get(e,t,r.items)))return r}}return null}setCount(e,t,A,i){var s=o(this.box).find(`#tb_${this.name}_item_${a.escapeId(e)} .w2ui-tb-count > span`);0<s.length?(s.removeClass().addClass(A??"").text(t).get(0).style.cssText=i??"",this.last.badge[e]={className:A??"",style:i??""},this.get(e).count=t):(this.set(e,{count:t}),this.setCount(...arguments))}show(){let e=[];return Array.from(arguments).forEach((t=>{var A=this.get(t);A&&(A.hidden=!1,e.push(String(t).split(":")[0]),"group"==A.type)&&A.items.forEach((e=>this.show(e.id)))})),this._refresh({effected:e,resize:!0}),e}hide(){let e=[];return Array.from(arguments).forEach((t=>{var A=this.get(t);A&&(A.hidden=!0,e.push(String(t).split(":")[0]),"group"==A.type)&&A.items.forEach((e=>this.hide(e.id)))})),this._refresh({effected:e,hideTooltip:!0,resize:!0}),e}enable(){let e=[];return Array.from(arguments).forEach((t=>{var A=this.get(t);A&&("group"==A.type?A.items.forEach((e=>this.enable(e.id))):(A.disabled=!1,e.push(String(t).split(":")[0])))})),this._refresh({effected:e}),e}disable(){let e=[];return Array.from(arguments).forEach((t=>{var A=this.get(t);A&&("group"==A.type?A.items.forEach((e=>this.disable(e.id))):(A.disabled=!0,e.push(String(t).split(":")[0])))})),this._refresh({effected:e,hideTooltip:!0}),e}check(){let e=[];return Array.from(arguments).forEach((t=>{var A=this.get(t);A&&-1==String(t).indexOf(":")&&("group"==A.type?A.items.forEach((e=>this.check(e.id))):(A.checked=!0,e.push(String(t).split(":")[0])))})),this._refresh({effected:e}),e}uncheck(){let e=[];return Array.from(arguments).forEach((t=>{var A=this.get(t);A&&-1==String(t).indexOf(":")&&(["menu","menu-radio","menu-check","drop","color","text-color"].includes(A.type)&&A.checked&&g.hide(this.name+"-drop"),"group"==A.type?A.items.forEach((e=>this.uncheck(e.id))):(A.checked=!1,e.push(String(t).split(":")[0])))})),this._refresh({effected:e}),e}click(e,t){var A=String(e).split(":");let i=this.get(A[0]),s=i&&i.items?a.normMenu.call(this,i.items,i):[];if(1<A.length)(A=this.get(e))&&!A.disabled&&this.menuClick({name:this.name,item:i,subItem:A,originalEvent:t});else if(i&&!i.disabled&&!0!==(A=this.trigger("click",{target:null!=e?e:this.name,item:i,object:i,originalEvent:t})).isCancelled){s=i&&i.items?a.normMenu.call(this,i.items,i):[];let d="#tb_"+this.name+"_item_"+a.escapeId(i.id);if(o(this.box).find(d).removeClass("down"),"radio"==i.type){for(let e=0;e<this.items.length;e++){var n=this.items[e];if("group"==n.type)for(let e=0;e<n.items.length;e++){var r=n.items[e];null!=r&&r.id!=i.id&&"radio"===r.type&&r.group==i.group&&r.checked&&(r.checked=!1,this.refresh(r.id))}null!=n&&n.id!=i.id&&"radio"===n.type&&n.group==i.group&&n.checked&&(n.checked=!1,this.refresh(n.id))}i.checked=!0,o(this.box).find(d).addClass("checked")}if(["menu","menu-radio","menu-check","drop","color","text-color"].includes(i.type)){if(this.tooltipHide(e),i.checked)return void g.hide(this.name+"-drop");t=g.get(this.name+"-drop"),t?.displayed&&t.hide(),t?.listeners?.splice(0),setTimeout((()=>{var e=(e,t)=>{let A=this;return function(){A.set(e,{checked:!1})}},t=o(this.box).find("#tb_"+this.name+"_item_"+a.escapeId(i.id));if(a.isPlainObject(i.overlay)||(i.overlay={}),"drop"==i.type&&g.show(a.extend({html:i.html,class:"w2ui-white",hideOn:["doc-click"]},i.overlay,{anchor:t[0],name:this.name+"-drop",data:{item:i,btn:d}})).hide(e(i.id)),["menu","menu-radio","menu-check"].includes(i.type)){let A="normal";"menu-radio"==i.type&&(A="radio",s.forEach((e=>{i.selected==e.id?e.checked=!0:e.checked=!1}))),"menu-check"==i.type&&(A="check",s.forEach((e=>{Array.isArray(i.selected)&&i.selected.includes(e.id)?e.checked=!0:e.checked=!1}))),m.show(a.extend({items:s,align:i.text?"left":"none"},i.overlay,{type:A,name:this.name+"-drop",anchor:t[0],data:{item:i,btn:d}})).hide(e(i.id)).remove((e=>{this.menuClick({name:this.name,remove:!0,item:i,subItem:e.detail.item,originalEvent:e})})).select((e=>{this.menuClick({name:this.name,item:i,subItem:e.detail.item,originalEvent:e})}))}["color","text-color"].includes(i.type)&&f.show(a.extend({color:i.color},i.overlay,{anchor:t[0],name:this.name+"-drop",data:{item:i,btn:d}})).hide(e(i.id)).select((e=>{null!=e.detail.color&&this.colorClick({name:this.name,item:i,color:e.detail.color})}))}),0)}if(["check","menu","menu-radio","menu-check","drop","color","text-color"].includes(i.type)&&(i.checked=!i.checked,i.checked?o(this.box).find(d).addClass("checked"):o(this.box).find(d).removeClass("checked")),i.route){let e=String("/"+i.route).replace(/\/{2,}/g,"/");var l=a.parseRoute(e);if(0<l.keys.length)for(let t=0;t<l.keys.length;t++)e=e.replace(new RegExp(":"+l.keys[t].name,"g"),this.routeData[l.keys[t].name]);setTimeout((()=>{window.location.hash=e}),1)}this.tooltipShow(e),A.finish()}}scroll(e,t,A){return new Promise(((i,s)=>{var n=o(this.box).find(`.w2ui-tb-line:nth-child(${t}) .w2ui-scroll-wrapper`),r=n.get(0).scrollLeft,l=n.find(".w2ui-tb-right").get(0),a=n.parent().get(0).getBoundingClientRect().width,d=r+parseInt(l.offsetLeft)+parseInt(l.clientWidth);switch(e){case"left":(scroll=r-a+50)<=0&&(scroll=0),n.get(0).scrollTo({top:0,left:scroll,behavior:A?"atuo":"smooth"});break;case"right":(scroll=r+a-50)>=d-a&&(scroll=d-a),n.get(0).scrollTo({top:0,left:scroll,behavior:A?"atuo":"smooth"})}setTimeout((()=>{this.resize(),i()}),A?0:600)}))}render(e){var t=Date.now(),A=("string"==typeof e&&(e=o(e).get(0)),this.trigger("render",{target:this.name,box:e??this.box}));if(!0!==A.isCancelled&&(null!=e&&(this.unmount(),this.box=e),this.box)){Array.isArray(this.right)||(this.right=[this.right]);let e="",s=0;for(let t=0;t<this.items.length;t++){var i=this.items[t];null!=i&&(null==i.id&&(i.id="item_"+t),null!=i.caption&&console.log("NOTICE: toolbar item.caption property is deprecated, please use item.text. Item -> ",i),null!=i.hint&&console.log("NOTICE: toolbar item.hint property is deprecated, please use item.tooltip. Item -> ",i),0!==t&&"new-line"!=i.type||(s++,e+=`\n                    <div class="w2ui-tb-line">\n                        <div class="w2ui-scroll-wrapper w2ui-eaction" data-mousedown="resize">\n                            <div class="w2ui-tb-right">${this.right[s-1]??""}</div>\n                        </div>\n                        <div class="w2ui-scroll-left w2ui-eaction" data-click='["scroll", "left", "${s}"]'></div>\n                        <div class="w2ui-scroll-right w2ui-eaction" data-click='["scroll", "right", "${s}"]'></div>\n                    </div>\n                `),i.line=s)}return o(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(e),0<o(this.box).length&&(o(this.box)[0].style.cssText+=this.style),a.bindEvents(o(this.box).find(".w2ui-tb-line .w2ui-eaction"),this),this.last.observeResize=new ResizeObserver((()=>{this.resize()})),this.last.observeResize.observe(this.box),this.refresh(),this.resize(),A.finish(),Date.now()-t}}refresh(e){var t=Date.now(),A=this.trigger("refresh",{target:null!=e?e:this.name,item:this.get(e)});if(!0!==A.isCancelled){let l;if(null==e)for(let e=0;e<this.items.length;e++){var i=this.items[e];null==i.id&&(i.id="item_"+e),this.refresh(i.id)}else{var s=this.get(e);if(null==s)return!1;if("function"!=typeof s.onRefresh||!0!==(l=this.trigger("refresh",{target:e,item:s,object:s})).isCancelled){var n=`#tb_${this.name}_item_`+a.escapeId(s.id);let i=o(this.box).find(n);var r=this.getItemHTML(s);if(this.tooltipHide(e),"spacer"==s.type&&o(this.box).find(`.w2ui-tb-line:nth-child(${s.line??1})`).find(".w2ui-tb-right").css("width","auto"),0===i.length){e=parseInt(this.get(e,!0))+1;let t=o(this.box).find(`#tb_${this.name}_item_`+a.escapeId(this.items[e]?this.items[e].id:""));0==t.length?t=o(this.box).find(".w2ui-tb-line:nth-child("+s.line).find(".w2ui-tb-right").before(r):t.after(r),a.bindEvents(o(this.box).find(n+`, ${n} .w2ui-eaction`),this)}else{o(this.box).find(n).replace(o.html(r));let e=o(this.box).find(n),t=(a.bindEvents(e,this),a.bindEvents(e.find(".w2ui-eaction"),this),g.get(!0));Object.keys(t).forEach((A=>{t[A].anchor==i.get(0)&&(t[A].anchor=e.get(0))}))}if(["menu","menu-radio","menu-check"].includes(s.type)&&s.checked){let t=Array.isArray(s.selected)?s.selected:[s.selected];(e="function"==typeof s.items?s.items(s):[...s.items]).forEach((e=>{t.includes(e.id)?e.checked=!0:e.checked=!1})),m.update(this.name+"-drop",e)}return"function"==typeof s.onRefresh&&l.finish(),A.finish(),Date.now()-t}}}}resize(){var e=Date.now(),t=this.trigger("resize",{target:this.name});if(!0!==t.isCancelled)return o(this.box).find(".w2ui-tb-line").each((e=>{var t=((e=o(e)).find(".w2ui-scroll-left, .w2ui-scroll-right").hide(),e.find(".w2ui-scroll-wrapper").get(0)),A=e.find(".w2ui-tb-right"),i=e.get(0).getBoundingClientRect().width;i<(A=0<A.length?A[0].offsetLeft+A[0].clientWidth:0)&&(0<t.scrollLeft&&e.find(".w2ui-scroll-left").show(),i<A-t.scrollLeft)&&e.find(".w2ui-scroll-right").show()})),t.finish(),Date.now()-e}destroy(){var e=this.trigger("destroy",{target:this.name});!0!==e.isCancelled&&(0<o(this.box).find(".w2ui-scroll-wrapper").length&&this.unmount(),delete l[this.name],e.finish())}unmount(){super.unmount(),this.last.observeResize?.disconnect()}getItemHTML(e){let t="",A=(null!=e.caption&&null==e.text&&(e.text=e.caption),null==e.text&&(e.text=""),null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint),null==e.tooltip&&(e.tooltip=""),"function"==typeof e.get||!Array.isArray(e.items)&&"function"!=typeof e.items||(e.get=function(t){let A=e.items;return(A="function"==typeof A?e.items(e):A).find((e=>e.id==t))}),""),i="function"==typeof e.text?e.text.call(this,e):e.text;e.icon&&(A=e.icon,"function"==typeof e.icon&&(A=e.icon.call(this,e)),A=`<div class="w2ui-tb-icon">${A="<"!==String(A).slice(0,1)?`<span class="${A}" ${e.icon_style?`style="${e.icon_style}"`:""}></span>`:A}</div>`);var s=["w2ui-tb-button","w2ui-eaction"];switch(e.checked&&s.push("checked"),e.disabled&&s.push("disabled"),e.hidden&&s.push("hidden"),A||s.push("no-icon"),e.type){case"color":case"text-color":if("string"==typeof e.color&&("#"==e.color.slice(0,1)&&(e.color=e.color.slice(1)),[3,6,8].includes(e.color.length))&&(e.color="#"+e.color),"color"==e.type&&(i=`<span class="w2ui-tb-color-box" style="background-color: ${null!=e.color?e.color:"#fff"}"></span>\n                           `+(e.text?`<div style="margin-left: 17px;">${a.lang(e.text)}</div>`:"")),"text-color"==e.type){var n=null!=e.color?e.color:"#444";let t=e.backColor;!0===e.backColor&&(t="#fff",a.colorContrast("#fff",n)<2)&&(t="#555"),i=`<span style="color: ${n}">${e.text?a.lang(e.text):e.backColor?`<b style="background-color: ${t??"transparent"}; padding: 2px 5px; border-radius: 3px;">Ab</b>`:"<b>Ab</b>"}</span>`}case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"label":case"drop":n=!0===e.arrow||!1!==e.arrow&&["menu","menu-radio","menu-check","drop","color","text-color"].includes(e.type),t=`\n                    <div id="tb_${this.name}_item_${e.id}" class="${s.join(" ")} ${e.class||""}"\n                        style="${e.hidden?"display: none":""} ${"label"==e.type?e.style??"":""}"\n                        ${e.disabled?"":`data-click='["click","${e.id}", "event"]'\n                               data-mouseenter='["mouseAction", "event", "this", "Enter", "${e.id}"]'\n                               data-mouseleave='["mouseAction", "event", "this", "Leave", "${e.id}"]'\n                               data-mousedown='["mouseAction", "event", "this", "Down", "${e.id}"]'\n                               data-mouseup='["mouseAction", "event", "this", "Up", "${e.id}"]'`}\n                    >\n                        ${A}\n                        ${""!=i&&null!=i||null!=e.count||n?`<div class="w2ui-tb-text" style="${"label"!=e.type?e.style??"":""}; ${i?"":"padding-left: 0; margin-left: 23px;"}">\n                                    ${a.lang(i)}\n                                    ${null!=e.count?a.stripSpaces(`\n                                            <span class="w2ui-tb-count">\n                                                <span class="${this.last.badge[e.id]?this.last.badge[e.id].className??"":""}"\n                                                        style="${this.last.badge[e.id]?this.last.badge[e.id].style??"":""}">${e.count}</span>\n                                            </span>`):""}\n                                    ${n?`<span class="w2ui-tb-down" ${i||e.count?"":'style="margin-left: -3px"'}><span></span></span>`:""}\n                                </div>`:""}\n                    </div>\n                `;break;case"break":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-break"\n                            style="${e.hidden?"display: none":""}; ${e.style||""}">\n                            &#160;\n                        </div>`;break;case"spacer":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-spacer"\n                            style="${e.hidden?"display: none":""}; ${e.style||""}">\n                        </div>`;break;case"html":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-html ${s.join(" ")}"\n                            style="${e.hidden?"display: none":""}; ${e.style||""}">\n                            ${"function"==typeof e.html?e.html.call(this,e):e.html}\n                        </div>`;break;case"input":{var r;n=e.placeholder;let A=e.value;e.spinner&&"object"==typeof e.spinner&&(e.input??={},Object.assign(e.input,e.spinner,{spinner:!0})),null!=A&&""!==String(A).trim()&&e.input?.spinner&&(r=e.input?.step??1,r=e.input?.precision??String(r).split(".")[1]?.length??0,A=isNaN(A)?A:A.toFixed(r)),t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-input w2ui-eaction ${s.join(" ")}"\n                            style="${e.hidden?"display: none":""}; ${e.style||""}"\n                        >\n                            <span class="w2ui-input-label">${e.text??""}</span>\n                            ${e.input?.spinner?`<span class="w2ui-spinner-dec w2ui-eaction" data-click='["spinner", "${e.id}", "dec", "event"]'> – </span>`:""}\n                            <input class="w2ui-toolbar-input w2ui-eaction ${e.input?.spinner?"w2ui-has-spinner":""}"\n                                ${n?`placeholder="${n}"`:""} style="${e.input?.style??""}"\n                                value="${A??""}${e.input?.suffix??""}" ${e.input?.attrs??""}\n                                data-input='["change", "${e.id}", "this", true]'\n                                data-change='["change", "${e.id}", "this"]'\n                                data-keydown='["spinner", "${e.id}", "key", "event"]'\n                                data-mouseenter='["mouseAction", "event", "this", "Enter", "${e.id}"]'\n                                data-mouseleave='["mouseAction", "event", "this", "Leave", "${e.id}"]'\n                            >\n                            ${e.input?.spinner?`<span class="w2ui-spinner-inc w2ui-eaction" data-click='["spinner", "${e.id}", "inc", "event"]'> + </span>`:""}\n                        </div>`;break}case"group":t=`<div id="tb_${this.name}_item_${e.id}" class="w2ui-tb-group"\n                    style="display: flex; ${e.hidden?"display: none":""}; ${e.style||""}">`,Array.isArray(e.items)?e.items.forEach((e=>{t+=this.getItemHTML(e)})):console.log("ERROR: toolbar group is empty"),t+="</div>"}return t}spinner(e,t,A){var i=this.get(e);let s=0;switch(t){case"inc":s=i.input?.step??1;break;case"dec":s=-(i.input?.step??1);break;case"key":if(i.input.spinner||null!=i.input.step){let e=1;switch((A.shiftKey||A.metaKey)&&(e=10),A.altKey&&(e=.1),A.key){case"ArrowUp":s=(i.input?.step??1)*e,A.preventDefault();break;case"ArrowDown":s=-(i.input?.step??1)*e,A.preventDefault()}}}0!==s&&this.change(e,parseFloat(i.value??0)+s)}change(e,t,A){var i=this.get(e),s=o(this.box).find("#tb_"+this.name+"_item_"+a.escapeId(e)).find("input.w2ui-toolbar-input"),n=(null==(t=t instanceof HTMLInputElement?t.value:t)&&(t=s.val()),!i.input.spinner&&null==i.input.min&&null==i.input.max&&null==i.input.step||(t=parseFloat(t)),null!=i.input?.suffix&&String(t).substr(-i.input.suffix.length)==i.input.suffix&&(t=String(t).substr(0,t.length-i.input.suffix.length)),null!=i.input?.min&&i.input.min>t&&(t=i.input.min),null!=i.input?.max&&i.input.max<t&&(t=i.input.max),i.input.step&&(isNaN(t)&&(t=i.input.min??0),n=i.input?.step??1,n=i.input.precision??String(n).split(".")[1]?.length??0,t=t.toFixed(n)),this.trigger(A?"input":"change",{target:e,id:e,value:t,item:i}));if(!n.isCancelled){i.value=t;let e="";null!=i.input?.suffix&&String(t).substr(-i.input.suffix.length)!=i.input.suffix&&(e=i.input.suffix),A||s.val(t+e),n.finish()}}tooltipShow(e){if(null!=this.tooltip){var t=o(this.box).find("#tb_"+this.name+"_item_"+a.escapeId(e)).get(0),A=(e=this.get(e),"string"==typeof this.tooltip?{position:this.tooltip}:this.tooltip);let i=e.tooltip;"function"==typeof i&&(i=i.call(this,e)),["menu","menu-radio","menu-check","drop","color","text-color"].includes(e.type)&&1==e.checked||g.show({anchor:t,name:this.name+"-tooltip",html:i,...A})}}tooltipHide(e){null!=this.tooltip&&g.hide(this.name+"-tooltip")}menuClick(e){if(e.item&&!e.item.disabled){var t=this.trigger(!0!==e.remove?"click":"remove",{target:e.item.id+":"+e.subItem.id,item:e.item,subItem:e.subItem,originalEvent:e.originalEvent});if(!0!==t.isCancelled){let s=e.subItem,n=this.get(e.item.id),r=n.items;if("function"==typeof r&&(r=n.items()),"menu"==n.type&&(n.selected=s.id),"menu-radio"==n.type&&(n.selected=s.id,Array.isArray(r)&&r.forEach((e=>{!0===e.checked&&delete e.checked,Array.isArray(e.items)&&e.items.forEach((e=>{!0===e.checked&&delete e.checked}))})),s.checked=!0),"menu-check"==n.type)if(Array.isArray(n.selected)||(n.selected=[]),null==s.group){var A=n.selected.indexOf(s.id);-1==A?(n.selected.push(s.id),s.checked=!0):(n.selected.splice(A,1),s.checked=!1)}else if(!1!==s.group){let e=[];A=n.selected.indexOf(s.id);let t=A=>{A.forEach((A=>{var i;A.group===s.group&&-1!=(i=n.selected.indexOf(A.id))&&(A.id!=s.id&&e.push(A.id),n.selected.splice(i,1)),Array.isArray(A.items)&&t(A.items)}))};t(r),-1==A&&(n.selected.push(s.id),s.checked=!0)}if("string"==typeof s.route){let e=""!==s.route?String("/"+s.route).replace(/\/{2,}/g,"/"):"";var i=a.parseRoute(e);if(0<i.keys.length)for(let t=0;t<i.keys.length;t++)null!=this.routeData[i.keys[t].name]&&(e=e.replace(new RegExp(":"+i.keys[t].name,"g"),this.routeData[i.keys[t].name]));setTimeout((()=>{window.location.hash=e}),1)}this.refresh(e.item.id),t.finish()}}}colorClick(e){var t;e.item&&!e.item.disabled&&!0!==(t=this.trigger("click",{target:e.item.id,item:e.item,color:e.color,final:!0})).isCancelled&&(e.item.color=e.color,this.refresh(e.item.id),t.finish())}mouseAction(e,t,A,i){var s=this.get(i);if(!0!==(e=this.trigger("mouse"+A,{target:i,item:s,object:s,originalEvent:e})).isCancelled&&!s.disabled&&!s.hidden){switch(A){case"Enter":["label","input"].includes(s.type)||o(t).addClass("over"),this.tooltipShow(i);break;case"Leave":["label","input"].includes(s.type)||o(t).removeClass("over down"),this.tooltipHide(i);break;case"Down":["label","input"].includes(s.type)||o(t).addClass("down");break;case"Up":["label","input"].includes(s.type)||o(t).removeClass("down")}e.finish()}}}class y extends s{constructor(e){super(e.name),this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.multi=!1,this.editable=!1,this.reorder=!1,this.flatButton=!1,this.keyboard=!0,this.flat=!1,this.hasFocus=!1,this.levelPadding=12,this.toggleAlign="right",this.skipRefresh=!1,this.tabIndex=null,this.handle={width:0,style:"",text:"",tooltip:""},this.badge=null,this.onClick=null,this.onSelect=null,this.onUnselect=null,this.onDblClick=null,this.onMouseEnter=null,this.onMouseLeave=null,this.onContextMenu=null,this.onMenuClick=null,this.onExpand=null,this.onCollapse=null,this.onKeydown=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.onFocus=null,this.onBlur=null,this.onFlat=null,this.onEdit=null,this.onRename=null,this.onReorder=null,this.onDragStart=null,this.onDragOver=null,this.node_template={id:null,text:"",order:null,count:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!1,plus:!1,childOffset:0,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},this.last={badge:{},renaming:!1,move:null};var t=e.nodes;delete e.nodes,Object.assign(this,e),Array.isArray(t)&&this.add(t),e.nodes=t,"string"==typeof this.box&&(this.box=o(this.box).get(0)),this.box&&this.render(this.box)}add(e,t){return 1==arguments.length&&(t=arguments[0],e=this),"string"==typeof e&&(e=this.get(e)),this.insert(e=null!=e&&""!=e?e:this,null,t)}insert(e,t,A){let i,s,n,r,o;if(2==arguments.length&&"string"==typeof e)if(A=arguments[1],null!=(t=arguments[0])){if(null==(s=this.get(t)))return null!=(A=Array.isArray(A)?A:[A])[0].caption&&null==A[0].text&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",A[0]),A[0].text=A[0].caption),i=A[0].text,console.log('ERROR: Cannot insert node "'+i+'" because cannot find node "'+t+'" to insert before.'),null;e=this.get(t).parent}else e=this;null!=(e="string"==typeof e?this.get(e):e)&&""!=e||(e=this),Array.isArray(A)||(A=[A]);for(let l=0;l<A.length;l++)if(null!=(r=A[l]).caption&&null==r.text&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text"),r.text=r.caption),null==typeof r.id)i=r.text,console.log('ERROR: Cannot insert node "'+i+'" because it has no id.');else if(null!=this.get(this,r.id))console.log("ERROR: Cannot insert node with id="+r.id+" (text: "+r.text+") because another node with the same id already exists.");else{if((n=Object.assign({},this.node_template,r)).sidebar=this,n.parent=e,o=n.nodes||[],n.nodes=[],null==t)e.nodes.push(n);else{if(null==(s=this.get(e,t,!0)))return console.log('ERROR: Cannot insert node "'+r.text+'" because cannot find node "'+t+'" to insert before.'),null;e.nodes.splice(s,0,n)}0<o.length&&this.insert(n,null,o)}return this.skipRefresh||this.refresh(e.id),n}remove(){let e,t=0;return Array.from(arguments).forEach((A=>{null!=(e=this.get(A))&&(null!=this.selected&&(Array.isArray(this.selected)?this.selected.splice(this.selected.indexOf(e.id),1):this.selected===e.id&&(this.selected=null)),null!=(A=this.get(e.parent,A,!0)))&&(e.parent.nodes[A].selected&&e.sidebar.unselect(e.id),e.parent.nodes.splice(A,1),e.parent.collapsible=0<e.parent.nodes.length,t++)})),this.skipRefresh||(0<t&&1==arguments.length?this.refresh(e.parent.id):this.refresh()),t}set(e,t,A){if(2==arguments.length&&(A=t,t=e,e=this),null==(e="string"==typeof e?this.get(e):e).nodes)return null;for(let s=0;s<e.nodes.length;s++){var i;if(e.nodes[s].id===t)return i=this.update(t,A),0!=Object.keys(i).length&&(i=A.nodes,a.extend(e.nodes[s],A,null!=i?{nodes:[]}:{}),null!=i&&this.add(e.nodes[s],i),this.skipRefresh||this.refresh(t)),!0;if(this.set(e.nodes[s],t,A))return!0}return!1}get(e,t,A){if(0===arguments.length){var i=[],s=this.find({});for(let e=0;e<s.length;e++)null!=s[e].id&&i.push(s[e].id);return i}if((1==arguments.length||2==arguments.length&&!0===t)&&(A=t,t=e,e=this),null!=(e="string"==typeof e?this.get(e):e).nodes)for(let i=0;i<e.nodes.length;i++){if(e.nodes[i].id==t)return!0===A?i:e.nodes[i];var n=this.get(e.nodes[i],t,A);if(n||0===n)return n}return null}setCount(e,t,A={}){var i=o(this.box).find(`#node_${a.escapeId(e)} .w2ui-node-badge`);0<i.length?(i.removeClass().addClass("w2ui-node-badge "+(A.className??"w2ui-node-count")).text(t).get(0).style.cssText=A.style||"",this.last.badge[e]={className:A.className??"",style:A.style??""},this.get(e).count=t):(this.set(e,{count:t}),this.setCount(...arguments))}find(e,t,A){if(1==arguments.length&&(t=e,e=this),A=A||[],null!=(e="string"==typeof e?this.get(e):e).nodes)for(let s=0;s<e.nodes.length;s++){let n=!0;for(var i in t)e.nodes[s][i]!=t[i]&&(n=!1);n&&A.push(e.nodes[s]),0<e.nodes[s].nodes.length&&(A=this.find(e.nodes[s],t,A))}return A}sort(e,t){null==(e=e&&"object"==typeof e?e:{}).foldersFirst&&(e.foldersFirst=!0),null==e.caseSensitive&&(e.caseSensitive=!1),null==e.reverse&&(e.reverse=!1),(t=null==t?this.nodes:t).sort(((t,A)=>{var i=t.nodes&&0<t.nodes.length,s=A.nodes&&0<A.nodes.length;if(!1===e.foldersFirst||!i&&!s||i&&s){let i=t.text,s=A.text;return e.caseSensitive||(i=i.toLowerCase(),s=s.toLowerCase()),null!=t.order&&(i=t.order),null!=A.order&&(s=A.order),(1===(t=a.naturalCompare(i,s))||-1===t)&e.reverse?-t:t}return i&&!s?e.reverse?1:-1:!i&&s?e.reverse?-1:1:void 0})),t.forEach((t=>{t.nodes&&0<t.nodes.length&&this.sort(e,t.nodes)}))}each(e,t){(t=null==t?this.nodes:t).forEach((t=>{e.call(this,t),t.nodes&&0<t.nodes.length&&this.each(e,t.nodes)}))}search(e,t=null){let A=0,i=e.toLowerCase();return this.each((s=>{let n=!1;(n="function"==typeof t?t(e,s):!(-1===s.text.toLowerCase().indexOf(i)))?(A++,function e(t){t.parent&&(t.parent.hidden=!1,e(t.parent))}(s),s.hidden=!1):s.hidden=!0})),this.refresh(),A}show(){let e=[];return Array.from(arguments).forEach((t=>{null!=(t=this.get(t))&&!1!==t.hidden&&(t.hidden=!1,e.push(t.id))})),0<e.length&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}hide(){let e=[];return Array.from(arguments).forEach((t=>{null!=(t=this.get(t))&&!0!==t.hidden&&(t.hidden=!0,e.push(t.id))})),0<e.length&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}enable(){let e=[];return Array.from(arguments).forEach((t=>{null!=(t=this.get(t))&&!1!==t.disabled&&(t.disabled=!1,e.push(t.id))})),0<e.length&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}disable(){let e=[];return Array.from(arguments).forEach((t=>{null!=(t=this.get(t))&&!0!==t.disabled&&(t.disabled=!0,t.selected&&this.unselect(t.id),e.push(t.id))})),0<e.length&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e}select(e){if(!Array.isArray(e)){var t=this.get(e);if(!t)return!1;var A=this.trigger("select",{target:e,id:e,node:t});if(!0!==A.isCancelled){if(!this.multi&&this.selected==e&&t.selected)return!1;var i=o(this.box).find("#node_"+a.escapeId(e));i.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),0<i.length&&(this.inView(e)||this.scrollIntoView(e)),t.selected=!0,this.multi?(Array.isArray(this.selected)||(this.selected=this.selected?[this.selected]:[]),this.selected.push(e)):this.selected=this.multi?[e]:e,A.finish()}return!0}[...e].forEach((e=>this.select(e)))}unselect(e){var t,A;if(0===arguments.length&&(e=this.selected),!Array.isArray(e))return!!(A=this.get(e))&&(!0!==(t=this.trigger("unselect",{target:e,id:e,node:A})).isCancelled&&(A.selected=!1,o(this.box).find("#node_"+a.escapeId(e)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),"string"==typeof this.selected&&this.selected==e&&(this.selected=null),this.multi&&Array.isArray(this.selected)&&-1!=(A=this.selected.indexOf(e))&&this.selected.splice(A,1),t.finish()),!0);[...e].forEach((e=>this.unselect(e)))}toggle(e){var t=this.get(e);return null!=t&&(t.plus?(this.set(e,{plus:!1}),this.expand(e),void this.refresh(e)):0!==t.nodes.length&&!!t.collapsible&&(this.get(e).expanded?this.collapse(e):this.expand(e)))}collapse(e){var t,A=this.get(e);return null!=A&&(!0!==(t=this.trigger("collapse",{target:e,object:A,node:A})).isCancelled?(o(this.box).find("#node_"+a.escapeId(e)+"_sub").hide(),o(this.box).find("#node_"+a.escapeId(e)+" .w2ui-expanded").removeClass("w2ui-expanded").addClass("w2ui-collapsed"),A.expanded=!1,t.finish(),this.refresh(e),!0):void 0)}expand(e){var t=this.get(e),A=this.trigger("expand",{target:e,object:t,node:t});if(!0!==A.isCancelled)return o(this.box).find("#node_"+a.escapeId(e)+"_sub").show(),o(this.box).find("#node_"+a.escapeId(e)+" .w2ui-collapsed").removeClass("w2ui-collapsed").addClass("w2ui-expanded"),t.expanded=!0,A.finish(),this.refresh(e),!0}collapseAll(e){if(null==(e="string"==typeof(e=null==e?this:e)?this.get(e):e).nodes)return!1;for(let t=0;t<e.nodes.length;t++)!0===e.nodes[t].expanded&&(e.nodes[t].expanded=!1),e.nodes[t].nodes&&0<e.nodes[t].nodes.length&&this.collapseAll(e.nodes[t]);return this.refresh(e.id),!0}expandAll(e){if(null==(e="string"==typeof(e=null==e?this:e)?this.get(e):e).nodes)return!1;for(let t=0;t<e.nodes.length;t++)!1===e.nodes[t].expanded&&(e.nodes[t].expanded=!0),e.nodes[t].nodes&&0<e.nodes[t].nodes.length&&this.expandAll(e.nodes[t]);this.refresh(e.id)}expandParents(e){return null!=(e=this.get(e))&&(e.parent&&(e.parent.expanded||(e.parent.expanded=!0,this.refresh(e.parent.id)),this.expandParents(e.parent.id)),!0)}click(e,t){let A=this,i=this.get(e);if(null!=i)if(i.disabled||i.group)A.trigger("click",{target:e,originalEvent:t,node:i,object:i}).finish();else{let s=o(A.box).find("#node_"+a.escapeId(e));s.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout((()=>{var n=A.trigger("click",{target:e,originalEvent:t,node:i,object:i});if(!0===n.isCancelled)s.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected");else{if(this.multi){var r=t?.shiftKey??!1,o=(t?.ctrlKey||t?.metaKey)??!1;if("string"==typeof this.selected&&(this.selected=[this.selected]),o&&!r){if(this.selected?.includes(e))return void this.unselect(e);this.select(e)}else if(!o&&r){let t=this.getChain();var l=Math.min(this.selected.map((e=>t.indexOf(e)))),d=t.indexOf(e);for(let e=Math.min(l,d);e<t.length&&e<=Math.max(l,d);e++){var c=this.get(t[e]);this.selected.includes(t[e])||1==c.hidden||this.select(t[e])}}else o=this.selected?.filter((t=>t!=e&&this.selected.includes(t))),this.unselect(o),this.selected?.includes(e)||this.select(e)}else if(this.selected!==e&&(null!=this.selected&&this.unselect(this.selected),this.select(e),"string"==typeof i.route)){let e=""!==i.route?String("/"+i.route).replace(/\/{2,}/g,"/"):"";var h=a.parseRoute(e);if(0<h.keys.length)for(let t=0;t<h.keys.length;t++)null!=A.routeData[h.keys[t].name]&&(e=e.replace(new RegExp(":"+h.keys[t].name,"g"),A.routeData[h.keys[t].name]));setTimeout((()=>{window.location.hash=e}),1)}n.finish()}}),1)}}focus(e){let t=this;if(!0===(e=this.trigger("focus",{target:this.name,originalEvent:e})).isCancelled)return!1;this.hasFocus=!0,o(this.box).find(".w2ui-sidebar-body").addClass("w2ui-focus"),setTimeout((()=>{var e=o(t.box).find("#sidebar_"+t.name+"_focus").get(0);document.activeElement!=e&&e.focus()}),10),e.finish()}blur(e){if(!0===(e=this.trigger("blur",{target:this.name,originalEvent:e})).isCancelled)return!1;this.hasFocus=!1,o(this.box).find(".w2ui-sidebar-body").removeClass("w2ui-focus"),e.finish()}next(e,t){if(null==e)return null;var A=e.parent,i=this.get(e.id,!0);let s=null;return null!=(s=e.expanded&&0<e.nodes.length&&!0!==t?(t=e.nodes[0]).hidden||t.disabled||t.group?this.next(t):t:A&&i+1<A.nodes.length?A.nodes[i+1]:this.next(A,!0))&&(s.hidden||s.disabled||s.group)?this.next(s):s}prev(e){if(null==e)return null;var t=e.parent;e=this.get(e.id,!0);let A=e=>{var t;return e.expanded&&0<e.nodes.length?(t=e.nodes[e.nodes.length-1]).hidden||t.disabled||t.group?this.prev(t):A(t):e},i=0<e?A(t.nodes[e-1]):t;return null!=i&&(i.hidden||i.disabled||i.group)?this.prev(i):i}getChain(e,t={}){t.returnDisabled??=!1,t.returnGroups??=!1;let A=[];return(e=null==e?this.nodes:e).forEach((e=>{(!e.disabled&&!e.group||e.disabled&&t.returnDisabled||e.group&&t.returnGroups)&&A.push(e.id),Array.isArray(e.nodes)&&e.expanded&&A.push(...this.getChain(e.nodes,t))})),A}keydown(e){let t=this;var A=Array.isArray(this.selected)?this.selected[0]:this.selected;let i=t.get(A);if(!0===this.keyboard){if(i=i||this.nodes[0],27==e.keyCode){var s=this.last.move;if(s?.reorder&&s?.moved)return void s.restore()}!0!==(s=this.trigger("keydown",{target:this.name,originalEvent:e})).isCancelled&&(13!=e.keyCode&&32!=e.keyCode||(13!=e.keyCode||!this.editable||e.ctrlKey||e.metaKey?0<i.nodes.length&&this.toggle(A):this.edit(A)),37==e.keyCode&&(0<i.nodes.length&&i.expanded?this.collapse(A):(n(i.parent),i.parent.group||this.collapse(i.parent.id))),39==e.keyCode&&(0<i.nodes.length||i.plus)&&!i.expanded&&this.expand(A),38==e.keyCode&&(null==this.get(A)?n(this.nodes[0]||null):n(r(i,this.prev))),40==e.keyCode&&(null==this.get(A)?n(this.nodes[0]||null):n(r(i,this.next))),[13,32,37,38,39,40].includes(e.keyCode)&&(e.preventDefault&&e.preventDefault(),e.stopPropagation)&&e.stopPropagation(),s.finish())}function n(e,A){null==e||e.hidden||e.disabled||e.group||(t.click(e.id,A),t.inView(e.id))||t.scrollIntoView(e.id)}function r(e,A){for(e=A.call(t,e);null!=e&&(e.hidden||e.disabled)&&!e.group;)e=A(e);return e}}inView(e){var t;return!(!(e=o(this.box).find("#node_"+a.escapeId(e)).get(0))||(t=o(this.box).find(".w2ui-sidebar-body").get(0),e.offsetTop<t.scrollTop)||e.offsetTop+e.clientHeight>t.clientHeight+t.scrollTop)}scrollIntoView(e,t){return new Promise(((A,i)=>{null==e&&(e=Array.isArray(this.selected)?this.selected[0]:this.selected),null!=this.get(e)&&(o(this.box).find("#node_"+a.escapeId(e)).get(0).scrollIntoView({block:"center",inline:"center",behavior:t?"atuo":"smooth"}),setTimeout((()=>{this.resize(),A()}),t?0:500))}))}dblClick(e,t){var A=this.get(e);!0!==(t=this.trigger("dblClick",{target:e,originalEvent:t,object:A})).isCancelled&&(this.editable?this.edit(e):this.toggle(e),t.finish())}mouseDown(e,t){let A=this;if(this.reorder){this.last.move={x:t.screenX,y:t.screenY,divX:0,divY:0,reorder:!0,moved:!1};let n=this.last.move;var i,s=o(this.box).find(".w2ui-sidebar-body");n.ghost||(i=o(this.box).find("#node_"+a.escapeId(e)),n.offsetY=t.offsetY,n.target=e,n.pos={top:i.get(0).offsetTop-1,left:i.get(0).offsetLeft},t=o(i.find(".w2ui-node-data").get(0).cloneNode(!0)),n.node=i,n.nodeSub=i.next(),s.append('<div id="sidebar_'+this.name+'_ghost" class="w2ui-node w2ui-ghost"></div>'),o(this.box).find("#sidebar_"+this.name+"_ghost").append(t),n.ghost=o(this.box).find("#sidebar_"+this.name+"_ghost"),n.ghost.css({display:"none"}),n.restore=()=>{n.resetReorder(),this.refresh()},n.resetReorder=()=>{this.last.move=null,o(this.box).find(`#sidebar_${this.name}_ghost`).remove(),o(document).off(`.w2ui-${this.name}-reorder`)}),o(document).on(`mousemove.w2ui-${this.name}-reorder`,(function(e){if(e.target.tagName){var t=A.last.move;if(t.divX=e.screenX-t.x,t.divY=e.screenY-t.y,!(Math.abs(t.divX)<=1&&Math.abs(t.divY)<=1)){if(1==A.reorder&&t.reorder&&!t.moved){var i=A.trigger("dragStart",{target:t.target,moved:!0,node:A.get(t.target),mv:t,originalEvent:e});if(!0===i.isCancelled)return void t.restore();var s=t.node.get(0).getBoundingClientRect();t.moved=!0,t.node.html("").removeAttr("id","data-id").addClass("w2ui-reorder-empty").css({height:s.height+"px"}),"none"!==t.node.next().css("display")&&(s=t.node.next().get(0).getBoundingClientRect(),t.node.next().html('<div class="w2ui-reorder-empty-sub"></div>').css({height:s.height+"px"})),t.ghost.css({display:"block"}),i.finish()}var n;t.ghost.css({top:t.pos.top+t.divY+"px",left:0}),s=o(e.target).closest(".w2ui-node, .w2ui-node-group").attr("data-id"),o(e.target).hasClass("w2ui-sidebar-body")&&5<e.layerY&&!t.append?!0!==(i=A.trigger("dragOver",{target:t.target,append:!0,mv:t,originalEvent:e})).isCancelled&&(t.ghost.before(t.node),t.ghost.before(t.nodeSub),t.append=!0,t.moveBefore=null,i.finish()):null!=s&&s!=t.moveBefore&&(t.append=!1,t.moveBefore=s,!0!==(e=A.trigger("dragOver",{target:t.target,moveBefore:s,mv:t,originalEvent:e})).isCancelled)&&((n=o(A.box).find("#node_"+a.escapeId(s))).before(t.node),n.before(t.nodeSub),e.finish())}}})).on(`mouseup.w2ui-${this.name}-reorder`,(function(e){var t=A.last.move;if(t.resetReorder(),t.moved)if(null!=t.moveBefore&&t.target!=t.moveBefore||t.append)if(!0===(e=A.trigger("reorder",{target:t.target,moveBefore:t.moveBefore,append:t.append,originalEvent:e})).isCancelled)A.refresh();else{var i=(s=A.get(t.target)).parent.nodes.indexOf(s),s=s.parent.nodes.splice(i,1);if(t.append)A.nodes.push(...s),s.forEach((e=>e.parent=A));else{let e=A.get(t.moveBefore);i=e.parent.nodes.indexOf(e),s.forEach((t=>t.parent=e.parent)),e.parent.nodes.splice(i,0,...s)}A.refresh(),e.finish()}else A.refresh()}))}}edit(e){let t=this,A=o(this.box).find("#node_"+a.escapeId(e)),i=A.find(".w2ui-node-text");var s=this.trigger("edit",{target:e,el:A,textEl:i});if(!0!==s.isCancelled){this.last.renaming=!0,A.addClass("w2ui-editing"),i.addClass("w2ui-focus").css("pointer-events","all").attr("contenteditable",a.isFirefox?"true":"plaintext-only").on("blur.node-editing",(e=>{setTimeout(r,0)})).on("keydown.node-editing",(e=>{13==e.keyCode&&r(e),27==e.keyCode&&r(e,!0)})).get(0).focus();let n=i.text();return a.setCursorPosition(i[0],0,i.text().length),s.finish(),i.get(0);function r(s,r){var o=i.text();if(A.removeClass("w2ui-editing"),i.removeClass("w2ui-focus").css("pointer-events","none").removeAttr("contenteditable").off(".node-editing"),!r&&t.last.renaming&&n!==o){if(!0===(s=t.trigger("rename",{target:e,text_previous:n,text_new:o,originalEvent:s})).isCancelled)return i.text(n),t.last.renaming=!1,void t.focus();t.set(e,{text:o}),s.finish()}r&&t.set(e,{text:n}),t.last.renaming=!1,t.focus()}}}contextMenu(e,t){var A=this.get(e),i=(Array.isArray(this.selected)?this.selected.includes(e)||this.click(e):e!=this.selected&&this.click(e),this.trigger("contextMenu",{target:e,originalEvent:t,object:A,allowOnDisabled:!1}));!0===i.isCancelled||A.disabled&&!i.allowOnDisabled||(0<this.menu.length&&m.show({name:this.name+"_menu",anchor:document.body,items:this.menu,originalEvent:t}).select((A=>{this.menuClick(e,parseInt(A.detail.index),t)})),t.preventDefault&&t.preventDefault(),i.finish())}menuClick(e,t,A){!0!==(e=this.trigger("menuClick",{target:e,originalEvent:A,menuIndex:t,menuItem:this.menu[t]})).isCancelled&&e.finish()}goFlat(){var e=this.trigger("flat",{goFlat:!this.flat});!0!==e.isCancelled&&(this.flat=!this.flat,this.refresh(),e.finish())}render(e){var t=Date.now();let A=this;"string"==typeof e&&(e=o(e).get(0));var i=this.trigger("render",{target:this.name,box:e??this.box});if(!0!==i.isCancelled&&(null!=e&&(this.unmount(),this.box=e),this.box)){let s;return o(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html(`<div>\n                <div class="w2ui-sidebar-top"></div>\n                <input id="sidebar_${this.name}_focus" ${this.tabIndex?'tabindex="'+this.tabIndex+'"':""}\n                    style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0"\n                    ${a.isMobile?"readonly":""}/>\n                <div class="w2ui-sidebar-body"></div>\n                <div class="w2ui-sidebar-bottom"></div>\n            </div>`),e=o(this.box).get(0).getBoundingClientRect(),o(this.box).find(":scope > div").css({width:e.width+"px",height:e.height+"px"}),o(this.box).get(0).style.cssText+=this.style,o(this.box).find("#sidebar_"+this.name+"_focus").on("focus",(function(e){clearTimeout(s),A.hasFocus||A.focus(e)})).on("blur",(function(e){s=setTimeout((()=>{A.hasFocus&&A.blur(e)}),100)})).on("keydown",(function(e){l[A.name].keydown.call(l[A.name],e)})),o(this.box).off("mousedown").on("mousedown",(function(e){setTimeout((()=>{var t;-1==["INPUT","TEXTAREA","SELECT"].indexOf(e.target.tagName.toUpperCase())&&(t=o(A.box).find("#sidebar_"+A.name+"_focus"),document.activeElement!=t.get(0))&&0<t.length&&t.get(0).focus()}),1)})),e=`<div class="w2ui-flat w2ui-flat-${this.flat?"right":"left"}" ${0==this.flatButton?'style="display: none"':""}></div>`,""===this.topHTML&&!e||(o(this.box).find(".w2ui-sidebar-top").html(this.topHTML+e),o(this.box).find(".w2ui-sidebar-body").css("top",o(this.box).find(".w2ui-sidebar-top").get(0)?.clientHeight+"px"),o(this.box).find(".w2ui-flat").off("click").on("click",(e=>{this.goFlat()}))),""!==this.bottomHTML&&(o(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),o(this.box).find(".w2ui-sidebar-body").css("bottom",o(this.box).find(".w2ui-sidebar-bottom").get(0)?.clientHeight+"px")),this.last.observeResize=new ResizeObserver((()=>{this.resize()})),this.last.observeResize.observe(this.box),i.finish(),this.refresh(),Date.now()-t}}update(e,t={}){let A;if(e=this.get(e)){var i=o(this.box).find("#node_"+a.escapeId(e.id));if(e.group)t.text&&(e.text=t.text,i.find(".w2ui-group-text").replace("function"==typeof e.text?e.text.call(this,e):'<span class="w2ui-group-text">'+e.text+"</span>"),delete t.text),t.class&&(e.class=t.class,A=i.data("level"),i.get(0).className="w2ui-node-group w2ui-level-"+A+(e.class?" "+e.class:""),delete t.class),t.style&&(e.style=t.style,i.get(0).nextElementSibling.style=e.style+";"+(!e.hidden&&e.expanded?"":"display: none;"),delete t.style);else{if(t.icon&&0<(s=i.find(".w2ui-node-image > span")).length&&(e.icon=t.icon,s[0].className="function"==typeof e.icon?e.icon.call(this,e):e.icon,delete t.icon),t.count){e.count=t.count;let r=e.count??this.badge.text;var s=this.badge.style,n=this.last.badge[e.id];"function"==typeof r&&(r=r.call(this,e,A)),i.find(".w2ui-node-badge").html(r).attr("style",s+"; "+(n?.style??"")),0<i.find(".w2ui-node-badge").length&&delete t.count}t.class&&0<i.length&&(e.class=t.class,A=i.data("level"),i[0].className="w2ui-node w2ui-level-"+A+(e.selected?" w2ui-selected":"")+(e.disabled?" w2ui-disabled":"")+(e.class?" "+e.class:""),delete t.class),t.text&&(e.text=t.text,i.find(".w2ui-node-text").html("function"==typeof e.text?e.text.call(this,e):e.text),delete t.text),t.style&&0<i.length&&(s=i.find(".w2ui-node-text"),e.style=t.style,s[0].style=e.style,delete t.style)}}return t}refresh(e,t){if(null!=this.box){var A=Date.now();let l=this;var i=this.trigger("refresh",{target:null!=e?e:this.name,nodeId:null!=e?e:null,fullRefresh:null==e});if(!0!==i.isCancelled){1==this.flatButton?o(this.box).find(".w2ui-sidebar-top .w2ui-flat").show().removeClass("w2ui-flat-left w2ui-flat-right").addClass(" w2ui-flat-"+(this.flat?"right":"left")):o(this.box).find(".w2ui-sidebar-top .w2ui-flat").hide(),o(this.box).find(":scope > div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:o(this.box).get(0)?.clientWidth+"px",height:o(this.box).get(0)?.clientHeight+"px"}),0<this.nodes.length&&null==this.nodes[0].parent&&(s=this.nodes,this.nodes=[],this.add(this,s));let d,c,h=this;if(null==e)d=this,c=".w2ui-sidebar-body";else{if(null==(d=this.get(e)))return;c="#node_"+a.escapeId(d.id)+"_sub"}var s="#node_"+a.escapeId(d.id);let u;d!==this&&(u=p(d),o(this.box).find(s).before('<div id="sidebar_'+this.name+'_tmp"></div>'),o(this.box).find(s).remove(),o(this.box).find(c).remove(),o(this.box).find("#sidebar_"+this.name+"_tmp").before(u),o(this.box).find("#sidebar_"+this.name+"_tmp").remove()),e=o(this.box).find(":scope > div").get(0);var n={top:e?.scrollTop,left:e?.scrollLeft};o(this.box).find(c).html("");for(let g=0;g<d.nodes.length;g++){var r=d.nodes[g];if(u=p(r),o(this.box).find(c).append(u),0!==r.nodes.length)this.refresh(r.id,!0);else{if(!0===(r=this.trigger("refresh",{target:r.id})).isCancelled)return;r.finish()}}return e&&(e.scrollTop=n.top,e.scrollLeft=n.left),t||(e=o(this.box).find(s+`, ${s} .w2ui-eaction, ${c} .w2ui-eaction`),a.bindEvents(e,this)),i.finish(),Date.now()-A;function p(e){let t="",A=e.icon,i=(null==A&&(A=h.icon),e.parent),s=0;for(;i&&null!=i.parent;)i=i.parent,s++;if(null!=e.caption&&null==e.text&&(e.text=e.caption),null!=e.caption&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",e),e.text=e.caption),Array.isArray(e.nodes)&&0<e.nodes.length&&(e.collapsible=!0),e.group){let A=a.lang("function"==typeof e.text?e.text.call(h,e,s):e.text);"<span"!=String(A).substr(0,5)&&(A=`<span class="w2ui-group-text">${A}</span>`),t=`\n                    <div id="node_${e.id}" data-id="${e.id}" data-level="${s}" style="${e.hidden?"display: none":""}"\n                        class="w2ui-node-group w2ui-level-${s} ${e.class||""} w2ui-eaction"\n                        data-click="toggle|${e.id}"\n                        data-contextmenu="contextMenu|${e.id}|event"\n                        data-mouseenter="showPlus|this|inherit"\n                        data-mouseleave="showPlus|this|transparent">\n                        ${e.groupShowHide&&e.collapsible?`<span>${!e.hidden&&e.expanded?a.lang("Hide"):a.lang("Show")}</span>`:"<span></span>"} ${A}\n                    </div>\n                    <div class="w2ui-node-sub" id="node_${e.id}_sub" style="${e.style}; ${!e.hidden&&e.expanded?"":"display: none;"}">\n                </div>`,h.flat&&(t=`\n                        <div class="w2ui-node-group" id="node_${e.id}" data-id="${e.id}"><span>&#160;</span></div>\n                        <div id="node_${e.id}_sub" style="${e.style}; ${!e.hidden&&e.expanded?"":"display: none;"}"></div>`)}else{e.selected&&!e.disabled&&(h.multi?(h.selected??=[],h.selected.includes(e.id)||h.selected.push(e.id)):h.selected=e.id);let i="";A&&(i=A instanceof Object?(n="function"==typeof A.text?A.text.call(h,e,s)??"":A.text,`\n                            <div class="w2ui-node-image w2ui-eaction" style="${h.icon.style??""}; pointer-events: all"\n                                data-mouseEnter="mouseAction|Enter|this|${e.id}|event|icon"\n                                data-mouseLeave="mouseAction|Leave|this|${e.id}|event|icon"\n                                data-click="mouseAction|click|this|${e.id}|event|icon">\n                                    ${n}\n                            </div>\n                        `):`\n                            <div class="w2ui-node-image">\n                                <span class="${"function"==typeof A?A.call(h,e,s):A}"></span>\n                            </div>`);let o="",d="";if(null!=l.badge||null!=e.count){let t=e.count??l.badge?.text;var n=l.badge?.style,r=h.last.badge[e.id];(t="function"==typeof t?t.call(l,e,s):t)&&(d=`\n                            <div class="w2ui-node-badge w2ui-eaction ${null!=e.count?"w2ui-node-count":""} ${r?.className??""}"\n                                style="${n??""};${r?.style??""}"\n                                data-mouseEnter="mouseAction|Enter|this|${e.id}|event|badge"\n                                data-mouseLeave="mouseAction|Leave|this|${e.id}|event|badge"\n                                data-click="mouseAction|click|this|${e.id}|event|badge"\n                            >\n                                ${t}\n                            </div>`)}n=["w2ui-node","w2ui-level-"+s,"w2ui-eaction"],e.selected&&n.push("w2ui-selected"),e.disabled&&n.push("w2ui-disabled"),e.class&&n.push(e.class),!0===e.collapsible&&(r=["w2ui-sb-toggle","w2ui-eaction",e.expanded?"w2ui-expanded":"w2ui-collapsed"],"left"==l.toggleAlign&&r.push("w2ui-left-toggle"),o=`<div class="${r.join(" ")}" data-click="toggle|${e.id}"><span></span></div>`,n.push("w2ui-has-children")),r=a.lang("function"==typeof e.text?e.text.call(h,e,s):e.text);let c=e.parent?.childOffset??0;0===s&&!0===e.collapsible&&"left"==l.toggleAlign&&(c+=12),t=`\n                    <div id="node_${e.id}" class="${n.join(" ")}" data-id="${e.id}" data-level="${s}"\n                        style="${e.hidden?"display: none;":""}"\n                        data-click="click|${e.id}|event"\n                        data-dblclick="dblClick|${e.id}|event"\n                        data-mouseDown="mouseDown|${e.id}|event"\n                        data-contextmenu="contextMenu|${e.id}|event"\n                        data-mouseEnter="mouseAction|Enter|this|${e.id}|event"\n                        data-mouseLeave="mouseAction|Leave|this|${e.id}|event"\n                    >\n                        ${h.handle.text?`<div class="w2ui-node-handle w2ui-eaction" style="width: ${h.handle.width}px; ${h.handle.style}"\n                                    data-mouseEnter="mouseAction|Enter|this|${e.id}|event|handle"\n                                    data-mouseLeave="mouseAction|Leave|this|${e.id}|event|handle"\n                                    data-click="mouseAction|click|this|${e.id}|event|handle"\n                                >\n                                   ${"function"==typeof h.handle.text?h.handle.text.call(h,e,s)??"":h.handle.text}\n                              </div>`:""}\n                      <div class="w2ui-node-data" style="margin-left: ${s*h.levelPadding+c+h.handle.width}px">\n                            ${o} ${i} ${d}\n                            <div class="w2ui-node-text ${i?"":"no-icon"}" style="${e.style||""}">${r}</div>\n                       </div>\n                    </div>\n                    <div class="w2ui-node-sub" id="node_${e.id}_sub" style="${e.style}; ${!e.hidden&&e.expanded?"":"display: none;"}"></div>`,h.flat&&(t=`\n                        <div id="node_${e.id}" class="${n.join(" ")}" data-id="${e.id}" style="${e.hidden?"display: none;":""}"\n                            data-click="click|${e.id}|event"\n                            data-dblclick="dblClick|${e.id}|event"\n                            data-contextmenu="contextMenu|${e.id}|event"\n                            data-mouseEnter="mouseAction|Enter|this|${e.id}|event|tooltip"\n                            data-mouseLeave="mouseAction|Leave|this|${e.id}|event|tooltip"\n                        >\n                            <div class="w2ui-node-data w2ui-node-flat">${i}</div>\n                        </div>\n                        <div class="w2ui-node-sub" id="node_${e.id}_sub" style="${e.style}; ${!e.hidden&&e.expanded?"":"display: none;"}"></div>`)}return t}}}}mouseAction(e,t,A,i,s){let n;if(A=this.get(A),null==s&&(n=this.trigger("mouse"+e,{target:A.id,node:A,originalEvent:i})),"tooltip"==s){let i=a.lang("function"==typeof A.text?A.text.call(this,A):A.text)+(A.count||0===A.count?' - <span class="w2ui-node-badge w2ui-node-count">'+A.count+"</span>":"");"Leave"==e&&(i=""),this.tooltip(t,i)}if("handle"==s)if("click"==e){var r=this.handle.onClick;"function"==typeof r&&r.call(this,A,i)}else{let s=this.handle.tooltip;"function"==typeof s&&(s=s.call(this,A,i)),"Leave"==e&&(s=""),this.otherTooltip(t,s)}if("icon"==s)if("click"==e)"function"==typeof(r=this.icon.onClick)&&r.call(this,A,i);else{let s=this.icon.tooltip;"function"==typeof s&&(s=s.call(this,A,i)),"Leave"==e&&(s=""),this.otherTooltip(t,s)}if("badge"==s)if("click"==e)r=this.badge?.onClick,"function"==typeof r&&r.call(this,A,i);else{let s=this.badge?.tooltip;"function"==typeof s&&(s=s.call(this,A,i)),"Leave"==e&&(s=""),this.otherTooltip(t,s)}n?.finish()}tooltip(e,t){e=o(e).find(".w2ui-node-data"),""!==t?g.show({anchor:e.get(0),name:this.name+"_tooltip",html:t,position:"right|left"}):g.hide(this.name+"_tooltip")}otherTooltip(e,t){""!==t?g.show({anchor:e,name:this.name+"_tooltip",html:t,position:"top|bottom"}):g.hide(this.name+"_tooltip")}showPlus(e,t){o(e).find("span:nth-child(1)").css("color",t)}resize(){var e,t=Date.now(),A=this.trigger("resize",{target:this.name});if(!0!==A.isCancelled)return null!=this.box&&(e=o(this.box).get(0).getBoundingClientRect(),o(this.box).css("overflow","hidden"),o(this.box).find(":scope > div").css({width:e.width+"px",height:e.height+"px"})),A.finish(),Date.now()-t}destroy(){var e=this.trigger("destroy",{target:this.name});!0!==e.isCancelled&&(0<o(this.box).find(".w2ui-sidebar-body").length&&this.unmount(),delete l[this.name],e.finish())}unmount(){super.unmount(),this.last.observeResize?.disconnect()}lock(e,t){var A=Array.from(arguments);A.unshift(this.box),a.lock(...A)}unlock(e){a.unlock(this.box,e)}}class b extends s{constructor(e){super(e.name),this.box=null,this.name=null,this.active=null,this.reorder=!1,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.last={},this.right="",this.style="",this.onClick=null,this.onMouseEnter=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onClose=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.tab_template={id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null};var t=e.tabs;delete e.tabs,Object.assign(this,e),Array.isArray(t)&&this.add(t),e.tabs=t,"string"==typeof this.box&&(this.box=o(this.box).get(0)),this.box&&this.render(this.box)}add(e){return this.insert(null,e)}insert(e,t){Array.isArray(t)||(t=[t]);let A=[];return t.forEach((t=>{var i,s;null==t.id?console.log(`ERROR: The parameter "id" is required but not supplied. (obj: ${this.name})`):a.checkUniqueId(t.id,this.tabs,"tabs",this.name)&&(t=Object.assign({},this.tab_template,t),null==e?(this.tabs.push(t),A.push(this.animateInsert(null,t))):(i=this.get(e,!0),s=this.tabs[i].id,this.tabs.splice(i,0,t),A.push(this.animateInsert(s,t))))})),Promise.all(A)}remove(){let e=0;return Array.from(arguments).forEach((t=>{(t=this.get(t))&&(e++,this.tabs.splice(this.get(t.id,!0),1),o(this.box).find(`#tabs_${this.name}_tab_`+a.escapeId(t.id)).remove())})),this.resize(),e}select(e){return this.active!=e&&null!=this.get(e)&&(this.active=e,this.refresh(),!0)}set(e,t){var A=this.get(e,!0);return null!=A&&(a.extend(this.tabs[A],t),this.refresh(e),!0)}get(e,t){if(0===arguments.length){var A=[];for(let e=0;e<this.tabs.length;e++)null!=this.tabs[e].id&&A.push(this.tabs[e].id);return A}for(let A=0;A<this.tabs.length;A++)if(this.tabs[A].id==e)return!0===t?A:this.tabs[A];return null}show(){let e=[];return Array.from(arguments).forEach((t=>{(t=this.get(t))&&!1!==t.hidden&&(t.hidden=!1,e.push(t.id))})),setTimeout((()=>{e.forEach((e=>{this.refresh(e),this.resize()}))}),15),e}hide(){let e=[];return Array.from(arguments).forEach((t=>{(t=this.get(t))&&!0!==t.hidden&&(t.hidden=!0,e.push(t.id))})),setTimeout((()=>{e.forEach((e=>{this.refresh(e),this.resize()}))}),15),e}enable(){let e=[];return Array.from(arguments).forEach((t=>{(t=this.get(t))&&!1!==t.disabled&&(t.disabled=!1,e.push(t.id))})),setTimeout((()=>{e.forEach((e=>{this.refresh(e)}))}),15),e}disable(){let e=[];return Array.from(arguments).forEach((t=>{(t=this.get(t))&&!0!==t.disabled&&(t.disabled=!0,e.push(t.id))})),setTimeout((()=>{e.forEach((e=>{this.refresh(e)}))}),15),e}dragMove(e){if(this.last.reordering){let r=this;var t=this.last.moving,A=this.tabs[t.index],i=l(t.index,1),s=l(t.index,-1);if(A=o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(A.id)),0<t.divX&&i){var n=o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(i.id));let d=parseInt(A.get(0).clientWidth),c=parseInt(n.get(0).clientWidth);if(d=d<c?Math.floor(d/3):Math.floor(c/3),c-=d,t.divX>c)return i=this.tabs.indexOf(i),this.tabs.splice(t.index,0,this.tabs.splice(i,1)[0]),t.$tab.before(n.get(0)),t.$tab.css("opacity",0),void Object.assign(this.last.moving,{index:i,divX:-d,x:e.pageX+d,left:t.left+t.divX+d})}if(t.divX<0&&s){n=o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(s.id));let h=parseInt(A.get(0).clientWidth),u=parseInt(n.get(0).clientWidth);h=h<u?Math.floor(h/3):Math.floor(u/3),u-=h,Math.abs(t.divX)>u&&(i=this.tabs.indexOf(s),this.tabs.splice(t.index,0,this.tabs.splice(i,1)[0]),n.before(t.$tab),t.$tab.css("opacity",0),Object.assign(t,{index:i,divX:h,x:e.pageX-h,left:t.left+t.divX-h}))}function l(e,t){e+=t;let A=r.tabs[e];return A&&A.hidden?l(e,t):A}}}mouseAction(e,t,A){var i=this.get(t),s=this.trigger("mouse"+e,{target:t,tab:i,object:i,originalEvent:A});if(!0!==s.isCancelled&&!i?.disabled&&!i?.hidden){switch(e){case"Enter":this.tooltipShow(t);break;case"Leave":this.tooltipHide(t);break;case"Down":this.initReorder(t,A)}s.finish()}}tooltipShow(e){var t=this.get(e);if(e=o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(e)).get(0),null!=this.tooltip&&!t?.disabled&&!this.last.reordering){var A=this.tooltip;let i=t?.tooltip;"function"==typeof i&&(i=i.call(this,t)),g.show({anchor:e,name:this.name+"_tooltip",html:i,position:A})}}tooltipHide(e){null!=this.tooltip&&g.hide(this.name+"_tooltip")}getTabHTML(e){if(e=this.get(e,!0),null==(e=this.tabs[e]))return!1;null==e.text&&null!=e.caption&&(e.text=e.caption),null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint),null!=e.caption&&console.log("NOTICE: tabs tab.caption property is deprecated, please use tab.text. Tab -> ",e),null!=e.hint&&console.log("NOTICE: tabs tab.hint property is deprecated, please use tab.tooltip. Tab -> ",e);let t=e.text,A=(null==(t="function"==typeof t?t.call(this,e):t)&&(t=""),""),i="";return e.hidden&&(i+="display: none;"),e.disabled&&(i+="opacity: 0.2;"),e.closable&&!e.disabled&&(A=`<div class="w2ui-tab-close w2ui-eaction ${this.active===e.id?"active":""}"\n                data-mousedown="stop" data-mouseup="clickClose|${e.id}|event">\n            </div>`),`\n            <div id="tabs_${this.name}_tab_${e.id}" style="${i} ${e.style}"\n                class="w2ui-tab w2ui-eaction ${this.active===e.id?"active":""} ${e.closable?"closable":""} ${e.class||""}"\n                data-mouseenter="mouseAction|Enter|${e.id}|event]"\n                data-mouseleave="mouseAction|Leave|${e.id}|event]"\n                data-mousedown="mouseAction|Down|${e.id}|event"\n                data-mouseup="mouseAction|Up|${e.id}|event"\n                data-click="click|${e.id}|event"\n               >\n                    ${a.lang(t)+A}\n            </div>`}refresh(e){var t=Date.now(),A=("up"==this.flow?o(this.box).addClass("w2ui-tabs-up"):o(this.box).removeClass("w2ui-tabs-up"),this.trigger("refresh",{target:null!=e?e:this.name,object:this.get(e)}));if(!0!==A.isCancelled){if(null==e)for(let e=0;e<this.tabs.length;e++)this.refresh(this.tabs[e].id);else{var i="#tabs_"+this.name+"_tab_"+a.escapeId(e),s=o(this.box).find(i);e=this.getTabHTML(e),0===s.length?o(this.box).find("#tabs_"+this.name+"_right").before(e):0==o(this.box).find(".tab-animate-insert").length&&s.replace(e),a.bindEvents(o(this.box).find(i+`, ${i} .w2ui-eaction`),this)}return o(this.box).find("#tabs_"+this.name+"_right").html(this.right),A.finish(),Date.now()-t}}render(e){var t=Date.now(),A=("string"==typeof e&&(e=o(e).get(0)),this.trigger("render",{target:this.name,box:e??this.box}));if(!0!==A.isCancelled)return null!=e&&(this.unmount(),this.box=e),!!this.box&&(e=`\n            <div class="w2ui-tabs-line"></div>\n            <div class="w2ui-scroll-wrapper w2ui-eaction" data-mousedown="resize">\n                <div id="tabs_${this.name}_right" class="w2ui-tabs-right">${this.right}</div>\n            </div>\n            <div class="w2ui-scroll-left w2ui-eaction" data-click='["scroll","left"]'></div>\n            <div class="w2ui-scroll-right w2ui-eaction" data-click='["scroll","right"]'></div>`,o(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(e),0<o(this.box).length&&(o(this.box)[0].style.cssText+=this.style),a.bindEvents(o(this.box).find(".w2ui-eaction"),this),this.last.observeResize=new ResizeObserver((()=>{this.resize()})),this.last.observeResize.observe(this.box),A.finish(),this.refresh(),this.resize(),Date.now()-t)}initReorder(e,t){if(this.reorder){let A,i=this,s=o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(e)),n=this.get(e,!0),r=o(s.get(0).cloneNode(!0));r.attr("id","#tabs_"+this.name+"_tab_ghost"),this.last.moving={index:n,indexFrom:n,$tab:s,$ghost:r,divX:0,left:s.get(0).getBoundingClientRect().left,parentX:o(this.box).get(0).getBoundingClientRect().left,x:t.pageX,opacity:s.css("opacity")},o(document).off(".w2uiTabReorder").on("mousemove.w2uiTabReorder",(function(e){if(!i.last.reordering){if(!0===(A=i.trigger("reorder",{target:i.tabs[n].id,indexFrom:n,tab:i.tabs[n]})).isCancelled)return;g.hide(this.name+"_tooltip"),i.last.reordering=!0,r.addClass("moving"),r.css({"pointer-events":"none",position:"absolute",left:s.get(0).getBoundingClientRect().left}),s.css("opacity",0),o(i.box).find(".w2ui-scroll-wrapper").append(r.get(0)),o(i.box).find(".w2ui-tab-close").hide()}i.last.moving.divX=e.pageX-i.last.moving.x,r.css("left",i.last.moving.left-i.last.moving.parentX+i.last.moving.divX+"px"),i.dragMove(e)})).on("mouseup.w2uiTabReorder",(function(){o(document).off(".w2uiTabReorder"),r.css({transition:"0.1s",left:i.last.moving.$tab.get(0).getBoundingClientRect().left-i.last.moving.parentX}),o(i.box).find(".w2ui-tab-close").show(),r.remove(),s.css({opacity:i.last.moving.opacity}),i.last.reordering&&A.finish({indexTo:i.last.moving.index}),i.last.reordering=!1}))}}scroll(e,t){return new Promise(((A,i)=>{var s=o(this.box).find(".w2ui-scroll-wrapper"),n=s.get(0).scrollLeft,r=s.find(".w2ui-tabs-right").get(0),l=s.parent().get(0).getBoundingClientRect().width,a=n+parseInt(r.offsetLeft)+parseInt(r.clientWidth);switch(e){case"left":{let e=n-l+50;e<=0&&(e=0),s.get(0).scrollTo({top:0,left:e,behavior:t?"atuo":"smooth"});break}case"right":{let e=n+l-50;e>=a-l&&(e=a-l),s.get(0).scrollTo({top:0,left:e,behavior:t?"atuo":"smooth"});break}}setTimeout((()=>{this.resize(),A()}),t?0:350)}))}scrollIntoView(e,t){return new Promise(((A,i)=>{null==e&&(e=this.active),null!=this.get(e)&&(o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(e)).get(0).scrollIntoView({block:"start",inline:"center",behavior:t?"atuo":"smooth"}),setTimeout((()=>{this.resize(),A()}),t?0:500))}))}resize(){var e=Date.now();if(null!=this.box){var t,A,i,s,n=this.trigger("resize",{target:this.name});if(!0!==n.isCancelled)return null!=this.box&&((t=o(this.box)).find(".w2ui-scroll-left, .w2ui-scroll-right").hide(),A=t.find(".w2ui-scroll-wrapper").get(0),s=t.find(".w2ui-tabs-right"),(i=t.get(0).getBoundingClientRect().width)<(s=0<s.length?s[0].offsetLeft+s[0].clientWidth:0))&&(0<A.scrollLeft&&t.find(".w2ui-scroll-left").show(),i<s-A.scrollLeft)&&t.find(".w2ui-scroll-right").show(),n.finish(),Date.now()-e}}destroy(){var e=this.trigger("destroy",{target:this.name});!0!==e.isCancelled&&(0<o(this.box).find("#tabs_"+this.name+"_right").length&&this.unmount(),delete l[this.name],e.finish())}unmount(){super.unmount(),this.last.observeResize?.disconnect()}click(e,t){var A=this.get(e);if(null==A||A.disabled||this.last.reordering)return!1;if(!0!==(e=this.trigger("click",{target:e,tab:A,object:A,originalEvent:t})).isCancelled){if(o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(this.active)).removeClass("active"),this.active=A.id,o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(this.active)).addClass("active"),"string"==typeof A.route){let e=""!==A.route?String("/"+A.route).replace(/\/{2,}/g,"/"):"";var i=a.parseRoute(e);if(0<i.keys.length)for(let t=0;t<i.keys.length;t++)null!=this.routeData[i.keys[t].name]&&(e=e.replace(new RegExp(":"+i.keys[t].name,"g"),this.routeData[i.keys[t].name]));setTimeout((()=>{window.location.hash=e}),1)}e.finish()}}clickClose(e,t){var A=this.get(e);if(null==A||A.disabled)return!1;let i=this.trigger("close",{target:e,object:A,tab:A,originalEvent:t});!0!==i.isCancelled&&(this.animateClose(e).then((()=>{this.remove(e),i.finish(),this.refresh()})),t)&&t.stopPropagation()}animateClose(e){return new Promise(((t,A)=>{var i=o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(e)),s=parseInt(i.get(0).clientWidth||0);let n=i.replace(`<div class="tab-animate-close" style="display: inline-block; flex-shrink: 0; width: ${s}px; transition: width 0.25s"></div>`);setTimeout((()=>{n.css({width:"0px"})}),1),setTimeout((()=>{n.remove(),this.resize(),t()}),500)}))}animateInsert(e,t){return new Promise(((A,i)=>{let s=o(this.box).find("#tabs_"+this.name+"_tab_"+a.escapeId(e)),n=o.html(this.getTabHTML(t.id));if(0==s.length)(s=o(this.box).find("#tabs_tabs_right")).before(n),this.resize();else{n.css({opacity:0}),o(this.box).find("#tabs_tabs_right").before(n.get(0));let e=o(this.box).find("#"+n.attr("id")).get(0)?.clientWidth??0,i=o.html('<div class="tab-animate-insert" style="flex-shrink: 0; width: 0; transition: width 0.25s"></div>');s.before(i),n.hide(),i.before(n[0]),setTimeout((()=>{i.css({width:e+"px"})}),1),setTimeout((()=>{i.remove(),n.css({opacity:1}).show(),this.refresh(t.id),this.resize(),A()}),500)}}))}}let v=["top","left","main","preview","right","bottom"];class C extends s{constructor(e){super(e.name),this.box=null,this.name=null,this.panels=[],this.last={},this.padding=1,this.resizer=4,this.style="",this.onShow=null,this.onHide=null,this.onResizing=null,this.onResizerClick=null,this.onRender=null,this.onRefresh=null,this.onChange=null,this.onResize=null,this.onDestroy=null,this.panel_template={type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",html:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},removed:null,onRefresh:null,onShow:null,onHide:null},Object.assign(this,e),Array.isArray(this.panels)||(this.panels=[]),this.panels.forEach(((e,t)=>{var A,i,s;this.panels[t]=a.extend({},this.panel_template,e),(a.isPlainObject(e.tabs)||Array.isArray(e.tabs))&&function(e,t,A){var i=e.get(t);if(null!=i&&null==A&&(A=i.tabs),null!=i&&null!=A){Array.isArray(A)&&(A={tabs:A});var s=e.name+"_"+t+"_tabs";l[s]&&l[s].destroy(),i.tabs=new b(a.extend({},A,{owner:e,name:e.name+"_"+t+"_tabs"})),i.show.tabs=!0}}(this,e.type),(a.isPlainObject(e.toolbar)||Array.isArray(e.toolbar))&&(t=this,e=e.type,A=void 0,null!=(i=t.get(e))&&null==A&&(A=i.toolbar),null!=i)&&null!=A&&(Array.isArray(A)&&(A={items:A}),s=t.name+"_"+e+"_toolbar",l[s]&&l[s].destroy(),i.toolbar=new B(a.extend({},A,{owner:t,name:t.name+"_"+e+"_toolbar"})),i.show.toolbar=!0)})),v.forEach((e=>{null==this.get(e)&&this.panels.push(a.extend({},this.panel_template,{type:e,hidden:"main"!==e,size:50}))})),"string"==typeof this.box&&(this.box=o(this.box).get(0)),this.box&&this.render(this.box)}html(e,t,A){let i=this.get(e);var s={panel:e,html:i.html,error:!1,cancelled:!1,removed(e){"function"==typeof e&&(i.removed=e)}};if("function"==typeof i.removed&&(i.removed({panel:e,html:i.html,html_new:t,transition:A||"none"}),i.removed=null),"css"==e)o(this.box).find("#layout_"+this.name+"_panel_css").html("<style>"+t+"</style>"),s.status=!0;else if(null==i)console.log("ERROR: incorrect panel name. Panel name can be main, left, right, top, bottom, preview or css"),s.error=!0;else if(null!=t){var n=this.trigger("change",{target:e,panel:i,html_new:t,transition:A});if(!0===n.isCancelled)s.cancelled=!0;else{let s="#layout_"+this.name+"_panel_"+i.type;var r=o(this.box).find(s+'> [data-role="panel-content"]');let l=0;if(0<r.length&&(o(this.box).find(s).get(0).scrollTop=0,l=o(r).css("top")),"function"==typeof i.html.unmount&&i.html.unmount(),r.addClass("w2ui-panel-content"),r.removeAttr("style"),this.resizeBoxes(e),""===i.html)i.html=t,this.refresh(e);else if(i.html=t,!i.hidden)if(null!=A&&""!==A){o(this.box).addClass("animating");let n=o(this.box).find(s+'> [data-role="panel-content"]'),r=(n.after('<div class="w2ui-panel-content new-panel" data-role="panel-content" style="'+n[0].style.cssText+'"></div>'),o(this.box).find(s+'> [data-role="panel-content"].new-panel'));n.css("top",l),r.css("top",l),"object"==typeof t?(t.box=r[0],t.render()):r.hide().html(t),a.transition(n[0],r[0],A,(()=>{n.remove(),r.removeClass("new-panel"),r.css("overflow",i.overflow),o(o(this.box).find(s+'> [data-role="panel-content"]').get(1)).remove(),o(this.box).removeClass("animating"),this.refresh(e)}))}else this.refresh(e);n.finish()}}return s}message(e,t){var A=this.get(e);let i=o(this.box).find("#layout_"+this.name+"_panel_"+A.type),s=i.css("overflow");return i.css("overflow","hidden"),(A=a.message({owner:this,box:i.get(0),after:".w2ui-panel-title",param:e},t))&&A.self.on("close:after",(()=>{i.css("overflow",s)})),A}confirm(e,t){var A=this.get(e);let i=o(this.box).find("#layout_"+this.name+"_panel_"+A.type),s=i.css("overflow");return i.css("overflow","hidden"),(A=a.confirm({owner:this,box:i.get(0),after:".w2ui-panel-title",param:e},t))&&A.self.on("close:after",(()=>{i.css("overflow",s)})),A}load(e,t,A){return new Promise(((i,s)=>{"css"!=e&&null==this.get(e)||null==t?s():fetch(t).then((e=>e.text())).then((t=>{this.resize(),i(this.html(e,t,A))}))}))}sizeTo(e,t,A){return null!=this.get(e)&&(o(this.box).find(":scope > div > .w2ui-panel").css("transition",!0!==A?".2s":"0s"),setTimeout((()=>{this.set(e,{size:t})}),1),setTimeout((()=>{o(this.box).find(":scope > div > .w2ui-panel").css("transition","0s"),this.resize()}),300),!0)}show(e,t){let A=this.trigger("show",{target:e,thisect:this.get(e),immediate:t});var i;if(!0!==A.isCancelled)return null!=(i=this.get(e))&&(!(i.hidden=!1)===t?(o(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"1"}),A.finish(),this.resize()):(o(this.box).addClass("animating"),o(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"0"}),o(this.box).find(":scope > div > .w2ui-panel").css("transition",".2s"),setTimeout((()=>{this.resize()}),1),setTimeout((()=>{o(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"1"})}),250),setTimeout((()=>{o(this.box).find(":scope > div > .w2ui-panel").css("transition","0s"),o(this.box).removeClass("animating"),A.finish(),this.resize()}),300)),!0)}hide(e,t){let A=this.trigger("hide",{target:e,object:this.get(e),immediate:t});var i;if(!0!==A.isCancelled)return null!=(i=this.get(e))&&((i.hidden=!0)===t?(o(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"0"}),A.finish(),this.resize()):(o(this.box).addClass("animating"),o(this.box).find(":scope > div > .w2ui-panel").css("transition",".2s"),o(this.box).find("#layout_"+this.name+"_panel_"+e).css({opacity:"0"}),setTimeout((()=>{this.resize()}),1),setTimeout((()=>{o(this.box).find(":scope > div > .w2ui-panel").css("transition","0s"),o(this.box).removeClass("animating"),A.finish(),this.resize()}),300)),!0)}toggle(e,t){var A=this.get(e);return null!=A&&(A.hidden?this.show(e,t):this.hide(e,t))}set(e,t){var A=this.get(e,!0);return null!=A&&(a.extend(this.panels[A],t),null==t.html&&null==t.resizable||this.refresh(e),this.resize(),!0)}get(e,t){for(let A=0;A<this.panels.length;A++)if(this.panels[A].type==e)return!0===t?A:this.panels[A];return null}el(e){return 1!=(e=o(this.box).find("#layout_"+this.name+"_panel_"+e+'> [data-role="panel-content"]')).length?null:e[0]}hideToolbar(e){var t=this.get(e);t&&(t.show.toolbar=!1,o(this.box).find(`#layout_${this.name}_panel_${e} > [data-role="panel-toolbar"]`).hide(),this.resize())}showToolbar(e){var t=this.get(e);t&&(t.show.toolbar=!0,o(this.box).find(`#layout_${this.name}_panel_${e} > [data-role="panel-toolbar"]`).show(),this.resize())}toggleToolbar(e){var t=this.get(e);t&&(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))}assignToolbar(e,t){"string"==typeof t&&null!=l[t]&&(t=l[t]);var A=this.get(e),i=(A.toolbar=t,o(this.box).find(e+'> [data-role="panel-toolbar"]'));null!=A.toolbar?(i.attr("name")!=A.toolbar.name?A.toolbar.render(i.get(0)):null!=A.toolbar&&A.toolbar.refresh(),(t.owner=this).showToolbar(e),this.refresh(e)):(i.html(""),this.hideToolbar(e))}hideTabs(e){var t=this.get(e);t&&(t.show.tabs=!1,o(this.box).find("#layout_"+this.name+"_panel_"+e+'> [data-role="panel-tabs"]').hide(),this.resize())}showTabs(e){var t=this.get(e);t&&(t.show.tabs=!0,o(this.box).find("#layout_"+this.name+"_panel_"+e+'> [data-role="panel-tabs"]').show(),this.resize())}toggleTabs(e){var t=this.get(e);t&&(t.show.tabs?this.hideTabs(e):this.showTabs(e))}render(e){var t=Date.now();let A=this;"string"==typeof e&&(e=o(e).get(0));var i=this.trigger("render",{target:this.name,box:e??this.box});if(!0!==i.isCancelled){if(null!=e&&(this.unmount(),this.box=e),!this.box)return!1;o(this.box).attr("name",this.name).addClass("w2ui-layout").html("<div></div>"),0<o(this.box).length&&(o(this.box)[0].style.cssText+=this.style);for(let e=0;e<v.length;e++){var s='<div id="layout_'+this.name+"_panel_"+v[e]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs" data-role="panel-tabs"></div>    <div class="w2ui-panel-toolbar" data-role="panel-toolbar"></div>    <div class="w2ui-panel-content" data-role="panel-content"></div></div><div id="layout_'+this.name+"_resizer_"+v[e]+'" class="w2ui-resizer"></div>';o(this.box).find(":scope > div").append(s)}return o(this.box).find(":scope > div").append('<div id="layout_'+this.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),this.refresh(),this.last.observeResize=new ResizeObserver((()=>{this.resize()})),this.last.observeResize.observe(this.box),i.finish(),setTimeout((()=>{A.last.events={resizeStart:n,mouseMove:l,mouseUp:r},this.resize()}),0),Date.now()-t}function n(e,t){A.box&&(t=t||window.event,o(document).off("mousemove",A.last.events.mouseMove).on("mousemove",A.last.events.mouseMove),o(document).off("mouseup",A.last.events.mouseUp).on("mouseup",A.last.events.mouseUp),A.last.resize={type:e,x:t.screenX,y:t.screenY,diff_x:0,diff_y:0,value:0},v.forEach((e=>{var t=o(A.el(e)).find(".w2ui-lock");0<t.length?t.data("locked","yes"):A.lock(e,{opacity:0})})),t=o(A.box).find("#layout_"+A.name+"_resizer_"+e).get(0),"left"!=e&&"right"!=e||(A.last.resize.value=parseInt(t.style.left)),"top"!=e&&"preview"!=e&&"bottom"!=e||(A.last.resize.value=parseInt(t.style.top)))}function r(e){if(A.box&&(e=e||window.event,o(document).off("mousemove",A.last.events.mouseMove),o(document).off("mouseup",A.last.events.mouseUp),null!=A.last.resize)){if(v.forEach((e=>{var t=o(A.el(e)).find(".w2ui-lock");"yes"==t.data("locked")?t.removeData("locked"):A.unlock(e)})),0!==A.last.diff_x||0!==A.last.resize.diff_y){var t=A.get("top"),i=A.get("bottom"),s=A.get(A.last.resize.type),n=(e=a.getSize(o(A.box),"width"),a.getSize(o(A.box),"height")),r=String(s.size);let l,d;switch(A.last.resize.type){case"top":l=parseInt(s.sizeCalculated)+A.last.resize.diff_y,d=0;break;case"bottom":l=parseInt(s.sizeCalculated)-A.last.resize.diff_y,d=0;break;case"preview":l=parseInt(s.sizeCalculated)-A.last.resize.diff_y,d=(t&&!t.hidden?t.sizeCalculated:0)+(i&&!i.hidden?i.sizeCalculated:0);break;case"left":l=parseInt(s.sizeCalculated)+A.last.resize.diff_x,d=0;break;case"right":l=parseInt(s.sizeCalculated)-A.last.resize.diff_x,d=0}"%"==r.substr(r.length-1)?s.size=Math.floor(100*l/("left"==s.type||"right"==s.type?e:n-d)*100)/100+"%":"-"==String(s.size).substr(0,1)?s.size=parseInt(s.size)-s.sizeCalculated+l:s.size=l,A.resize()}o(A.box).find("#layout_"+A.name+"_resizer_"+A.last.resize.type).removeClass("active"),delete A.last.resize}}function l(e){if(A.box&&(e=e||window.event,null!=A.last.resize)){var t=A.get(A.last.resize.type),i=A.last.resize,s=A.trigger("resizing",{target:A.name,object:t,originalEvent:e,panel:i?i.type:"all",diff_x:i?i.diff_x:0,diff_y:i?i.diff_y:0});if(!0!==s.isCancelled){var n=o(A.box).find("#layout_"+A.name+"_resizer_"+i.type);let l=e.screenX-i.x,a=e.screenY-i.y;var r=A.get("main");switch(n.hasClass("active")||n.addClass("active"),i.type){case"left":t.minSize-l>t.width&&(l=t.minSize-t.width),t.maxSize&&t.width+l>t.maxSize&&(l=t.maxSize-t.width),r.minSize+l>r.width&&(l=r.width-r.minSize);break;case"right":t.minSize+l>t.width&&(l=t.width-t.minSize),t.maxSize&&t.width-l>t.maxSize&&(l=t.width-t.maxSize),r.minSize-l>r.width&&(l=r.minSize-r.width);break;case"top":t.minSize-a>t.height&&(a=t.minSize-t.height),t.maxSize&&t.height+a>t.maxSize&&(a=t.maxSize-t.height),r.minSize+a>r.height&&(a=r.height-r.minSize);break;case"preview":case"bottom":t.minSize+a>t.height&&(a=t.height-t.minSize),t.maxSize&&t.height-a>t.maxSize&&(a=t.height-t.maxSize),r.minSize-a>r.height&&(a=r.minSize-r.height)}switch(i.diff_x=l,i.diff_y=a,i.type){case"top":case"preview":case"bottom":(i.diff_x=0)<n.length&&(n[0].style.top=i.value+i.diff_y+"px");break;case"left":case"right":(i.diff_y=0)<n.length&&(n[0].style.left=i.value+i.diff_x+"px")}s.finish()}}}}unmount(){super.unmount(),this.panels.forEach((e=>{e.tabs?.unmount?.(),e.toolbar?.unmount?.()})),this.last.observeResize?.disconnect()}destroy(){var e=this.trigger("destroy",{target:this.name});if(!0!==e.isCancelled)return null!=l[this.name]&&(this.panels.forEach((e=>{e.tabs?.destroy?.(),e.toolbar?.destroy?.()})),0<o(this.box).find("#layout_"+this.name+"_panel_main").length&&this.unmount(),delete l[this.name],e.finish(),this.last.events&&this.last.events.resize&&o(window).off("resize",this.last.events.resize),!0)}refresh(e){let t=this;null==e&&(e=null);var A=Date.now(),i=t.trigger("refresh",{target:null!=e?e:t.name,object:t.get(e)});if(!0!==i.isCancelled){if("string"==typeof e){let A=t.get(e);if(null==A)return;let i="#layout_"+t.name+"_panel_"+A.type;e="#layout_"+t.name+"_resizer_"+A.type,o(t.box).find(i).css({display:A.hidden?"none":"block"}),A.resizable?o(t.box).find(e).show():o(t.box).find(e).hide(),"object"==typeof A.html&&"function"==typeof A.html.render?(A.html.box=o(t.box).find(i+'> [data-role="panel-content"]')[0],setTimeout((()=>{0<o(t.box).find(i+'> [data-role="panel-content"]').length&&(o(t.box).find(i+'> [data-role="panel-content"]').removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",A.overflow)[0].style.cssText+=";"+A.style),A.html&&"function"==typeof A.html.render&&A.html.render()}),1)):0<o(t.box).find(i+'> [data-role="panel-content"]').length&&(o(t.box).find(i+'> [data-role="panel-content"]').removeClass().removeAttr("name").addClass("w2ui-panel-content").html(A.html).css("overflow",A.overflow)[0].style.cssText+=";"+A.style);let s=o(t.box).find(i+'> [data-role="panel-tabs"]');A.show.tabs?(s.attr("name")!=A.tabs.name&&null!=A.tabs?A.tabs.render(s.get(0)):A.tabs.refresh(),s.addClass("w2ui-panel-tabs")):s.html("").removeAttr("name").removeClass("w2ui-tabs").hide(),s=o(t.box).find(i+'> [data-role="panel-toolbar"]'),A.show.toolbar?(s.attr("name")!=A.toolbar.name&&null!=A.toolbar?A.toolbar.render(s.get(0)):A.toolbar.refresh(),s.addClass("w2ui-panel-toolbar")):s.html("").removeAttr("name").removeClass("w2ui-toolbar").hide(),s=o(t.box).find(i+"> .w2ui-panel-title"),A.title?s.html(A.title).show():s.html("").hide()}else{if(0===o(t.box).find("#layout_"+t.name+"_panel_main").length)return void t.render();t.resize();for(let e=0;e<this.panels.length;e++)t.refresh(this.panels[e].type)}return i.finish(),Date.now()-A}}resize(){if(!this.box)return!1;var e=Date.now();let t=this.last.resize;var A=this.trigger("resize",{target:this.name,panel:t?t.type:"all",diff_x:t?t.diff_x:0,diff_y:t?t.diff_y:0});if(!0!==A.isCancelled){this.padding<0&&(this.padding=0);var i=a.getSize(o(this.box),"width"),s=a.getSize(o(this.box),"height");let y=this;var n=this.get("main"),r=this.get("preview"),d=this.get("left"),c=this.get("right"),h=this.get("top"),u=this.get("bottom"),p=null!=r&&!0!==r.hidden,g=null!=d&&!0!==d.hidden,m=null!=c&&!0!==c.hidden,f=null!=h&&!0!==h.hidden,w=null!=u&&!0!==u.hidden;let b,C,x,Q;for(let e=0;e<v.length;e++)if("main"!==v[e]&&(t=this.get(v[e]))){var B=String(t.size||0);if("%"==B.substr(B.length-1)){let e=s;"preview"==t.type&&(e=e-(h&&!h.hidden?h.sizeCalculated:0)-(u&&!u.hidden?u.sizeCalculated:0)),t.sizeCalculated=parseInt(("left"==t.type||"right"==t.type?i:e)*parseFloat(t.size)/100)}else t.sizeCalculated=parseInt(t.size);t.sizeCalculated=Math.max(t.sizeCalculated,parseInt(t.minSize))}return"-"==String(c.size).substr(0,1)&&(g&&"-"==String(d.size).substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):c.sizeCalculated=i-(g?d.sizeCalculated:0)+parseInt(c.size)),"-"==String(d.size).substr(0,1)&&(m&&"-"==String(c.size).substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):d.sizeCalculated=i-(m?c.sizeCalculated:0)+parseInt(d.size)),null!=h&&!0!==h.hidden?(b=0,C=0,x=i,Q=h.sizeCalculated,o(this.box).find("#layout_"+this.name+"_panel_top").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px"}),h.width=x,h.height=Q,h.resizable&&(C=h.sizeCalculated-(0===this.padding?this.resizer:0),Q=this.resizer>this.padding?this.resizer:this.padding,o(this.box).find("#layout_"+this.name+"_resizer_top").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",(function(e){e.preventDefault();var t=y.trigger("resizerClick",{target:"top",originalEvent:e});if(!0!==t.isCancelled)return l[y.name].last.events.resizeStart("top",e),t.finish(),!1})))):(o(this.box).find("#layout_"+this.name+"_panel_top").hide(),o(this.box).find("#layout_"+this.name+"_resizer_top").hide()),null!=d&&!0!==d.hidden?(b=0,C=0+(f?h.sizeCalculated+this.padding:0),x=d.sizeCalculated,Q=s-(f?h.sizeCalculated+this.padding:0)-(w?u.sizeCalculated+this.padding:0),o(this.box).find("#layout_"+this.name+"_panel_left").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px"}),d.width=x,d.height=Q,d.resizable&&(b=d.sizeCalculated-(0===this.padding?this.resizer:0),x=this.resizer>this.padding?this.resizer:this.padding,o(this.box).find("#layout_"+this.name+"_resizer_left").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",(function(e){e.preventDefault();var t=y.trigger("resizerClick",{target:"left",originalEvent:e});if(!0!==t.isCancelled)return l[y.name].last.events.resizeStart("left",e),t.finish(),!1})))):(o(this.box).find("#layout_"+this.name+"_panel_left").hide(),o(this.box).find("#layout_"+this.name+"_resizer_left").hide()),null!=c&&!0!==c.hidden?(b=i-c.sizeCalculated,C=0+(f?h.sizeCalculated+this.padding:0),x=c.sizeCalculated,Q=s-(f?h.sizeCalculated+this.padding:0)-(w?u.sizeCalculated+this.padding:0),o(this.box).find("#layout_"+this.name+"_panel_right").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px"}),c.width=x,c.height=Q,c.resizable&&(b-=this.padding,x=this.resizer>this.padding?this.resizer:this.padding,o(this.box).find("#layout_"+this.name+"_resizer_right").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",(function(e){e.preventDefault();var t=y.trigger("resizerClick",{target:"right",originalEvent:e});if(!0!==t.isCancelled)return l[y.name].last.events.resizeStart("right",e),t.finish(),!1})))):(o(this.box).find("#layout_"+this.name+"_panel_right").hide(),o(this.box).find("#layout_"+this.name+"_resizer_right").hide()),null!=u&&!0!==u.hidden?(b=0,C=s-u.sizeCalculated,x=i,Q=u.sizeCalculated,o(this.box).find("#layout_"+this.name+"_panel_bottom").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px"}),u.width=x,u.height=Q,u.resizable&&(C-=0===this.padding?0:this.padding,Q=this.resizer>this.padding?this.resizer:this.padding,o(this.box).find("#layout_"+this.name+"_resizer_bottom").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",(function(e){e.preventDefault();var t=y.trigger("resizerClick",{target:"bottom",originalEvent:e});if(!0!==t.isCancelled)return l[y.name].last.events.resizeStart("bottom",e),t.finish(),!1})))):(o(this.box).find("#layout_"+this.name+"_panel_bottom").hide(),o(this.box).find("#layout_"+this.name+"_resizer_bottom").hide()),b=0+(g?d.sizeCalculated+this.padding:0),C=0+(f?h.sizeCalculated+this.padding:0),x=i-(g?d.sizeCalculated+this.padding:0)-(m?c.sizeCalculated+this.padding:0),Q=s-(f?h.sizeCalculated+this.padding:0)-(w?u.sizeCalculated+this.padding:0)-(p?r.sizeCalculated+this.padding:0),o(this.box).find("#layout_"+this.name+"_panel_main").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px"}),n.width=x,n.height=Q,null!=r&&!0!==r.hidden?(b=0+(g?d.sizeCalculated+this.padding:0),C=s-(w?u.sizeCalculated+this.padding:0)-r.sizeCalculated,x=i-(g?d.sizeCalculated+this.padding:0)-(m?c.sizeCalculated+this.padding:0),Q=r.sizeCalculated,o(this.box).find("#layout_"+this.name+"_panel_preview").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px"}),r.width=x,r.height=Q,r.resizable&&(C-=0===this.padding?0:this.padding,Q=this.resizer>this.padding?this.resizer:this.padding,o(this.box).find("#layout_"+this.name+"_resizer_preview").css({display:"block",left:b+"px",top:C+"px",width:x+"px",height:Q+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",(function(e){e.preventDefault();var t=y.trigger("resizerClick",{target:"preview",originalEvent:e});if(!0!==t.isCancelled)return l[y.name].last.events.resizeStart("preview",e),t.finish(),!1})))):(o(this.box).find("#layout_"+this.name+"_panel_preview").hide(),o(this.box).find("#layout_"+this.name+"_resizer_preview").hide()),this.resizeBoxes(),A.finish(),Date.now()-e}}resizeBoxes(e){let t=v;(t=e||"string"!=typeof e?v:[e]).forEach(((e,t)=>{var A;t=this.get(v[t]),e=`#layout_${this.name}_panel_${e} > `;let i=0;t&&(t.title&&(A=o(this.box).find(e+".w2ui-panel-title").css({top:i+"px",display:"block"}),i+=a.getSize(A,"height")),t.show.tabs&&(A=o(this.box).find(e+'[data-role="panel-tabs"]').css({top:i+"px",display:"block"}),i+=a.getSize(A,"height")),t.show.toolbar)&&(A=o(this.box).find(e+'[data-role="panel-toolbar"]').css({top:i+"px",display:"block"}),i+=a.getSize(A,"height")),o(this.box).find(e+'[data-role="panel-content"]').css({display:"block",top:i+"px"})}))}lock(e,t,A){var i;-1==v.indexOf(e)?console.log("ERROR: First parameter needs to be the a valid panel name."):((i=Array.from(arguments))[0]="#layout_"+this.name+"_panel_"+e,a.lock(...i))}unlock(e,t){-1==v.indexOf(e)?console.log("ERROR: First parameter needs to be the a valid panel name."):(e="#layout_"+this.name+"_panel_"+e,a.unlock(e,t))}}class x extends s{constructor(e){if(super(e.name),this.name=null,this.box=null,this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.toolbar={},this.ranges=[],this.contextMenu=[],this.searchMap={},this.searchData=[],this.sortMap={},this.sortData=[],this.savedSearches=[],this.defaultSearches=[],this.total=0,this.recid=null,this.last={field:"",label:"",logic:"AND",search:"",searchIds:[],selection:{indexes:[],columns:{}},saved_sel:null,multi:!1,fetch:{action:"",offset:null,start:0,response:0,options:null,controller:null,loaded:!1,hasMore:!1},vscroll:{scrollTop:0,scrollLeft:0,recIndStart:null,recIndEnd:null,colIndStart:0,colIndEnd:0,pull_more:!1,pull_refresh:!0,show_extra:0},sel_ind:null,sel_col:null,sel_type:null,sel_recid:null,idCache:{},move:null,cancelClick:null,inEditMode:!1,_edit:null,kbd_timer:null,marker_timer:null,click_time:null,click_recid:null,bubbleEl:null,colResizing:!1,tmp:null,copy_event:null,userSelect:"",columnDrag:!1,state:null,toolbar_height:0},this.header="",this.url="",this.limit=100,this.offset=0,this.postData={},this.routeData={},this.httpHeaders={},this.show={header:!1,toolbar:!1,footer:!1,columnMenu:!0,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!1,toolbarSearch:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,searchLogic:!0,searchHiddenMsg:!1,searchSave:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!1,selectionBorder:!0,selectionResizer:!0,skipRecords:!0,saveRestoreState:!0},this.stateId=null,this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=32,this.lineNumberWidth=34,this.keyboard=!0,this.selectType="row",this.liveSearch=!1,this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.showExtraOnSearch=0,this.markSearch=!0,this.columnTooltip="top|bottom",this.disableCVS=!1,this.nestedFields=!0,this.vs_start=150,this.vs_extra=5,this.style="",this.tabIndex=null,this.dataType=null,this.parser=null,this.advanceOnEdit=!0,this.useLocalStorage=!0,this.colTemplate={text:"",field:"",size:null,min:20,max:null,gridMinWidth:null,sizeCorrected:null,sizeCalculated:null,sizeOriginal:null,sizeType:null,hidden:!1,sortable:!1,sortMode:null,searchable:!1,resizable:!0,hideable:!0,autoResize:null,attr:"",style:"",render:null,title:null,tooltip:null,editable:{},frozen:!1,info:null,clipboardCopy:!1},this.stateColProps={text:!1,field:!0,size:!0,min:!1,max:!1,gridMinWidth:!1,sizeCorrected:!1,sizeCalculated:!0,sizeOriginal:!0,sizeType:!0,hidden:!0,sortable:!1,sortMode:!0,searchable:!1,resizable:!1,hideable:!1,autoResize:!1,attr:!1,style:!1,render:!1,title:!1,tooltip:!1,editable:!1,frozen:!0,info:!1,clipboardCopy:!1},this.msgDelete="Are you sure you want to delete ${count} ${records}?",this.msgNotJSON="Returned data is not in valid JSON format.",this.msgHTTPError="HTTP error. See console for more details.",this.msgServerError="Server error",this.msgRefresh="Refreshing...",this.msgNeedReload="Your remote data source record count has changed, reloading from the first record.",this.msgEmpty="",this.buttons={reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"menu-check",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",overlay:{align:"none"}},search:{type:"html",id:"w2ui-search",html:'<div class="w2ui-icon w2ui-icon-search w2ui-search-down w2ui-action" data-click="searchShowFields"></div>'},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",batch:1,disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",batch:!0,disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},this.operators={text:["is","begins","contains","ends"],number:["=","between",">","<",">=","<="],date:["is",{oper:"less",text:"before"},{oper:"more",text:"since"},"between"],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},this.defaultOperator={text:"begins",number:"=",date:"is",list:"is",enum:"in",hex:"begins",color:"begins"},this.operatorsMap={text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},this.onAdd=null,this.onEdit=null,this.onRequest=null,this.onLoad=null,this.onDelete=null,this.onSave=null,this.onSelect=null,this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onContextMenuClick=null,this.onColumnClick=null,this.onColumnDblClick=null,this.onColumnContextMenu=null,this.onColumnResize=null,this.onColumnAutoResize=null,this.onSort=null,this.onSearch=null,this.onSearchOpen=null,this.onChange=null,this.onRestore=null,this.onExpand=null,this.onCollapse=null,this.onError=null,this.onKeydown=null,this.onToolbar=null,this.onColumnOnOff=null,this.onCopy=null,this.onPaste=null,this.onSelectionExtend=null,this.onEditField=null,this.onRender=null,this.onRefresh=null,this.onReload=null,this.onResize=null,this.onDestroy=null,this.onStateSave=null,this.onStateRestore=null,this.onFocus=null,this.onBlur=null,this.onReorderRow=null,this.onSearchSave=null,this.onSearchRemove=null,this.onSearchSelect=null,this.onColumnSelect=null,this.onColumnDragStart=null,this.onColumnDragEnd=null,this.onResizerDblClick=null,this.onMouseEnter=null,this.onMouseLeave=null,a.extend(this,e),Array.isArray(this.records)){let e=[];this.records.forEach(((t,A)=>{null!=t[this.recid]&&(t.recid=t[this.recid]),null==t.recid&&console.log("ERROR: Cannot add records without recid. (obj: "+this.name+")"),!0===t.w2ui?.summary&&(this.summary.push(t),e.push(A))})),e.sort();for(let t=e.length-1;0<=t;t--)this.records.splice(e[t],1)}Array.isArray(this.columns)&&this.columns.forEach(((e,t)=>{if(e=a.extend({},this.colTemplate,e),null!=(t=(this.columns[t]=e).searchable)&&!1!==t&&null==this.getSearch(e.field))if(a.isPlainObject(t))this.addSearch(a.extend({field:e.field,label:e.text,type:"text"},t));else{let t=e.searchable,A="";!0===e.searchable&&(t="text",A='size="20"'),this.addSearch({field:e.field,label:e.text,type:t,attr:A})}})),Array.isArray(this.defaultSearches)&&this.defaultSearches.forEach(((e,t)=>{e.id="default-"+t,e.icon??="w2ui-icon-search"})),e=this.cache("searches"),Array.isArray(e)&&e.forEach((e=>{this.savedSearches.push({id:e.id??"none",text:e.text??"none",icon:"w2ui-icon-search",remove:!0,logic:e.logic??"AND",data:e.data??[]})})),this.initToolbar(),"string"==typeof this.box&&(this.box=o(this.box).get(0)),this.box&&this.render(this.box)}add(e,t){Array.isArray(e)||(e=[e]);let A=0;for(let s=0;s<e.length;s++){var i=e[s];null!=i[this.recid]&&(i.recid=i[this.recid]),null==i.recid?console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")"):(!0===i.w2ui?.summary?t?this.summary.unshift(i):this.summary.push(i):t?this.records.unshift(i):this.records.push(i),A++)}var s,n;return(this.url?.get??this.url)||(this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),n=(s=this.records.length-e.length)+e.length,this.last.vscroll.recIndStart<=n&&this.last.vscroll.recIndEnd>=s)?this.refresh():o(this.box).find("#grid_"+this.name+"_footer .w2ui-footer-right .w2ui-total").html(a.formatNumber(this.total)),A}find(e,t,A){var i,s=[];let n=!1;for(i in e=null==e?{}:e)-1!=String(i).indexOf(".")&&(n=!0);var r=A?this.last.vscroll.recIndStart:0;let o=A?this.last.vscroll.recIndEnd+1:this.records.length;o>this.records.length&&(o=this.records.length);for(let A=r;A<o;A++){let i=!0;for(var l in e){let t=this.records[A][l];n&&-1!=String(l).indexOf(".")&&(t=this.parseField(this.records[A],l)),"not-null"==e[l]?null!=t&&""!==t||(i=!1):e[l]!=t&&(i=!1)}i&&!0!==t&&s.push(this.records[A].recid),i&&!0===t&&s.push(A)}return s}set(e,t,A){if("object"==typeof e&&null!==e&&(A=t,t=e,e=null),null==e){for(let e=0;e<this.records.length;e++)a.extend(this.records[e],t);!0!==A&&this.refresh()}else{var i=this.get(e,!0);if(null==i)return!1;this.records[i]?.recid!=e?a.extend(this.summary[i],t):a.extend(this.records[i],t),!0!==A&&this.refreshRow(e,i)}return!0}replace(e,t,A){var i=this.get(e,!0);return null!=i&&(this.records[i]?.recid!=e?this.summary[i]=t:this.records[i]=t,!0!==A&&this.refreshRow(e,i),!0)}get(e,t){if(Array.isArray(e)){var A=[];for(let s=0;s<e.length;s++){var i=this.get(e[s],t);null!==i&&A.push(i)}return A}{let A=this.last.idCache;A||(this.last.idCache=A={});var s=A[e];if("number"==typeof s){if(0<=s&&s<this.records.length&&this.records[s].recid==e)return!0===t?s:this.records[s];if(0<=(s=~s)&&s<this.summary.length&&this.summary[s].recid==e)return!0===t?s:this.summary[s];this.last.idCache=A={}}for(let i=0;i<this.records.length;i++)if(this.records[i].recid==e)return A[e]=i,!0===t?i:this.records[i];for(let i=0;i<this.summary.length;i++)if(this.summary[i].recid==e)return A[e]=~i,!0===t?i:this.summary[i];return null}}getFirst(e){if(0==this.records.length)return null;let t=this.records[0];var A=this.last.searchIds;return 0<this.searchData.length?Array.isArray(A)&&0<A.length?this.records[A[e||0]]:null:t}remove(){let e=0;for(let t=0;t<arguments.length;t++){for(let A=this.records.length-1;0<=A;A--)this.records[A].recid==arguments[t]&&(this.records.splice(A,1),e++);for(let A=this.summary.length-1;0<=A;A--)this.summary[A].recid==arguments[t]&&(this.summary.splice(A,1),e++)}return(this.url?.get??this.url)||(this.localSort(!1,!0),this.localSearch(),this.total=this.records.length),this.refresh(),e}addColumn(e,t){let A=0;1==arguments.length?(t=e,e=this.columns.length):null==(e="string"==typeof e?this.getColumn(e,!0):e)&&(e=this.columns.length),Array.isArray(t)||(t=[t]);for(let s=0;s<t.length;s++){var i=a.extend({},this.colTemplate,t[s]);if(this.columns.splice(e,0,i),t[s].searchable){let e=t[s].searchable,A="";!0===t[s].searchable&&(e="text",A='size="20"'),this.addSearch({field:t[s].field,label:t[s].text,type:e,attr:A})}e++,A++}return this.refresh(),A}removeColumn(){let e=0;for(let t=0;t<arguments.length;t++)for(let A=this.columns.length-1;0<=A;A--)this.columns[A].field==arguments[t]&&(this.columns[A].searchable&&this.removeSearch(arguments[t]),this.columns.splice(A,1),e++);return this.refresh(),e}getColumn(e,t){if(0===arguments.length){var A=[];for(let e=0;e<this.columns.length;e++)A.push(this.columns[e].field);return A}for(let A=0;A<this.columns.length;A++)if(this.columns[A].field==e)return!0===t?A:this.columns[A];return null}updateColumn(e,t){let A=0;return(e=Array.isArray(e)?e:[e]).forEach((e=>{this.columns.forEach((i=>{if(i.field==e){let e=a.clone(t);Object.keys(e).forEach((t=>{"function"==typeof e[t]&&(e[t]=e[t](i)),i[t]!=e[t]&&A++})),a.extend(i,e)}}))})),0<A&&this.refresh(),A}toggleColumn(){return this.updateColumn(Array.from(arguments),{hidden:e=>!e.hidden})}showColumn(){return this.updateColumn(Array.from(arguments),{hidden:!1})}hideColumn(){return this.updateColumn(Array.from(arguments),{hidden:!0})}addSearch(e,t){let A=0;1==arguments.length?(t=e,e=this.searches.length):null==(e="string"==typeof e?this.getSearch(e,!0):e)&&(e=this.searches.length),Array.isArray(t)||(t=[t]);for(let i=0;i<t.length;i++)this.searches.splice(e,0,t[i]),e++,A++;return this.searchClose(),A}removeSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let A=this.searches.length-1;0<=A;A--)this.searches[A].field==arguments[t]&&(this.searches.splice(A,1),e++);return this.searchClose(),e}getSearch(e,t){if(0===arguments.length){var A=[];for(let e=0;e<this.searches.length;e++)A.push(this.searches[e].field);return A}for(let A=0;A<this.searches.length;A++)if(this.searches[A].field==e)return!0===t?A:this.searches[A];return null}toggleSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let A=this.searches.length-1;0<=A;A--)this.searches[A].field==arguments[t]&&(this.searches[A].hidden=!this.searches[A].hidden,e++);return this.searchClose(),e}showSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let A=this.searches.length-1;0<=A;A--)this.searches[A].field==arguments[t]&&!1!==this.searches[A].hidden&&(this.searches[A].hidden=!1,e++);return this.searchClose(),e}hideSearch(){let e=0;for(let t=0;t<arguments.length;t++)for(let A=this.searches.length-1;0<=A;A--)this.searches[A].field==arguments[t]&&!0!==this.searches[A].hidden&&(this.searches[A].hidden=!0,e++);return this.searchClose(),e}getSearchData(e){for(let t=0;t<this.searchData.length;t++)if(this.searchData[t].field==e)return this.searchData[t];return null}localSort(e,t){let A=this;if(this.url?.get??this.url)return console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty."),0;if(0===Object.keys(this.sortData).length){let e=this.last.originalSort;return e&&this.records.sort(((t,A)=>(t=e.indexOf(t.recid),e.indexOf(A.recid)<t?1:-1))),0}let i=Date.now();this.selectionSave(),this.prepareData(),t||this.reset();for(let e=0;e<this.sortData.length;e++){var s=this.getColumn(this.sortData[e].field);if(!s)return;"string"==typeof s.render&&(-1!=["date","age"].indexOf(s.render.split(":")[0])&&(this.sortData[e].field_=s.field+"_"),-1!=["time"].indexOf(s.render.split(":")[0]))&&(this.sortData[e].field_=s.field+"_")}for(let e=0;e<A.records.length;e++){var n=A.records[e];null!=n.w2ui?.parent_recid&&(n.w2ui._path=o(n))}this.records.sort(((e,t)=>{if(!(e.w2ui&&null!=e.w2ui.parent_recid||t.w2ui&&null!=t.w2ui.parent_recid))return l(e,t);var A=o(e),i=o(t);for(let e=0;e<Math.min(A.length,i.length);e++){var s=l(A[e],i[e]);if(0!==s)return s}return A.length>i.length?1:A.length<i.length?-1:(console.log("ERROR: two paths should not be equal."),0)}));for(let e=0;e<A.records.length;e++){var r=A.records[e];null!=r.w2ui?.parent_recid&&(r.w2ui._path=null)}return this.selectionRestore(t),i=Date.now()-i,!0!==e&&this.show.statusSort&&setTimeout((()=>{this.status(a.lang("Sorting took ${count} seconds",{count:i/1e3}))}),10),i;function o(e){var t;return e.w2ui&&null!=e.w2ui.parent_recid?e.w2ui._path||((t=A.get(e.w2ui.parent_recid))?o(t).concat(e):(console.log("ERROR: no parent record: "+e.w2ui.parent_recid),[e])):[e]}function l(e,t){if(e===t)return 0;for(let n=0;n<A.sortData.length;n++){var i=A.sortData[n].field,s=A.sortData[n].field_||i;let r=e[s],o=t[s];if(-1!=String(i).indexOf(".")&&(r=A.parseField(e,s),o=A.parseField(t,s)),(s=A.getColumn(i))&&0<Object.keys(s.editable).length&&(a.isPlainObject(r)&&r.text&&(r=r.text),a.isPlainObject(o))&&o.text&&(o=o.text),0!==(i=d(r,o,0,A.sortData[n].direction,s.sortMode||"default")))return i}return d(e.recid,t.recid,0,"asc")}function d(e,t,A,i,s){if(e===t)return 0;if((null==e||""===e)&&null!=t&&""!==t)return 1;if(null!=e&&""!==e&&(null==t||""===t))return-1;if(i="asc"===i.toLowerCase()?1:-1,typeof e!=typeof t)return typeof t<typeof e?i:-i;if(e.constructor.name!=t.constructor.name)return e.constructor.name>t.constructor.name?i:-i;e&&"object"==typeof e&&(e=e.valueOf()),t&&"object"==typeof t&&(t=t.valueOf());var n={}.toString;switch(e&&"object"==typeof e&&e.toString!=n&&(e=String(e)),t&&"object"==typeof t&&t.toString!=n&&(t=String(t)),"string"==typeof e&&(e=e.toLowerCase().trim()),"string"==typeof t&&(t=t.toLowerCase().trim()),s){case"natural":s=a.naturalCompare;break;case"i18n":s=a.i18nCompare}return"function"==typeof s?s(e,t)*i:t<e?i:e<t?-i:0}}localSearch(e){let t=this;var A=this.url?.get??this.url;if(!A){let s=Date.now(),n={}.toString,r={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),0<this.searchData.length&&!A){for(let e=this.total=0;e<this.records.length;e++){var i=this.records[e];if(function e(A){let i,s,r,o,l=0,d=!1;for(let e=0;e<t.searchData.length;e++){let c=t.searchData[e],h=t.getSearch(c.field);if(null!=c){null==h&&(h={field:c.field,type:c.type});let e=t.parseField(A,h.field);switch(i=null==e||"object"==typeof e&&e.toString==n?"":String(e).toLowerCase(),null!=c.value&&(Array.isArray(c.value)?(s=c.value[0],r=c.value[1]):s=String(c.value).toLowerCase()),c.operator){case"=":case"is":t.parseField(A,h.field)==c.value?l++:"date"==h.type?(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.formatDate(o,"yyyy-mm-dd"),s=a.formatDate(a.isDate(s,a.settings.dateFormat,!0),"yyyy-mm-dd"),i==s&&l++):"time"==h.type?(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.formatTime(o,"hh24:mi"),s=a.formatTime(s,"hh24:mi"),i==s&&l++):"datetime"==h.type&&(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.formatDateTime(o,"yyyy-mm-dd|hh24:mm:ss"),s=a.formatDateTime(a.isDateTime(s,a.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),i==s)&&l++;break;case"between":-1!=["int","float","money","currency","percent"].indexOf(h.type)?parseFloat(t.parseField(A,h.field))>=parseFloat(s)&&parseFloat(t.parseField(A,h.field))<=parseFloat(r)&&l++:"date"==h.type?(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.isDate(o,a.settings.dateFormat,!0),s=a.isDate(s,a.settings.dateFormat,!0),null!=(r=a.isDate(r,a.settings.dateFormat,!0))&&(r=new Date(r.getTime()+864e5)),i>=s&&i<r&&l++):"time"==h.type?(i=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),s=a.isTime(s,!0),r=a.isTime(r,!0),s=(new Date).setHours(s.hours,s.minutes,s.seconds||0,0),r=(new Date).setHours(r.hours,r.minutes,r.seconds||0,0),i>=s&&i<r&&l++):"datetime"==h.type&&(i=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),s=a.isDateTime(s,a.settings.datetimeFormat,!0),r=(r=a.isDateTime(r,a.settings.datetimeFormat,!0))&&new Date(r.getTime()+864e5),i>=s)&&i<r&&l++;break;case"<=":d=!0;case"<":case"less":-1!=["int","float","money","currency","percent"].indexOf(h.type)?(i=parseFloat(t.parseField(A,h.field)),s=parseFloat(c.value),(i<s||d&&i===s)&&l++):"date"==h.type?(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.isDate(o,a.settings.dateFormat,!0),s=a.isDate(s,a.settings.dateFormat,!0),(i<s||d&&i===s)&&l++):"time"==h.type?(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.formatTime(o,"hh24:mi"),s=a.formatTime(s,"hh24:mi"),(i<s||d&&i===s)&&l++):"datetime"==h.type&&(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.formatDateTime(o,"yyyy-mm-dd|hh24:mm:ss"),s=a.formatDateTime(a.isDateTime(s,a.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),i.length==s.length)&&(i<s||d&&i===s)&&l++;break;case">=":d=!0;case">":case"more":-1!=["int","float","money","currency","percent"].indexOf(h.type)?(i=parseFloat(t.parseField(A,h.field)),s=parseFloat(c.value),(i>s||d&&i===s)&&l++):"date"==h.type?(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.isDate(o,a.settings.dateFormat,!0),s=a.isDate(s,a.settings.dateFormat,!0),(i>s||d&&i===s)&&l++):"time"==h.type?(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.formatTime(o,"hh24:mi"),s=a.formatTime(s,"hh24:mi"),(i>s||d&&i===s)&&l++):"datetime"==h.type&&(o=t.parseField(A,h.field+"_")instanceof Date?t.parseField(A,h.field+"_"):t.parseField(A,h.field),i=a.formatDateTime(o,"yyyy-mm-dd|hh24:mm:ss"),s=a.formatDateTime(a.isDateTime(s,a.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),i.length==s.length)&&(i>s||d&&i===s)&&l++;break;case"in":o=c.value,(-1!==(o=c.svalue?c.svalue:o).indexOf(a.isFloat(e)?parseFloat(e):e)||-1!==o.indexOf(i)&&""!==i)&&l++;break;case"not in":o=c.value,-1!==(o=c.svalue?c.svalue:o).indexOf(a.isFloat(e)?parseFloat(e):e)||-1!==o.indexOf(i)&&""!==i||l++;break;case"begins":case"begins with":0===i.indexOf(s)&&l++;break;case"contains":0<=i.indexOf(s)&&l++;break;case"null":null==t.parseField(A,h.field)&&l++;break;case"not null":null!=t.parseField(A,h.field)&&l++;break;case"ends":case"ends with":let n=i.lastIndexOf(s);-1!==n&&n==i.length-s.length&&l++}}}if("OR"==t.last.logic&&0!==l||"AND"==t.last.logic&&l==t.searchData.length)return!0;if(A.w2ui?.children&&!0!==A.w2ui?.expanded)for(let t=0;t<A.w2ui.children.length;t++)if(e(A.w2ui.children[t]))return!0;return!1}(i))if(i?.w2ui&&function e(A){let i=t.get(A,!0);if(null==i||null==A||r[A]||t.last.searchIds.includes(i))return;r[A]=!0;let s=t.records[i];s?.w2ui&&e(s.w2ui.parent_recid),t.last.searchIds.push(i)}(i.w2ui.parent_recid),0<this.showExtraOnSearch){let t=this.showExtraOnSearch,A=this.showExtraOnSearch;if(e<t&&(t=e),e+A>this.records.length&&(A=this.records.length-e),0<t)for(let A=e-t;A<e;A++)this.last.searchIds.indexOf(A)<0&&this.last.searchIds.push(A);if(this.last.searchIds.indexOf(e)<0&&this.last.searchIds.push(e),0<A)for(let t=e+1;t<=e+A;t++)this.last.searchIds.indexOf(t)<0&&this.last.searchIds.push(t)}else this.last.searchIds.push(e)}this.total=this.last.searchIds.length}return s=Date.now()-s,!0!==e&&this.show.statusSearch&&setTimeout((()=>{this.status(a.lang("Search took ${count} seconds",{count:s/1e3}))}),10),s}console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.")}getRangeData(e,t){var A=this.get(e[0].recid,!0),i=this.get(e[1].recid,!0),s=e[0].column,n=e[1].column,r=[];if(s==n)for(let e=A;e<=i;e++){var o=this.records[e],l=o[this.columns[s].field]||null;r.push(!0!==t?l:{data:l,column:s,index:e,record:o})}else if(A==i){var a=this.records[A];for(let e=s;e<=n;e++){var d=a[this.columns[e].field]||null;r.push(!0!==t?d:{data:d,column:e,index:A,record:a})}}else for(let e=A;e<=i;e++){var c=this.records[e];r.push([]);for(let A=s;A<=n;A++){var h=c[this.columns[A].field];!0!==t?r[r.length-1].push(h):r[r.length-1].push({data:h,column:A,index:e,record:c})}}return r}addRange(e){let t,A,i=0;if("row"!=this.selectType){Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++){if("object"!=typeof e[n]&&(e[n]={name:"selection"}),"selection"==e[n].name){if(!1===this.show.selectionBorder)continue;var s=this.getSelection();if(0===s.length){this.removeRange("selection");continue}t=s[0],A=s[s.length-1]}else t=e[n].range[0],A=e[n].range[1];if(t){s={name:e[n].name,range:[{recid:t.recid,column:t.column},{recid:A.recid,column:A.column}],style:e[n].style||"",class:e[n].class};let r=!1;for(let t=0;t<this.ranges.length;t++)if(this.ranges[t].name==e[n].name){r=t;break}!1!==r?this.ranges[r]=s:this.ranges.push(s),i++}}this.refreshRanges()}return i}removeRange(){let e=0;for(let A=0;A<arguments.length;A++){var t=arguments[A];o(this.box).find("#grid_"+this.name+"_"+t).remove(),o(this.box).find("#grid_"+this.name+"_f"+t).remove();for(let A=this.ranges.length-1;0<=A;A--)this.ranges[A].name==t&&(this.ranges.splice(A,1),e++)}return e}refreshRanges(){if(0!==this.ranges.length){let u,p=this;var e=Date.now(),t=o(this.box).find(`#grid_${this.name}_frecords`),A=o(this.box).find(`#grid_${this.name}_records`);for(let y=0;y<this.ranges.length;y++){var i=this.ranges[y],s=i.range[0],n=i.range[1];null==s.index&&(s.index=this.get(s.recid,!0)),null==n.index&&(n.index=this.get(n.recid,!0));let b=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(s.recid)+' td[col="'+s.column+'"]'),v=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(n.recid)+' td[col="'+n.column+'"]'),C=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(s.recid)+' td[col="'+s.column+'"]'),x=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(n.recid)+' td[col="'+n.column+'"]'),Q=n.column;s.column<this.last.vscroll.colIndStart&&n.column>this.last.vscroll.colIndStart&&(b=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(s.recid)+' td[col="start"]')),s.column<this.last.vscroll.colIndEnd&&n.column>this.last.vscroll.colIndEnd&&(v=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(n.recid)+' td[col="end"]'),Q='"end"');var r,l=parseInt(o(this.box).find("#grid_"+this.name+"_rec_top").next().attr("index")),d=parseInt(o(this.box).find("#grid_"+this.name+"_rec_bottom").prev().attr("index")),c=parseInt(o(this.box).find("#grid_"+this.name+"_frec_top").next().attr("index")),h=parseInt(o(this.box).find("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===b.length&&s.index<l&&n.index>l&&(b=o(this.box).find("#grid_"+this.name+"_rec_top").next().find('td[col="'+s.column+'"]')),0===v.length&&n.index>d&&s.index<d&&(v=o(this.box).find("#grid_"+this.name+"_rec_bottom").prev().find('td[col="'+Q+'"]')),0===C.length&&s.index<c&&n.index>c&&(C=o(this.box).find("#grid_"+this.name+"_frec_top").next().find('td[col="'+s.column+'"]')),0===x.length&&n.index>h&&s.index<h&&(x=o(this.box).find("#grid_"+this.name+"_frec_bottom").prev().find('td[col="'+n.column+'"]')),d=(l=o(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input")).attr("index"),c=this.records[d]?.recid,h=l.attr("column"),"selection"==i.name&&i.range[0].recid==c&&i.range[0].column==h||(u=o(this.box).find("#grid_"+this.name+"_f"+i.name),(0<C.length||0<x.length)&&(0===u.length?(t.append('<div id="grid_'+this.name+"_f"+i.name+'" class="w2ui-selection" style="'+i.style+'">'+("selection"==i.name&&this.show.selectionResizer?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),u=o(this.box).find("#grid_"+this.name+"_f"+i.name)):(u.attr("style",i.style),u.find(".w2ui-selection-resizer").show()),0===x.length&&(0===(x=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(n.recid)+" td:last-child")).length&&(x=o(this.box).find("#grid_"+this.name+"_frec_bottom td:first-child")),u.css("border-right","0px"),u.find(".w2ui-selection-resizer").hide()),null!=s.recid)&&null!=n.recid&&0<C.length&&0<x.length?(d=getComputedStyle(x[0]),l=C.prop("offsetTop")-C.prop("scrollTop"),c=C.prop("offsetLeft")+C.prop("scrollLeft"),h=x.prop("offsetTop")-x.prop("scrollTop"),r=x.prop("offsetLeft")+x.prop("scrollLeft"),u.show().css({top:(0<l?l:0)+"px",left:(0<c?c:0)+"px",width:r-c+parseFloat(d.width)-1+"px",height:h-l+parseFloat(d.height)-1+"px"})):u.hide(),u=o(this.box).find("#grid_"+this.name+"_"+i.name),(0<b.length||0<v.length)&&(0===u.length?(A.append(`\n                        <div id="grid_${this.name}_${i.name}" class="w2ui-selection ${i.class??""}" style="${i.style}">\n                            ${"selection"==i.name&&this.show.selectionResizer?`<div id="grid_${this.name}_resizer" class="w2ui-selection-resizer"></div>`:""}\n                        </div>\n                    `),u=o(this.box).find("#grid_"+this.name+"_"+i.name)):u.attr("style",i.style),0===b.length&&0===(b=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(s.recid)+" td:first-child")).length&&(b=o(this.box).find("#grid_"+this.name+"_rec_top td:first-child")),0!==x.length&&u.css("border-left","0px"),null!=s.recid)&&null!=n.recid&&0<b.length&&0<v.length?(r=getComputedStyle(v[0]),c=b.prop("offsetTop")-b.prop("scrollTop"),h=b.prop("offsetLeft")+b.prop("scrollLeft"),l=v.prop("offsetTop")-v.prop("scrollTop"),d=v.prop("offsetLeft")+v.prop("scrollLeft"),u.show().css({top:(0<c?c:0)+"px",left:(0<h?h:0)+"px",width:d-h+parseFloat(r.width)-1+"px",height:l-c+parseFloat(r.height)-1+"px"})):u.hide())}o(this.box).find(".w2ui-selection-resizer").off(".resizer").on("mousedown.resizer",(function(e){var t=(A=p.getSelection())[0],A=A[A.length-1];p.last.move={type:"expand",x:e.screenX,y:e.screenY,divX:0,divY:0,index:t.index,recid:t.recid,column:t.column,name:f[t.column]+(t.index+1)+":"+f[A.column]+(A.index+1),originalRange:[a.clone(t),a.clone(A)],newRange:[a.clone(t),a.clone(A)]},m.originalName=p.last.move.name,m.originalRange=p.last.move.originalRange,o("body").off(".w2ui-"+p.name).on("mousemove.w2ui-"+p.name,w).on("mouseup.w2ui-"+p.name,B),e.preventDefault()})).on("dblclick.resizer",(e=>{!0!==(e=this.trigger("resizerDblClick",{target:this.name,originalEvent:e})).isCancelled&&e.finish()}));let g,m={target:this.name,originalRange:null,newRange:null},f="abcdefghijklmnopqrstuvwxyz";return Date.now()-e;function w(e){var t=p.last.move;if(t&&"expand"==t.type){t.divX=e.screenX-t.x,t.divY=e.screenY-t.y;let A,i,s,n=e.target;"TD"!=n.tagName.toUpperCase()&&(n=o(n).closest("td")[0]),null!=(s=null!=o(n).attr("col")?parseInt(o(n).attr("col")):s)&&(n=o(n).closest("tr")[0],i=parseInt(o(n).attr("index")),A=p.records[i]?.recid,t.newRange[1].recid!=A||t.newRange[1].column!=s)&&(e=a.clone(t.newRange),t.newRange=[{recid:t.recid,index:t.index,column:t.column},{recid:A,index:i,column:s}],m.newName=f[t.column]+(t.index+1)+":"+f[s]+(i+1),m.newRange=a.clone(t.newRange),!0===(g=p.trigger("selectionExtend",m)).isCancelled?(t.newRange=e,m.newRange=e):p.addRange({name:"selection-expand",range:t.newRange,class:"w2ui-selection-expand"}))}}function B(e){p.removeRange("selection-expand"),o("body").off(".w2ui-"+p.name),"expand"==p.last.move?.type&&g.finish&&g.finish(),delete p.last.move}}}select(){if(0===arguments.length)return 0;let e=0;var t=this.last.selection;this.multiSelect||this.selectNone(!0);let A=Array.from(arguments);Array.isArray(A[0])&&(A=A[0]);var i={target:this.name};if(1==A.length?(i.multiple=!1,a.isPlainObject(A[0])?i.clicked={recid:A[0].recid,column:A[0].column}:i.recid=A[0]):(i.multiple=!0,i.clicked={recids:A}),0!=this.compareSelection(A).select.length){if(!0===(i=this.trigger("select",i)).isCancelled)return 0;if("row"==this.selectType)for(let i=0;i<A.length;i++){var s="object"==typeof A[i]?A[i].recid:A[i],n=this.get(s,!0);if(null!=n){let A=null,i=null;(0!==this.searchData.length||n+1>=this.last.vscroll.recIndStart&&n+1<=this.last.vscroll.recIndEnd)&&(A=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(s)),i=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(s))),"row"==this.selectType&&-1==t.indexes.indexOf(n)&&(t.indexes.push(n),A&&i&&(A.addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected"),i.addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected"),A.find(".w2ui-grid-select-check").prop("checked",!0)),e++)}}else{var r={};for(let e=0;e<A.length;e++){var l="object"==typeof A[e]?A[e].recid:A[e],d="object"==typeof A[e]?A[e].column:null;if(r[l]=r[l]||[],Array.isArray(d))r[l]=d;else if(a.isInt(d))r[l].push(d);else for(let e=0;e<this.columns.length;e++)this.columns[e].hidden||r[l].push(parseInt(e))}var c,h=[];for(c in r){var u=this.get(c,!0);if(null!=u){let A=null,i=null;u+1>=this.last.vscroll.recIndStart&&u+1<=this.last.vscroll.recIndEnd&&(A=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(c)),i=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(c)));var p=t.columns[u]||[];-1==t.indexes.indexOf(u)&&t.indexes.push(u);for(let e=0;e<r[c].length;e++)-1==p.indexOf(r[c][e])&&p.push(r[c][e]);p.sort(((e,t)=>e-t));for(let t=0;t<r[c].length;t++){var g=r[c][t];-1==h.indexOf(g)&&h.push(g),A&&(A.find("#grid_"+this.name+"_data_"+u+"_"+g).addClass("w2ui-selected"),A.find(".w2ui-col-number").addClass("w2ui-row-selected"),A.find(".w2ui-grid-select-check").prop("checked",!0)),i&&(i.find("#grid_"+this.name+"_data_"+u+"_"+g).addClass("w2ui-selected"),i.find(".w2ui-col-number").addClass("w2ui-row-selected"),i.find(".w2ui-grid-select-check").prop("checked",!0)),e++}t.columns[u]=p}}for(let e=0;e<h.length;e++)o(this.box).find("#grid_"+this.name+"_column_"+h[e]+" .w2ui-col-header").addClass("w2ui-col-selected")}t.indexes.sort(((e,t)=>e-t));var m=0<this.records.length&&t.indexes.length==this.records.length,f=0<t.indexes.length&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return m||f?o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0):o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,m),i.finish(),e}}unselect(){let e=0;var t=this.last.selection;let A=Array.from(arguments);Array.isArray(A[0])&&(A=A[0]);var i={target:this.name};if(1==A.length?(i.multiple=!1,a.isPlainObject(A[0])?i.clicked={recid:A[0].recid,column:A[0].column}:i.clicked={recid:A[0]}):(i.multiple=!0,i.recids=A),0!=this.compareSelection(A).unselect.length){if(!0===(i=this.trigger("select",i)).isCancelled)return 0;for(let i=0;i<A.length;i++){var s="object"==typeof A[i]?A[i].recid:A[i];if(null!=(n=this.get(s))){var n=this.get(n.recid,!0),r=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(s)),l=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(s));if("row"==this.selectType)-1!=t.indexes.indexOf(n)&&(t.indexes.splice(t.indexes.indexOf(n),1),r.removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected"),l.removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=r.length&&(r[0].style.cssText="height: "+this.recordHeight+"px; "+r.attr("custom_style"),l[0].style.cssText="height: "+this.recordHeight+"px; "+l.attr("custom_style")),r.find(".w2ui-grid-select-check").prop("checked",!1),e++);else{var d=A[i].column;if(!a.isInt(d)){var c=[];for(let e=0;e<this.columns.length;e++)this.columns[e].hidden||c.push({recid:s,column:e});return this.unselect(c)}if(l=t.columns[n],Array.isArray(l)&&-1!=l.indexOf(d)){l.splice(l.indexOf(d),1),o(this.box).find(`#grid_${this.name}_rec_${a.escapeId(s)} > td[col="${d}"]`).removeClass("w2ui-selected w2ui-inactive"),o(this.box).find(`#grid_${this.name}_frec_${a.escapeId(s)} > td[col="${d}"]`).removeClass("w2ui-selected w2ui-inactive");let A=!1,i=!1;var h=this.getSelection();for(let e=0;e<h.length;e++)h[e].column==d&&(A=!0),h[e].recid==s&&(i=!0);A||o(this.box).find(`.w2ui-grid-columns td[col="${d}"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="${d}"] .w2ui-col-header`).removeClass("w2ui-col-selected"),i||o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(s)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),e++,0===l.length&&(delete t.columns[n],t.indexes.splice(t.indexes.indexOf(n),1),r.find(".w2ui-grid-select-check").prop("checked",!1))}}}}var u=0<this.records.length&&t.indexes.length==this.records.length,p=0<t.indexes.length&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return u||p?o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0):o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,u),i.finish(),e}}compareSelection(e){var t=this.getSelection(),A=[],i=[];if("row"==this.selectType){e.forEach(((t,A)=>{"object"==typeof t&&(e[A]=t.recid)}));for(let i=0;i<e.length;i++)t.includes(e[i])||A.push(e[i]);for(let A=0;A<e.length;A++)t.includes(e[A])&&i.push(e[A])}else{for(let i=0;i<e.length;i++){let s=!1;for(let A=0;A<t.length;A++)e[i].recid==t[A].recid&&e[i].column==t[A].column&&(s=!0);s||A.push({recid:e[i].recid,column:e[i].column})}for(let A=0;A<t.length;A++){let s=!1;for(let i=0;i<e.length;i++)e[i].recid==t[A].recid&&e[i].column==t[A].column&&(s=!0);s||i.push({recid:t[A].recid,column:t[A].column})}}return{select:A,unselect:i}}selectAll(){var e=Date.now();if(!1!==this.multiSelect){var t=this.url?.get??this.url;let i=a.clone(this.last.selection);var A=[];for(let e=0;e<this.columns.length;e++)A.push(e);if(i.indexes=[],t||0===this.searchData.length){let e=this.records.length;0==this.searchData.length||t||(e=this.last.searchIds.length);for(let t=0;t<e;t++)i.indexes.push(t),"row"!=this.selectType&&(i.columns[t]=A.slice())}else for(let e=0;e<this.last.searchIds.length;e++)i.indexes.push(this.last.searchIds[e]),"row"!=this.selectType&&(i.columns[this.last.searchIds[e]]=A.slice());if(!0!==(t=this.trigger("select",{target:this.name,multiple:!0,all:!0,clicked:i})).isCancelled)return this.last.selection=i,"row"==this.selectType?(o(this.box).find(".w2ui-grid-records tr:not(.w2ui-empty-record)").addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected"),o(this.box).find(".w2ui-grid-frecords tr:not(.w2ui-empty-record)").addClass("w2ui-selected").find(".w2ui-col-number").addClass("w2ui-row-selected")):(o(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),o(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),o(this.box).find(".w2ui-grid-records tr:not(.w2ui-empty-record)").find(".w2ui-grid-data:not(.w2ui-col-select)").addClass("w2ui-selected"),o(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),o(this.box).find(".w2ui-grid-frecords tr:not(.w2ui-empty-record)").find(".w2ui-grid-data:not(.w2ui-col-select)").addClass("w2ui-selected")),o(this.box).find("input.w2ui-grid-select-check").prop("checked",!0),i=this.getSelection(!0),this.addRange("selection"),o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0),this.status(),this.updateToolbar({indexes:i},!0),t.finish(),Date.now()-e}}selectNone(e){var t,A=Date.now();let i;if(e||!0!==(i=this.trigger("select",{target:this.name,clicked:[]})).isCancelled)return t=this.last.selection,"row"==this.selectType?(o(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected"),o(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").find(".w2ui-col-number").removeClass("w2ui-row-selected")):(o(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),o(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),o(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),o(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive")),o(this.box).find("input.w2ui-grid-select-check").prop("checked",!1),t.indexes=[],t.columns={},this.removeRange("selection"),o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.updateToolbar(t,!1),e||i.finish(),Date.now()-A}updateToolbar(e){let t=this,A=e&&e.indexes?e.indexes.length:0;function i(i,s){if(null!=i.batch){let n=!1;!0===i.batch?0<A&&(n=!0):"number"==typeof i.batch?A===i.batch&&(n=!0):"function"==typeof i.batch&&(n=i.batch({cnt:A,sel:e})),n?t.toolbar.enable(s+i.id):t.toolbar.disable(s+i.id)}}this.toolbar.render&&(this.toolbar.items.forEach((e=>{i(e,""),Array.isArray(e.items)&&e.items.forEach((t=>{i(t,e.id+":")}))})),this.show.toolbarSave)&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"))}getSelection(e){var t=[],A=this.last.selection;if("row"==this.selectType)for(let i=0;i<A.indexes.length;i++)this.records[A.indexes[i]]&&t.push(!0===e?A.indexes[i]:this.records[A.indexes[i]].recid);else for(let e=0;e<A.indexes.length;e++){var i=A.columns[A.indexes[e]];if(this.records[A.indexes[e]])for(let s=0;s<i.length;s++)t.push({recid:this.records[A.indexes[e]].recid,index:parseInt(A.indexes[e]),column:i[s]})}return t}search(e,t){var A=this.url?.get??this.url,i=[];let s=this.last.multi,n=this.last.logic,r=this.last.field,l=this.last.search,d=!1;var c=o(`#w2overlay-${this.name}-search-overlay`);""===t&&(t=null);for(let e=0;e<this.searches.length;e++)this.searches[e].hidden&&null!=this.searches[e].value&&(i.push({field:this.searches[e].field,operator:this.searches[e].operator||"is",type:this.searches[e].type,value:this.searches[e].value||""}),d=!0);if(0===arguments.length&&0===c.length&&(t=this.multiSearch?(e=this.searchData,this.last.logic):(e=this.last.field,this.last.search)),0===arguments.length&&0!==c.length){this.focus(),n=c.find(`#grid_${this.name}_logic`).val(),l="";for(let e=0;e<this.searches.length;e++){var h=this.searches[e],u=c.find("#grid_"+this.name+"_operator_"+e).val(),p=c.find("#grid_"+this.name+"_field_"+e),g=c.find("#grid_"+this.name+"_field2_"+e);let t=p.val(),n=g.val(),r=null,o=null;if(-1!=["int","float","money","currency","percent"].indexOf(h.type)&&(m=p[0]._w2field,g=g[0]._w2field,m&&(t=m.clean(t)),g)&&(n=g.clean(n)),-1!=["list","enum"].indexOf(h.type)||-1!=["in","not in"].indexOf(u))if(t=p[0]._w2field.selected||{},Array.isArray(t)){r=[];for(let e=0;e<t.length;e++)r.push(a.isFloat(t[e].id)?parseFloat(t[e].id):String(t[e].id).toLowerCase()),delete t[e].hidden;0===Object.keys(t).length&&(t="")}else o=t.text||"",t=t.id||"";if(""!==t&&null!=t||null!=n&&""!==n){var m={field:h.field,type:h.type,operator:u};"between"==u?a.extend(m,{value:[t,n]}):"in"==u&&"string"==typeof t||"not in"==u&&"string"==typeof t?a.extend(m,{value:t.split(",")}):a.extend(m,{value:t}),r&&a.extend(m,{svalue:r}),o&&a.extend(m,{text:o});try{"date"==h.type&&"between"==u&&(m.value[0]=t,m.value[1]=n),"date"==h.type&&"is"==u&&(m.value=t)}catch(A){}i.push(m),s=!0}}}if("string"==typeof e&&(1==arguments.length&&(t=e,e="all"),r=e,l=t,s=!1,n=d?"AND":"OR",null!=t))if("all"==e.toLowerCase()){if(0<this.searches.length)for(let e=0;e<this.searches.length;e++){var f,w=this.searches[e];if(("text"==w.type||"alphanumeric"==w.type&&a.isAlphaNumeric(t)||"int"==w.type&&a.isInt(t)||"float"==w.type&&a.isFloat(t)||"percent"==w.type&&a.isFloat(t)||("hex"==w.type||"color"==w.type)&&a.isHex(t)||"currency"==w.type&&a.isMoney(t)||"money"==w.type&&a.isMoney(t)||"date"==w.type&&a.isDate(t)||"time"==w.type&&a.isTime(t)||"datetime"==w.type&&a.isDateTime(t)||"datetime"==w.type&&a.isDate(t)||"enum"==w.type&&a.isAlphaNumeric(t)||"list"==w.type&&a.isAlphaNumeric(t))&&(f=this.defaultOperator[this.operatorsMap[w.type]],f={field:w.field,type:w.type,operator:null!=w.operator?w.operator:f,value:t},""!=String(t).trim())&&i.push(f),-1!=["int","float","money","currency","percent"].indexOf(w.type)&&2==String(t).trim().split("-").length&&(f=String(t).trim().split("-"),B={field:w.field,type:w.type,operator:null!=w.operator?w.operator:"between",value:[f[0],f[1]]},i.push(B)),-1!=["list","enum"].indexOf(w.type)){var B,y=[];null==w.options&&(w.options={}),Array.isArray(w.options.items)||(w.options.items=[]);for(let e=0;e<w.options.items;e++){var b=w.options.items[e];try{var v=new RegExp(t,"i");v.test(b)&&y.push(e),b.text&&v.test(b.text)&&y.push(b.id)}catch(A){}}0<y.length&&(B={field:w.field,type:w.type,operator:null!=w.operator?w.operator:"in",value:y},i.push(B))}}else for(let e=0;e<this.columns.length;e++){var C={field:this.columns[e].field,type:"text",operator:this.defaultOperator.text,value:t};i.push(C)}0==i.length&&(x={field:"All",type:"text",operator:this.defaultOperator.text,value:t},i.push(x))}else{var x=c.find("#grid_"+this.name+"_search_all");let A=this.getSearch(e);if((A=null==A?{field:e,type:"text"}:A).field==e&&(this.last.label=A.label),""!==t){let e=this.defaultOperator[this.operatorsMap[A.type]],s=t;if(-1!=["date","time","datetime"].indexOf(A.type)&&(e="is"),-1!=["list","enum"].indexOf(A.type)&&(e="is",s=(x=x._w2field.get())&&0<Object.keys(x).length?x.id:""),"int"==A.type&&""!==t&&(e="is",-1!=String(t).indexOf("-")&&2==(x=t.split("-")).length&&(e="between",s=[parseInt(x[0]),parseInt(x[1])]),-1!=String(t).indexOf(","))){var Q=t.split(",");e="in",s=[];for(let e=0;e<Q.length;e++)s.push(Q[e])}null!=A.operator&&(e=A.operator),x={field:A.field,type:A.type,operator:e,value:s},i.push(x)}}if(Array.isArray(e)){let A="AND";"string"==typeof t&&"OR"!=(A=t.toUpperCase())&&"AND"!=A&&(A="AND"),l="",s=!0,n=A;for(let t=0;t<e.length;t++){var F=e[t];"number"==typeof F.value&&null==F.operator&&(F.operator=this.defaultOperator.number),"string"==typeof F.value&&null==F.operator&&(F.operator=this.defaultOperator.text),Array.isArray(F.value)&&null==F.operator&&(F.operator=this.defaultOperator.enum),a.isDate(F.value)&&null==F.operator&&(F.operator=this.defaultOperator.date),i.push(F)}}!0!==(x=this.trigger("search",{target:this.name,multi:0===arguments.length,searchField:e||"multi",searchValue:e?t:"multi",searchData:i,searchLogic:n})).isCancelled&&(this.searchData=x.detail.searchData,this.last.field=r,this.last.search=l,this.last.multi=s,this.last.logic=x.detail.searchLogic,this.last.vscroll.scrollTop=0,this.last.vscroll.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),A?(this.last.fetch.offset=0,this.reload()):(this.localSearch(),this.refresh()),x.finish())}searchOpen(){if(this.box&&0!==this.searches.length){let e=this.trigger("searchOpen",{target:this.name});if(!0!==e.isCancelled){let t=o(this.toolbar.box).find(".w2ui-grid-search-input .w2ui-search-drop");t.addClass("checked"),g.show({name:this.name+"-search-overlay",anchor:o(this.box).find("#grid_"+this.name+"_search_all").get(0),position:"bottom|top",html:this.getSearchesHTML(),align:"left",arrowSize:12,class:"w2ui-grid-search-advanced",hideOn:["doc-click"]}).then((t=>{this.initSearches(),this.last.search_opened=!0;let A=o(`#w2overlay-${this.name}-search-overlay`);A.data("gridName",this.name).off(".grid-search").on("click.grid-search",(()=>{A.find("input, select").each((e=>{(e=o(e).data("tooltipName"))&&e.forEach((e=>{g.hide(e)}))}))})),a.bindEvents(A.find("select, input, button"),this);var i=o(`#w2overlay-${this.name}-search-overlay *[rel=search]`);0<i.length&&i[0].focus(),e.finish()})).hide((e=>{t.removeClass("checked"),this.last.search_opened=!1}))}}}searchClose(){g.hide(this.name+"-search-overlay")}searchFieldTooltip(e,t,A){e=this.searches[e];var i=this.searchData[t];let s=i.operator,n=("less"==(s="more"==s&&"date"==i.type?"since":s)&&"date"==i.type&&(s="before"),""),r=i.value;Array.isArray(i.value)?(i.value.forEach((e=>{n+=`<span class="value">${e.text||e}</span>`})),"date"==i.type&&(n="",i.value.forEach((e=>{n+=`<span class="value">${a.formatDate(e)}</span>`})))):"date"==i.type&&(r=a.formatDateTime(r)),g.hide(this.name+"-search-props"),g.show({name:this.name+"-search-props",anchor:A,class:"w2ui-white",hideOn:"doc-click",html:`\n                <div class="w2ui-grid-search-single">\n                    <span class="field">${e.label}</span>\n                    <span class="operator">${a.lang(s)}</span>\n                    ${Array.isArray(i.value)?""+n:`<span class="value">${r}</span>`}\n                    <div class="buttons">\n                        <button id="remove" class="w2ui-btn">${a.lang("Remove This Field")}</button>\n                    </div>\n                </div>`}).then((e=>{o(e.detail.overlay.box).find("#remove").on("click",(()=>{this.searchData.splice(""+t,1),this.reload(),this.localSearch(),g.hide(this.name+"-search-props")}))}))}searchSuggest(e,t,A){clearTimeout(this.last.kbd_timer),clearTimeout(this.last.overlay_timer),this.searchShowFields(!0),this.searchClose(),!0===t?g.hide(this.name+"-search-suggest"):0<o(`#w2overlay-${this.name}-search-suggest`).length||(e?(t=o(this.box).find(`#grid_${this.name}_search_all`).get(0),e=[...this.defaultSearches??[],...0<this.defaultSearches?.length&&0<this.savedSearches?.length?["--"]:[],...this.savedSearches??[]],Array.isArray(e)&&0<e.length&&m.show({name:this.name+"-search-suggest",anchor:t,align:"both",items:e,hideOn:["doc-click","sleect","remove"],render(e){let t=e.text;return e.isDefault?`<b>${t}</b>`:t}}).select((e=>{var t=this.trigger("searchSelect",{target:this.name,index:e.detail.index,item:e.detail.item});!0===t.isCancelled?e.preventDefault():(e.detail.overlay.hide(),this.last.logic=e.detail.item.logic||"AND",this.last.search="",this.last.label="[Multiple Fields]",this.searchData=a.clone(e.detail.item.data),this.searchSelected=a.clone(e.detail.item,{exclude:["icon","remove"]}),this.reload(),t.finish())})).remove((e=>{let t=e.detail.item,A=this.trigger("searchRemove",{target:this.name,index:e.detail.index,item:t});!0===A.isCancelled?e.preventDefault():(e.detail.overlay.hide(),this.confirm(a.lang('Do you want to delete search "${item}"?',{item:t.text})).yes((e=>{var i=this.savedSearches.findIndex((e=>e.id==t.id));-1!==i&&this.savedSearches.splice(i,1),this.cacheSave("searches",this.savedSearches.map((e=>a.clone(e,{exclude:["remove","icon"]})))),e.detail.self.close(),A.finish()})).no((e=>{e.detail.self.close()})))}))):this.last.overlay_timer=setTimeout((()=>{this.searchSuggest(!0)}),100))}searchSave(){let e="",t=(this.searchSelected&&(e=this.searchSelected.text),this.savedSearches.findIndex((e=>e.id==this.searchSelected?.id))),A=this.trigger("searchSave",{target:this.name,saveLocalStorage:!0});!0!==A.isCancelled&&this.message({width:350,height:150,body:`<div class="w2ui-grid-save-search">\n                        <span>${a.lang(-1!=t?"Update Search":"Save New Search")}</span>\n                        <input class="search-name w2ui-input" placeholder="${a.lang("Search name")}">\n                   </div>`,buttons:`\n                <button id="grid-search-cancel" class="w2ui-btn">${a.lang("Cancel")}</button>\n                <button id="grid-search-save" class="w2ui-btn w2ui-btn-blue" ${""==String(e).trim()?"disabled":""}>${a.lang("Save")}</button>\n            `}).open((async i=>{o(i.detail.box).find("input, button").eq(0).val(e),await i.complete,o(i.detail.box).find("#grid-search-cancel").on("click",(()=>{this.message()})),o(i.detail.box).find("#grid-search-save").on("click",(()=>{var e=o(i.detail.box).find(".w2ui-message .search-name").val();this.searchSelected&&-1!=t?Object.assign(this.savedSearches[t],{id:e,text:e,logic:this.last.logic,data:a.clone(this.searchData)}):this.savedSearches.push({id:e,text:e,icon:"w2ui-icon-search",remove:!0,logic:this.last.logic,data:this.searchData}),this.cacheSave("searches",this.savedSearches.map((e=>a.clone(e,{exclude:["remove","icon"]})))),this.message(),(this.searchSelected?(this.searchSelected.text=e,o(this.box).find(`#grid_${this.name}_search_name .name-text`)):(this.searchSelected={text:e,logic:this.last.logic,data:a.clone(this.searchData)},o(i.detail.box).find(`#grid_${this.name}_search_all`).val(" ").prop("readOnly",!0),o(i.detail.box).find(`#grid_${this.name}_search_name`).show().find(".name-text"))).html(e),A.finish({name:e})})),o(i.detail.box).find("input, button").off(".message").on("keydown.message",(e=>{var t=String(o(i.detail.box).find(".w2ui-message-body input").val()).trim();13==e.keyCode&&""!=t&&o(i.detail.box).find("#grid-search-save").trigger("click"),27==e.keyCode&&this.message()})).eq(0).on("input.message",(e=>{var t=o(i.detail.box).closest(".w2ui-message").find("#grid-search-save");""===String(o(i.detail.box).val()).trim()?t.prop("disabled",!0):t.prop("disabled",!1)})).get(0).focus()}))}cache(e){if(a.hasLocalStorage&&this.useLocalStorage)try{var t=JSON.parse(localStorage.w2ui||"{}");return t[this.stateId||this.name]??={},t[this.stateId||this.name][e]}catch(e){}return null}cacheSave(e,t){if(a.hasLocalStorage&&this.useLocalStorage)try{var A=JSON.parse(localStorage.w2ui||"{}");return A[this.stateId||this.name]??={},A[this.stateId||this.name][e]=t,localStorage.w2ui=JSON.stringify(A),!0}catch(e){delete localStorage.w2ui}return!1}searchReset(e){var t=[];let A=!1;for(let e=0;e<this.searches.length;e++)this.searches[e].hidden&&null!=this.searches[e].value&&(t.push({field:this.searches[e].field,operator:this.searches[e].operator||"is",type:this.searches[e].type,value:this.searches[e].value||""}),A=!0);var i=this.trigger("search",{reset:!0,target:this.name,searchData:t});if(!0!==i.isCancelled){var s=o(this.box).find("#grid_"+this.name+"_search_all");if(this.searchData=i.detail.searchData,this.searchSelected=null,this.last.search="",this.last.logic=A?"AND":"OR",s.next().hide(),0<this.searches.length)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label="All Fields",s.next().show();else{let e=0;for(;e<this.searches.length&&(this.searches[e].hidden||!1===this.searches[e].simple);)e++;e>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[e].field,this.last.label=this.searches[e].label)}this.last.multi=!1,this.last.fetch.offset=0,this.last.vscroll.scrollTop=0,this.last.vscroll.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),s=s.val("").get(0),s?._w2field&&s._w2field.reset(),e||this.reload(),i.finish()}}searchShowFields(e){if(!0===e)g.hide(this.name+"-search-fields");else{var t=[];for(let e=-1;e<this.searches.length;e++){let i=this.searches[e];var A=i?i.field:null;A=this.getColumn(A);let s=!1,n=null;if(1==this.show.searchHiddenMsg&&-1!=e&&(null==A||!0===A.hidden&&!1!==A.hideable)&&(s=!0,n=a.lang("This column "+(null==A?"does not exist":"is hidden"))),-1==e){if(!this.multiSearch||!this.show.searchAll)continue;i={field:"all",label:"All Fields"}}else{if(null!=A&&!1===A.hideable)continue;if(!0===i.hidden&&(n=a.lang("This column is hidden"),!1===i.simple))continue}null==i.label&&null!=i.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",i),i.label=i.caption),t.push({id:i.field,text:a.lang(i.label),search:i,tooltip:n,disabled:s,checked:i.field==this.last.field})}m.show({type:"radio",name:this.name+"-search-fields",anchor:o(this.box).find("#grid_"+this.name+"_search_name").parent().find(".w2ui-search-down").get(0),items:t,align:"none",hideOn:["doc-click","select"]}).select((e=>{this.searchInitInput(e.detail.item.search.field)}))}}searchInitInput(e,t){let A;var i=o(this.box).find("#grid_"+this.name+"_search_all");if("all"==e)A={field:"all",label:a.lang("All Fields")};else if(null==(A=this.getSearch(e)))return;""!=this.last.search?(this.last.label=A.label,this.search(A.field,this.last.search)):(this.last.field=A.field,this.last.label=A.label),i.attr("placeholder",a.lang("Search")+" "+a.lang(A.label||A.caption||A.field,!0)),this.searchSelected?(o(this.box).find(`#grid_${this.name}_search_all`).val(" ").prop("readOnly",!0),o(this.box).find(`#grid_${this.name}_search_name`).show().find(".name-text").html(this.searchSelected.text)):(o(this.box).find(`#grid_${this.name}_search_all`).prop("readOnly",!1),o(this.box).find(`#grid_${this.name}_search_name`).hide().find(".name-text").html(""))}clear(e){this.total=0,this.records=[],this.summary=[],this.last.fetch.offset=0,this.last.idCache={},this.last.selection={indexes:[],columns:{}},this.reset(!0),e||this.refresh()}reset(e){this.last.vscroll.scrollTop=0,this.last.vscroll.scrollLeft=0,this.last.vscroll.recIndStart=null,this.last.vscroll.recIndEnd=null,o(this.box).find(`#grid_${this.name}_records`).prop("scrollTop",0),e||this.refresh()}skip(e,t){this.url?.get??this.url?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!a.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(t)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")}load(e,t){return null==e?(console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'),new Promise(((e,t)=>{t()}))):(this.clear(!0),this.request("load",{},e,t))}reload(e){let t=this;var A=this.url?.get??this.url;return t.selectionSave(),A?this.load(A,(()=>{t.selectionRestore(),"function"==typeof e&&e()})):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof e&&e({status:"success"}),new Promise((e=>{e()})))}request(e,t,A,i){let s,n,r=this;var o=new Promise(((e,t)=>{s=e,n=t}));if(null==t&&(t={}),!(A=A||this.url))return new Promise(((e,t)=>{t()}));let l;a.isInt(this.offset)||(this.offset=0),a.isInt(this.last.fetch.offset)||(this.last.fetch.offset=0);var d={limit:this.limit,offset:parseInt(this.offset)+parseInt(this.last.fetch.offset),searchLogic:this.last.logic,search:this.searchData.map((e=>(e=a.clone(e),this.searchMap&&this.searchMap[e.field]&&(e.field=this.searchMap[e.field]),e))),sort:this.sortData.map((e=>(e=a.clone(e),this.sortMap&&this.sortMap[e.field]&&(e.field=this.sortMap[e.field]),e)))};if(0===this.searchData.length&&(delete d.search,delete d.searchLogic),0===this.sortData.length&&delete d.sort,a.extend(d,this.postData),a.extend(d,t),"delete"!=e&&"save"!=e||(delete d.limit,delete d.offset,"delete"==(d.action=e)&&(d[this.recid||"recid"]=this.getSelection())),"load"==e){if(!0===(l=this.trigger("request",{target:this.name,url:A,postData:d,httpMethod:"GET",httpHeaders:this.httpHeaders})).isCancelled)return new Promise(((e,t)=>{t()}))}else l={detail:{url:A,postData:d,httpMethod:"save"==e?"PUT":"DELETE",httpHeaders:this.httpHeaders}};if(0===this.last.fetch.offset&&this.lock(a.lang(this.msgRefresh),!0),this.last.fetch.controller)try{this.last.fetch.controller.abort()}catch(t){}switch(A=l.detail.url,e){case"save":A?.save&&(A=A.save);break;case"delete":A?.remove&&(A=A.remove);break;default:A=A?.get??A}if(0<Object.keys(this.routeData).length){var c=a.parseRoute(A);if(0<c.keys.length)for(let e=0;e<c.keys.length;e++)null!=this.routeData[c.keys[e].name]&&(A=A.replace(new RegExp(":"+c.keys[e].name,"g"),this.routeData[c.keys[e].name]))}return A=new URL(A,location),t=a.prepareParams(A,{method:l.detail.httpMethod,headers:l.detail.httpHeaders,body:l.detail.postData},this.dataType),Object.assign(this.last.fetch,{action:e,options:t,controller:new AbortController,start:Date.now(),loaded:!1}),t.signal=this.last.fetch.controller.signal,fetch(A,t).catch(h).then((t=>{null!=t&&(200!=t?.status?h(t??{}):(r.unlock(),t.json().catch(h).then((t=>{this.requestComplete(t,e,i,s,n)}))))})),"load"==e&&l.finish(),o;function h(t){var A;"AbortError"!==t?.name&&(r.unlock(),!0!==(A=r.trigger("error",{response:t,lastFetch:r.last.fetch})).isCancelled)&&(t.status&&200!=t.status?t.json().then((e=>{r.error(t.status+": "+e.message??t.statusText)})).catch((()=>{r.error(t.status+": "+t.statusText)})):(console.log("ERROR: Server communication failed.","\n   EXPECTED:",{total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{error:!0,message:"error message"}),r.requestComplete({error:!0,message:a.lang(this.msgHTTPError),response:t},e,i,s,n)),A.finish())}}requestComplete(e,t,A,i,s){let n=e.error??!1,r=(null==e.error&&"error"===e.status&&(n=!0),this.last.fetch.response=(Date.now()-this.last.fetch.start)/1e3,setTimeout((()=>{this.show.statusResponse&&this.status(a.lang("Server Response ${count} seconds",{count:this.last.fetch.response}))}),10),this.last.vscroll.pull_more=!1,this.last.vscroll.pull_refresh=!0,"load");"save"==this.last.fetch.action&&(r="save"),"delete"==this.last.fetch.action&&(r="delete");var l=this.trigger(r,{target:this.name,error:n,data:e,lastFetch:this.last.fetch});if(!0===l.isCancelled)s();else{if(n)this.error(a.lang(e.message??this.msgServerError)),s(e);else if("function"==typeof this.parser?"object"!=typeof(e=this.parser(e))&&console.log("ERROR: Your parser did not return proper object"):null==e?e={error:!0,message:a.lang(this.msgNotJSON)}:Array.isArray(e)&&(e={error:n,records:e,total:e.length}),"load"==t){if(null==e.total&&(e.total=-1),null==e.records&&(e.records=[]),e.records.length==this.limit?(s=this.records.length+e.records.length,this.last.fetch.hasMore=s!=this.total):(this.last.fetch.hasMore=!1,this.total=this.offset+this.last.fetch.offset+e.records.length),this.last.fetch.hasMore||o(this.box).find("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide(),0===this.last.fetch.offset)this.records=[],this.summary=[];else if(-1!=e.total&&parseInt(e.total)!=parseInt(this.total)){let e=this;return this.message(a.lang(this.msgNeedReload)).ok((()=>{delete e.last.fetch.offset,e.reload()})),new Promise((e=>{e()}))}a.isInt(e.total)&&(this.total=parseInt(e.total)),e.records&&e.records.forEach((e=>{this.recid&&(e.recid=this.parseField(e,this.recid)),null==e.recid&&(e.recid="recid-"+this.records.length),(!0===e.w2ui?.summary?this.summary:this.records).push(e)})),e.summary&&(this.summary=[],e.summary.forEach((e=>{this.recid&&(e.recid=this.parseField(e,this.recid)),null==e.recid&&(e.recid="recid-"+this.summary.length),this.summary.push(e)})))}else if("delete"==t)return this.reset(),this.reload();(this.url?.get??this.url)||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),0===this.last.fetch.offset?this.refresh():(this.scroll(),this.resize()),"function"==typeof A&&A(e),i(e),l.finish(),this.last.fetch.loaded=!0}}error(e){var t=this.trigger("error",{target:this.name,message:e});!0!==t.isCancelled&&(this.message(e),t.finish())}getChanges(e){var t=[];void 0===e&&(e=this.records);for(let s=0;s<e.length;s++){var A,i=e[s];i?.w2ui&&(null!=i.w2ui.changes&&((A={})[this.recid||"recid"]=i.recid,t.push(a.extend(A,i.w2ui.changes))),!0!==i.w2ui.expanded)&&i.w2ui.children&&i.w2ui.children.length&&t.push(...this.getChanges(i.w2ui.children))}return t}mergeChanges(){var e=this.getChanges();for(let i=0;i<e.length;i++){var t,A=this.get(e[i][this.recid||"recid"]);for(t in e[i])if(!("recid"==t||this.recid&&t==this.recid)){"object"==typeof e[i][t]&&(e[i][t]=e[i][t].text);try{!function e(t,A,i){let s=A.split(".");1==s.length?t[A]=i:(t=t[s[0]],s.shift(),e(t,s.join("."),i))}(A,t,e[i][t])}catch(e){console.log("ERROR: Cannot merge. ",e.message||"",e)}A.w2ui&&delete A.w2ui.changes}}this.refresh()}save(e){var t=this.getChanges(),A=this.url?.save??this.url;let i=this.trigger("save",{target:this.name,changes:t});!0!==i.isCancelled&&(A?this.request("save",{changes:i.detail.changes},null,(t=>{t.error||this.mergeChanges(),i.finish(),"function"==typeof e&&e(t)})):(this.mergeChanges(),i.finish()))}editField(e,t,A,i){let s=this;if(!0===this.last.inEditMode)i&&13==i.keyCode?(({index:n,column:r,value:l}=this.last._edit),this.editChange({type:"custom",value:l},n,r,i),this.editDone(n,r,i)):0<(l=o(this.box).find("div.w2ui-edit-box .w2ui-input")).length&&("DIV"==l.get(0).tagName?(l.text(l.text()+A),a.setCursorPosition(l.get(0),l.text().length)):(l.val(l.val()+A),a.setCursorPosition(l.get(0),l.val().length)));else{let d=this.get(e,!0),c=this.getCellEditable(d,t);if(c&&!["checkbox","check"].includes(c.type)){let h=this.records[d],u=this.columns[t];var n=!0===u.frozen?"_f":"_";if(-1!=["enum","file"].indexOf(c.type))console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');else{var r=this.trigger("editField",{target:this.name,recid:e,column:t,value:A,index:d,originalEvent:i});if(!0!==r.isCancelled){A=r.detail.value,this.last.inEditMode=!0,this.last.editColumn=t,this.last._edit={value:A,index:d,column:t,recid:e},this.selectNone(!0),this.select({recid:e,column:t});var l=o(this.box).find("#grid_"+this.name+n+"rec_"+a.escapeId(e));let p=l.find('[col="'+t+'"] > div'),m=(this.last._edit.tr=l,this.last._edit.div=p,o(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&(o(this.box).find("#grid_"+this.name+n+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),p=o(this.box).find("#grid_"+this.name+"_editable > div:first-child")),c.attr=c.attr??"",c.text=c.text??"",c.style=c.style??"",c.items=c.items??[],null!=h.w2ui?.changes?.[u.field]?a.stripTags(h.w2ui.changes[u.field]):a.stripTags(s.parseField(h,u.field))),f="object"!=typeof(m=null==m?"":m)?m:"",w=(null!=r.detail.prevValue&&(f=r.detail.prevValue),null!=A&&(m=A),null!=u.style?u.style+";":"");"string"==typeof u.render&&["number","int","float","money","percent","size"].includes(u.render.split(":")[0])&&(w+="text-align: right;"),0<c.items.length&&!a.isPlainObject(c.items[0])&&(c.items=a.normMenu(c.items));let B,y=["date","time","datetime","color","list","combo"];function b(e){try{var t=getComputedStyle(e),A="DIV"==e.tagName.toUpperCase()?e.innerText:e.value,i=o(s.box).find("#grid_"+s.name+"_editable").get(0),n=`font-family: ${t["font-family"]}; font-size: ${t["font-size"]}; white-space: no-wrap;`,r=a.getStrWidth(A,n);r+20>i.clientWidth&&o(i).css("width",r+20+"px")}catch(e){}}n=`font-family: ${(i=getComputedStyle(l.find('[col="'+t+'"] > div').get(0)))["font-family"]}; font-size: ${i["font-size"]};`,"div"===c.type?(p.addClass("w2ui-editable").html(a.stripSpaces(`<div id="grid_${this.name}_edit_${e}_${t}" class="w2ui-input w2ui-focus"\n                        contenteditable autocorrect="off" autocomplete="off" spellcheck="false"\n                        style="${n+w+c.style}"\n                        field="${u.field}" recid="${e}" column="${t}" ${c.attr}>\n                    </div>`+c.text)),(B=p.find("div.w2ui-input").get(0)).innerText="object"!=typeof m?m:"",null!=A?a.setCursorPosition(B,B.innerText.length):a.setCursorPosition(B,0,B.innerText.length)):(p.addClass("w2ui-editable").html(a.stripSpaces(`<input id="grid_${this.name}_edit_${e}_${t}" class="w2ui-input"\n                        autocorrect="off" autocomplete="off" spellcheck="false" type="text"\n                        style="${n+w+c.style}"\n                        field="${u.field}" recid="${e}" column="${t}" ${c.attr}>`+c.text)),B=p.find("input").get(0),"number"==c.type&&(m=a.formatNumber(m)),"date"==c.type&&(m=a.formatDate(a.isDate(m,c.format,!0)||new Date,c.format)),B.value="object"!=typeof m?m:"",l=e=>{var t=this.last._edit?.escKey;let A=!1;var i=o(B).data("tooltipName");i&&null!=g.get(i[0])?.selected&&(A=!0),!this.last.inEditMode||t||!y.includes(c.type)||e.detail.overlay.anchor?.id!=this.last._edit.input?.id&&"list"!=c.type||(this.editChange(),this.editDone(void 0,void 0,{keyCode:A?13:0}))},new F(a.extend({},c,{el:B,selected:m,onSelect:l,onHide:l})),null==A&&B&&B.select()),Object.assign(this.last._edit,{input:B,edit:c}),o(B).off(".w2ui-editable").on("blur.w2ui-editable",(e=>{var A;this.last.inEditMode&&(A=this.last._edit.edit.type,o(B).data("tooltipName")&&y.includes(A)||!0===e.target._keepOpen?delete e.target._keepOpen:(this.editChange(B,d,t,e),this.editDone()))})).on("mousedown.w2ui-editable",(e=>{e.stopPropagation()})).on("click.w2ui-editable",(e=>{b.call(B,e)})).on("paste.w2ui-editable",(e=>{e.preventDefault(),e=e.clipboardData.getData("text/plain"),document.execCommand("insertHTML",!1,e)})).on("keyup.w2ui-editable",(e=>{b.call(B,e)})).on("keydown.w2ui-editable",(A=>{switch(A.keyCode){case 8:"list"!=c.type||B._w2field||A.preventDefault();break;case 9:case 13:A.preventDefault();break;case 27:var i=o(B).data("tooltipName");if(i&&0<i.length)return this.last._edit.escKey=!0,g.hide(i[0]),void A.preventDefault();A.stopPropagation()}setTimeout((()=>{switch(A.keyCode){case 9:var i=A.shiftKey?s.prevCell(d,t,!0):s.nextCell(d,t,!0);null!=i&&(n=s.records[i.index].recid,this.editChange(B,d,t,A),this.editDone(d,t,A),"row"!=s.selectType?(s.selectNone(!0),s.select({recid:n,column:i.colIndex})):s.editField(n,i.colIndex,null,A),A.preventDefault)&&A.preventDefault();break;case 13:{let e=!1;var n=o(B).data("tooltipName");n&&null!=g.get(n[0]).selected&&(e=!0),n&&e||!0===B._keepOpen?delete B._keepOpen:(this.editChange(B,d,t,A),this.editDone(d,t,A));break}case 27:{this.last._edit.escKey=!1;let i=s.parseField(h,u.field);null!=h.w2ui?.changes?.[u.field]&&(i=h.w2ui.changes[u.field]),null!=B._prevValue&&(i=B._prevValue),"DIV"==B.tagName?B.innerText=null!=i?i:"":B.value=null!=i?i:"",this.editDone(d,t,A),setTimeout((()=>{s.select({recid:e,column:t})}),1);break}}b(B)}),1)})),B&&(B._prevValue=f),"list"!=c.type&&setTimeout((()=>{this.last.inEditMode&&B&&(B.focus(),clearTimeout(this.last.kbd_timer),(B.resize=b)(B))}),50),r.finish({input:B})}}}}}editChange(e,t,A,i){e=e??this.last._edit.input,t=t??this.last._edit.index,A=A??this.last._edit.column,i=i??{};var s=(t<0?this.summary:this.records)[t=t<0?-t-1:t],n=this.columns[A];let r="DIV"==e?.tagName?e.innerText:e.value;var o=e._w2field,l=(o&&(null!=(r="list"==o.type?o.selected:r)&&0!==Object.keys(r).length||(r=""),a.isPlainObject(r)||(r=o.clean(r))),"checkbox"==e.type&&(!1===s.w2ui?.editable&&(e.checked=!e.checked),r=e.checked),this.parseField(s,n.field)),d=s.w2ui?.changes&&s.w2ui.changes.hasOwnProperty(n.field)?s.w2ui.changes[n.field]:l;let c={target:this.name,input:e,recid:s.recid,index:t,column:A,originalEvent:i,value:{new:r,previous:d,original:l}},h=(null!=i.target?._prevValue&&(c.value.previous=i.target._prevValue),0);for(;h<20;){if(h++,"object"!=typeof(r=c.value.new)&&String(l)!=String(r)||"object"==typeof r&&r&&r.id!=l&&("object"!=typeof l||null==l||r.id!=l.id)){if(!0!==(c=this.trigger("change",c)).isCancelled){if(r!==c.detail.value.new)continue;(""!==c.detail.value.new&&null!=c.detail.value.new||""!==d&&null!=d)&&(s.w2ui=s.w2ui??{},s.w2ui.changes=s.w2ui.changes??{},s.w2ui.changes[n.field]=c.detail.value.new),c.finish()}}else if(!0!==(c=this.trigger("restore",c)).isCancelled){if(r!==c.detail.value.new)continue;s.w2ui?.changes&&(delete s.w2ui.changes[n.field],0===Object.keys(s.w2ui.changes).length)&&delete s.w2ui.changes,c.finish()}break}}editDone(e,t,A){if(e=e??this.last._edit.index,t=t??this.last._edit.column,A=A??{},this.advanceOnEdit&&13==A.keyCode){let i=A.shiftKey?this.prevRow(e,t,1):this.nextRow(e,t,1);null==i&&(i=e),setTimeout((()=>{"row"!=this.selectType?(this.selectNone(!0),this.select({recid:this.records[i].recid,column:t})):this.editField(this.records[i].recid,t,null,A)}),1)}var i=e<0,s=o(this.last._edit?.tr).find('[col="'+t+'"]'),n=this.records[e],r=this.columns[t];this.last.inEditMode=!1,this.last._edit=null,i||(null!=n.w2ui?.changes?.[r.field]?s.addClass("w2ui-changed"):s.removeClass("w2ui-changed"),s.replace(this.getCellHTML(e,t,i))),o(this.box).find("div.w2ui-edit-box").remove(),this.updateToolbar(),setTimeout((()=>{var e=o(this.box).find(`#grid_${this.name}_focus`).get(0);document.activeElement===e||this.last.inEditMode||e.focus()}),10)}delete(e){var t=this.trigger("delete",{target:this.name,force:e});if(e&&this.message(),!0!==t.isCancelled){e=t.detail.force;var A=this.getSelection();if(0!==A.length)if(""==this.msgDelete||e){if("object"!=typeof this.url?this.url:this.url.remove)this.request("delete");else if("object"!=typeof A[0])this.selectNone(),this.remove.apply(this,A);else{for(let e=0;e<A.length;e++){var i=this.columns[A[e].column].field,s=this.get(A[e].recid,!0),n=this.records[s];null!=s&&"recid"!=i&&(this.records[s][i]="",n.w2ui?.changes)&&delete n.w2ui.changes[i]}this.update()}t.finish()}else this.confirm({text:a.lang(this.msgDelete,{count:A.length,records:a.lang(1==A.length?"record":"records")}),width:380,height:170,yes_text:a.lang("Delete"),yes_class:"w2ui-btn-red",no_text:a.lang("Cancel")}).yes((e=>{e.detail.self.close(),this.delete(!0)})).no((e=>{e.detail.self.close()}))}}click(e,t){var A=Date.now();let i=null;if(!(1==this.last.cancelClick||t&&t.altKey))if("object"==typeof e&&null!==e&&(i=e.column,e=e.recid),null==t&&(t={}),A-parseInt(this.last.click_time)<350&&this.last.click_recid==e&&"click"==t.type)this.dblClick(e,t);else{if(this.last.bubbleEl&&(this.last.bubbleEl=null),this.last.click_time=A,A=this.last.click_recid,this.last.click_recid=e,null==i&&t.target){let e=t.target;"TD"!=e.tagName&&(e=o(e).closest("td")[0]),null!=o(e).attr("col")&&(i=parseInt(o(e).attr("col")))}var s=this.trigger("click",{target:this.name,recid:e,column:i,originalEvent:t});if(!0!==s.isCancelled){var n=this.getSelection(),r=(o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.get(e,!0)),l=[];let c,h,u,p;if(this.last.sel_ind=r,this.last.sel_col=i,this.last.sel_recid=e,this.last.sel_type="click",t.shiftKey&&0<n.length&&this.multiSelect){if(n[0].recid){c=this.get(n[0].recid,!0),h=this.get(e,!0),p=i>n[0].column?(u=n[0].column,i):(u=i,n[0].column);for(let e=u;e<=p;e++)l.push(e)}else c=this.get(A,!0),h=this.get(e,!0);var a=[],d=(c>h&&(A=c,c=h,h=A),this.url?.get?this.url.get:this.url);for(let e=c;e<=h;e++)if(!(0<this.searchData.length)||d||this.last.searchIds.includes(e))if("row"==this.selectType)a.push(this.records[e].recid);else for(let t=0;t<l.length;t++)a.push({recid:this.records[e].recid,column:l[t]});this.select(a)}else{let s=-1!=(A=this.last.selection).indexes.indexOf(r),l=!1;o(t.target).closest("td").hasClass("w2ui-col-select")&&(l=!0),(t.ctrlKey||t.shiftKey||t.metaKey||l)&&this.multiSelect||this.showSelectColumn?!0===(s="row"==this.selectType&&s)?this.unselect({recid:e,column:i}):this.select({recid:e,column:i}):!0===(s=!("row"!=this.selectType&&!A.columns[r]?.includes(i))&&s)&&1==n.length?this.unselect({recid:e,column:i}):(this.selectNone(!0),this.select({recid:e,column:i}))}this.status(),this.initResize(),s.finish()}}}columnClick(e,t){if(!0!==this.last.colResizing){let n=this.trigger("columnClick",{target:this.name,field:e,originalEvent:t});if(!0!==n.isCancelled){if("row"==this.selectType)(A=this.getColumn(e))&&A.sortable&&this.sort(e,null,!(!t||!(t.ctrlKey||t.metaKey||t.shiftKey))),"line-number"==n.detail.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll());else if(t.altKey&&(A=this.getColumn(e))&&A.sortable&&this.sort(e,null,!(!t||!(t.ctrlKey||t.metaKey||t.shiftKey))),"line-number"==n.detail.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{t.shiftKey||t.metaKey||t.ctrlKey||this.selectNone(!0);var A=this.getSelection(),i=(e=this.getColumn(n.detail.field,!0),[]),s=[];if(0!=A.length&&t.shiftKey){let t=e,i=A[0].column;t>i&&(t=A[0].column,i=e);for(let e=t;e<=i;e++)s.push(e)}else s.push(e);if(!0!==(n=this.trigger("columnSelect",{target:this.name,columns:s})).isCancelled){for(let e=0;e<this.records.length;e++)i.push({recid:this.records[e].recid,column:s});this.select(i)}n.finish()}n.finish()}}}columnDblClick(e,t){!0!==(e=this.trigger("columnDblClick",{target:this.name,field:e,originalEvent:t})).isCancelled&&e.finish()}columnContextMenu(e,t){!0!==(e=this.trigger("columnContextMenu",{target:this.name,field:e,originalEvent:t})).isCancelled&&(this.show.columnMenu&&(m.show({type:"check",contextMenu:!0,originalEvent:t,items:this.initColumnOnOff()}).then((()=>{o("#w2overlay-context-menu .w2ui-grid-skip").off(".w2ui-grid").on("click.w2ui-grid",(e=>{e.stopPropagation()})).on("keypress",(e=>{13==e.keyCode&&(this.skip(e.target.value),this.toolbar.click("w2ui-column-on-off"))}))})).select((e=>{var t=e.detail.item.id;["w2ui-stateSave","w2ui-stateReset"].includes(t)?this[t.substring(5)]():"w2ui-skip"!=t&&this.columnOnOff(e,e.detail.item.id),clearTimeout(this.last.kbd_timer)})),clearTimeout(this.last.kbd_timer)),t.preventDefault(),e.finish())}columnAutoSize(e){if(0==arguments.length)this.columns.forEach(((e,t)=>this.columnAutoSize(t)));else{var t=this.columns[e],A=o(`#grid_${this.name}_column_${e} .w2ui-col-header`)[0];if(!1===t.autoResize||!0===t.hidden||!A)return!0;var i=getComputedStyle(A);let s=a.getStrWidth(A.innerHTML,`font-family: ${i.fontFamily}; font-size: `+i.fontSize,!0)+parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)+4;o(this.box).find(`.w2ui-grid-records td[col="${e}"] > div`,this.box).each((e=>{var t=getComputedStyle(e);e=a.getStrWidth(e.innerHTML,`font-family: ${t.fontFamily}; font-size: `+t.fontSize,!0)+parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+4,s<e&&(s=e)})),!0!==(A=this.trigger("columnAutoResize",{maxWidth:s,originalEvent:event,target:this.name,column:t})).isCancelled&&(0<s&&(null==t.sizeOriginal&&(t.sizeOriginal=t.size),t.size=Math.min(Math.abs(s),t.max||1/0)+"px",this.resizeRecords(),this.resizeRecords(),this.scroll()),A.finish())}}columnAutoSizeAll(){this.columns.forEach(((e,t)=>this.columnAutoSize(t)))}focus(e){if(!0===(e=this.trigger("focus",{target:this.name,originalEvent:e})).isCancelled)return!1;this.hasFocus=!0,o(this.box).removeClass("w2ui-inactive").find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout((()=>{var e=o(this.box).find(`#grid_${this.name}_focus`).get(0);e&&document.activeElement!=e&&e.focus()}),10),e.finish()}blur(e){if(!0===(e=this.trigger("blur",{target:this.name,originalEvent:e})).isCancelled)return!1;this.hasFocus=!1,o(this.box).addClass("w2ui-inactive").find(".w2ui-selected").addClass("w2ui-inactive"),o(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),e.finish()}keydown(e){let t=this,A="object"!=typeof this.url?this.url:this.url.get;if(!0===t.keyboard){var i=t.trigger("keydown",{target:t.name,originalEvent:e});if(!0!==i.isCancelled)if(0<o(this.box).find(".w2ui-message").length)27==e.keyCode&&this.message();else{let l=!1,d=o(t.box).find("#grid_"+t.name+"_records"),c=t.getSelection(),h=(0===c.length&&(l=!0),c[0]||null),u=[],p=c[c.length-1];if("object"==typeof h&&null!=h){h=c[0].recid,u=[];let Q=0;for(;c[Q]&&c[Q].recid==h;)u.push(c[Q].column),Q++;p=c[c.length-1].recid}let g=t.get(h,!0),m=t.get(p,!0),f=o(t.box).find(`#grid_${t.name}_rec_`+(null!=g?a.escapeId(t.records[g].recid):"none"));var s,n=Math.floor(d[0].clientHeight/t.recordHeight);let w=!1,B=e.keyCode,y=e.shiftKey;switch(B){case 8:case 46:t.delete(),w=!0,e.stopPropagation();break;case 27:t.last.move?.type?(delete t.last.move,t.removeRange("selection-preview"),t.removeRange("selection-expand")):t.selectNone(),w=!0;break;case 65:(e.metaKey||e.ctrlKey)&&(t.selectAll(),w=!0);break;case 13:if("row"==this.selectType&&!0===t.show.expandColumn){if(f.length<=0)break;t.toggle(h,e),w=!0}else{for(let F=0;F<this.columns.length;F++)if(this.getCellEditable(g,F)){u.push(parseInt(F));break}0<(u="row"==this.selectType&&this.last._edit&&this.last._edit.column?[this.last._edit.column]:u).length&&(t.editField(h,u[0]??this.last.editColumn,null,e),w=!0)}break;case 37:!function(){if(l)C();else{if("row"==t.selectType){if(f.length<=0)return;var A=t.records[g].w2ui||{};!A||null==A.parent_recid||Array.isArray(A.children)&&0!==A.children.length&&A.expanded?t.collapse(h,e):(t.unselect(h),t.collapse(A.parent_recid,e),t.select(A.parent_recid))}else{let A=t.prevCell(g,u[0]);if(A=A?.index!=g?null:A?.colIndex,y||null!=A||(t.selectNone(!0),A=0),null!=A)if(y&&t.multiSelect){if(x())return;var i=[],s=[],n=[];if(0===u.indexOf(t.last.sel_col)&&1<u.length){for(let e=0;e<c.length;e++)-1==i.indexOf(c[e].recid)&&i.push(c[e].recid),n.push({recid:c[e].recid,column:u[u.length-1]});t.unselect(n),t.scrollIntoView(g,u[u.length-1],!0)}else{for(let e=0;e<c.length;e++)-1==i.indexOf(c[e].recid)&&i.push(c[e].recid),s.push({recid:c[e].recid,column:A});t.select(s),t.scrollIntoView(g,A,!0)}}else t.click({recid:h,column:A},e),t.scrollIntoView(g,A,!0);else y||t.selectNone(!0)}w=!0}}();break;case 39:!function(){if(l)C();else{if("row"==t.selectType){if(f.length<=0)return;t.expand(h,e)}else{let n=t.nextCell(g,u[u.length-1]);if(n=n.index!=g?null:n.colIndex,y||null!=n||(t.selectNone(!0),n=t.columns.length-1),null!=n)if(y&&39==B&&t.multiSelect){if(x())return;var A=[],i=[],s=[];if(u.indexOf(t.last.sel_col)==u.length-1&&1<u.length){for(let e=0;e<c.length;e++)-1==A.indexOf(c[e].recid)&&A.push(c[e].recid),s.push({recid:c[e].recid,column:u[0]});t.unselect(s),t.scrollIntoView(g,u[0],!0)}else{for(let e=0;e<c.length;e++)-1==A.indexOf(c[e].recid)&&A.push(c[e].recid),i.push({recid:c[e].recid,column:n});t.select(i),t.scrollIntoView(g,n,!0)}}else t.click({recid:h,column:n},e),t.scrollIntoView(g,n,!0);else y||t.selectNone(!0)}w=!0}}();break;case 33:b(n);break;case 34:v(n);break;case 35:v(-1);break;case 36:b(-1);break;case 38:b(e.metaKey||e.ctrlKey?-1:1);break;case 40:v(e.metaKey||e.ctrlKey?-1:1);break;case 17:case 91:l||a.isSafari&&(t.last.copy_event=t.copy(!1,e),(s=o(t.box).find("#grid_"+t.name+"_focus")).val(t.last.copy_event.detail.text),s[0].select());break;case 67:(e.metaKey||e.ctrlKey)&&(a.isSafari||(t.last.copy_event=t.copy(!1,e),(s=o(t.box).find("#grid_"+t.name+"_focus")).val(t.last.copy_event.detail.text),s[0].select()),t.copy(t.last.copy_event,e));break;case 88:l||(e.ctrlKey||e.metaKey)&&(a.isSafari||(t.last.copy_event=t.copy(!1,e),(s=o(t.box).find("#grid_"+t.name+"_focus")).val(t.last.copy_event.detail.text),s[0].select()),t.copy(t.last.copy_event,e))}var r=[32,187,189,192,219,220,221,186,222,188,190,191];for(let U=48;U<=111;U++)r.push(U);function b(i){if(l&&C(),!(f.length<=0)){let r=t.prevRow(g,"row"==t.selectType?0:c[0].column,i);if(null!=(r=y||null!=r?r:0==t.searchData.length||A?0:t.last.searchIds[0])){if(y&&t.multiSelect){if(x())return;if("row"==t.selectType)t.last.sel_ind>r&&t.last.sel_ind!=m?t.unselect(t.records[m].recid):t.select(t.records[r].recid);else if(t.last.sel_ind>r&&t.last.sel_ind!=m){r=m;var s=[];for(let e=0;e<u.length;e++)s.push({recid:t.records[r].recid,column:u[e]});t.unselect(s)}else{var n=[];for(let e=0;e<u.length;e++)n.push({recid:t.records[r].recid,column:u[e]});t.select(n)}}else t.selectNone(!0),t.click({recid:t.records[r].recid,column:u[0]},e);t.scrollIntoView(r,null,!0,1!=i),e.preventDefault&&e.preventDefault()}else y||t.selectNone(!0)}}function v(i){if(l&&C(),!(f.length<=0)){let r=t.nextRow(m,"row"==t.selectType?0:c[0].column,i);if(null!=(r=y||null!=r?r:0==t.searchData.length||A?t.records.length-1:t.last.searchIds[t.last.searchIds.length-1])){if(y&&t.multiSelect){if(x())return;if("row"==t.selectType)t.last.sel_ind<r&&t.last.sel_ind!=g?t.unselect(t.records[g].recid):t.select(t.records[r].recid);else if(t.last.sel_ind<r&&t.last.sel_ind!=g){r=g;var s=[];for(let e=0;e<u.length;e++)s.push({recid:t.records[r].recid,column:u[e]});t.unselect(s)}else{var n=[];for(let e=0;e<u.length;e++)n.push({recid:t.records[r].recid,column:u[e]});t.select(n)}}else t.selectNone(!0),t.click({recid:t.records[r].recid,column:u[0]},e);t.scrollIntoView(r,null,!0,1!=i),w=!0}else y||t.selectNone(!0)}}function C(){if(t.records&&0!==t.records.length){let e=Math.floor(d[0].scrollTop/t.recordHeight)+1;(!t.records[e]||e<2)&&(e=0),void 0!==t.records[e]&&t.select({recid:t.records[e].recid,column:0})}}function x(){if("click"==t.last.sel_type){if("row"==t.selectType)return t.last.sel_type="key",1<c.length&&(c.splice(c.indexOf(t.records[t.last.sel_ind].recid),1),t.unselect(c),1);if(t.last.sel_type="key",1<c.length){for(let e=0;e<c.length;e++)if(c[e].recid==t.last.sel_recid&&c[e].column==t.last.sel_col){c.splice(e,1);break}return t.unselect(c),1}}}-1==r.indexOf(B)||e.ctrlKey||e.metaKey||w||(0===u.length&&u.push(0),w=!1,setTimeout((()=>{var A=o(t.box).find("#grid_"+t.name+"_focus"),i=A.val();A.val(""),t.editField(h,u[0],i,e)}),1)),w&&e.preventDefault&&e.preventDefault(),i.finish()}}}scrollIntoView(e,t,A,i){let s=this.records.length;if(0!==(s=0==this.searchData.length||this.url?s:this.last.searchIds.length)){if(null==e){if(0===(n=this.getSelection()).length)return;a.isPlainObject(n[0])?(e=n[0].index,t=n[0].column):e=this.get(n[0],!0)}var n,r=(n=o(this.box).find(`#grid_${this.name}_records`))[0].clientWidth,l=n[0].clientHeight,d=n[0].scrollTop,c=n[0].scrollLeft,h=this.last.searchIds.length;if(0<h&&(e=this.last.searchIds.indexOf(e)),n.css({"scroll-behavior":A?"auto":"smooth"}),l<this.recordHeight*(0<h?h:s)&&0<n.length&&(h=(A=Math.floor(d/this.recordHeight))+Math.floor(l/this.recordHeight),e==A&&n.prop("scrollTop",d-l/1.3),e==h&&n.prop("scrollTop",d+l/1.3),(e<A||h<e)&&n.prop("scrollTop",(e-1)*this.recordHeight),!0===i)&&n.prop("scrollTop",e*this.recordHeight),null!=t){let e=0,A=0;d=a.scrollBarSize();for(let i=0;i<=t;i++){var u=this.columns[i];u.frozen||u.hidden||(e=A,A+=parseInt(u.sizeCalculated))}r<A-c?n.prop("scrollLeft",e-d):e<c&&n.prop("scrollLeft",A-r+2*d)}}}scrollToColumn(e){if(null!=e){let A=0,i=!1;for(let s=0;s<this.columns.length;s++){var t=this.columns[s];if(t.field==e){i=!0;break}t.frozen||t.hidden||(A+=t=parseInt(t.sizeCalculated||t.size))}i&&(this.last.vscroll.scrollLeft=A+1,this.scroll())}}dblClick(e,t){let A=null;if("object"==typeof e&&null!==e&&(A=e.column,e=e.recid),null==t&&(t={}),null==A&&t.target){let e=t.target;"TD"!=e.tagName.toUpperCase()&&(e=o(e).closest("td")[0]),A=parseInt(o(e).attr("col"))}var i=this.get(e,!0),s=this.records[i],n=this.trigger("dblClick",{target:this.name,recid:e,column:A,originalEvent:t});!0!==n.isCancelled&&(this.selectNone(!0),this.getCellEditable(i,A)?this.editField(e,A,null,t):(this.select({recid:e,column:A}),(this.show.expandColumn||s&&s.w2ui&&Array.isArray(s.w2ui.children))&&this.toggle(e)),n.finish())}showContextMenu(e,t,A){if("text"!=this.last.userSelect){null==(A=null==A?{offsetX:0,offsetY:0,target:o(this.box).find(`#grid_${this.name}_rec_`+e)[0]}:A).offsetX&&(A.offsetX=A.layerX-A.target.offsetLeft,A.offsetY=A.layerY-A.target.offsetTop);var i=this.getSelection();if("row"==this.selectType)-1==i.indexOf(e)&&this.click(e);else{let s=!1;for(let A=0;A<i.length;A++)i[A].recid!=e&&i[A].column!=t||(s=!0);s||null==e||this.click({recid:e,column:t}),s||null==t||this.columnClick(this.columns[t].field,A)}var s=this.trigger("contextMenu",{target:this.name,originalEvent:A,recid:e,column:t});!0!==s.isCancelled&&(0<this.contextMenu?.length&&m.show({contextMenu:!0,originalEvent:A,items:this.contextMenu}).select((A=>{clearTimeout(this.last.kbd_timer),this.contextMenuClick(e,t,A)})),A.preventDefault(),clearTimeout(this.last.kbd_timer),s.finish())}}contextMenuClick(e,t,A){!0!==(e=this.trigger("contextMenuClick",{target:this.name,recid:e,column:t,originalEvent:A.detail.originalEvent,menuEvent:A,menuIndex:A.detail.index,menuItem:A.detail.item})).isCancelled&&e.finish()}toggle(e){var t=this.get(e);if(null!=t)return t.w2ui=t.w2ui??{},!0===t.w2ui.expanded?this.collapse(e):this.expand(e)}expand(e,t){var A=this.get(e,!0);let i=this.records[A];i.w2ui=i.w2ui??{};var s=a.escapeId(e),n=i.w2ui.children;let r;if(Array.isArray(n)){if(!0===i.w2ui.expanded||0===n.length)return!1;if(!0===(r=this.trigger("expand",{target:this.name,recid:e})).isCancelled)return!1;i.w2ui.expanded=!0,n.forEach((e=>{e.w2ui=e.w2ui??{},e.w2ui.parent_recid=i.recid,null==e.w2ui.children&&(e.w2ui.children=[])})),this.records.splice.apply(this.records,[A+1,0].concat(n)),-1!==this.total&&(this.total+=n.length),("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!0,!0),0<this.searchData.length&&this.localSearch(!0)),!0!==t&&this.refresh(),r.finish()}else{if(0<o(this.box).find("#grid_"+this.name+"_rec_"+s+"_expanded_row").length||!0!==this.show.expandColumn)return!1;if("none"==i.w2ui.expanded)return!1;if(o(this.box).find("#grid_"+this.name+"_rec_"+s).after(`<tr id="grid_${this.name}_rec_${e}_expanded_row" class="w2ui-expanded-row">\n                    <td colspan="100" class="w2ui-expanded2">\n                        <div id="grid_${this.name}_rec_${e}_expanded"></div>\n                    </td>\n                    <td class="w2ui-grid-data-last"></td>\n                </tr>`),o(this.box).find("#grid_"+this.name+"_frec_"+s).after(`<tr id="grid_${this.name}_frec_${e}_expanded_row" class="w2ui-expanded-row">\n                    ${this.show.lineNumbers?'<td class="w2ui-col-number"></td>':""}\n                    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">\n                       <div id="grid_${this.name}_frec_${e}_expanded"></div>\n                    </td>\n                </tr>`),!0===(r=this.trigger("expand",{target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+e+"_expanded"})).isCancelled)return o(this.box).find("#grid_"+this.name+"_rec_"+s+"_expanded_row").remove(),o(this.box).find("#grid_"+this.name+"_frec_"+s+"_expanded_row").remove(),!1;A=o(this.box).find("#grid_"+this.name+"_rec_"+e+"_expanded"),n=o(this.box).find("#grid_"+this.name+"_frec_"+e+"_expanded"),t=A.find(":scope div:first-child")[0]?.clientHeight??50,A[0].clientHeight<t&&A.css({height:t+"px"}),n[0].clientHeight<t&&n.css({height:t+"px"}),o(this.box).find("#grid_"+this.name+"_rec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),o(this.box).find("#grid_"+this.name+"_frec_"+s).attr("expanded","yes").addClass("w2ui-expanded"),o(this.box).find("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("-"),i.w2ui.expanded=!0,r.finish(),this.resizeRecords()}return!0}collapse(e,t){var A=this.get(e,!0);let i=this.records[A],s=(i.w2ui=i.w2ui||{},a.escapeId(e));var n=i.w2ui.children;let r;if(Array.isArray(n)){if(!0!==i.w2ui.expanded)return!1;if(!0===(r=this.trigger("collapse",{target:this.name,recid:e})).isCancelled)return!1;!function e(t){t.w2ui.expanded=!1;for(let A=0;A<t.w2ui.children.length;A++){let i=t.w2ui.children[A];i.w2ui.expanded&&e(i)}}(i);var l=[];for(let e=i;null!=e;e=this.get(e.w2ui.parent_recid))l.push(e.w2ui.parent_recid);let s=n=A+1;for(;!(this.records.length<=s+1||null==this.records[s+1].w2ui||0<=l.indexOf(this.records[s+1].w2ui.parent_recid));)s++;this.records.splice(n,s-n+1),-1!==this.total&&(this.total-=s-n+1),("object"!=typeof this.url?this.url:this.url.get)||0<this.searchData.length&&this.localSearch(!0),!0!==t&&this.refresh(),r.finish()}else{if(0===o(this.box).find("#grid_"+this.name+"_rec_"+s+"_expanded_row").length||!0!==this.show.expandColumn)return!1;if(!0===(r=this.trigger("collapse",{target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+e+"_expanded"})).isCancelled)return!1;o(this.box).find("#grid_"+this.name+"_rec_"+s).removeAttr("expanded").removeClass("w2ui-expanded"),o(this.box).find("#grid_"+this.name+"_frec_"+s).removeAttr("expanded").removeClass("w2ui-expanded"),o(this.box).find("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),o(this.box).find("#grid_"+this.name+"_rec_"+s+"_expanded").css("height","0px"),o(this.box).find("#grid_"+this.name+"_frec_"+s+"_expanded").css("height","0px"),setTimeout((()=>{o(this.box).find("#grid_"+this.name+"_rec_"+s+"_expanded_row").remove(),o(this.box).find("#grid_"+this.name+"_frec_"+s+"_expanded_row").remove(),i.w2ui.expanded=!1,r.finish(),this.resizeRecords()}),300)}return!0}sort(e,t,A){var i=this.trigger("sort",{target:this.name,field:e,direction:t,multiField:A});if(!0!==i.isCancelled){if(null!=e){let i=this.sortData.length;for(let t=0;t<this.sortData.length;t++)if(this.sortData[t].field==e){i=t;break}if(null==t)if(null==(t=this.sortData[i]?.direction))null==this.last.originalSort&&(this.last.originalSort=this.records.map((e=>e.recid))),t="asc";else switch(t.toLowerCase()){case"asc":t="desc";break;case"desc":t="";break;default:t="asc"}1!=A&&(this.sortData=[],i=0),""===t?this.sortData.splice(i,1):(this.sortData[i]??={},Object.assign(this.sortData[i],{field:e,direction:t}))}else this.sortData=[];("object"!=typeof this.url?this.url:this.url.get)?(i.finish({direction:t}),this.last.fetch.offset=0,this.reload()):(this.localSort(!1,!0),0<this.searchData.length&&this.localSearch(!0),this.last.vscroll.scrollTop=0,o(this.box).find(`#grid_${this.name}_records`).prop("scrollTop",0),i.finish({direction:t}),this.refresh())}}copy(e,t){if(a.isPlainObject(e))return e.finish(),e.text;var A=this.getSelection();if(0===A.length)return"";let i,s="";if("object"==typeof A[0]){let e=A[0].column,t=A[0].column;var n=[];for(let i=0;i<A.length;i++)A[i].column<e&&(e=A[i].column),A[i].column>t&&(t=A[i].column),-1==n.indexOf(A[i].index)&&n.push(A[i].index);n.sort(((e,t)=>e-t));for(let A=0;A<n.length;A++){var r=n[A];for(let A=e;A<=t;A++)!0!==this.columns[A].hidden&&(s+=this.getCellCopy(r,A)+"\t");s=s.substr(0,s.length-1),s+="\n"}}else{for(let e=0;e<this.columns.length;e++){var o=this.columns[e];if(!0!==o.hidden){let e=o.text||o.field;o.text&&o.text.length<3&&o.tooltip&&(e=o.tooltip),s+='"'+a.stripTags(e)+'"\t'}}s=s.substr(0,s.length-1),s+="\n";for(let e=0;e<A.length;e++){var l=this.get(A[e],!0);for(let e=0;e<this.columns.length;e++)!0!==this.columns[e].hidden&&(s+='"'+this.getCellCopy(l,e)+'"\t');s=s.substr(0,s.length-1),s+="\n"}}return s=s.substr(0,s.length-1),null==e?!0===(i=this.trigger("copy",{target:this.name,text:s,cut:88==t.keyCode,originalEvent:t})).isCancelled?"":(s=i.detail.text,i.finish(),s):!1===e?!0===(i=this.trigger("copy",{target:this.name,text:s,cut:88==t.keyCode,originalEvent:t})).isCancelled?"":(s=i.detail.text,i):void 0}getCellCopy(e,t){return a.stripTags(this.getCellHTML(e,t))}paste(e,t){var A=this.getSelection();let i=this.get(A[0].recid,!0);var s,n,r,o=A[0].column;if(!0!==(t=this.trigger("paste",{target:this.name,text:e,index:i,column:o,originalEvent:t})).isCancelled){if(e=t.detail.text,"row"==this.selectType||0===A.length)console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected.");else{if("object"!=typeof e){var l=[];e=e.split("\n");for(let t=0;t<e.length;t++){var a=e[t].split("\t");let A=0;var d=this.records[i],c=[];if(null!=d){for(let e=0;e<a.length;e++)this.columns[o+A]&&(s=d,n=this.columns[o+A].field,r=a[e],s.w2ui=s.w2ui??{},s.w2ui.changes=s.w2ui.changes||{},s.w2ui.changes[n]=r,c.push(o+A),A++);for(let e=0;e<c.length;e++)l.push({recid:d.recid,column:c[e]});i++}}this.selectNone(!0),this.select(l)}else this.selectNone(!0),this.select([{recid:this.records[i],column:o}]);this.refresh()}t.finish()}}resize(){var e=Date.now();if(this.box&&o(this.box).attr("name")==this.name){var t=this.trigger("resize",{target:this.name});if(!0!==t.isCancelled)return null!=this.box&&(this.resizeBoxes(),this.resizeRecords()),t.finish(),Date.now()-e}}update({cells:e,fullCellRefresh:t,ignoreColumns:A}={}){var i=Date.now();let s=this;if(null==this.box)return 0;if(Array.isArray(e))for(let t=0;t<e.length;t++){var n=e[t].index,r=e[t].column;if(!(n<0))if(null==n||null==r)console.log("ERROR: Wrong argument for grid.update({ cells }), cells should be [{ index: X, column: Y }, ...]");else{var l=this.records[n]??{};l.w2ui=l.w2ui??{},l.w2ui._update=l.w2ui._update??{cells:[]};let e=l.w2ui._update.row1,t=l.w2ui._update.row2;null!=e&&e.isConnected&&null!=t&&t.isColSelected||(e=this.box.querySelector(`#grid_${this.name}_rec_`+a.escapeId(l.recid)),t=this.box.querySelector(`#grid_${this.name}_frec_`+a.escapeId(l.recid)),l.w2ui._update.row1=e,l.w2ui._update.row2=t),c(l,e,t,n,r)}}else for(let e=this.last.vscroll.recIndStart-1;e<=this.last.vscroll.recIndEnd;e++){let t=e;t=0<this.last.searchIds.length?this.last.searchIds[e]:e;var d=this.records[t];if(!(t<0||null==d)){d.w2ui=d.w2ui??{},d.w2ui._update=d.w2ui._update??{cells:[]};let e=d.w2ui._update.row1,A=d.w2ui._update.row2;null!=e&&e.isConnected&&null!=A&&A.isColSelected||(e=this.box.querySelector(`#grid_${this.name}_rec_`+a.escapeId(d.recid)),A=this.box.querySelector(`#grid_${this.name}_frec_`+a.escapeId(d.recid)),d.w2ui._update.row1=e,d.w2ui._update.row2=A);for(let i=0;i<this.columns.length;i++)c(d,e,A,t,i)}}return Date.now()-i;function c(e,i,n,r,l){var d=s.columns[l];if(!Array.isArray(A)||!A.includes(l)&&!A.includes(d.field)){let A=e.w2ui._update.cells[l];if(null!=A&&A.isConnected||(A=s.box.querySelector(`#grid_${s.name}_data_${r}_`+l),e.w2ui._update.cells[l]=A),null!=A){if(t)o(A).replace(s.getCellHTML(r,l,!1)),A=s.box.querySelector(`#grid_${s.name}_data_${r}_`+l),e.w2ui._update.cells[l]=A;else{var c=A.children[0],{value:r,style:h,className:u}=s.getCellValue(r,l,!1,!0);if(c.innerHTML!=r&&(c.innerHTML=r),""!=h&&A.style.cssText!=h&&(A.style.cssText=h),""!=u){let e=["w2ui-grid-data"],t=[];c=u.split(" ").filter((e=>!!e)),A.classList.forEach((A=>{e.includes(A)||t.push(A)})),A.classList.remove(...t),A.classList.add(...c)}}if(s.columns[l].style&&s.columns[l].style!=A.style.cssText&&(A.style.cssText=s.columns[l].style??""),null!=e.w2ui.class){if("string"==typeof e.w2ui.class){let t=["w2ui-odd","w2ui-even","w2ui-record"],A=[];r=e.w2ui.class.split(" ").filter((e=>!!e)),i&&n&&(i.classList.forEach((e=>{t.includes(e)||A.push(e)})),i.classList.remove(...A),i.classList.add(...r),n.classList.remove(...A),n.classList.add(...r))}if(a.isPlainObject(e.w2ui.class)&&"string"==typeof e.w2ui.class[d.field]){let t=["w2ui-grid-data"],i=[];h=e.w2ui.class[d.field].split(" ").filter((e=>!!e)),A.classList.forEach((e=>{t.includes(e)||i.push(e)})),A.classList.remove(...i),A.classList.add(...h)}}null!=e.w2ui.style&&(i&&n&&"string"==typeof e.w2ui.style&&i.style.cssText!==e.w2ui.style&&(i.style.cssText="height: "+s.recordHeight+"px;"+e.w2ui.style,i.setAttribute("custom_style",e.w2ui.style),n.style.cssText="height: "+s.recordHeight+"px;"+e.w2ui.style,n.setAttribute("custom_style",e.w2ui.style)),a.isPlainObject(e.w2ui.style))&&"string"==typeof e.w2ui.style[d.field]&&A.style.cssText!==e.w2ui.style[d.field]&&(A.style.cssText=e.w2ui.style[d.field])}}}}refreshCell(e,t){var A=this.get(e,!0),i=(t=this.getColumn(t,!0),e=!this.records[A]||this.records[A].recid!=e,o(this.box).find(`${e?".w2ui-grid-summary ":""}#grid_${this.name}_data_${A}_`+t));return 0!=i.length&&(i.replace(this.getCellHTML(A,t,e)),!0)}refreshRow(e,t=null){let A=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(e)),i=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(e));if(0<A.length){null==t&&(t=this.get(e,!0));var s=A.attr("line"),n=!this.records[t]||this.records[t].recid!=e,r="object"!=typeof this.url?this.url:this.url.get;if(0<this.searchData.length&&!r)for(let e=0;e<this.last.searchIds.length;e++)this.last.searchIds[e]==t&&(t=e);r=this.getRecordHTML(t,s,n),A.replace(r[0]),i.replace(r[1]);let l=this.records[t].w2ui?this.records[t].w2ui.style:"";return"string"==typeof l&&(A=o(this.box).find("#grid_"+this.name+"_frec_"+a.escapeId(e)),i=o(this.box).find("#grid_"+this.name+"_rec_"+a.escapeId(e)),A.attr("custom_style",l),i.attr("custom_style",l),A.hasClass("w2ui-selected")&&(l=l.replace("background-color","none")),A[0].style.cssText="height: "+this.recordHeight+"px;"+l,i[0].style.cssText="height: "+this.recordHeight+"px;"+l),n&&this.resize(),!0}return!1}refresh(){var e=Date.now(),t="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!t&&0===this.searchData.length&&(this.total=this.records.length),this.box&&!0!==(t=this.trigger("refresh",{target:this.name})).isCancelled){this.show.header?o(this.box).find(`#grid_${this.name}_header`).html(a.lang(this.header)+"&#160;").show():o(this.box).find(`#grid_${this.name}_header`).hide(),this.show.toolbar?o(this.box).find("#grid_"+this.name+"_toolbar").show():o(this.box).find("#grid_"+this.name+"_toolbar").hide(),this.searchClose();var A=o(this.box).find("#grid_"+this.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&0<this.searches.length&&(this.last.field=this.searches[0].field,this.last.label=this.searches[0].label);for(let e=0;e<this.searches.length;e++)this.searches[e].field==this.last.field&&(this.last.label=this.searches[e].label);if(this.last.multi?A.attr("placeholder","["+a.lang("Multiple Fields")+"]"):A.attr("placeholder",a.lang("Search")+" "+a.lang(this.last.label,!0)),A.val()!=this.last.search){let e=this.last.search;(i=A._w2field)&&(e=i.format(e)),A.val(e)}this.refreshSearch(),this.refreshBody(),this.show.footer?o(this.box).find(`#grid_${this.name}_footer`).html(this.getFooterHTML()).show():o(this.box).find(`#grid_${this.name}_footer`).hide();var i=this.last.selection,s=(A=0<this.records.length&&i.indexes.length==this.records.length,i=0<i.indexes.length&&0!==this.searchData.length&&i.indexes.length==this.last.searchIds.length,A||i?o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!0):o(this.box).find("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.find({"w2ui.expanded":!0},!0,!0));for(let e=0;e<s.length;e++){var n=this.records[s[e]].w2ui;n&&!Array.isArray(n.children)&&(n.expanded=!1)}return this.markSearch&&setTimeout((()=>{var e=[];for(let i=0;i<this.searchData.length;i++){var t=this.searchData[i],A=this.getSearch(t.field);A&&!A.hidden&&(A=this.getColumn(t.field,!0),e.push({field:t.field,search:t.value,col:A}))}0<e.length&&e.forEach((e=>{var t=o(this.box).find('td[col="'+e.col+'"]:not(.w2ui-head)');a.marker(t,e.search)}))}),50),this.updateToolbar(this.last.selection),t.finish(),this.resize(),this.addRange("selection"),setTimeout((()=>{this.resize(),this.scroll()}),1),this.reorderColumns&&!this.last.columnDrag?this.last.columnDrag=this.initColumnDrag():!this.reorderColumns&&this.last.columnDrag&&this.last.columnDrag.remove(),Date.now()-e}}refreshSearch(){if(this.multiSearch&&0<this.searchData.length){0==o(this.box).find(".w2ui-grid-searches").length&&o(this.box).find(".w2ui-grid-toolbar").css("height",this.last.toolbar_height+35+"px").append(`<div id="grid_${this.name}_searches" class="w2ui-grid-searches"></div>`);let e=`\n                <span id="grid_${this.name}_search_logic" class="w2ui-grid-search-logic"></span>\n                <div class="grid-search-line"></div>`;this.searchData.forEach(((t,A)=>{var i=this.getSearch(t.field,!0),s=this.searches[i];let n;if(n="enum"==s?.type&&Array.isArray(t.value)?`<span class="grid-search-count">${t.value.length}</span>`:"list"==s?.type&&t.text&&t.text!==t.value?": "+t.text:": "+t.value,s&&"date"==s.type)if("between"==t.operator){let e=t.value[0],A=t.value[1];Number(e)===e&&(e=a.formatDate(e)),Number(A)===A&&(A=a.formatDate(A)),n=`: ${e} - `+A}else{let e=t.value,A=(Number(e)==e&&(e=a.formatDate(e)),t.operator);"more:"==(A="less"==(A="more"==A?"since":A)?"before":A).substr(0,5)&&(A="since"),n=`: ${A} `+e}e+=`<span class="w2ui-action" data-click="searchFieldTooltip|${i}|${A}|this">\n                    ${s?s.label??s.field:t.field}\n                    ${n}\n                    <span class="icon-chevron-down"></span>\n                </span>`})),e+=`\n                ${this.show.searchSave?`<div class="grid-search-line"></div>\n                       <button class="w2ui-btn grid-search-btn" data-click="searchSave">${a.lang("Save")}</button>\n                      `:""}\n                <button class="w2ui-btn grid-search-btn btn-remove"\n                    data-click="searchReset">X</button>\n            `,o(this.box).find(`#grid_${this.name}_searches`).html(e),o(this.box).find(`#grid_${this.name}_search_logic`).html(a.lang("AND"==this.last.logic?"All":"Any"))}else o(this.box).find(".w2ui-grid-toolbar").css("height",this.last.toolbar_height+"px").find(".w2ui-grid-searches").remove();this.searchSelected?(o(this.box).find(`#grid_${this.name}_search_all`).val(" ").prop("readOnly",!0),o(this.box).find(`#grid_${this.name}_search_name`).show().find(".name-text").html(this.searchSelected.text)):(o(this.box).find(`#grid_${this.name}_search_all`).prop("readOnly",!1),o(this.box).find(`#grid_${this.name}_search_name`).hide().find(".name-text").html("")),a.bindEvents(o(this.box).find(`#grid_${this.name}_searches .w2ui-action, #grid_${this.name}_searches button`),this)}refreshBody(){this.scroll();var e=this.getRecordsHTML(),t=this.getColumnsHTML();e='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(a.scrollBarSize()-1)+'px;">'+e[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records">'+e[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+a.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+t[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+t[1]+"</tbody></table></div>"+`<div class="w2ui-intersection-marker" style="display: none; height: ${this.recordHeight-5}px">\n               <div class="top-marker"></div>\n               <div class="bottom-marker"></div>\n            </div>`;let A=o(this.box).find(`#grid_${this.name}_body`,this.box).html(e);t=o(this.box).find(`#grid_${this.name}_records`,this.box),e=o(this.box).find(`#grid_${this.name}_frecords`,this.box),"row"==this.selectType&&(t.on("mouseover mouseout",{delegate:"tr"},(e=>{var t=o(e.delegate).attr("index");t=this.records[t]?.recid,o(this.box).find(`#grid_${this.name}_frec_`+a.escapeId(t)).toggleClass("w2ui-record-hover","mouseover"==e.type)})),e.on("mouseover mouseout",{delegate:"tr"},(e=>{var t=o(e.delegate).attr("index");t=this.records[t]?.recid,o(this.box).find(`#grid_${this.name}_rec_`+a.escapeId(t)).toggleClass("w2ui-record-hover","mouseover"==e.type)}))),a.isMobile?t.append(e).on("click",{delegate:"tr"},(e=>{var t=o(e.delegate).attr("index");t=this.records[t]?.recid,this.dblClick(t,e)})):t.add(e).on("click",{delegate:"tr"},(e=>{var t=o(e.delegate).attr("index");t=this.records[t]?.recid,"-none-"!=t&&this.click(t,e)})).on("contextmenu",{delegate:"tr"},(e=>{var t=o(e.delegate).attr("index"),A=(t=this.records[t]?.recid,(A=o(e.target).closest("td")).attr("col")?parseInt(A.attr("col")):null);this.showContextMenu(t,A,e)})).on("mouseover",{delegate:"tr"},(e=>{this.last.rec_out=!1;let t=o(e.delegate).attr("index"),A=this.records[t]?.recid;t!==this.last.rec_over&&(this.last.rec_over=t,setTimeout((()=>{delete this.last.rec_out,this.trigger("mouseEnter",{target:this.name,originalEvent:e,index:t,recid:A}).finish()})))})).on("mouseout",{delegate:"tr"},(e=>{let t=o(e.delegate).attr("index"),A=this.records[t]?.recid;this.last.rec_out=!0,setTimeout((()=>{let i=()=>{this.trigger("mouseLeave",{target:this.name,originalEvent:e,index:t,recid:A}).finish()};t!==this.last.rec_over&&i(),setTimeout((()=>{this.last.rec_out&&(delete this.last.rec_out,delete this.last.rec_over,i())}))}))})),A.data("scroll",{lastDelta:0,lastTime:0}).find(".w2ui-grid-frecords").on("mousewheel DOMMouseScroll ",(e=>{e.preventDefault();var t=A.data("scroll"),i=A.find(".w2ui-grid-records"),s=(e=null!=typeof e.wheelDelta?-e.wheelDelta:e.detail||e.deltaY,i.prop("scrollTop"));t.lastDelta+=e,e=Math.round(t.lastDelta),A.data("scroll",t),i.get(0).scroll({top:s+e,behavior:"smooth"})})),t.off(".body-global").on("scroll.body-global",{delegate:".w2ui-grid-records"},(e=>{this.scroll(e)})),o(this.box).find(".w2ui-grid-body").off(".body-global").on("click.body-global dblclick.body-global contextmenu.body-global",{delegate:"td.w2ui-head"},(e=>{var t=o(e.delegate).attr("col"),A=this.columns[t]??{field:t};switch(e.type){case"click":this.columnClick(A.field,e);break;case"dblclick":this.columnDblClick(A.field,e);break;case"contextmenu":this.columnContextMenu(A.field,e)}})).on("mouseover.body-global",{delegate:".w2ui-col-header"},(e=>{let t=o(e.delegate).parent().attr("col");this.columnTooltipShow(t,e),o(e.delegate).off(".tooltip").on("mouseleave.tooltip",(()=>{this.columnTooltipHide(t,e)}))})).on("click.body-global",{delegate:"input.w2ui-select-all"},(e=>{e.delegate.checked?this.selectAll():this.selectNone(),e.stopPropagation(),clearTimeout(this.last.kbd_timer)})).on("click.body-global",{delegate:".w2ui-show-children, .w2ui-col-expand"},(e=>{e.stopPropagation(),e=o(e.target).parents("tr").attr("index"),this.toggle(this.records[e].recid)})).on("click.body-global mouseover.body-global",{delegate:".w2ui-info"},(e=>{var t=o(e.delegate).closest("td"),A=t.parent(),i=this.columns[t.attr("col")],s=A.parents(".w2ui-grid-body").hasClass("w2ui-grid-summary");["mouseenter","mouseover"].includes(i.info?.showOn?.toLowerCase())&&"mouseover"==e.type?this.showBubble(A.attr("index"),t.attr("col"),s).then((()=>{o(e.delegate).off(".tooltip").on("mouseleave.tooltip",(()=>{g.hide(this.name+"-bubble")}))})):"click"==e.type&&(g.hide(this.name+"-bubble"),this.showBubble(A.attr("index"),t.attr("col"),s))})).on("mouseover.body-global",{delegate:".w2ui-clipboard-copy"},(e=>{if(!e.delegate._tooltipShow){let A=o(e.delegate).parent(),i=A.parent();var t=this.columns[A.attr("col")];let s=i.parents(".w2ui-grid-body").hasClass("w2ui-grid-summary");g.show({name:this.name+"-bubble",anchor:e.delegate,html:a.lang("string"==typeof t.clipboardCopy?t.clipboardCopy:"Copy to clipboard"),position:"top|bottom",offsetY:-2}).hide((t=>{e.delegate._tooltipShow=!1,o(e.delegate).off(".tooltip")})),o(e.delegate).off(".tooltip").on("mouseleave.tooltip",(e=>{g.hide(this.name+"-bubble")})).on("click.tooltip",(e=>{e.stopPropagation(),g.update(this.name+"-bubble",a.lang("Copied")),this.clipboardCopy(i.attr("index"),A.attr("col"),s)})),e.delegate._tooltipShow=!0}})).on("click.body-global",{delegate:".w2ui-editable-checkbox"},(e=>{var t=o(e.delegate).data();this.editChange.call(this,e.delegate,t.changeind,t.colind,e),this.updateToolbar()})),0===this.records.length&&this.msgEmpty?o(this.box).find(`#grid_${this.name}_body`).append(`<div id="grid_${this.name}_empty_msg" class="w2ui-grid-empty-msg"><div>${a.lang(this.msgEmpty)}</div></div>`):0<o(this.box).find(`#grid_${this.name}_empty_msg`).length&&o(this.box).find(`#grid_${this.name}_empty_msg`).remove(),0<this.summary.length?(e=this.getSummaryHTML(),o(this.box).find(`#grid_${this.name}_fsummary`).html(e[0]).show(),o(this.box).find(`#grid_${this.name}_summary`).html(e[1]).show()):(o(this.box).find(`#grid_${this.name}_fsummary`).hide(),o(this.box).find(`#grid_${this.name}_summary`).hide())}render(e){var t=Date.now();let A=this;"string"==typeof e&&(e=o(e).get(0));var i=this.trigger("render",{target:this.name,box:e??this.box});if(!0!==i.isCancelled&&(null!=e&&(this.unmount(),this.box=e),this.box)){if(e="object"!=typeof this.url?this.url:this.url.get,this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label="All Fields";else{let h=0;for(;h<this.searches.length&&(this.searches[h].hidden||!1===this.searches[h].simple);)h++;h>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[h].field,this.last.label=this.searches[h].label)}if(o(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid w2ui-inactive").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input" '+(this.tabIndex?'tabindex="'+this.tabIndex+'"':"")+(a.isMobile?"readonly":"")+"></textarea></div>"),"row"!=this.selectType&&o(this.box).addClass("w2ui-ss"),0<o(this.box).length&&(o(this.box)[0].style.cssText+=this.style),null!=this.toolbar&&this.toolbar.render(o(this.box).find("#grid_"+this.name+"_toolbar")[0]),this.last.toolbar_height=o(this.box).find(`#grid_${this.name}_toolbar`).prop("offsetHeight"),this.last.field&&"all"!=this.last.field){let u=this.searchData;setTimeout((()=>{this.searchInitInput(this.last.field,1==u.length?u[0].value:null)}),1)}o(this.box).find(`#grid_${this.name}_footer`).html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),e&&(this.clear(),this.refresh());let s,n=!1;for(let p=0;p<this.searches.length;p++)if(this.searches[p].hidden){n=!0;break}return n?(this.searchReset(!1),e||setTimeout((()=>{this.searchReset()}),1)):this.reload(),o(this.box).find(`#grid_${this.name}_focus`).on("focus",(e=>{clearTimeout(this.last.kbd_timer),this.hasFocus||this.focus()})).on("blur",(e=>{clearTimeout(this.last.kbd_timer),this.last.kbd_timer=setTimeout((()=>{this.hasFocus&&this.blur()}),100)})).on("paste",(e=>{var t=e.clipboardData||null;if(t){let s=t.items,n=[];for(var A in s=2==s.length&&2==(s=2==s.length&&"file"==s[1].kind?[s[1]]:s).length&&"text/plain"==s[0].type&&"text/html"==s[1].type?[s[1]]:s)if("file"===(A=s[A]).kind){var i=A.getAsFile();n.push({kind:"file",data:i})}else if("string"===A.kind&&("text/plain"===A.type||"text/html"===A.type)){e.preventDefault();let i=t.getData("text/plain");-1!=i.indexOf("\r")&&-1==i.indexOf("\n")&&(i=i.replace(/\r/g,"\n")),n.push({kind:"text/html"==A.type?"html":"text",data:i})}1===n.length&&"file"!=n[0].kind&&(n=n[0].data),l[this.name].paste(n,e),e.preventDefault()}})).on("keydown",(function(e){l[A.name].keydown.call(l[A.name],e)})),o(this.box).off("mousedown.mouseStart").on("mousedown.mouseStart",(function(e){if(1==e.which&&("text"==A.last.userSelect&&(A.last.userSelect="",o(A.box).find(".w2ui-grid-body").css("user-select","none")),!("row"==A.selectType&&(o(e.target).parents().hasClass("w2ui-head")||o(e.target).hasClass("w2ui-head"))||A.last.move&&"expand"==A.last.move.type))){if(e.altKey)o(A.box).find(".w2ui-grid-body").css("user-select","text"),A.selectNone(),A.last.move={type:"text-select"},A.last.userSelect="text";else{let r=e.target;var t={x:e.offsetX-10,y:e.offsetY-10};let l=!1;for(;r&&(!r.classList||!r.classList.contains("w2ui-grid"));)r.tagName&&"TD"==r.tagName.toUpperCase()&&(l=!0),r.tagName&&"TR"!=r.tagName.toUpperCase()&&1==l&&(t.x+=r.offsetLeft,t.y+=r.offsetTop),r=r.parentNode;var i=o(e.target).parents("tr").attr("index");if(i=A.records[i]?.recid,"cell"==A.selectType&&!e.shiftKey){let t=parseInt(o(e.target).closest("td").attr("col")),s=t;isNaN(t)&&(t=0,s=A.columns.length-1),A.addRange({name:"selection-preview",range:[{recid:i,column:t},{recid:i,column:s}],class:"w2ui-selection-preview"})}A.last.move={x:e.screenX,y:e.screenY,divX:0,divY:0,focusX:t.x,focusY:t.y,recid:i,column:parseInt(("TD"==e.target.tagName.toUpperCase()?o(e.target):o(e.target).parents("td")).attr("col")),type:"select",ghost:!1,start:!0},null==A.last.move.recid&&0<A.records.length&&(A.last.move.type="select-column",i=parseInt(o(e.target).closest("td").attr("col")),s=A.records[0].recid,n=A.records[A.records.length-1].recid,A.addRange({name:"selection-preview",range:[{recid:s,column:i},{recid:n,column:i}],class:"w2ui-selection-preview"}));let a=e.target,d=o(A.box).find("#grid_"+A.name+"_focus");if(A.last.move){let e=A.last.move.focusX,t=A.last.move.focusY;var s=o(a).parents("table").parent();(s.hasClass("w2ui-grid-records")||s.hasClass("w2ui-grid-frecords")||s.hasClass("w2ui-grid-columns")||s.hasClass("w2ui-grid-fcolumns")||s.hasClass("w2ui-grid-summary"))&&(e=A.last.move.focusX-o(A.box).find("#grid_"+A.name+"_records").prop("scrollLeft"),t=A.last.move.focusY-o(A.box).find("#grid_"+A.name+"_records").prop("scrollTop")),(o(a).hasClass("w2ui-grid-footer")||0<o(a).parents("div.w2ui-grid-footer").length)&&(t=o(A.box).find("#grid_"+A.name+"_footer").get(0).offsetTop),s.hasClass("w2ui-scroll-wrapper")&&s.parent().hasClass("w2ui-toolbar")&&(e=A.last.move.focusX-s.prop("scrollLeft")),d.css({left:e-10,top:t})}setTimeout((()=>{A.last.inEditMode||(["INPUT","TEXTAREA","SELECT"].includes(a.tagName)?a.focus():d.get(0)!==document.active&&d.get(0)?.focus({preventScroll:!0}))}),50),A.multiSelect||A.reorderRows||"drag"!=A.last.move.type||delete A.last.move}if(1==A.reorderRows){let t=e.target;var n,l,a,c,h;"TD"!=t.tagName.toUpperCase()&&(t=o(t).parents("td")[0]),o(t).hasClass("w2ui-col-number")||o(t).hasClass("w2ui-col-order")?(A.selectNone(),A.last.move.reorder=!0,n=o(A.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),i=o(A.box).find(".w2ui-odd.w2ui-empty-record").css("background-color"),o(A.box).find(".w2ui-even td").filter(":not(.w2ui-col-number)").css("background-color",n),o(A.box).find(".w2ui-odd td").filter(":not(.w2ui-col-number)").css("background-color",i),l=A.last.move,a=o(A.box).find(".w2ui-grid-records"),l.ghost||(h=(c=o(A.box).find(`#grid_${A.name}_rec_`+l.recid)).parents("table").find("tr:first-child").get(0).cloneNode(!0),l.offsetY=e.offsetY,l.from=l.recid,l.pos={top:c.get(0).offsetTop-1,left:c.get(0).offsetLeft},l.ghost=o(c.get(0).cloneNode(!0)),l.ghost.removeAttr("id"),l.ghost.find("td").css({"border-top":"1px solid silver","border-bottom":"1px solid silver"}),c.find("td").remove(),c.append(`<td colspan="1000"><div class="w2ui-reorder-empty" style="height: ${A.recordHeight-2}px"></div></td>`),a.append('<div id="grid_'+A.name+'_ghost_line" style="position: absolute; z-index: 999999; pointer-events: none; width: 100%;"></div>'),a.append('<table id="grid_'+A.name+'_ghost" style="position: absolute; z-index: 999998; opacity: 0.9; pointer-events: none;"></table>'),o(A.box).find("#grid_"+A.name+"_ghost").append(h).append(l.ghost)),o(A.box).find("#grid_"+A.name+"_ghost").css({top:l.pos.top+"px",left:l.pos.left+"px"})):A.last.move.reorder=!1}o(document).on("mousemove.w2ui-"+A.name,r).on("mouseup.w2ui-"+A.name,d),e.stopPropagation()}})),this.updateToolbar(),i.finish(),this.last.observeResize=new ResizeObserver((()=>{this.resize(),this.scroll()})),this.last.observeResize.observe(this.box),Date.now()-t;function r(e){if(e.target.tagName){var t=A.last.move;if(t&&["select","select-column"].includes(t.type)&&(t.divX=e.screenX-t.x,t.divY=e.screenY-t.y,!(Math.abs(t.divX)<=1&&Math.abs(t.divY)<=1)))if(A.last.cancelClick=!0,1==A.reorderRows&&A.last.move.reorder){var i=o(e.target).parents("tr").attr("index");let s=A.records[i]?.recid;(s="-none-"!=s&&null!=s?s:"bottom")!=t.from&&(i=o(A.box).find("#grid_"+A.name+"_rec_"+s),o(A.box).find(".insert-before"),i.addClass("insert-before"),t.lastY=e.screenY,t.to=s,i={top:i.get(0)?.offsetTop,left:i.get(0)?.offsetLeft},o(A.box).find("#grid_"+A.name+"_ghost_line").css({top:i.top+"px",left:t.pos.left+"px","border-top":"2px solid #769EFC"})),o(A.box).find("#grid_"+A.name+"_ghost").css({top:t.pos.top+t.divY+"px",left:t.pos.left+"px"})}else{"row"==A.selectType&&t.start&&t.recid&&(A.selectNone(),t.start=!1);var n=[];if(i=("TR"==e.target.tagName.toUpperCase()?o(e.target):o(e.target).parents("tr")).attr("index"),i=A.records[i]?.recid,null==i){if("row"!=A.selectType&&(!A.last.move||"select"!=A.last.move.type)){var r=parseInt(o(e.target).parents("td").attr("col"));if(isNaN(r))A.removeRange("column-selection"),o(A.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),o(A.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete t.colRange;else{let e=r+"-"+r;t.column<r&&(e=t.column+"-"+r);var l=[],a=(e=t.column>r?r+"-"+t.column:e).split("-");for(let e=parseInt(a[0]);e<=parseInt(a[1]);e++)l.push(e);t.colRange!=e&&"select-column"==t.type&&!0!==(s=A.trigger("columnSelect",{target:A.name,columns:l})).isCancelled&&(t.colRange=e,r=A.records[0].recid,c=A.records[A.records.length-1].recid,A.addRange({name:"selection-preview",range:[{recid:r,column:a[0]},{recid:c,column:a[1]}],class:"w2ui-selection-preview"}))}}}else{let s=A.get(t.recid,!0);if(!(null==s||A.records[s]&&A.records[s].recid!=t.recid)){let l=A.get(i,!0);if(null!=l){let a=parseInt(t.column),u=parseInt(("TD"==e.target.tagName.toUpperCase()?o(e.target):o(e.target).parents("td")).attr("col"));isNaN(a)&&isNaN(u)&&(a=0,u=A.columns.length-1),s>l&&(r=s,s=l,l=r);var d,c="ind1:"+s+",ind2;"+l+",col1:"+a+",col2:"+u;if(t.range!=c){t.range=c;for(let e=s;e<=l;e++)if(!(0<A.last.searchIds.length&&-1==A.last.searchIds.indexOf(e)))if("row"!=A.selectType){a>u&&(d=a,a=u,u=d);for(let t=a;t<=u;t++)A.columns[t].hidden||n.push({recid:A.records[e].recid,column:parseInt(t)})}else n.push(A.records[e].recid);if("row"!=A.selectType)i=n[0],e=n[n.length-1],A.addRange({name:"selection-preview",range:[{recid:i.recid,column:i.column},{recid:e.recid,column:e.column}],class:"w2ui-selection-preview"}),t.newRange=n;else if(A.multiSelect){var h=A.getSelection();for(let e=0;e<n.length;e++)-1==h.indexOf(n[e])&&A.select(n[e]);for(let e=0;e<h.length;e++)-1==n.indexOf(h[e])&&A.unselect(h[e])}}}}}}}}function d(e){var t=A.last.move;if(setTimeout((()=>{delete A.last.cancelClick}),1),!o(e.target).parents().hasClass(".w2ui-head")&&!o(e.target).hasClass(".w2ui-head")){if(A.removeRange("selection-preview"),t&&["select","select-column"].includes(t.type)){if(null!=t.colRange&&!0!==s.isCancelled){var i=t.colRange.split("-"),n=[];for(let e=0;e<A.records.length;e++){var r=[];for(let e=parseInt(i[0]);e<=parseInt(i[1]);e++)r.push(e);n.push({recid:A.records[e].recid,column:r})}s.finish(),A.selectNone(!0),A.select(n)}else null!=t.newRange&&(A.selectNone(!0),A.select(...t.newRange));if(1==A.reorderRows&&A.last.move.reorder)if(null!=t.to){if(!0===(e=A.trigger("reorderRow",{target:A.name,recid:t.from,moveBefore:t.to})).isCancelled)return c(),void delete A.last.move;var l=A.get(t.from,!0);let i=A.get(t.to,!0);"bottom"==t.to&&(i=A.records.length),t=A.records[l],null!=l&&null!=i&&(A.records.splice(l,1),l>i?A.records.splice(i,0,t):A.records.splice(i-1,0,t)),A.sortData=[],o(A.box).find(`#grid_${A.name}_columns .w2ui-col-header`).removeClass("w2ui-col-sorted"),c(),e.finish()}else c()}delete A.last.move,o(document).off(".w2ui-"+A.name)}}function c(){o(A.box).find(`#grid_${A.name}_ghost`).remove(),o(A.box).find(`#grid_${A.name}_ghost_line`).remove(),A.refresh(),delete A.last.move}}}unmount(){super.unmount(),this.toolbar?.unmount(),this.last.observeResize?.disconnect()}destroy(){var e=this.trigger("destroy",{target:this.name});!0!==e.isCancelled&&(this.toolbar?.destroy?.(),0<o(this.box).find(`#grid_${this.name}_body`).length&&this.unmount(),delete l[this.name],e.finish())}initColumnOnOff(){var e,t=[{id:"line-numbers",text:"Line #",checked:this.show.lineNumbers}];for(let e=0;e<this.columns.length;e++){var A=this.columns[e];let i=this.columns[e].text;!1!==A.hideable&&(i=(i=!i&&this.columns[e].tooltip?this.columns[e].tooltip:i)||"- column "+(parseInt(e)+1)+" -",t.push({id:A.field,text:a.stripTags(i),checked:!A.hidden}))}(("object"!=typeof this.url?this.url:this.url.get)&&this.show.skipRecords||this.show.saveRestoreState)&&t.push({text:"--"}),this.show.skipRecords&&(e=a.lang("Skip")+`<input id="${this.name}_skip" type="text" class="w2ui-input w2ui-grid-skip" value="${this.offset}">`+a.lang("records"),t.push({id:"w2ui-skip",text:e,group:!1,icon:"w2ui-icon-empty"})),this.show.saveRestoreState&&t.push({id:"w2ui-stateSave",text:a.lang("Save Grid State"),icon:"w2ui-icon-empty",group:!1},{id:"w2ui-stateReset",text:a.lang("Restore Default State"),icon:"w2ui-icon-empty",group:!1});let i=[];return t.forEach((e=>{e.text=a.lang(e.text),e.checked&&i.push(e.id)})),this.toolbar.set("w2ui-column-on-off",{selected:i,items:t}),t}initColumnDrag(e){if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";let t=this,A={pressed:!1,targetPos:null,columnHead:null},i=(e,t)=>{var A=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"];!0!==t&&A.push("w2ui-head-last");for(let t=0;t<A.length;t++)if(o(e).closest(".w2ui-head").hasClass(A[t]))return!0;return!1};function s(e){var s,n,r,l;A.pressed&&A.columnHead&&(s=e.pageX,n=e.pageY,i(e.target,!0)||0!=o(e.target).closest("td").length&&(r=(r=o(e.target).closest("td")).hasClass("w2ui-head-last")?t.columns.length:parseInt(r.attr("col")),A.targetPos!=r)&&(l=o(t.box).find(".w2ui-grid-body").get(0).getBoundingClientRect(),e=o(e.target).closest("td").get(0).getBoundingClientRect(),o(t.box).find(".w2ui-intersection-marker").show().css({left:e.left-l.left+"px",height:e.height+"px"}),A.targetPos=r),l=s,e=n,o(A.ghost).css({left:l-10+"px",top:e-10+"px"}).show())}function n(e){if(A.pressed&&A.columnHead){A.pressed=!1;var i,s,n=()=>{var e=o(t.box).find(".w2ui-grid-ghost");o(t.box).find(".w2ui-intersection-marker").hide(),o(A.ghost).remove(),e.remove(),o(document).off(".colDrag"),A={}};if(e.pageX==A.initialX&&e.pageY==A.initialY)t.columnClick(t.columns[A.originalPos].field,e),n();else{if(!0===(e=t.trigger("columnDragEnd",{originalEvent:e,target:A.columnHead[0],dragData:A})).isCancelled)return!1;i=t.columns[A.originalPos],s=t.columns,A.originalPos!=A.targetPos&&null!=A.targetPos&&(s.splice(A.targetPos,0,a.clone(i)),s.splice(s.indexOf(i),1)),n(),t.refresh(),e.finish({targetColumn:NaN})}}}return o(t.box).off(".colDrag").on("mousedown.colDrag",(function(e){var r,l;if(!A.pressed&&0!==A.numberPreColumnsPresent&&0===e.button&&o(e.target).parents().hasClass("w2ui-head")&&!i(e.target)){if(A.pressed=!0,A.initialX=e.pageX,A.initialY=e.pageY,A.numberPreColumnsPresent=o(t.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length,A.columnHead=d=o(e.target).closest(".w2ui-head"),A.originalPos=l=parseInt(d.attr("col"),10),!0===(l=t.trigger("columnDragStart",{originalEvent:e,origColumnNumber:l,target:d[0]})).isCancelled)return!1;r=A.columns=o(t.box).find(".w2ui-head:not(.w2ui-head-last)"),o(document).on("mouseup.colDrag",n),o(document).on("mousemove.colDrag",s);var d=t.columns[A.originalPos];d=a.lang("function"==typeof d.text?d.text(d):d.text),A.ghost=o.html(`<span col="${A.originalPos}">${d}</span>`)[0],o(document.body).append(A.ghost),o(A.ghost).css({display:"none",left:e.pageX,top:e.pageY,opacity:1,margin:"3px 0 0 20px",padding:"3px","background-color":"white",position:"fixed","z-index":999999}).addClass(".w2ui-grid-ghost"),A.offsets=[];for(let e=0,t=r.length;e<t;e++){var c=r[e].getBoundingClientRect();A.offsets.push(c.left)}l.finish()}})),{remove(){o(t.box).off(".colDrag"),t.last.columnDrag=!1}}}columnOnOff(e,t){if(!0!==(e=this.trigger("columnOnOff",{target:this.name,field:t,originalEvent:e})).isCancelled){var A=this.find({"w2ui.expanded":!0},!0);for(let e=0;e<A.length;e++){var i=this.records[e].w2ui;i&&!Array.isArray(i.children)&&(this.records[e].w2ui.expanded=!1)}"line-numbers"==t?(this.show.lineNumbers=!this.show.lineNumbers,this.refresh()):(t=this.getColumn(t)).hidden?this.showColumn(t.field):this.hideColumn(t.field),e.finish()}}initToolbar(){if(null==this.toolbar.render){let t=this.toolbar.items||[];var e;this.toolbar.items=[],this.toolbar=new B(a.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push(a.extend({},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push(a.extend({},this.buttons.columns)),this.show.toolbarSearch&&(e=`\n                <div class="w2ui-grid-search-input">\n                    ${this.buttons.search.html}\n                    <div id="grid_${this.name}_search_name" class="w2ui-grid-search-name">\n                        <span class="name-icon w2ui-icon-search"></span>\n                        <span class="name-text"></span>\n                        <span class="name-cross w2ui-action" data-click="searchReset">x</span>\n                    </div>\n                    <input type="text" id="grid_${this.name}_search_all" class="w2ui-search-all" tabindex="-1"\n                        autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"\n                        placeholder="${a.lang(this.last.label,!0)}" value="${this.last.search}"\n                        data-focus="searchSuggest" data-click="stop"\n                    >\n                    <div class="w2ui-search-drop w2ui-action" data-click="searchOpen"\n                            style="${this.multiSearch?"":"display: none"}">\n                        <span class="w2ui-icon-drop"></span>\n                    </div>\n                </div>`,this.toolbar.items.push({id:"w2ui-search",type:"html",html:e,onRefresh:async e=>{await e.complete,e=o(this.box).find(`#grid_${this.name}_search_all`),a.bindEvents(o(this.box).find(`#grid_${this.name}_search_all, .w2ui-action`),this);let t=a.debounce((e=>{e=e.target.value,this.liveSearch&&this.last.liveText!=e&&(this.last.liveText=e,this.search(this.last.field,e))}),250);e.on("blur",(()=>{this.last.liveText=""})).on("keyup",(e=>{switch(e.keyCode){case 40:this.searchSuggest(!0);break;case 38:this.searchSuggest(!0,!0);break;case 13:this.search(this.last.field,e.target.value);break;default:t(e)}}))}})),Array.isArray(t)&&(e=t.map((e=>e.id)),this.show.toolbarAdd&&!e.includes(this.buttons.add.id)&&this.toolbar.items.push(a.extend({},this.buttons.add)),this.show.toolbarEdit&&!e.includes(this.buttons.edit.id)&&this.toolbar.items.push(a.extend({},this.buttons.edit)),this.show.toolbarDelete&&!e.includes(this.buttons.delete.id)&&this.toolbar.items.push(a.extend({},this.buttons.delete)),this.show.toolbarSave&&!e.includes(this.buttons.save.id)&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push(a.extend({},this.buttons.save))),t=t.map((e=>this.buttons[e.name]?a.extend({},this.buttons[e.name],e):e))),this.toolbar.items.push(...t),this.toolbar.on("click",(e=>{var t=this.trigger("toolbar",{target:e.target,originalEvent:e});if(!0!==t.isCancelled){let i;switch(e.detail.item.id){case"w2ui-reload":if(!0===(i=this.trigger("reload",{target:this.name})).isCancelled)return!1;this.reload(),i.finish();break;case"w2ui-column-on-off":e.detail.subItem?(A=e.detail.subItem.id,["w2ui-stateSave","w2ui-stateReset"].includes(A)?this[A.substring(5)]():"w2ui-skip"!=A&&this.columnOnOff(e,e.detail.subItem.id)):(this.initColumnOnOff(),setTimeout((()=>{o(`#w2overlay-${this.name}_toolbar-drop .w2ui-grid-skip`).off(".w2ui-grid").on("click.w2ui-grid",(e=>{e.stopPropagation()})).on("keypress",(e=>{13==e.keyCode&&(this.skip(e.target.value),this.toolbar.click("w2ui-column-on-off"))}))}),100));break;case"w2ui-add":if(!0===(i=this.trigger("add",{target:this.name,recid:null})).isCancelled)return!1;i.finish();break;case"w2ui-edit":{var A=this.getSelection();let e=null;if(1==A.length&&(e=A[0]),!0===(i=this.trigger("edit",{target:this.name,recid:e})).isCancelled)return!1;i.finish();break}case"w2ui-delete":this.delete();break;case"w2ui-save":this.save()}t.finish()}})),this.toolbar.on("refresh",(e=>{if("w2ui-search"==e.target){let e=this.searchData;setTimeout((()=>{this.searchInitInput(this.last.field,1==e.length?e[0].value:null)}),1)}}))}}initResize(){let e=this;o(this.box).find(".w2ui-resizer").off(".grid-col-resize").on("click.grid-col-resize",(function(e){e.stopPropagation(),e.preventDefault()})).on("mousedown.grid-col-resize",(function(t){t=t||window.event,e.last.colResizing=!0,e.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt(o(this).attr("name"))},e.last.tmp.tds=o(e.box).find("#grid_"+e.name+'_body table tr:first-child td[col="'+e.last.tmp.col+'"]'),t.stopPropagation(),t.preventDefault();for(let t=0;t<e.columns.length;t++)e.columns[t].hidden||(null==e.columns[t].sizeOriginal&&(e.columns[t].sizeOriginal=e.columns[t].size),e.columns[t].size=e.columns[t].sizeCalculated);let A,i=e.trigger("columnResize",{target:e.name,resizeBy:0,originalEvent:t,column:e.last.tmp.col,field:e.columns[e.last.tmp.col].field});o(document).off(".grid-col-resize").on("mousemove.grid-col-resize",(function(t){var s,n;1==e.last.colResizing&&(t=t||window.event,!0!==(s=e.trigger("columnResizeMove",a.extend(i.detail,{resizeBy:t.screenX-e.last.tmp.gx,originalEvent:t}))).isCancelled)&&(e.last.tmp.x=t.screenX-e.last.tmp.x,e.last.tmp.y=t.screenY-e.last.tmp.y,n=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px",e.columns[e.last.tmp.col].size=n,A&&clearTimeout(A),A=setTimeout((()=>{e.resizeRecords(),e.scroll()}),100),e.last.tmp.tds.css({width:n}),e.last.tmp.x=t.screenX,e.last.tmp.y=t.screenY,s.finish())})).on("mouseup.grid-col-resize",(function(t){o(document).off(".grid-col-resize"),e.resizeRecords(),e.scroll(),i.finish({originalEvent:t}),setTimeout((()=>{e.last.colResizing=!1}),1)}))})).on("dblclick.grid-col-resize",(function(t){var A=parseInt(o(this).attr("name"));e.columnAutoSize(A),t.stopPropagation(),t.preventDefault()})).each((e=>{var t=o(e).get(0).parentNode;o(e).css({height:t.clientHeight+"px","margin-left":t.clientWidth-3+"px"})}))}resizeBoxes(){var e=o(this.box).find(`#grid_${this.name}_header`),t=o(this.box).find(`#grid_${this.name}_toolbar`),A=o(this.box).find(`#grid_${this.name}_fsummary`),i=o(this.box).find(`#grid_${this.name}_summary`),s=o(this.box).find(`#grid_${this.name}_footer`),n=o(this.box).find(`#grid_${this.name}_body`);this.show.header&&e.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&t.css({top:0+(this.show.header?a.getSize(e,"height"):0)+"px",left:"0px",right:"0px"}),0<this.summary.length&&(A.css({bottom:0+(this.show.footer?a.getSize(s,"height"):0)+"px"}),i.css({bottom:0+(this.show.footer?a.getSize(s,"height"):0)+"px",right:"0px"})),this.show.footer&&s.css({bottom:"0px",left:"0px",right:"0px"}),n.css({top:0+(this.show.header?a.getSize(e,"height"):0)+(this.show.toolbar?a.getSize(t,"height"):0)+"px",bottom:0+(this.show.footer?a.getSize(s,"height"):0)+(0<this.summary.length?a.getSize(i,"height"):0)+"px",left:"0px",right:"0px"})}resizeRecords(){let e=this;o(this.box).find(".w2ui-empty-record").remove();var t,A=o(this.box),i=o(this.box).find(":scope > div.w2ui-grid-box"),s=o(this.box).find(`#grid_${this.name}_header`),n=o(this.box).find(`#grid_${this.name}_toolbar`),r=o(this.box).find(`#grid_${this.name}_summary`),l=o(this.box).find(`#grid_${this.name}_fsummary`),d=o(this.box).find(`#grid_${this.name}_footer`),c=o(this.box).find(`#grid_${this.name}_body`),h=o(this.box).find(`#grid_${this.name}_columns`),u=o(this.box).find(`#grid_${this.name}_fcolumns`),p=o(this.box).find(`#grid_${this.name}_records`),g=o(this.box).find(`#grid_${this.name}_frecords`),m=o(this.box).find(`#grid_${this.name}_scroll1`);let f=8*String(this.total).length+10,w=(f<34&&(f=34),null!=this.lineNumberWidth&&(f=this.lineNumberWidth),!1),B=!1,y=0;for(let e=0;e<this.columns.length;e++)this.columns[e].frozen||this.columns[e].hidden||(y+=parseInt(this.columns[e].sizeCalculated||this.columns[e].size));p[0]?.clientWidth<y&&(w=!0),c[0]?.clientHeight-(h[0]?.clientHeight??0)<(o(p).find(":scope > table")[0]?.clientHeight??0)+(w?a.scrollBarSize():0)&&(B=!0),this.fixedBody?(t=i[0]?.clientHeight-(this.show.header?a.getSize(s,"height"):0)-(this.show.toolbar?a.getSize(n,"height"):0)-("none"!=r.css("display")?a.getSize(r,"height"):0)-(this.show.footer?a.getSize(d,"height"):0),c.css("height",t+"px")):(s=(t=a.getSize(h,"height")+a.getSize(o(this.box).find("#grid_"+this.name+"_records table"),"height")+(w?a.scrollBarSize():0))+(this.show.header?a.getSize(s,"height"):0)+(this.show.toolbar?a.getSize(n,"height"):0)+("none"!=r.css("display")?a.getSize(r,"height"):0)+(this.show.footer?a.getSize(d,"height"):0),i.css("height",s+"px"),c.css("height",t+"px"),A.css("height",a.getSize(i,"height")+"px"));let b,v,C=this.records.length;if(n="object"!=typeof this.url?this.url:this.url.get,0==this.searchData.length||n||(C=this.last.searchIds.length),this.fixedBody||(B=!1),w||B?(h.find(":scope > table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",a.scrollBarSize()+"px").show(),p.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+a.getSize(h,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":w?"auto":"hidden","overflow-y":B?"auto":"hidden"})):(h.find(":scope > table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),p.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+a.getSize(h,"height")+"px",overflow:"hidden"}),0<p.length&&(this.last.vscroll.scrollTop=0,this.last.vscroll.scrollLeft=0)),w?(g.css("margin-bottom",a.scrollBarSize()+"px"),m.show()):(g.css("margin-bottom",0),m.hide()),g.css({overflow:"hidden",top:p.css("top")}),this.show.emptyRecords&&!B){let e=Math.floor((p[0]?.clientHeight??0)/this.recordHeight)-1,t=0;if((t=p[0]?p[0].scrollHeight-e*this.recordHeight:t)>=this.recordHeight&&(t-=this.recordHeight,e++),this.fixedBody){for(let t=C;t<e;t++)x(t,this.recordHeight,this);x(e,t,this)}}function x(e,t,A){let i="",s="";var n;i+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+t+'px">',s+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+t+'px">',A.show.lineNumbers&&(i+='<td class="w2ui-col-number"></td>'),A.show.selectColumn&&(i+='<td class="w2ui-grid-data w2ui-col-select"></td>'),A.show.expandColumn&&(i+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),s+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',A.reorderRows&&(s+='<td class="w2ui-grid-data w2ui-col-order" col="order"></td>');for(let e=0;e<A.columns.length;e++){var r=A.columns[e];(r.hidden||e<A.last.vscroll.colIndStart||e>A.last.vscroll.colIndEnd)&&!r.frozen||(n='<td class="w2ui-grid-data" '+(null!=r.attr?r.attr:"")+' col="'+e+'"></td>',r.frozen?i+=n:s+=n)}i+='<td class="w2ui-grid-data-last"></td> </tr>',s+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',o(A.box).find("#grid_"+A.name+"_frecords > table").append(i),o(A.box).find("#grid_"+A.name+"_records > table").append(s)}if(0<c.length){let e=parseInt(c[0].clientWidth)-(B?a.scrollBarSize():0)-(this.show.lineNumbers?f:0)-(this.reorderRows?26:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,t=(b=e,!1);for(let e=v=0;e<this.columns.length;e++){var Q=this.columns[e];0<Q.gridMinWidth&&(Q.gridMinWidth>b&&!0!==Q.hidden&&(Q.hidden=!0,t=!0),Q.gridMinWidth<b)&&!0===Q.hidden&&(Q.hidden=!1,t=!0)}if(!0===t)return void this.refresh();for(let t=0;t<this.columns.length;t++){var F=this.columns[t];F.hidden||("px"==String(F.size).substr(String(F.size).length-2).toLowerCase()?(e-=parseFloat(F.size),this.columns[t].sizeCalculated=F.size,this.columns[t].sizeType="px"):(v+=parseFloat(F.size),this.columns[t].sizeType="%",delete F.sizeCorrected))}if(100!=v&&0<v)for(let e=0;e<this.columns.length;e++){var U=this.columns[e];U.hidden||"%"==U.sizeType&&(U.sizeCorrected=Math.round(100*parseFloat(U.size)*100/v)/100+"%")}for(let t=0;t<this.columns.length;t++){var E=this.columns[t];E.hidden||"%"==E.sizeType&&(null!=this.columns[t].sizeCorrected?this.columns[t].sizeCalculated=Math.floor(e*parseFloat(E.sizeCorrected)/100)-1+"px":this.columns[t].sizeCalculated=Math.floor(e*parseFloat(E.size)/100)-1+"px")}}let k=0;for(let e=0;e<this.columns.length;e++){var I=this.columns[e];I.hidden||(null==I.min&&(I.min=20),parseInt(I.sizeCalculated)<parseInt(I.min)&&(I.sizeCalculated=I.min+"px"),parseInt(I.sizeCalculated)>parseInt(I.max)&&(I.sizeCalculated=I.max+"px"),k+=parseInt(I.sizeCalculated))}let H=parseInt(b)-parseInt(k);if(0<H&&0<v){let e=0;for(;;){var S=this.columns[e];if(null==S)e=0;else{if(!S.hidden&&"px"!=S.sizeType&&(S.sizeCalculated=parseInt(S.sizeCalculated)+1+"px",0==--H))break;e++}}}else 0<H&&h.find(":scope > table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",a.scrollBarSize()+"px").show();let T=1;this.show.lineNumbers&&(T+=f),this.show.selectColumn&&(T+=26),this.show.expandColumn&&(T+=26);for(let e=0;e<this.columns.length;e++)this.columns[e].hidden||this.columns[e].frozen&&(T+=parseInt(this.columns[e].sizeCalculated));u.css("width",T+"px"),g.css("width",T+"px"),l.css("width",T+"px"),m.css("width",T+"px"),h.css("left",T+.5+"px"),p.css("left",T+"px"),r.css("left",T+"px"),h.find(":scope > table > tbody > tr:nth-child(1) td").add(u.find(":scope > table > tbody > tr:nth-child(1) td")).each((t=>{o(t).hasClass("w2ui-col-number")&&o(t).css("width",f+"px");var A=o(t).attr("col");if(null!=A){if("start"==A){let A=0;for(let t=0;t<e.last.vscroll.colIndStart;t++)!e.columns[t]||e.columns[t].frozen||e.columns[t].hidden||(A+=parseInt(e.columns[t].sizeCalculated));o(t).css("width",A+"px")}e.columns[A]&&o(t).css("width",e.columns[A].sizeCalculated)}if(o(t).hasClass("w2ui-head-last"))if(e.last.vscroll.colIndEnd+1<e.columns.length){let A=0;for(let t=e.last.vscroll.colIndEnd+1;t<e.columns.length;t++)!e.columns[t]||e.columns[t].frozen||e.columns[t].hidden||(A+=parseInt(e.columns[t].sizeCalculated));o(t).css("width",A+"px")}else o(t).css("width",a.scrollBarSize()+(0<H&&0===v?H:0)+"px")})),3==h.find(":scope > table > tbody > tr").length&&h.find(":scope > table > tbody > tr:nth-child(1) td").add(u.find(":scope > table > tbody > tr:nth-child(1) td")).html("").css({height:"0",border:"0",padding:"0",margin:"0"}),p.find(":scope > table > tbody > tr:nth-child(1) td").add(g.find(":scope > table > tbody > tr:nth-child(1) td")).each((t=>{o(t).hasClass("w2ui-col-number")&&o(t).css("width",f+"px");var A=o(t).attr("col");if(null!=A){if("start"==A){let A=0;for(let t=0;t<e.last.vscroll.colIndStart;t++)!e.columns[t]||e.columns[t].frozen||e.columns[t].hidden||(A+=parseInt(e.columns[t].sizeCalculated));o(t).css("width",A+"px")}e.columns[A]&&o(t).css("width",e.columns[A].sizeCalculated)}if(o(t).hasClass("w2ui-grid-data-last")&&0===o(t).parents(".w2ui-grid-frecords").length)if(e.last.vscroll.colIndEnd+1<e.columns.length){let A=0;for(let t=e.last.vscroll.colIndEnd+1;t<e.columns.length;t++)!e.columns[t]||e.columns[t].frozen||e.columns[t].hidden||(A+=parseInt(e.columns[t].sizeCalculated));o(t).css("width",A+"px")}else o(t).css("width",(0<H&&0===v?H:0)+"px")})),r.find(":scope > table > tbody > tr:nth-child(1) td").add(l.find(":scope > table > tbody > tr:nth-child(1) td")).each((t=>{o(t).hasClass("w2ui-col-number")&&o(t).css("width",f+"px");var A=o(t).attr("col");if(null!=A){if("start"==A){let A=0;for(let t=0;t<e.last.vscroll.colIndStart;t++)!e.columns[t]||e.columns[t].frozen||e.columns[t].hidden||(A+=parseInt(e.columns[t].sizeCalculated));o(t).css("width",A+"px")}e.columns[A]&&o(t).css("width",e.columns[A].sizeCalculated)}o(t).hasClass("w2ui-grid-data-last")&&0===o(t).parents(".w2ui-grid-frecords").length&&o(t).css("width",a.scrollBarSize()+(0<H&&0===v?H:0)+"px")})),this.initResize(),this.refreshRanges(),(this.last.vscroll.scrollTop||this.last.vscroll.scrollLeft)&&0<p.length&&(h.prop("scrollLeft",this.last.vscroll.scrollLeft),p.prop("scrollTop",this.last.vscroll.scrollTop),p.prop("scrollLeft",this.last.vscroll.scrollLeft)),h.css("will-change","scroll-position")}getSearchesHTML(){let e=`\n            <div class="search-title">\n                ${a.lang("Advanced Search")}\n                <span class="search-logic" style="${this.show.searchLogic?"":"display: none"}">\n                    <select id="grid_${this.name}_logic" class="w2ui-input">\n                        <option value="AND" ${"AND"==this.last.logic?"selected":""}>${a.lang("All")}</option>\n                        <option value="OR" ${"OR"==this.last.logic?"selected":""}>${a.lang("Any")}</option>\n                    </select>\n                </span>\n            </div>\n            <table cellspacing="0"><tbody>\n        `;for(let i=0;i<this.searches.length;i++){var t=this.searches[i];if(t.type=String(t.type).toLowerCase(),!t.hidden){null==t.attr&&(t.attr=""),null==t.text&&(t.text=""),null==t.style&&(t.style=""),null==t.type&&(t.type="text"),null==t.label&&null!=t.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",t),t.label=t.caption);var A=`<select id="grid_${this.name}_operator_${i}" class="w2ui-input" data-change="initOperator|${i}">\n                    ${this.getOperators(t.type,t.operators)}\n                </select>`;let s;switch(e+=`<tr>\n                        <td class="caption">${a.lang(t.label??t.field)||""}</td>\n                        <td class="operator">${A}</td>\n                        <td class="value">`,t.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":s="width: 250px;",-1!=["hex","color"].indexOf(t.type)&&(s="width: 90px;"),e+=`<input rel="search" type="text" id="grid_${this.name}_field_${i}" name="${t.field}"\n                               class="w2ui-input" style="${s+t.style}" ${t.attr}>`;break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":s="width: 90px;","datetime"==t.type&&(s="width: 140px;"),e+=`<input id="grid_${this.name}_field_${i}" name="${t.field}" ${t.attr} rel="search" type="text"\n                                class="w2ui-input" style="${s+t.style}">\n                            <span id="grid_${this.name}_range_${i}" style="display: none">&#160;-&#160;&#160;\n                                <input rel="search" type="text" class="w2ui-input" style="${s+t.style}" id="grid_${this.name}_field2_${i}" name="${t.field}" ${t.attr}>\n                            </span>`;break;case"select":e+=`<select rel="search" class="w2ui-input" style="${t.style}" id="grid_${this.name}_field_${i}"\n                                name="${t.field}" ${t.attr}></select>`}e+=t.text+"    </td></tr>"}}return e+`<tr>\n            <td colspan="2" class="actions">\n                <button type="button" class="w2ui-btn close-btn" data-click="searchClose">${a.lang("Close")}</button>\n            </td>\n            <td class="actions">\n                <button type="button" class="w2ui-btn" data-click="searchReset">${a.lang("Reset")}</button>\n                <button type="button" class="w2ui-btn w2ui-btn-blue" data-click="search">${a.lang("Search")}</button>\n            </td>\n        </tr></tbody></table>`}getOperators(e,t){let A=this.operators[this.operatorsMap[e]]||[],i=(null!=t&&Array.isArray(t)&&(A=t),"");return A.forEach((e=>{let t=e,A=e;Array.isArray(e)?(t=e[1],A=e[0]):a.isPlainObject(e)&&(t=e.text,A=e.oper),null==t&&(t=e),i+=`<option name="11" value="${A}">${a.lang(t)}</option>\n`})),i}initOperator(e){let t;var A=this.searches[e],i=this.getSearchData(A.field),s=o(`#w2overlay-${this.name}-search-overlay`),n=s.find(`#grid_${this.name}_range_`+e);let r=s.find(`#grid_${this.name}_field_`+e),l=s.find(`#grid_${this.name}_field2_`+e);var d=s.find(`#grid_${this.name}_operator_`+e).val();switch(r.show(),n.hide(),d){case"between":n.css("display","inline");break;case"null":case"not null":r.hide(),r.val(d),r.trigger("change")}switch(A.type){case"text":case"alphanumeric":var c=r[0]._w2field;c&&c.reset();break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":r[0]._w2field||(new F(A.type,{el:r[0],...A.options}),new F(A.type,{el:l[0],...A.options}),setTimeout((()=>{r.trigger("keydown"),l.trigger("keydown")}),1));break;case"list":case"combo":case"enum":t=A.options,"list"==A.type&&(t.selected={}),"enum"==A.type&&(t.selected=[]),i&&(t.selected=i.value),r[0]._w2field||(c=new F(A.type,{el:r[0],...t}),i&&null!=i.text&&c.set({id:i.value,text:i.text}));break;case"select":t='<option value="">--</option>';for(let e=0;e<A.options.items.length;e++){var h=A.options.items[e];if(a.isPlainObject(A.options.items[e])){let e=h.id,A=h.text;null==e&&null!=h.value&&(e=h.value),null==A&&null!=h.text&&(A=h.text),null==e&&(e=""),t+='<option value="'+e+'">'+A+"</option>"}else t+='<option value="'+h+'">'+h+"</option>"}r.html(t)}}initSearches(){var e=o(`#w2overlay-${this.name}-search-overlay`);for(let s=0;s<this.searches.length;s++){var t=this.searches[s],A=this.getSearchData(t.field);t.type=String(t.type).toLowerCase(),"object"!=typeof t.options&&(t.options={});let n=t.operator,r=[...this.operators[this.operatorsMap[t.type]]];t.operators&&(r=t.operators),a.isPlainObject(n)&&(n=n.oper),r.forEach(((e,t)=>{a.isPlainObject(e)&&(r[t]=e.oper)})),A&&A.operator&&(n=A.operator),t=this.defaultOperator[this.operatorsMap[t.type]],-1==r.indexOf(n)&&(n=t),e.find(`#grid_${this.name}_operator_`+s).val(n),this.initOperator(s),t=e.find(`#grid_${this.name}_field_`+s);var i=e.find(`#grid_${this.name}_field2_`+s);null!=A&&(Array.isArray(A.value)?["in","not in"].includes(A.operator)?t[0]._w2field.set(A.value):(t.val(A.value[0]).trigger("change"),i.val(A.value[1]).trigger("change")):null!=A.value&&t.val(A.value).trigger("change"))}e.find(".w2ui-grid-search-advanced *[rel=search]").on("keypress",(e=>{13==e.keyCode&&(this.search(),g.hide(this.name+"-search-overlay"))}))}getColumnsHTML(){let e=this,t="",A="";var i,s,n;return this.show.columnHeaders&&(A=0<this.columnGroups.length?(n=r(!0),i=function(){let t="<tr>",A="<tr>",i="",s=e.columnGroups.length-1;null==e.columnGroups[s].text&&null!=e.columnGroups[s].caption&&(console.log("NOTICE: grid columnGroup.caption property is deprecated, please use columnGroup.text. Group -> ",e.columnGroups[s]),e.columnGroups[s].text=e.columnGroups[s].caption),""!=e.columnGroups[e.columnGroups.length-1].text&&e.columnGroups.push({text:""}),e.show.lineNumbers&&(t+='<td class="w2ui-head w2ui-col-number" col="line-number">    <div>&#160;</div></td>'),e.show.selectColumn&&(t+='<td class="w2ui-head w2ui-col-select" col="select">    <div style="height: 25px">&#160;</div></td>'),e.show.expandColumn&&(t+='<td class="w2ui-head w2ui-col-expand" col="expand">    <div style="height: 25px">&#160;</div></td>');let n=0;A+=`<td id="grid_${e.name}_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>`,e.reorderRows&&(A+='<td class="w2ui-head w2ui-col-order" col="order">    <div style="height: 25px">&#160;</div></td>');for(let s=0;s<e.columnGroups.length;s++){var r=e.columnGroups[s],o=e.columns[n]||{};null!=r.colspan&&(r.span=r.colspan),null!=r.span&&r.span==parseInt(r.span)||(r.span=1),null==o.text&&null!=o.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column ->",o),o.text=o.caption);let d=0;for(let t=n;t<n+r.span;t++)e.columns[t]&&!e.columns[t].hidden&&d++;if(!((d=s==e.columnGroups.length-1?100:d)<=0)){if(!0===r.main){let t="";for(let A=0;A<e.sortData.length;A++)e.sortData[A].field==o.field&&("asc"===(e.sortData[A].direction||"").toLowerCase()&&(t="w2ui-sort-up"),"desc"===(e.sortData[A].direction||"").toLowerCase())&&(t="w2ui-sort-down");let A="";!1!==o.resizable&&(A=`<div class="w2ui-resizer" name="${n}"></div>`);var l=a.lang("function"==typeof o.text?o.text(o):o.text);i=`<td id="grid_${e.name}_column_${n}" class="w2ui-head ${t}" col="${n}"     rowspan="2" colspan="${d}">`+A+`    <div class="w2ui-col-group w2ui-col-header ${t?"w2ui-col-sorted":""}">`+`        <div class="${t}"></div>`+(l||"&#160;")+"    </div></td>"}else l=a.lang("function"==typeof r.text?r.text(r):r.text),i=`<td id="grid_${e.name}_column_${n}" class="w2ui-head" col="${n}" colspan="${d}">    <div class="w2ui-col-group" style="${r.style??""}">${l||"&#160;"}</div></td>`;o&&o.frozen?t+=i:A+=i}n+=r.span}return t+="<td></td></tr>",A+=`<td id="grid_${e.name}_column_end" class="w2ui-head" col="end"></td></tr>`,[t,A]}(),s=r(!1),t=n[0]+i[0]+s[0],n[1]+i[1]+s[1]):(t=(n=r(!0))[0],n[1])),[t,A];function r(t){let A,i="<tr>",s="<tr>",n=(e.show.lineNumbers&&(i+='<td class="w2ui-head w2ui-col-number" col="line-number">    <div>#</div></td>'),e.show.selectColumn&&(i+=`<td class="w2ui-head w2ui-col-select" col="select">    <div>        <input type="checkbox" id="grid_${e.name}_check_all" class="w2ui-select-all" tabindex="-1"            style="${0==e.multiSelect?"display: none;":""}"        >    </div></td>`),e.show.expandColumn&&(i+='<td class="w2ui-head w2ui-col-expand" col="expand">    <div>&#160;</div></td>'),0),r=0;s+=`<td id="grid_${e.name}_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>`,e.reorderRows&&(s+='<td class="w2ui-head w2ui-col-order" col="order">    <div>&#160;</div></td>');for(let a=0;a<e.columns.length;a++){var o,l=e.columns[a];null==l.text&&null!=l.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column -> ",l),l.text=l.caption),null==l.size&&(l.size="100%"),a==r&&(A=e.columnGroups[n++]||{},r+=A.span),(a<e.last.vscroll.colIndStart||a>e.last.vscroll.colIndEnd)&&!l.frozen||l.hidden||!0===A.main&&!t||(o=e.getColumnCellHTML(a),l&&l.frozen?i+=o:s+=o)}return i+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',s+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',i+="</tr>",s+="</tr>",[i,s]}}getColumnCellHTML(e){var t=this.columns[e];if(null==t)return"";var A=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-col-reorderable ";let i="";for(let e=0;e<this.sortData.length;e++)this.sortData[e].field==t.field&&("asc"===(this.sortData[e].direction||"").toLowerCase()&&(i="w2ui-sort-up"),"desc"===(this.sortData[e].direction||"").toLowerCase())&&(i="w2ui-sort-down");var s,n=this.last.selection.columns;let r=!1;for(s in n)for(let t=0;t<n[s].length;t++)n[s][t]==e&&(r=!0);var o=a.lang("function"==typeof t.text?t.text(t):t.text);return'<td id="grid_'+this.name+"_column_"+e+'" col="'+e+'" class="w2ui-head '+i+A+'">'+(!1!==t.resizable?'<div class="w2ui-resizer" name="'+e+'"></div>':"")+'    <div class="w2ui-col-header '+(i?"w2ui-col-sorted":"")+" "+(r?"w2ui-col-selected":"")+'">        <div class="'+i+'"></div>'+(o||"&#160;")+"    </div></td>"}columnTooltipShow(e,t){var A=o(this.box).find("#grid_"+this.name+"_column_"+e),i=(e=this.columns[e],this.columnTooltip);g.show({name:this.name+"-column-tooltip",anchor:A.get(0),html:e?.tooltip,position:i})}columnTooltipHide(e,t){g.hide(this.name+"-column-tooltip")}getRecordsHTML(){let e=this.records.length;var t="object"!=typeof this.url?this.url:this.url.get;(e=0==this.searchData.length||t?e:this.last.searchIds.length)>this.vs_start?this.last.vscroll.show_extra=this.vs_extra:this.last.vscroll.show_extra=this.vs_start,t=o(this.box).find(`#grid_${this.name}_records`);let A=Math.floor((t.get(0)?.clientHeight||0)/this.recordHeight)+this.last.vscroll.show_extra+1;A<this.vs_start&&(A=this.vs_start),(!this.fixedBody||A>e)&&(A=e);var i=this.getRecordHTML(-1,0);let s="<table><tbody>"+i[0],n="<table><tbody>"+i[1];s+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',n+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(let e=0;e<A;e++)s+=(i=this.getRecordHTML(e,e+1))[0],n+=i[1];return t=(e-A)*this.recordHeight,s+='<tr id="grid_'+this.name+'_frec_bottom" rec="bottom" line="bottom" style="height: '+t+'px; vertical-align: top">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; ">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',n+='<tr id="grid_'+this.name+'_rec_bottom" rec="bottom" line="bottom" style="height: '+t+'px; vertical-align: top">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.vscroll.recIndStart=0,this.last.vscroll.recIndEnd=A,[s,n]}getSummaryHTML(){if(0!==this.summary.length){var e=this.getRecordHTML(-1,0);let t="<table><tbody>"+e[0],A="<table><tbody>"+e[1];for(let i=0;i<this.summary.length;i++)t+=(e=this.getRecordHTML(i,i+1,!0))[0],A+=e[1];return t+="</tbody></table>",A+="</tbody></table>",[t,A]}}scroll(e){let t=this;var A="object"!=typeof this.url?this.url:this.url.get,i=o(this.box).find(`#grid_${this.name}_records`),s=o(this.box).find(`#grid_${this.name}_frecords`);e&&(b=e.target.scrollTop,e=e.target.scrollLeft,this.last.vscroll.scrollTop=b,this.last.vscroll.scrollLeft=e,h=o(this.box).find(`#grid_${this.name}_columns`)[0],u=o(this.box).find(`#grid_${this.name}_summary`)[0],h&&(h.scrollLeft=e),u&&(u.scrollLeft=e),s[0])&&(s[0].scrollTop=b),this.last.bubbleEl&&(g.hide(this.name+"-bubble"),this.last.bubbleEl=null);let n=null,r=null;if(this.disableCVS||0<this.columnGroups.length)n=0,r=this.columns.length-1;else{var l,d=i.prop("clientWidth");let e=0;for(let t=0;t<this.columns.length;t++)this.columns[t].frozen||this.columns[t].hidden||(e+(l=parseInt(this.columns[t].sizeCalculated||this.columns[t].size))+30>this.last.vscroll.scrollLeft&&null==n&&(n=t),e+l-30>this.last.vscroll.scrollLeft+d&&null==r&&(r=t),e+=l);null==r&&(r=this.columns.length-1)}if(null!=n&&(n<0&&(n=0),r<0&&(r=0),n==r&&(0<n?n--:r++),n!=this.last.vscroll.colIndStart||r!=this.last.vscroll.colIndEnd)){var c=o(this.box),h=Math.abs(n-this.last.vscroll.colIndStart),u=Math.abs(r-this.last.vscroll.colIndEnd);if(h<5&&u<5){var p=c.find(`.w2ui-grid-columns #grid_${this.name}_column_start`),m=c.find(".w2ui-grid-columns .w2ui-head-last"),f=c.find(`#grid_${this.name}_records .w2ui-grid-data-spacer`),w=c.find(`#grid_${this.name}_records .w2ui-grid-data-last`),B=c.find(`#grid_${this.name}_summary .w2ui-grid-data-spacer`),y=c.find(`#grid_${this.name}_summary .w2ui-grid-data-last`);if(n>this.last.vscroll.colIndStart)for(let e=this.last.vscroll.colIndStart;e<n;e++)c.find("#grid_"+this.name+"_columns #grid_"+this.name+"_column_"+e).remove(),c.find("#grid_"+this.name+'_records td[col="'+e+'"]').remove(),c.find("#grid_"+this.name+'_summary td[col="'+e+'"]').remove();if(r<this.last.vscroll.colIndEnd)for(let e=this.last.vscroll.colIndEnd;e>r;e--)c.find("#grid_"+this.name+"_columns #grid_"+this.name+"_column_"+e).remove(),c.find("#grid_"+this.name+'_records td[col="'+e+'"]').remove(),c.find("#grid_"+this.name+'_summary td[col="'+e+'"]').remove();if(n<this.last.vscroll.colIndStart)for(let e=this.last.vscroll.colIndStart-1;e>=n;e--)this.columns[e]&&(this.columns[e].frozen||this.columns[e].hidden)||(p.after(this.getColumnCellHTML(e)),f.each((t=>{var A=o(t).parent().attr("index");let i='<td class="w2ui-grid-data" col="'+e+'" style="height: 0px"></td>';null!=A&&(i=this.getCellHTML(parseInt(A),e,!1)),o(t).after(i)})),B.each((t=>{var A=o(t).parent().attr("index");let i='<td class="w2ui-grid-data" col="'+e+'" style="height: 0px"></td>';null!=A&&(i=this.getCellHTML(parseInt(A),e,!0)),o(t).after(i)})));if(r>this.last.vscroll.colIndEnd)for(let e=this.last.vscroll.colIndEnd+1;e<=r;e++)this.columns[e]&&(this.columns[e].frozen||this.columns[e].hidden)||(m.before(this.getColumnCellHTML(e)),w.each((t=>{var A=o(t).parent().attr("index");let i='<td class="w2ui-grid-data" col="'+e+'" style="height: 0px"></td>';null!=A&&(i=this.getCellHTML(parseInt(A),e,!1)),o(t).before(i)})),y.each((t=>{var A=o(t).parent().attr("index")||-1;A=this.getCellHTML(parseInt(A),e,!0),o(t).before(A)})));this.last.vscroll.colIndStart=n,this.last.vscroll.colIndEnd=r}else{this.last.vscroll.colIndStart=n,this.last.vscroll.colIndEnd=r,e=this.getColumnsHTML();var b=this.getRecordsHTML();h=this.getSummaryHTML(),u=c.find(`#grid_${this.name}_columns`);let t=c.find(`#grid_${this.name}_records`);var v=c.find(`#grid_${this.name}_frecords`);let A=c.find(`#grid_${this.name}_summary`);u.find("tbody").html(e[1]),v.html(b[0]),t.prepend(b[1]),null!=h&&A.html(h[1]),setTimeout((()=>{t.find(":scope > table").filter(":not(table:first-child)").remove(),A[0]&&(A[0].scrollLeft=this.last.vscroll.scrollLeft)}),1)}this.resizeRecords()}let C=this.records.length;if(C>this.total&&-1!==this.total&&(C=this.total),0!==(C=0==this.searchData.length||A?C:this.last.searchIds.length)&&0!==i.length&&0!==i.prop("clientHeight")){C>this.vs_start?this.last.vscroll.show_extra=this.vs_extra:this.last.vscroll.show_extra=this.vs_start;let n=Math.round(i.prop("scrollTop")/this.recordHeight+1),r=n+(Math.round(i.prop("clientHeight")/this.recordHeight)-1);if(n>C&&(n=C),r>=C-1&&(r=C),o(this.box).find("#grid_"+this.name+"_footer .w2ui-footer-right").html((this.show.statusRange?a.formatNumber(this.offset+n)+"-"+a.formatNumber(this.offset+r)+(-1!=this.total?" "+a.lang("of")+' <span class="w2ui-total">'+a.formatNumber(this.total)+"</span>":""):"")+(A&&this.show.statusBuffered?" ("+a.lang("buffered")+' <span class="w2ui-buffered">'+a.formatNumber(C)+"</span>"+(0<this.offset?', skip <span class="w2ui-skip">'+a.formatNumber(this.offset):"")+"</span>)":"")),A||this.fixedBody&&!(-1!=this.total&&this.total<=this.vs_start)){let A=Math.floor(i.prop("scrollTop")/this.recordHeight)-this.last.vscroll.show_extra,n=A+Math.floor(i.prop("clientHeight")/this.recordHeight)+2*this.last.vscroll.show_extra+1;A<1&&(A=1),n>this.total&&-1!=this.total&&(n=this.total);var x=i.find("#grid_"+this.name+"_rec_top"),Q=i.find("#grid_"+this.name+"_rec_bottom"),F=s.find("#grid_"+this.name+"_frec_top"),U=s.find("#grid_"+this.name+"_frec_bottom");let r,l,d,c,h;if(-1!=String(x.next().prop("id")).indexOf("_expanded_row")&&(x.next().remove(),F.next().remove()),this.total>n&&-1!=String(Q.prev().prop("id")).indexOf("_expanded_row")&&(Q.prev().remove(),U.prev().remove()),u=parseInt(x.next().attr("line")),e=parseInt(Q.prev().attr("line")),u<=A||1==u||this.last.vscroll.pull_refresh){if(n<=e+this.last.vscroll.show_extra-2&&n!=this.total)return;for(this.last.vscroll.pull_refresh=!1;l=s.find("#grid_"+this.name+"_frec_top").next(),"bottom"!=(d=i.find("#grid_"+this.name+"_rec_top").next()).attr("line")&&parseInt(d.attr("line"))<A;)l.remove(),d.remove();r=i.find("#grid_"+this.name+"_rec_bottom").prev(),"top"==(c=r.attr("line"))&&(c=A);for(let e=parseInt(c)+1;e<=n;e++)this.records[e-1]&&((d=this.records[e-1].w2ui)&&!Array.isArray(d.children)&&(d.expanded=!1),h=this.getRecordHTML(e-1,e),Q.before(h[1]),U.before(h[0]))}else{if(A>=u-this.last.vscroll.show_extra+2&&1<A)return;for(;l=s.find("#grid_"+this.name+"_frec_bottom").prev(),"top"!=(d=i.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line")&&parseInt(d.attr("line"))>n;)l.remove(),d.remove();r=i.find("#grid_"+this.name+"_rec_top").next(),"bottom"==(c=r.attr("line"))&&(c=n);for(let e=parseInt(c)-1;e>=A;e--)this.records[e-1]&&((d=this.records[e-1].w2ui)&&!Array.isArray(d.children)&&(d.expanded=!1),h=this.getRecordHTML(e-1,e),x.after(h[1]),F.after(h[0]))}t.markSearch&&(clearTimeout(t.last.marker_timer),t.last.marker_timer=setTimeout((()=>{var e=[];for(let s=0;s<t.searchData.length;s++){var A=t.searchData[s],i=t.getSearch(A.field);i&&!i.hidden&&(i=t.getColumn(A.field,!0),e.push({field:A.field,search:A.value,col:i}))}0<e.length&&e.forEach((e=>{var A=o(t.box).find('td[col="'+e.col+'"]:not(.w2ui-head)');a.marker(A,e.search)}))}),50)),setTimeout((()=>{this.refreshRanges()}),0),v=(A-1)*this.recordHeight;let p=(C-n)*this.recordHeight;p<0&&(p=0),x.css("height",v+"px"),F.css("height",v+"px"),Q.css("height",p+"px"),U.css("height",p+"px"),this.last.vscroll.recIndStart=A,this.last.vscroll.recIndEnd=n,Math.floor(i.prop("scrollTop")/this.recordHeight)+Math.floor(i.prop("clientHeight")/this.recordHeight)+10>C&&!0!==this.last.vscroll.pull_more&&(C<this.total-this.offset||-1==this.total&&this.last.fetch.hasMore)&&(!0===this.autoLoad&&(this.last.vscroll.pull_more=!0,this.last.fetch.offset+=this.limit,this.request("load")),o(this.box).find("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").show().eq(1).off(".load-more").on("click.load-more",(function(){o(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'),t.last.vscroll.pull_more=!0,t.last.fetch.offset+=t.limit,t.request("load")})).find("td").html(t.autoLoad?'<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>':'<div style="padding-top: 15px">'+a.lang("Load ${count} more...",{count:t.limit})+"</div>"))}}}getRecordHTML(e,t,A){let i="",s="";var n=this.last.selection;let r;if(-1==e){i+='<tr line="0">',s+='<tr line="0">',this.show.lineNumbers&&(i+='<td class="w2ui-col-number" style="height: 0px"></td>'),this.show.selectColumn&&(i+='<td class="w2ui-col-select" style="height: 0px"></td>'),this.show.expandColumn&&(i+='<td class="w2ui-col-expand" style="height: 0px"></td>'),s+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px"></td>',this.reorderRows&&(s+='<td class="w2ui-col-order" style="height: 0px"></td>');for(let e=0;e<this.columns.length;e++){var o=this.columns[e],l='<td class="w2ui-grid-data" col="'+e+'" style="height: 0px;"></td>';o.frozen&&!o.hidden?i+=l:o.hidden||e<this.last.vscroll.colIndStart||e>this.last.vscroll.colIndEnd||(s+=l)}i+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',s+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>'}else{var a="object"!=typeof this.url?this.url:this.url.get;if(!0!==A){if(0<this.searchData.length&&!a){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e]}else if(e>=this.records.length)return"";r=this.records[e]}else{if(e>=this.summary.length)return"";r=this.summary[e]}if(!r)return"";null==r.recid&&null!=this.recid&&null!=(a=this.parseField(r,this.recid))&&(r.recid=a);let o=!1,l=(-1!=n.indexes.indexOf(e)&&(o=!0),r.w2ui?r.w2ui.style:""),p=(null!=l&&"string"==typeof l||(l=""),r.w2ui?r.w2ui.class:"");if(null!=p&&"string"==typeof p||(p=""),i+='<tr id="grid_'+this.name+"_frec_"+r.recid+'" recid="'+r.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+p+(o&&"row"==this.selectType?" w2ui-selected":"")+(r.w2ui&&!1===r.w2ui.editable?" w2ui-no-edit":"")+(r.w2ui&&!0===r.w2ui.expanded?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(o||""==l?l.replace("background-color","none"):l)+'" '+(""!=l?'custom_style="'+l+'"':"")+">",s+='<tr id="grid_'+this.name+"_rec_"+r.recid+'" recid="'+r.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+p+(o&&"row"==this.selectType?" w2ui-selected":"")+(r.w2ui&&!1===r.w2ui.editable?" w2ui-no-edit":"")+(r.w2ui&&!0===r.w2ui.expanded?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(o||""==l?l.replace("background-color","none"):l)+'" '+(""!=l?'custom_style="'+l+'"':"")+">",this.show.lineNumbers&&(i+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(A?"_s":"")+'"    class="w2ui-col-number '+(o?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(!0!==A?this.getLineHTML(t,r):"")+"</td>"),this.show.selectColumn&&(i+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(A?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(!0===A||r.w2ui&&!0===r.w2ui.hideCheckBox?"":'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(o?'checked="checked"':"")+' style="pointer-events: none"/>    </div>')+"</td>"),this.show.expandColumn){let t="";t=!0===r.w2ui?.expanded?"-":"+","none"!=r.w2ui?.expanded&&Array.isArray(r.w2ui?.children)&&r.w2ui?.children.length||(t="+"),"spinner"==r.w2ui?.expanded&&(t='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),i+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(A?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==A?`<div>${t}</div>`:"")+"</td>"}s+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',this.reorderRows&&(s+='<td id="grid_'+this.name+"_cell_"+e+"_order"+(A?"_s":"")+'" class="w2ui-grid-data w2ui-col-order" col="order">'+(!0!==A?'<div title="Drag to reorder">&nbsp;</div>':"")+"</td>");let g=0,m=0;for(;;){let t=1;var d,c=this.columns[g];if(null==c)break;if(c.hidden)g++,0<m&&m--;else if(0<m){if(g++,null==this.columns[g])break;r.w2ui.colspan[this.columns[g-1].field]=0,m--}else{if(r.w2ui&&(u=r.w2ui.colspan,d=this.columns[g].field,u)&&0===u[d]&&delete u[d],!(g<this.last.vscroll.colIndStart||g>this.last.vscroll.colIndEnd)||c.frozen){if(r.w2ui&&"object"==typeof r.w2ui.colspan){var h=parseInt(r.w2ui.colspan[c.field])||null;if(1<h){let e=0;for(let t=g;t<g+h&&!(t>=this.columns.length);t++)this.columns[t].hidden&&e++;t=h-e,m=h-1}}var u=this.getCellHTML(e,g,A,t);c.frozen?i+=u:s+=u}g++}}i+='<td class="w2ui-grid-data-last"></td>',s+='<td class="w2ui-grid-data-last" col="end"></td>'}return i+="</tr>",s+="</tr>",[i,s]}getLineHTML(e){return"<div>"+e+"</div>"}getCellHTML(e,t,A,i){let s=this,n=this.columns[t];if(null==n)return"";let r=(!0!==A?this.records:this.summary)[e],{value:o,style:l,className:d,attr:c,divAttr:h}=this.getCellValue(e,t,A,!0);var u=-1!==e?this.getCellEditable(e,t):"";let p="max-height: "+parseInt(this.recordHeight)+"px;"+(n.clipboardCopy?"margin-right: 20px":"");var g=!A&&r?.w2ui?.changes&&null!=r.w2ui.changes[n.field],m=this.last.selection;let f=!1,w="";if(-1!=m.indexes.indexOf(e)&&(f=!0),null==i&&(i=r?.w2ui?.colspan&&r.w2ui.colspan[n.field]?r.w2ui.colspan[n.field]:1),0===t&&Array.isArray(r?.w2ui?.children)){let e=0,t=this.get(r.w2ui.parent_recid,!0);for(;null!=t;){e++;var B=this.records[t].w2ui;if(null==B||null==B.parent_recid)break;t=this.get(B.parent_recid,!0)}if(r.w2ui.parent_recid)for(let t=0;t<e;t++)w+='<span class="w2ui-show-children w2ui-icon-empty"></span>';var y=0<r.w2ui.children.length?r.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty";w+=`<span class="w2ui-show-children ${y}"></span>`}if(!0===n.info&&(n.info={}),null!=n.info){let i="w2ui-icon-info",s=("function"==typeof n.info.icon?i=n.info.icon(r,{self:this,index:e,colIndex:t,summary:!!A}):"object"==typeof n.info.icon?i=n.info.icon[this.parseField(r,n.field)]||"":"string"==typeof n.info.icon&&(i=n.info.icon),n.info.style||"");"function"==typeof n.info.style?s=n.info.style(r,{self:this,index:e,colIndex:t,summary:!!A}):"object"==typeof n.info.style?s=n.info.style[this.parseField(r,n.field)]||"":"string"==typeof n.info.style&&(s=n.info.style),w+=`<span class="w2ui-info ${i}" style="${s}"></span>`}let b,v=o,C=(u&&-1!=["checkbox","check"].indexOf(u.type)&&(p+="text-align: center;",v=`<input tabindex="-1" type="checkbox" class="w2ui-editable-checkbox"\n                            data-changeInd="${A?-(e+1):e}" data-colInd="${t}" ${v?'checked="checked"':""}>`,w=""),null==(v=`<div style="${p}" ${function(i){let o;return s.show.recordTitles&&(null!=n.title?("function"==typeof n.title&&(o=n.title.call(s,r,{self:this,index:e,colIndex:t,summary:!!A})),"string"==typeof n.title&&(o=n.title)):o=a.stripTags(String(i).replace(/"/g,"''"))),null!=o?'title="'+String(o)+'"':""}(v)} ${h}>${w}${String(v)}</div>`)&&(v=""),"string"==typeof n.render&&(y=n.render.toLowerCase().split(":"),-1!=["number","int","float","money","currency","percent","size"].indexOf(y[0]))&&(l+="text-align: right;"),r?.w2ui&&("object"==typeof r.w2ui.style&&("string"==typeof r.w2ui.style[t]&&(l+=r.w2ui.style[t]+";"),"string"==typeof r.w2ui.style[n.field])&&(l+=r.w2ui.style[n.field]+";"),"object"==typeof r.w2ui.class)&&("string"==typeof r.w2ui.class[t]&&(d+=r.w2ui.class[t]+" "),"string"==typeof r.w2ui.class[n.field])&&(d+=r.w2ui.class[n.field]+" "),!1);return f&&m.columns[e]?.includes(t)&&(C=!0),n.clipboardCopy&&(b='<span class="w2ui-clipboard-copy w2ui-icon-paste"></span>'),v='<td class="w2ui-grid-data'+(C?" w2ui-selected":"")+" "+d+(g?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+e+"_"+t+'" col="'+t+'"    style="'+l+(null!=n.style?n.style:"")+'" '+(null!=n.attr?n.attr:"")+c+(1<i?'colspan="'+i+'"':"")+">"+v+(b&&a.stripTags(v)?b:"")+"</td>",-1===e&&!0===A?'<td class="w2ui-grid-data" col="'+t+'" style="height: 0px; '+l+'" '+(1<i?'colspan="'+i+'"':"")+"></td>":v}clipboardCopy(e,t,A){var i=(A?this.summary:this.records)[e],s=this.columns[t];let n=s?this.parseField(i,s.field):"";"function"==typeof s.clipboardCopy&&(n=s.clipboardCopy(i,{self:this,index:e,colIndex:t,summary:!!A})),o(this.box).find("#grid_"+this.name+"_focus").text(n).get(0).select(),document.execCommand("copy")}showBubble(e,t,A){var i=this.columns[t].info;if(i){let u="";var s=this.records[e],n=o(this.box).find(`${A?".w2ui-grid-summary":""} #grid_${this.name}_data_${e}_${t} .w2ui-info`);if(this.last.bubbleEl&&g.hide(this.name+"-bubble"),this.last.bubbleEl=n,null==i.fields){i.fields=[];for(let e=0;e<this.columns.length;e++){var r=this.columns[e];i.fields.push(r.field+("string"==typeof r.render?":"+r.render:""))}}let p=i.fields;if("function"==typeof p&&(p=p(s,{self:this,index:e,colIndex:t,summary:!!A})),"function"==typeof i.render)u=i.render(s,{self:this,index:e,colIndex:t,summary:!!A});else if(Array.isArray(p)){u='<table cellpadding="0" cellspacing="0">';for(let e=0;e<p.length;e++){var l=String(p[e]).split(":");if(""==l[0]||"-"==l[0]||"--"==l[0]||"---"==l[0])u+='<tr><td colspan=2><div style="border-top: '+(""==l[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';else{let e=this.getColumn(l[0]),t=(e=null==e?{field:l[0],caption:l[0]}:e)?this.parseField(s,e.field):"";1<l.length&&(a.formatters[l[1]]?t=a.formatters[l[1]](t,l[2]||null,s):console.log('ERROR: w2utils.formatters["'+l[1]+'"] does not exists.')),(!0===i.showEmpty||null!=t&&""!=t)&&(null!=i.maxLength&&"string"==typeof t&&t.length>i.maxLength&&(t=t.substr(0,i.maxLength)+"..."),u+="<tr><td>"+e.text+"</td><td>"+((0===t?"0":t)||"")+"</td></tr>")}}u+="</table>"}else if(a.isPlainObject(p)){for(var d in u='<table cellpadding="0" cellspacing="0">',p){var c=p[d];if(""==c||"-"==c||"--"==c||"---"==c)u+='<tr><td colspan=2><div style="border-top: '+(""==c?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';else{var h=String(c).split(":");let n=this.getColumn(h[0]),r=(n=null==n?{field:h[0],caption:h[0]}:n)?this.parseField(s,n.field):"";1<h.length&&(a.formatters[h[1]]?r=a.formatters[h[1]](r,h[2]||null,s):console.log('ERROR: w2utils.formatters["'+h[1]+'"] does not exists.')),"function"==typeof c&&(r=c(s,{self:this,index:e,colIndex:t,summary:!!A})),(!0===i.showEmpty||null!=r&&""!=r)&&(null!=i.maxLength&&"string"==typeof r&&r.length>i.maxLength&&(r=r.substr(0,i.maxLength)+"..."),u+="<tr><td>"+d+"</td><td>"+((0===r?"0":r)||"")+"</td></tr>")}}u+="</table>"}return g.show(a.extend({name:this.name+"-bubble",html:u,anchor:n.get(0),position:"top|bottom",class:"w2ui-info-bubble",style:"",hideOn:["doc-click"]},i.options??{})).hide((()=>[this.last.bubbleEl=null]))}}getCellEditable(e,t){var A=this.columns[t],i=this.records[e];if(!i||!A)return null;let s=i.w2ui?i.w2ui.editable:null;return!1===s?null:(null!=s&&!0!==s||"function"==typeof(s=0<Object.keys(A.editable??{}).length?A.editable:null)&&(A=this.getCellValue(e,t,!1),s=s.call(this,i,{self:this,value:A,index:e,colIndex:t})),s)}getCellValue(e,t,A,i){var s=this.columns[t],n=(!0!==A?this.records:this.summary)[e];let r=this.parseField(n,s.field),o="",l="",d="",c="";if(null!=n?.w2ui?.changes?.[s.field]&&(r=n.w2ui.changes[s.field]),null!=s.render&&-1!==e){if("function"==typeof s.render&&null!=n){let a;try{a=s.render.call(this,n,{self:this,value:r,index:e,colIndex:t,summary:!!A})}catch(i){throw new Error(`Render function for column "${s.field}" in grid "${this.name}": -- `+i.message)}null!=a&&"object"==typeof a&&"function"!=typeof a?(null!=a.id&&null!=a.text?r=a.text:"string"==typeof a.html?r=(a.html||"").trim():(r="",console.log("ERROR: render function should return a primitive or an object of the following structure.",{html:"",attr:"",style:"",class:"",divAttr:""})),d=a.attr??"",l=a.style??"",o=a.class??"",c=a.divAttr??""):r=String(a||"").trim()}if("object"==typeof s.render&&null!=(e=s.render[r])&&""!==e&&(r=e),"string"==typeof s.render){A=[],-1==(t=s.render.toLowerCase().indexOf(":"))?(A[0]=s.render.toLowerCase(),A[1]=""):(A[0]=s.render.toLowerCase().substr(0,t),A[1]=s.render.toLowerCase().substr(t+1));let e=a.formatters[A[0]];s.options&&!1===s.options.autoFormat&&(e=null),r="function"==typeof e?e(r,A[1],n):""}}return null==r&&(r=""),i?{value:r,attr:d,style:l,className:o,divAttr:c}:r}getFooterHTML(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'}status(e){if(null!=e)o(this.box).find(`#grid_${this.name}_footer`).find(".w2ui-footer-left").html(e);else{let t="";if(0<(e=this.getSelection()).length&&(this.show.statusSelection&&1<e.length&&(t=String(e.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+a.settings.groupSymbol)+" "+a.lang("selected")),this.show.statusRecordID)&&1==e.length){let A=e[0];"object"==typeof A&&(A=A.recid+", "+a.lang("Column")+": "+A.column),t=a.lang("Record ID")+": "+A+" "}o(this.box).find("#grid_"+this.name+"_footer .w2ui-footer-left").html(t)}}lock(e,t){let A=Array.from(arguments);A.unshift(this.box),setTimeout((()=>{o(this.box).find("#grid_"+this.name+"_empty_msg").remove(),a.lock(...A)}),10)}unlock(e){setTimeout((()=>{o(this.box).find(".w2ui-message").hasClass("w2ui-closing")||a.unlock(this.box,e)}),25)}stateSave(e){var t={columns:[],show:a.clone(this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,label:this.last.label,field:this.last.field,scrollTop:this.last.vscroll.scrollTop,scrollLeft:this.last.vscroll.scrollLeft},sortData:[],searchData:[]};let A;for(let e=0;e<this.columns.length;e++){let i=this.columns[e],s={};Object.keys(this.stateColProps).forEach(((e,t)=>{this.stateColProps[e]&&(A=void 0!==i[e]?i[e]:this.colTemplate[e]||null,s[e]=A)})),t.columns.push(s)}for(let e=0;e<this.sortData.length;e++)t.sortData.push(a.clone(this.sortData[e]));for(let e=0;e<this.searchData.length;e++)t.searchData.push(a.clone(this.searchData[e]));var i=this.trigger("stateSave",{target:this.name,state:t});if(!0!==i.isCancelled)return!0!==e&&this.cacheSave("state",t),i.finish(),t}stateRestore(e){let t="object"!=typeof this.url?this.url:this.url.get;e=e||this.cache("state");var A=this.trigger("stateRestore",{target:this.name,state:e});if(!0!==A.isCancelled){if(a.isPlainObject(e)){a.extend(this.show,e.show??{}),a.extend(this.last,e.last??{});let A=this.last.vscroll.scrollTop,n=this.last.vscroll.scrollLeft;for(let t=0;t<e.columns?.length;t++){var i=e.columns[t],s=this.getColumn(i.field,!0);null!==s&&(a.extend(this.columns[s],i),t!==s)&&this.columns.splice(t,0,this.columns.splice(s,1)[0])}this.sortData.splice(0,this.sortData.length);for(let t=0;t<e.sortData?.length;t++)this.sortData.push(e.sortData[t]);this.searchData.splice(0,this.searchData.length);for(let t=0;t<e.searchData?.length;t++)this.searchData.push(e.searchData[t]);setTimeout((()=>{t||(0<this.sortData.length&&this.localSort(),0<this.searchData.length&&this.localSearch()),this.last.vscroll.scrollTop=A,this.last.vscroll.scrollLeft=n,this.refresh()}),1),console.log(`INFO (w2ui): state restored for "${this.name}"`)}return A.finish(),!0}}stateReset(){this.stateRestore(this.last.state),this.cacheSave("state",null)}parseField(e,t){if(this.nestedFields){let i="";try{i=e;var A=String(t).split(".");for(let e=0;e<A.length;e++)i=i[A[e]]}catch(e){i=""}return i}return e?e[t]:""}prepareData(){let e=this;for(let t=0;t<this.records.length;t++)!function t(A){for(let t=0;t<e.columns.length;t++){let i=e.columns[t];if(null!=A[i.field]&&"string"==typeof i.render){if(-1!=["number","int","float","money","currency","percent"].indexOf(i.render.split(":")[0])&&"number"!=typeof A[i.field]&&(A[i.field]=parseFloat(A[i.field])),-1!=["date","age"].indexOf(i.render.split(":")[0])&&!A[i.field+"_"]){let e=A[i.field];a.isInt(e)&&(e=parseInt(e)),A[i.field+"_"]=new Date(e)}if(-1!=["time"].indexOf(i.render))if(a.isTime(A[i.field])){let e=a.isTime(A[i.field],!0),t=new Date;t.setHours(e.hours,e.minutes,e.seconds||0,0),A[i.field+"_"]||(A[i.field+"_"]=t)}else{let e=A[i.field],t=(e=null!=(e=a.isInt(e)?parseInt(e):e)?new Date(e):new Date,new Date);t.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),0),A[i.field+"_"]||(A[i.field+"_"]=t)}}}if(A.w2ui?.children&&!0!==A.w2ui?.expanded)for(let e=0;e<A.w2ui.children.length;e++)t(A.w2ui.children[e])}(this.records[t])}nextCell(e,t,A){if((t+=1)>=this.columns.length)return null==(e=this.nextRow(e))?e:this.nextCell(e,-1,A);var i=this.records[e].w2ui,s=this.columns[t];return i=i&&i.colspan&&!isNaN(i.colspan[s.field])?parseInt(i.colspan[s.field]):1,null==s?null:s&&s.hidden||0===i?this.nextCell(e,t,A):!A||null!=(s=this.getCellEditable(e,t))&&-1==["checkbox","check"].indexOf(s.type)?{index:e,colIndex:t}:this.nextCell(e,t,A)}prevCell(e,t,A){if((t-=1)<0)return null==(e=this.prevRow(e))?e:this.prevCell(e,this.columns.length,A);if(t<0)return null;var i=this.records[e].w2ui,s=this.columns[t];return i=i&&i.colspan&&!isNaN(i.colspan[s.field])?parseInt(i.colspan[s.field]):1,null==s?null:s&&s.hidden||0===i?this.prevCell(e,t,A):!A||null!=(s=this.getCellEditable(e,t))&&-1==["checkbox","check"].indexOf(s.type)?{index:e,colIndex:t}:this.prevCell(e,t,A)}nextRow(e,t,A){var i=this.last.searchIds;let s=null;if(-1==(A=null==A?1:A))return this.records.length-1;if(e+A<this.records.length&&0===i.length||0<i.length&&e<i[i.length-A]){if(e+=A,0<i.length)for(;!(i.includes(e)||e>this.records.length);)e+=A;var n=this.records[e].w2ui,r=this.columns[t];s=0===(n=n&&n.colspan&&null!=r&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1)?this.nextRow(e,t,A):e}return s}prevRow(e,t,A){var i=this.last.searchIds;let s=null;if(-1==(A=null==A?1:A))return 0;if(0<=e-A&&0===i.length||0<i.length&&e>i[0]){if(e-=A,0<i.length)for(;!(i.includes(e)||e<0);)e-=A;var n=this.records[e].w2ui,r=this.columns[t];s=0===(n=n&&n.colspan&&null!=r&&!isNaN(n.colspan[r.field])?parseInt(n.colspan[r.field]):1)?this.prevRow(e,t,A):e}return s}selectionSave(){return this.last.saved_sel=this.getSelection(),this.last.saved_sel}selectionRestore(e){var t,A=Date.now(),i=(this.last.selection={indexes:[],columns:{}},this.last.selection),s=this.last.saved_sel;if(s)for(let e=0;e<s.length;e++)a.isPlainObject(s[e])?null!=(t=this.get(s[e].recid,!0))&&(-1==i.indexes.indexOf(t)&&i.indexes.push(t),i.columns[t]||(i.columns[t]=[]),i.columns[t].push(s[e].column)):null!=(t=this.get(s[e],!0))&&i.indexes.push(t);return delete this.last.saved_sel,!0!==e&&this.refresh(),Date.now()-A}message(e){return a.message({owner:this,box:this.box,after:".w2ui-grid-header"},e)}confirm(e){return a.confirm({owner:this,box:this.box,after:".w2ui-grid-header"},e)}}class Q extends s{constructor(e){super(e.name),this.name=null,this.header="",this.box=null,this.url="",this.method=null,this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.pageStyle="",this.recid=null,this.fields=[],this.actions={},this.record={},this.original=null,this.dataType=null,this.postData={},this.httpHeaders={},this.toolbar={},this.tabs={},this.style="",this.focus=0,this.autosize=!0,this.nestedFields=!0,this.tabindexBase=0,this.isGenerated=!1,this.last={fetchCtrl:null,fetchOptions:null,errors:[]},this.onRequest=null,this.onLoad=null,this.onValidate=null,this.onSubmit=null,this.onProgress=null,this.onSave=null,this.onChange=null,this.onInput=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.onAction=null,this.onToolbar=null,this.onError=null,this.msgRefresh="Loading...",this.msgSaving="Saving...",this.msgServerError="Server error",this.ALL_TYPES=["text","textarea","email","pass","password","int","float","money","currency","percent","hex","alphanumeric","color","date","time","datetime","toggle","checkbox","radio","check","checks","list","combo","enum","file","select","switch","map","array","div","custom","html","empty"],this.LIST_TYPES=["select","radio","check","checks","list","combo","enum","switch"],this.W2FIELD_TYPES=["int","float","money","currency","percent","hex","alphanumeric","color","date","time","datetime","list","combo","enum","file"],a.extend(this,e);var t,A,i=e.record,s=e.original,n=e.fields,r=e.toolbar;let l=e.tabs;if(Object.assign(this,{record:{},original:null,fields:[],tabs:{},toolbar:{},handlers:[]}),n&&(e=function e(t){let A=[],i=[];if(a.isPlainObject(t)){let s=t;function n(e){let t=["html"];return null==e.html&&(e.html={}),Object.keys(e).forEach((A=>{-1==t.indexOf(A)&&-1!=["label","attr","style","text","span","page","column","anchor","group","groupStyle","groupTitleStyle","groupCollapsible"].indexOf(A)&&(e.html[A]=e[A],delete e[A])})),e}function r(e,t){let A=["style","html"];Object.keys(e).forEach((i=>{-1==A.indexOf(i)&&-1!=["span","column","attr","text","label"].indexOf(i)&&e[i]&&!t.html[i]&&(t.html[i]=e[i])}))}t=[],Object.keys(s).forEach((A=>{let o=s[A];if("group"==o.type){if(o.text=A,a.isPlainObject(o.fields)){let e=o.fields;o.fields=[],Object.keys(e).forEach((t=>{let A=e[t];A.field=t,o.fields.push(n(A))}))}t.push(o)}else if("tab"==o.type){let s={id:A,text:A},n=(o.style&&(s.style=o.style),i.push(s),e(o.fields).fields);n.forEach((e=>{e.html=e.html||{},e.html.page=i.length-1,r(o,e)})),t.push(...n)}else o.field=A,t.push(n(o))}))}return t.forEach((e=>{if("group"==e.type){let t={group:e.text||"",groupStyle:e.style||"",groupTitleStyle:e.titleStyle||"",groupCollapsible:!0===e.collapsible};Array.isArray(e.fields)&&e.fields.forEach((i=>{let s=a.clone(i);null==s.html&&(s.html={}),a.extend(s.html,t),Array("span","column","attr","label","page").forEach((t=>{null==s.html[t]&&null!=e[t]&&(s.html[t]=e[t])})),null==s.field&&null!=s.name&&(console.log("NOTICE: form field.name property is deprecated, please use field.field. Field ->",e),s.field=s.name),A.push(s)}))}else{let t=a.clone(e);null==t.field&&null!=t.name&&(console.log("NOTICE: form field.name property is deprecated, please use field.field. Field ->",e),t.field=t.name),A.push(t)}})),{fields:A,tabs:i}}(n),this.fields=e.fields,!l)&&0<e.tabs.length&&(l=e.tabs),Array.isArray(l)){a.extend(this.tabs,{tabs:[]});for(let e=0;e<l.length;e++){var d=l[e];"object"==typeof d?(this.tabs.tabs.push(d),!0===d.active&&(this.tabs.active=d.id)):this.tabs.tabs.push({id:d,text:d})}}else a.extend(this.tabs,l);for(t in a.extend(this.toolbar,r),i)a.isPlainObject(i[t])?this.record[t]=a.clone(i[t]):this.record[t]=i[t];for(A in s)a.isPlainObject(s[A])?this.original[A]=a.clone(s[A]):this.original[A]=s[A];""!==this.formURL?fetch(this.formURL).then((e=>e.text())).then((e=>{this.formHTML=e,this.isGenerated=!0,this.box&&this.render(this.box)})):this.formURL||this.formHTML?this.formHTML&&(this.isGenerated=!0):(this.formHTML=this.generateHTML(),this.isGenerated=!0),"string"==typeof this.box&&(this.box=o(this.box).get(0)),this.box&&this.render(this.box)}get(e,t){if(0===arguments.length){var A=[];for(let e=0;e<this.fields.length;e++)null!=this.fields[e].field&&A.push(this.fields[e].field);return A}for(let A=0;A<this.fields.length;A++)if(this.fields[A].field==e)return!0===t?A:this.fields[A];return null}set(e,t){for(let A=0;A<this.fields.length;A++)if(this.fields[A].field==e)return a.extend(this.fields[A],t),delete this.fields[A].w2field,this.refresh(e),!0;return!1}getValue(e,t){if(this.nestedFields){let i;try{var A=!0===t?this.original:this.record;i=String(e).split(".").reduce(((e,t)=>e[t]),A)}catch(e){}return i}return this.record[e]}setValue(e,t,A){if((""===t||null==t||Array.isArray(t)&&0===t.length||a.isPlainObject(t)&&0==Object.keys(t).length)&&(t=null),!this.nestedFields)return this.record[e]=t,A||this.setFieldValue(e,t),!0;try{let i=this.record;return String(e).split(".").map(((e,A,s)=>{s.length-1!==A?i=i[e]||(i[e]={},i[e]):i[e]=t})),A||this.setFieldValue(e,t),!0}catch(e){return!1}}getFieldValue(e){let t=this.get(e);if(null!=t){var A=t.el;let r=this.getValue(e);var i;e=this.getValue(e,!0);let l=A.value;if(!["int","float","percent","money","currency"].includes(t.type)||"int"!=t.type&&"."==l[l.length-1]||(l=t.w2field.clean(l)),["radio"].includes(t.type)&&(i=o(A).closest("div").find("input:checked").get(0),l=i?t.options.items[o(i).data("index")].id:null),["toggle","checkbox"].includes(t.type)&&(l=A.checked),-1!==["check","checks"].indexOf(t.type)&&(l=[],0<(i=o(A).closest("div").find("input:checked")).length&&i.each((e=>{e=t.options.items[o(e).data("index")],l.push(e.id)})),Array.isArray(r)||(r=[])),A=t.w2field?.selected,["list","enum","file"].includes(t.type)&&A){var s=A,n=r;if(Array.isArray(s)){l=[];for(let e=0;e<s.length;e++)l[e]=a.clone(s[e])}if(Array.isArray(n)){r=[];for(let e=0;e<n.length;e++)r[e]=a.clone(n[e])}a.isPlainObject(s)&&(l=a.clone(s)),a.isPlainObject(n)&&(r=a.clone(n))}return["map","array"].includes(t.type)&&(l="map"==t.type?{}:[],t.$el.parent().find(".w2ui-map-field").each((e=>{var A=o(e).find(".w2ui-map.key").val();e=o(e).find(".w2ui-map.value").val(),"map"==t.type?l[A]=e:l.push(e)}))),{current:l,previous:r,original:e}}}setFieldValue(e,t){let A=this.get(e);if(null!=A){var i=A.el;switch(A.type){case"toggle":case"checkbox":i.checked=!!t;break;case"radio":{t=t?.id??t;let e=o(i).closest("div").find("input");A.options.items.forEach(((A,i)=>{A.id===t&&e.filter(`[data-index="${i}"]`).prop("checked",!0)}));break}case"check":case"checks":{t=(t=Array.isArray(t)?t:null!=t?[t]:[]).map((e=>e?.id??e));let e=o(i).closest("div").find("input");A.options.items.forEach(((A,i)=>{e.filter(`[data-index="${i}"]`).prop("checked",!!t.includes(A.id))}));break}case"list":case"combo":let e=t;null==e?.id&&Array.isArray(A.options?.items)&&A.options.items.forEach((A=>{A.id===t&&(e=A)})),e!=t&&this.setValue(A.name,e,!0),"list"==A.type?(A.w2field.selected=e,A.w2field.refresh()):A.el.value=e?.text??t;break;case"switch":i.value=t,A.toolbar.uncheck(...A.toolbar.get()),A.toolbar.check(t);break;case"enum":case"file":{let e=[...t=Array.isArray(t)?t:null!=t?[t]:[]],i=!1;e.forEach(((t,s)=>{null==t?.id&&Array.isArray(A.options.items)&&A.options.items.forEach((A=>{A.id==t&&(e[s]=A,i=!0)}))})),i&&this.setValue(A.name,e,!0),A.w2field.selected=e,A.w2field.refresh();break}case"map":case"array":"map"!=A.type||null!=t&&a.isPlainObject(t)||(this.setValue(A.field,{},!0),t=this.getValue(A.field)),"array"!=A.type||null!=t&&Array.isArray(t)||(this.setValue(A.field,[],!0),t=this.getValue(A.field));var s=o(A.el).parent().find(".w2ui-map-container");A.el.mapRefresh(t,s);break;case"div":case"custom":o(i).html(t);break;case"color":i.value=t??"",A.w2field.refresh();break;case"html":case"empty":break;default:i.value=t??""}}}show(){var e=[];for(let A=0;A<arguments.length;A++){var t=this.get(arguments[A]);t&&t.hidden&&(t.hidden=!1,e.push(t.field))}return 0<e.length&&this.refresh.apply(this,e),this.updateEmptyGroups(),e}hide(){var e=[];for(let A=0;A<arguments.length;A++){var t=this.get(arguments[A]);t&&!t.hidden&&(t.hidden=!0,e.push(t.field))}return 0<e.length&&this.refresh.apply(this,e),this.updateEmptyGroups(),e}enable(){var e=[];for(let A=0;A<arguments.length;A++){var t=this.get(arguments[A]);t&&t.disabled&&(t.disabled=!1,e.push(t.field))}return 0<e.length&&this.refresh.apply(this,e),e}disable(){var e=[];for(let A=0;A<arguments.length;A++){var t=this.get(arguments[A]);t&&!t.disabled&&(t.disabled=!0,e.push(t.field))}return 0<e.length&&this.refresh.apply(this,e),e}updateEmptyGroups(){o(this.box).find(".w2ui-group").each((e=>{!function(e){let t=!0;return e.each((e=>{"none"!=e.style.display&&(t=!1)})),t}(o(e).find(".w2ui-field"))?o(e).show():o(e).hide()}))}change(){Array.from(arguments).forEach((e=>{(e=this.get(e)).$el&&e.$el.change()}))}reload(e){return("object"!=typeof this.url?this.url:this.url.get)&&null!=this.recid?this.request(e):("function"==typeof e&&e(),new Promise((e=>{e()})))}clear(){0!=arguments.length?Array.from(arguments).forEach((e=>{let t=this.record;String(e).split(".").map(((e,A,i)=>{i.length-1!==A?t=t[e]:delete t[e]})),this.refresh(e)})):(this.recid=null,this.record={},this.original=null,this.refresh(),this.hideErrors())}error(e){var t=this.trigger("error",{target:this.name,message:e,fetchCtrl:this.last.fetchCtrl,fetchOptions:this.last.fetchOptions});!0!==t.isCancelled&&(setTimeout((()=>{this.message(e)}),1),t.finish())}message(e){return a.message({owner:this,box:this.box,after:".w2ui-form-header"},e)}confirm(e){return a.confirm({owner:this,box:this.box,after:".w2ui-form-header"},e)}validate(e){null==e&&(e=!0);var t=[];for(let e=0;e<this.fields.length;e++){var A,i,s=this.fields[e];switch(null==this.getValue(s.field)&&this.setValue(s.field,""),-1!=["int","float","currency","money"].indexOf(s.type)&&(A=this.getValue(s.field),n=s.options.min,i=s.options.max,null!=n&&null!=A&&A<n&&t.push({field:s,error:a.lang("Should be more than ${min}",{min:n})}),null!=i)&&null!=A&&i<A&&t.push({field:s,error:a.lang("Should be less than ${max}",{max:i})}),s.type){case"alphanumeric":this.getValue(s.field)&&!a.isAlphaNumeric(this.getValue(s.field))&&t.push({field:s,error:a.lang("Not alpha-numeric")});break;case"int":this.getValue(s.field)&&!a.isInt(this.getValue(s.field))&&t.push({field:s,error:a.lang("Not an integer")});break;case"percent":case"float":this.getValue(s.field)&&!a.isFloat(this.getValue(s.field))&&t.push({field:s,error:a.lang("Not a float")});break;case"currency":case"money":this.getValue(s.field)&&!a.isMoney(this.getValue(s.field))&&t.push({field:s,error:a.lang("Not in money format")});break;case"color":case"hex":this.getValue(s.field)&&!a.isHex(this.getValue(s.field))&&t.push({field:s,error:a.lang("Not a hex number")});break;case"email":this.getValue(s.field)&&!a.isEmail(this.getValue(s.field))&&t.push({field:s,error:a.lang("Not a valid email")});break;case"checkbox":1==this.getValue(s.field)?this.setValue(s.field,!0):this.setValue(s.field,!1);break;case"date":s.options.format||(s.options.format=a.settings.dateFormat),this.getValue(s.field)&&!a.isDate(this.getValue(s.field),s.options.format)&&t.push({field:s,error:a.lang("Not a valid date")+": "+s.options.format})}var n=this.getValue(s.field);!0!==s.hidden&&s.required&&!["div","custom","html","empty"].includes(s.type)&&(null==n||""===n||Array.isArray(n)&&0===n.length||a.isPlainObject(n)&&0==Object.keys(n).length)&&t.push({field:s,error:a.lang("Required field")}),!0!==s.hidden&&0<s.options?.minLength&&!["enum","list","combo"].includes(s.type)&&(null==n||n.length<s.options.minLength)&&t.push({field:s,error:a.lang("Field should be at least ${count} characters.",{count:s.options.minLength})})}var r=this.trigger("validate",{target:this.name,errors:t});if(!0!==r.isCancelled)return this.last.errors=t,e&&this.showErrors(),r.finish(),t}showErrors(){var e=this.last.errors;e.length<=0||(this.goto(e[0].field.page),o(e[0].field.$el).parents(".w2ui-field")[0].scrollIntoView({block:"nearest",inline:"nearest"}),e.forEach((e=>{var t=a.extend({anchorClass:"w2ui-error",class:"w2ui-light",position:"right|left",hideOn:["input"]},e.options);if(null!=e.field){let A=e.field.el;"radio"===e.field.type?A=o(e.field.el).closest("div").get(0):["enum","file"].includes(e.field.type),g.show(a.extend({anchor:A,name:`${this.name}-${e.field.field}-error`,html:e.error},t))}})),o(e[0].field.$el).parents(".w2ui-page").off(".hideErrors").on("scroll.hideErrors",(e=>{this.hideErrors()})))}hideErrors(){this.fields.forEach((e=>{g.hide(`${this.name}-${e.field}-error`)}))}getChanges(){return null!=this.original&&"object"==typeof this.original&&0!==Object.keys(this.record).length?function e(t,A,i){if(Array.isArray(t)&&Array.isArray(A))for(;t.length<A.length;)t.push(null);for(var s in t)null!=t[s]&&"object"==typeof t[s]?(i[s]=e(t[s],A[s]||{},{}),(!i[s]||0==Object.keys(i[s]).length&&Object.keys(0==A[s].length))&&delete i[s]):(t[s]!=A[s]||null==t[s]&&null!=A[s])&&(i[s]=t[s]);return 0!=Object.keys(i).length?i:null}(this.record,this.original,{}):{}}getCleanRecord(e){let t=a.clone(this.record);return this.fields.forEach((e=>{if(-1!=["list","combo","enum"].indexOf(e.type)){var A={nestedFields:!0,record:t};let i=this.getValue.call(A,e.field);a.isPlainObject(i)&&null!=i.id&&this.setValue.call(A,e.field,i.id),Array.isArray(i)&&i.forEach(((e,t)=>{a.isPlainObject(e)&&e.id&&(i[t]=e.id)}))}var i;"map"==e.type&&(A={nestedFields:!0,record:t},(A=this.getValue.call(A,e.field))._order)&&delete A._order,"file"==e.type&&(A={nestedFields:!0,record:t},(i=this.getValue.call(A,e.field)??[]).forEach((e=>{delete e.file,delete e.modified})),this.setValue.call(A,e.field,i))})),!0===e&&Object.keys(t).forEach((e=>{this.get(e)||delete t[e]})),t}request(e,t){let A,i,s=this;var n=new Promise(((e,t)=>{A=e,i=t}));if("function"==typeof e&&(t=e,e=null),null==e&&(e={}),this.url&&("object"!=typeof this.url||this.url.get)){var r={action:"get"};if(!0!==(r.recid=this.recid,r.name=this.name,a.extend(r,this.postData),a.extend(r,e),e=this.trigger("request",{target:this.name,url:this.url,httpMethod:"GET",postData:r,httpHeaders:this.httpHeaders})).isCancelled){this.record={},this.original=null,this.lock(a.lang(this.msgRefresh));let l=e.detail.url;if("object"==typeof l&&l.get&&(l=l.get),this.last.fetchCtrl)try{this.last.fetchCtrl.abort()}catch(e){}if(0!=Object.keys(this.routeData).length){var o=a.parseRoute(l);if(0<o.keys.length)for(let c=0;c<o.keys.length;c++)null!=this.routeData[o.keys[c].name]&&(l=l.replace(new RegExp(":"+o.keys[c].name,"g"),this.routeData[o.keys[c].name]))}return l=new URL(l,location),r=a.prepareParams(l,{method:e.detail.httpMethod,headers:e.detail.httpHeaders,body:e.detail.postData},this.dataType),this.last.fetchCtrl=new AbortController,r.signal=this.last.fetchCtrl.signal,this.last.fetchOptions=r,fetch(l,r).catch(d).then((e=>{200!=e?.status?e&&d(e):e.json().catch(d).then((e=>{var i=s.trigger("load",{target:s.name,fetchCtrl:this.last.fetchCtrl,fetchOptions:this.last.fetchOptions,data:e});!0!==i.isCancelled&&(null==e.error&&"error"===e.status&&(e.error=!0),e.record||Object.assign(e,{record:a.clone(e)}),!0===e.error?s.error(a.lang(e.message??this.msgServerError)):s.record=a.clone(e.record),s.unlock(),i.finish(),s.refresh(),s.setFocus(),"function"==typeof t&&t(e),A(e))}))})),e.finish(),n;function d(e){var t;"AbortError"!==e.name&&(s.unlock(),!0!==(t=s.trigger("error",{response:e,fetchCtrl:s.last.fetchCtrl,fetchOptions:s.last.fetchOptions})).isCancelled)&&(e.status&&200!=e.status?s.error(e.status+": "+e.statusText):(console.log("ERROR: Server request failed.",e,". ","Expected Response:",{error:!1,record:{field1:1,field2:"item"}},"OR:",{error:!0,message:"Error description"}),s.error(String(e))),t.finish(),i(e))}}}}submit(e,t){return this.save(e,t)}save(e,t){let A,i,s=this;var n=new Promise(((e,t)=>{A=e,i=t})),r=("function"==typeof e&&(t=e,e=null),s.validate(!0));if(0===r.length)if(null==e&&(e={}),!s.url||"object"==typeof s.url&&!s.url.save)console.log("ERROR: Form cannot be saved because no url is defined.");else if(s.lock(a.lang(s.msgSaving)+' <span id="'+s.name+'_progress"></span>'),(r={action:"save"}).recid=s.recid,r.name=s.name,a.extend(r,s.postData),a.extend(r,e),r.record=a.clone(s.record),!0!==(e=s.trigger("submit",{target:s.name,url:s.url,httpMethod:this.method??"POST",postData:r,httpHeaders:s.httpHeaders})).isCancelled){let l=e.detail.url;if("object"==typeof l&&l.save&&(l=l.save),s.last.fetchCtrl&&s.last.fetchCtrl.abort(),0<Object.keys(s.routeData).length){var o=a.parseRoute(l);if(0<o.keys.length)for(let c=0;c<o.keys.length;c++)null!=s.routeData[o.keys[c].name]&&(l=l.replace(new RegExp(":"+o.keys[c].name,"g"),s.routeData[o.keys[c].name]))}return l=new URL(l,location),r=a.prepareParams(l,{method:e.detail.httpMethod,headers:e.detail.httpHeaders,body:e.detail.postData},this.dataType),this.last.fetchCtrl=new AbortController,r.signal=this.last.fetchCtrl.signal,this.last.fetchOptions=r,fetch(l,r).catch(d).then((e=>{s.unlock(),200!=e?.status?d(e??{}):e.json().catch(d).then((e=>{var i=s.trigger("save",{target:s.name,fetchCtrl:this.last.fetchCtrl,fetchOptions:this.last.fetchOptions,data:e});!0!==i.isCancelled&&(!0===e.error?s.error(a.lang(e.message??this.msgServerError)):s.original=null,i.finish(),s.refresh(),"function"==typeof t&&t(e),A(e))}))})),e.finish(),n;function d(e){var t;"AbortError"!==e?.name&&(s.unlock(),!0!==(t=s.trigger("error",{response:e,fetchCtrl:s.last.fetchCtrl,fetchOptions:s.last.fetchOptions})).isCancelled)&&(e.status&&200!=e.status?e.json().then((t=>{s.error(e.status+": "+t.message??e.statusText)})).catch((()=>{s.error(e.status+": "+e.statusText)})):(console.log("ERROR: Server request failed.",e,". ","Expected Response:",{error:!1,record:{field1:1,field2:"item"}},"OR:",{error:!0,message:"Error description"}),s.error(String(e))),t.finish(),i())}}}lock(e,t){var A=Array.from(arguments);A.unshift(this.box),a.lock(...A)}unlock(e){var t=this.box;a.unlock(t,e)}lockPage(e,t,A){return!!(e=o(this.box).find(".page-"+e)).length&&(a.lock(e,t,A),!0)}unlockPage(e,t){return!!(e=o(this.box).find(".page-"+e)).length&&(a.unlock(e,t),!0)}goto(e){this.page!==e&&(null!=e&&(this.page=e),!0===o(this.box).data("autoSize")&&(o(this.box).get(0).clientHeight=0),this.refresh())}generateHTML(){let e,t,A,i,s=[],n="";for(let l=0;l<this.fields.length;l++){A="";var r=' tabindex="'+(i=this.tabindexBase+l+1)+'"',o=this.fields[l];null==o.html&&(o.html={}),null==o.options&&(o.options={}),null!=o.html.caption&&null==o.html.label&&(console.log("NOTICE: form field.html.caption property is deprecated, please use field.html.label. Field ->",o),o.html.label=o.html.caption),null==o.html.label&&(o.html.label=o.field),o.html=a.extend({label:"",span:6,attr:"",text:"",style:"",page:0,column:0},o.html),null==e&&(e=o.html.page),null==t&&(t=o.html.column);let d=`<input id="${o.field}" name="${o.field}" class="w2ui-input ${o.html.class??""}" type="text" ${o.html.attr+r}>`;switch(o.type){case"pass":case"password":d=d.replace('type="text"','type="password"');break;case"checkbox":d=`\n                        <label class="w2ui-box-label">\n                            <input id="${o.field}" name="${o.field}" class="w2ui-input ${o.html.class??""}" type="checkbox" ${o.html.attr+r}>\n                            <span>${o.html.label}</span>\n                        </label>`;break;case"check":case"checks":{null==o.options.items&&null!=o.html.items&&(o.options.items=o.html.items);let e=o.options.items;d="",0<(e=Array.isArray(e)?e:[]).length&&(e=a.normMenu.call(this,e,o));for(let t=0;t<e.length;t++)d+=`\n                            <label class="w2ui-box-label">\n                                <input id="${o.field+t}" name="${o.field}" class="w2ui-input ${o.html.class??""}" type="checkbox"\n                                    ${o.html.attr+r} data-value="${e[t].id}" data-index="${t}">\n                                <span>&#160;${e[t].text}</span>\n                            </label>\n                            <br>`;break}case"radio":{d="",null==o.options.items&&null!=o.html.items&&(o.options.items=o.html.items);let e=o.options.items;0<(e=Array.isArray(e)?e:[]).length&&(e=a.normMenu.call(this,e,o));for(let t=0;t<e.length;t++)d+=`\n                            <label class="w2ui-box-label">\n                                <input id="${o.field+t}" name="${o.field}" class="w2ui-input ${o.html.class??""}" type="radio"\n                                    ${o.html.attr+(0===t?r:"")}\n                                    data-value="${e[t].id}" data-index="${t}">\n                                <span>&#160;${e[t].text}</span>\n                            </label>\n                            <br>`;break}case"select":{d=`<select id="${o.field}" name="${o.field}" class="w2ui-input ${o.html.class??""}" ${o.html.attr+r}>`,null==o.options.items&&null!=o.html.items&&(o.options.items=o.html.items);let e=o.options.items;0<(e=Array.isArray(e)?e:[]).length&&(e=a.normMenu.call(this,e,o));for(let t=0;t<e.length;t++)d+=`<option value="${e[t].id}">${e[t].text}</option>`;d+="</select>";break}case"switch":d=`<div id="${o.field}-tb" class="w2ui-form-switch ${o.html.class??""}" ${o.html.attr}\n                        style="outline1: 1px solid red !important; height: 34px; margin-top: -5px; padding: 0px; background-color: transparent; position: relative;"></div>\n                        <input id="${o.field}" name="${o.field}" ${r} class="w2ui-input"\n                            style="position: absolute; right: 0; margin-top: -30px; width: 1px; padding: 0; opacity: 0">`;break;case"textarea":d=`<textarea id="${o.field}" name="${o.field}" class="w2ui-input ${o.html.class??""}" ${o.html.attr+r}></textarea>`;break;case"toggle":d=`<input id="${o.field}" name="${o.field}" class="w2ui-input w2ui-toggle  ${o.html.class??""}"\n                                type="checkbox" ${o.html.attr+r}>\n                            <div><div></div></div>`;break;case"map":case"array":o.html.key=o.html.key||{},o.html.value=o.html.value||{},o.html.tabindex_str=r,d='<span style="float: right">'+(o.html.text||"")+'</span><input id="'+o.field+'" name="'+o.field+'" type="hidden" '+o.html.attr+r+'><div class="w2ui-map-container"></div>';break;case"div":case"custom":d=`<div id="${o.field}" name="${o.field}" ${o.html.attr+r} class="w2ui-input ${o.html.class??""}">`+(o&&o.html&&o.html.html?o.html.html:"")+"</div>";break;case"html":case"empty":d=`<div id="${o.field}" name="${o.field}" ${o.html.attr+r} class="w2ui-input ${o.html.class??""}">`+(o&&o.html?(o.html.html||"")+(o.html.text||""):"")+"</div>"}if(""!==n&&(e!=o.html.page||t!=o.html.column||o.html.group&&n!=o.html.group)&&(s[e][t]+="\n   </div>\n  </div>",n=""),o.html.group&&n!=o.html.group){let e="";o.html.groupCollapsible&&(e='<span class="w2ui-icon-collapse" style="width: 15px; display: inline-block; position: relative; top: -2px;"></span>'),A+='\n <div class="w2ui-group">\n   <div class="w2ui-group-title w2ui-eaction" style="'+(o.html.groupTitleStyle||"")+"; "+(""!=e?"cursor: pointer; user-select: none":"")+'"'+(""!=e?'data-group="'+a.base64encode(o.html.group)+'"':"")+(""!=e?'data-click="toggleGroup|'+o.html.group+'"':"")+">"+e+a.lang(o.html.group)+'</div>\n   <div class="w2ui-group-fields" style="'+(o.html.groupStyle||"")+'">',n=o.html.group}if(null==o.html.anchor){let e=null!=o.html.span?"w2ui-span"+o.html.span:"",t="<label"+("none"==(e=-1==o.html.span?"w2ui-span-none":e)?' style="display: none"':"")+">"+a.lang("checkbox"!=o.type?o.html.label:o.html.text)+"</label>";o.html.label||(t=""),A+='\n      <div class="w2ui-field '+e+'" style="'+(o.hidden?"display: none;":"")+o.html.style+'">\n         '+t+("empty"===o.type?d:"\n         <div>"+d+("array"!=o.type&&"map"!=o.type?a.lang("checkbox"!=o.type?o.html.text:""):"")+"</div>")+"\n      </div>"}else s[o.html.page].anchors=s[o.html.page].anchors||{},s[o.html.page].anchors[o.html.anchor]='<div class="w2ui-field w2ui-field-inline" style="'+(o.hidden?"display: none;":"")+o.html.style+'">'+("empty"===o.type?d:"<div>"+a.lang("checkbox"!=o.type?o.html.label:o.html.text,!0)+d+a.lang("checkbox"!=o.type?o.html.text:"")+"</div>")+"</div>";null==s[o.html.page]&&(s[o.html.page]={}),null==s[o.html.page][o.html.column]&&(s[o.html.page][o.html.column]=""),s[o.html.page][o.html.column]+=A,e=o.html.page,t=o.html.column}if(""!==n&&(s[e][t]+="\n   </div>\n  </div>"),this.tabs.tabs)for(let e=0;e<this.tabs.tabs.length;e++)null==s[e]&&(s[e]=[]);let l="";if(0<Object.keys(this.actions).length){for(var d in l+='\n<div class="w2ui-buttons">',i=this.tabindexBase+this.fields.length+1,this.actions){var c=this.actions[d],h={text:"",style:"",class:""};a.isPlainObject(c)?(null==c.text&&null!=c.caption&&(console.log("NOTICE: form action.caption property is deprecated, please use action.text. Action ->",c),c.text=c.caption),c.text&&(h.text=c.text),c.style&&(h.style=c.style),c.class&&(h.class=c.class)):(h.text=d,-1!==["save","update","create"].indexOf(d.toLowerCase())?h.class="w2ui-btn-blue":h.class=""),l+='\n    <button name="'+d+'" class="w2ui-btn '+h.class+'" style="'+h.style+'" tabindex="'+i+'">'+a.lang(h.text)+"</button>",i++}l+="\n</div>"}A="";for(let e=0;e<s.length;e++){if(A+='<div class="w2ui-page page-'+e+'" style="'+(0!==e?"display: none;":"")+this.pageStyle+'">',!s[e])return console.log(`ERROR: Page ${e} does not exist`),!1;s[e].before&&(A+=s[e].before),A+='<div class="w2ui-column-container">',Object.keys(s[e]).sort().forEach(((t,i)=>{t==parseInt(t)&&(A+='<div class="w2ui-column col-'+t+'">'+(s[e][t]||"")+"\n</div>")})),A+="\n</div>",s[e].after&&(A+=s[e].after),A+="\n</div>",s[e].anchors&&Object.keys(s[e].anchors).forEach(((t,i)=>{A=A.replace(t,s[e].anchors[t])}))}return A+=l}toggleGroup(e,t){var A;0!==(e=o(this.box).find('.w2ui-group-title[data-group="'+a.base64encode(e)+'"]')).length&&(A=o(e.prop("nextElementSibling")),(t=void 0===t?"none"==A.css("display"):t)?(A.show(),e.find("span").addClass("w2ui-icon-collapse").removeClass("w2ui-icon-expand")):(A.hide(),e.find("span").addClass("w2ui-icon-expand").removeClass("w2ui-icon-collapse")))}action(e,t){var A=this.actions[e];let i=A;a.isPlainObject(A)&&A.onClick&&(i=A.onClick),!0!==(e=this.trigger("action",{target:e,action:A,originalEvent:t})).isCancelled&&("function"==typeof i&&i.call(this,t),e.finish())}resize(){let e=this;var t=this.trigger("resize",{target:this.name});if(!0!==t.isCancelled){if(null!=this.box){let r=o(this.box).find(":scope > div .w2ui-form-header"),l=o(this.box).find(":scope > div .w2ui-form-toolbar"),d=o(this.box).find(":scope > div .w2ui-form-tabs"),c=o(this.box).find(":scope > div .w2ui-page");var A=o(this.box).find(":scope > div .w2ui-page.page-"+this.page+" > div");let h=o(this.box).find(":scope > div .w2ui-buttons");var{headerHeight:i,tbHeight:s,tabsHeight:n}=u();function u(){var t=""!==e.header?a.getSize(r,"height"):0,A=Array.isArray(e.toolbar?.items)&&0<e.toolbar?.items?.length?a.getSize(l,"height"):0,i=Array.isArray(e.tabs?.tabs)&&0<e.tabs?.tabs?.length?a.getSize(d,"height"):0;return l.css({top:t+"px"}),d.css({top:t+A+"px"}),c.css({top:t+A+i+"px",bottom:(0<h.length?a.getSize(h,"height"):0)+"px"}),{headerHeight:t,tbHeight:A,tabsHeight:i}}this.autosize&&(0!==o(this.box).get(0).clientHeight&&"yes"!=o(this.box).data("autosize")||(o(this.box).css({height:i+s+n+15+(0<c.length?a.getSize(A,"height"):0)+(0<h.length?a.getSize(h,"height"):0)+"px"}),o(this.box).data("autosize","yes")),u())}t.finish()}}refresh(){var e=Date.now();let t=this;if(this.box&&this.isGenerated&&o(this.box).html()){var A=this.trigger("refresh",{target:this.name,page:this.page,field:arguments[0],fields:arguments});if(!0!==A.isCancelled){let s=Array.from(this.fields.keys());0<arguments.length?s=Array.from(arguments).map(((e,t)=>("string"!=typeof e&&console.log("ERROR: Arguments in refresh functions should be field names"),this.get(e,!0)))).filter(((e,t)=>null!=e)):(o(this.box).find("input, textarea, select").each((e=>{var t=null!=o(e).attr("name")?o(e).attr("name"):o(e).attr("id"),A=this.get(t);if(A){var i=o(e).closest(".w2ui-page");if(0<i.length)for(let e=0;e<100;e++)if(i.hasClass("page-"+e)){A.page=e;break}}})),o(this.box).find(".w2ui-page").hide(),o(this.box).find(".w2ui-page.page-"+this.page).show(),o(this.box).find(".w2ui-form-header").html(a.lang(this.header)),"object"==typeof this.tabs&&Array.isArray(this.tabs.tabs)&&0<this.tabs.tabs.length?(o(this.box).find("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):o(this.box).find("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&Array.isArray(this.toolbar.items)&&0<this.toolbar.items.length?(o(this.box).find("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):o(this.box).find("#form_"+this.name+"_toolbar").hide());for(let e=0;e<s.length;e++){let A=this.fields[s[e]],i=(null==A.name&&null!=A.field&&(A.name=A.field),null==A.field&&null!=A.name&&(A.field=A.name),A.$el=o(this.box).find(`[name='${String(A.name).replace(/\\/g,"\\\\")}']`),A.el=A.$el.get(0),A.el&&(A.el.id=A.name),A.w2field&&A.w2field.reset(),A.$el.off(".w2form").on("change.w2form",(function(e){var i=t.getFieldValue(A.field),s=(["enum","file"].includes(A.type)&&(s=A.w2field?.helpers?.multi,o(s).removeClass("w2ui-error")),null!=this._previous&&(i.previous=this._previous,delete this._previous),t.trigger("change",{target:this.name,field:this.name,value:i,originalEvent:e}));!0!==s.isCancelled&&(t.setValue(this.name,i.current),s.finish())})).on("input.w2form",(function(e){null==t.original&&(0<Object.keys(t.record).length?t.original=a.clone(t.record):t.original={});var i=t.getFieldValue(A.field);!0!==(null==this._previous&&(this._previous=i.previous),e=t.trigger("input",{target:t.name,field:A,value:i,originalEvent:e})).isCancelled&&(t.setValue(this.name,i.current),e.finish())})),A.required?A.$el.closest(".w2ui-field").addClass("w2ui-required"):A.$el.closest(".w2ui-field").removeClass("w2ui-required"),null!=A.disabled&&(A.disabled?(null==A.$el.data("tabIndex")&&A.$el.data("tabIndex",A.$el.prop("tabIndex")),A.$el.prop("readOnly",!0).prop("disabled",!0).prop("tabIndex",-1).closest(".w2ui-field").addClass("w2ui-disabled")):A.$el.prop("readOnly",!1).prop("disabled",!1).prop("tabIndex",A.$el.data("tabIndex")??A.$el.prop("tabIndex")??0).closest(".w2ui-field").removeClass("w2ui-disabled")),A.el);i=i||o(this.box).find("#"+A.field),A.hidden?o(i).closest(".w2ui-field").hide():o(i).closest(".w2ui-field").show()}o(this.box).find("button, input[type=button]").each((e=>{o(e).off("click").on("click",(function(e){let A=this.value;this.id&&(A=this.id),this.name&&(A=this.name),t.action(A,e)}))}));for(let e=0;e<s.length;e++){let A=this.fields[s[e]];if(A.el){if(A.$el.hasClass("w2ui-input")||A.$el.addClass("w2ui-input"),A.type=String(A.type).toLowerCase(),A.options||(A.options={}),this.LIST_TYPES.includes(A.type)){let e=A.options.items;null==e&&(A.options.items=[]),"switch"==A.type?e.forEach(((t,A)=>e[A]="object"!=typeof t?{id:t,text:t}:t)):A.options.items=a.normMenu.call(this,e??[],A)}if("switch"==A.type&&(A.toolbar&&l[this.name+"_"+A.name+"_tb"].destroy(),(i=A.options.items).forEach((e=>e.type="radio")),A.toolbar=new B({box:A.$el.prev().get(0),name:this.name+"_"+A.name+"_tb",items:i,onClick(e){var i=e.detail.item.id;!0!==(i=t.trigger("change",{target:A.name,field:A.name,value:i,originalEvent:e})).isCancelled&&(t.record[A.name]=e.detail.item.id,t.setFieldValue(A.name,e.detail.item.id),i.finish())}}),A.$el.off(".form-input").on("focus.form-input",(e=>{var t=A.toolbar.get(A.$el.val(),!0);o(e.target).prop("_index",t)})).on("blur.form-input",(e=>{o(e.target).removeProp("_index"),o(`#${A.name}-tb .w2ui-tb-button`).removeClass("over")})).on("keydown.form-input",(e=>{let i=o(e.target).prop("_index");switch(e.key){case"ArrowLeft":0<i&&i--,o(`#${A.name}-tb .w2ui-tb-button`).removeClass("over").eq(i).addClass("over"),o(e.target).prop("_index",i);break;case"ArrowRight":i<A.toolbar.items.length-1&&i++,o(`#${A.name}-tb .w2ui-tb-button`).removeClass("over").eq(i).addClass("over"),o(e.target).prop("_index",i)}var s;32!=e.keyCode&&13!=e.keyCode||(s=A.toolbar.items[i],t.setFieldValue(A.name,s.id),o(`#${A.name}-tb .w2ui-tb-button`).removeClass("over")),e.metaKey||e.ctrlKey||9==e.keyCode||e.preventDefault()}))),"select"==A.type){var i=A.options.items;let e="";i.forEach((t=>{e+=`<option value="${t.id}">${t.text}</option>`})),A.$el.html(e)}this.W2FIELD_TYPES.includes(A.type)&&(A.w2field=A.w2field??new F(a.extend({},A.options,{type:A.type})),A.w2field.render(A.el)),["map","array"].includes(A.type)&&function(e){let A;e.el.mapAdd=function(e,t,A){var i=(e.disabled?" readOnly ":"")+(e.html.tabindex_str||"");A=`\n                            <div class="w2ui-map-field" style="margin-bottom: 5px" data-index="${A}">\n                            ${"map"==e.type?`<input type="text" ${(e.html.key.attr??"")+i} class="w2ui-input ${e.html.class??""} w2ui-map key">\n                                    ${e.html.key.text||""}\n                                `:""}\n                            <input type="text" ${(e.html.value.attr??"")+i} class="w2ui-input ${e.html.class??""} w2ui-map value">\n                                ${e.html.value.text||""}\n                            </div>`,t.append(A)},e.el.mapRefresh=function(i,s){let n,r,l;var d;"map"==e.type&&(null==(i=a.isPlainObject(i)?i:{})._order&&(i._order=Object.keys(i)),n=i._order),"array"==e.type&&(Array.isArray(i)||(i=[]),n=i.map(((e,t)=>t)));for(let e=s.find(".w2ui-map-field").length-1;e>=n.length;e--)s.find(`div[data-index='${e}']`).remove();for(let t=0;t<n.length;t++){let A=n[t],o=s.find(`div[data-index='${t}']`),a=(0==o.length&&(e.el.mapAdd(e,s,t),o=s.find(`div[data-index='${t}']`)),o.attr("data-key",A),r=o.find(".w2ui-map.key"),l=o.find(".w2ui-map.value"),i[A]);"array"==e.type&&0<(d=i.filter((e=>e.key==A))).length&&(a=d[0].value),r.val(A),l.val(a),!0!==e.disabled&&!1!==e.disabled||(r.prop("readOnly",!!e.disabled),l.prop("readOnly",!!e.disabled))}var c=n.length,h=s.find(`div[data-index='${c}']`);0!==h.length||r&&""==r.val()&&""==l.val()||r&&(!0===r.prop("readOnly")||!0===r.prop("disabled"))||e.el.mapAdd(e,s,c),!0!==e.disabled&&!1!==e.disabled||(h.find(".key").prop("readOnly",!!e.disabled),h.find(".value").prop("readOnly",!!e.disabled)),c=o(e.el).get(0)?.nextSibling,o(c).find("input.w2ui-map").off(".mapChange").on("keyup.mapChange",(function(e){var t=(i=o(e.target).closest(".w2ui-map-field")).get(0).nextElementSibling,i=i.get(0).previousElementSibling,s=(13==e.keyCode&&((s=A??t)instanceof HTMLElement&&0<(s=o(s).find("input")).length&&s.get(0).focus(),A=void 0),o(e.target).hasClass("key")?"key":"value");38==e.keyCode&&i&&(o(i).find("input."+s).get(0).select(),e.preventDefault()),40==e.keyCode&&t&&(o(t).find("input."+s).get(0).select(),e.preventDefault())})).on("keydown.mapChange",(function(e){38!=e.keyCode&&40!=e.keyCode||e.preventDefault()})).on("input.mapChange",(function(t){var A=(t=o(t.target).closest("div")).data("index"),i=t.get(0).nextElementSibling;if(""==t.find("input").val()||i){if(""==t.find("input").val()&&i){let e=!0;o(i).find("input").each((t=>{""!=t.value&&(e=!1)})),e&&o(i).remove()}}else e.el.mapAdd(e,s,parseInt(A)+1)})).on("change.mapChange",(function(i){null==t.original&&(0<Object.keys(t.record).length?t.original=a.clone(t.record):t.original={});let{current:n,previous:r,original:l}=t.getFieldValue(e.field);var d=o(i.target).closest(".w2ui-map-container");!0!==("map"==e.type&&(n._order=[]),d.find(".w2ui-map.key").each((e=>{n._order.push(e.value)})),d=t.trigger("change",{target:e.field,field:e.field,originalEvent:i,value:{current:n,previous:r,original:l}})).isCancelled&&("map"==e.type&&(n._order=n._order.filter((e=>""!==e)),delete n[""]),"array"==e.type&&(n=n.filter((e=>""!==e))),""==o(i.target).parent().find("input").val()&&(A=i.target),t.setValue(e.field,n),e.el.mapRefresh(n,s),d.finish())}))}}(A),this.setFieldValue(A.field,this.getValue(A.name))}}return A.finish(),this.resize(),Date.now()-e}}}render(e){var t=Date.now();let A=this;"string"==typeof e&&(e=o(e).get(0));var i=this.trigger("render",{target:this.name,box:e??this.box});if(!0!==i.isCancelled&&(null!=e&&(this.unmount(),this.box=e),this.isGenerated||this.formHTML)&&this.box){if(e='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+a.lang(this.header)+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>",o(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(e),0<o(this.box).length&&(o(this.box)[0].style.cssText+=this.style),a.bindEvents(o(this.box).find(".w2ui-eaction"),this),"function"!=typeof this.toolbar.render&&(this.toolbar=new B(a.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",(function(e){!0!==(e=A.trigger("toolbar",{target:e.target,originalEvent:e})).isCancelled&&e.finish()}))),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render(o(this.box).find("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=new b(a.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",(function(e){A.goto(this.get(e.target,!0))}))),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render(o(this.box).find("#form_"+this.name+"_tabs")[0]),this.tabs.active)&&this.tabs.click(this.tabs.active),i.finish(),this.resize(),(e="object"!=typeof this.url?this.url:this.url.get)&&null!=this.recid?this.request().catch((e=>this.refresh())):this.refresh(),this.last.observeResize=new ResizeObserver((()=>{this.resize()})),this.last.observeResize.observe(this.box),-1!=this.focus){let e=0,t=()=>{0<o(A.box).find("input, select, textarea").length?A.setFocus():++e<20&&setTimeout(t,50)};t()}return Date.now()-t}}unmount(){super.unmount(),this.tabs?.unmount?.(),this.toolbar?.unmount?.(),this.last.observeResize?.disconnect()}destroy(){var e=this.trigger("destroy",{target:this.name});!0!==e.isCancelled&&(this.tabs?.destroy?.(),this.toolbar?.destroy?.(),0<o(this.box).find("#form_"+this.name+"_tabs").length&&this.unmount(),this.last.observeResize?.disconnect(),delete l[this.name],e.finish())}setFocus(e){let t;if(void 0===e&&(e=this.focus),a.isInt(e)){if(e<0)return;for(var A=o(this.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > [type=radio]").filter(":not(.file-input)");null==A[e].offsetParent&&A.length>=e;)e++;A[e]&&(t=o(A[e]))}else"string"==typeof e&&(t=o(this.box).find(`[name='${e}']`));return 0<t.length&&t.get(0).focus(),t}}class F extends s{constructor(e,t){super(),"string"==typeof e&&null==t&&(t={type:e}),"object"==typeof e&&null==t&&(t=a.clone(e)),"string"==typeof e&&"object"==typeof t&&(t.type=e),t.type=String(t.type).toLowerCase(),this.el=t.el??null,this.selected=null,this.helpers={},this.type=t.type??"text",this.options=a.clone(t),this.onClick=t.onClick??null,this.onAdd=t.onAdd??null,this.onNew=t.onNew??null,this.onRemove=t.onRemove??null,this.onMouseEnter=t.onMouseEnter??null,this.onMouseLeave=t.onMouseLeave??null,this.onScroll=t.onScroll??null,this.tmp={},delete this.options.type,delete this.options.onClick,delete this.options.onMouseEnter,delete this.options.onMouseLeave,delete this.options.onScroll,this.el&&this.render(this.el)}render(e){e instanceof HTMLElement?(e._w2field?.reset?.(),(e._w2field=this).el=e,this.init()):console.log("ERROR: Cannot init w2field on empty subject")}init(){let e,t=this.options;if(["INPUT","TEXTAREA"].includes(this.el.tagName.toUpperCase())){switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":e={min:null,max:null,step:1,autoFormat:!0,autoCorrect:!0,currencyPrefix:a.settings.currencyPrefix,currencySuffix:a.settings.currencySuffix,currencyPrecision:a.settings.currencyPrecision,decimalSymbol:a.settings.decimalSymbol,groupSymbol:a.settings.groupSymbol,arrow:!1,keyboard:!0,precision:null,prefix:"",suffix:""},this.options=a.extend({},e,t),(t=this.options).numberRE=new RegExp("["+t.groupSymbol+"]","g"),t.moneyRE=new RegExp("["+t.currencyPrefix+t.currencySuffix+t.groupSymbol+"]","g"),t.percentRE=new RegExp("["+t.groupSymbol+"%]","g"),["text","alphanumeric","hex","bin"].includes(this.type)&&(t.arrow=!1,t.keyboard=!1);break;case"color":var A=parseInt(getComputedStyle(this.el)["font-size"])||12;e={prefix:"#",suffix:`<div style="width: ${A}px; height: ${A}px; margin-top: -2px;\n                                    position: relative; top: 50%; transform: translateY(-50%);">&#160;</div>`,arrow:!1,advanced:null,transparent:!0},this.options=a.extend({},e,t),t=this.options;break;case"date":e={format:a.settings.dateFormat,keyboard:!0,autoCorrect:!0,start:null,end:null,blockDates:[],blockWeekdays:[],colored:{},btnNow:!0},this.options=a.extend({type:"date"},e,t),t=this.options,null==o(this.el).attr("placeholder")&&o(this.el).attr("placeholder",t.format);break;case"time":e={format:a.settings.timeFormat,keyboard:!0,autoCorrect:!0,start:null,end:null,btnNow:!0,noMinutes:!1},this.options=a.extend({type:"time"},e,t),t=this.options,null==o(this.el).attr("placeholder")&&o(this.el).attr("placeholder",t.format);break;case"datetime":e={format:a.settings.dateFormat+"|"+a.settings.timeFormat,keyboard:!0,autoCorrect:!0,start:null,end:null,startTime:null,endTime:null,blockDates:[],blockWeekdays:[],colored:{},btnNow:!0,noMinutes:!1},this.options=a.extend({type:"datetime"},e,t),t=this.options,null==o(this.el).attr("placeholder")&&o(this.el).attr("placeholder",t.placeholder||t.format);break;case"list":case"combo":e={items:[],selected:{},prefix:"",suffix:"",openOnFocus:!1,icon:null,iconStyle:"",url:null,recId:null,recText:null,method:null,debounce:250,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,minDropWidth:null,match:"begins",align:"both",altRows:!0,renderDrop:null,compare:null,filter:!0,hideSelected:!1,markSearch:!1,msgNoItems:"No matches",msgSearch:"Type to search...",onSearch:null,onRequest:null,onLoad:null,onError:null},"function"==typeof t.items&&(t._items_fun=t.items),t.items=a.normMenu.call(this,t.items),"list"===this.type&&(o(this.el).addClass("w2ui-select"),!a.isPlainObject(t.selected))&&Array.isArray(t.items)&&t.items.forEach((e=>{e&&e.id===t.selected&&(t.selected=a.clone(e))})),t=a.extend({},e,t),(A=["is","begins","contains","ends"]).includes(t.match)||console.log(`ERROR: invalid value "${t.match}" for option.match. It should be one of following: ${A.join(", ")}.`),this.options=t,a.isPlainObject(t.selected)||(t.selected={}),this.selected=t.selected,o(this.el).attr("autocapitalize","off").attr("autocomplete","off").attr("autocorrect","off").attr("spellcheck","false"),null!=t.selected.text&&o(this.el).val(t.selected.text);break;case"enum":e={items:[],selected:[],max:0,maxItemWidth:250,style:"",openOnFocus:!1,renderItem:null,onMouseEnter:null,onMouseLeave:null,onScroll:null,onClick:null,onAdd:null,onNew:null,onRemove:null,url:null,recId:null,recText:null,debounce:250,method:null,postData:{},minLength:1,cacheMax:250,match:"begins",align:"",altRows:!0,renderDrop:null,maxDropHeight:350,maxDropWidth:null,markSearch:!1,compare:null,filter:!0,hideSelected:!0,msgNoItems:"No matches",msgSearch:"Type to search...",onSearch:null,onRequest:null,onLoad:null,onError:null},"function"==typeof(t=a.extend({},e,t,{suffix:""})).items&&(t._items_fun=t.items),(A=["is","begins","contains","ends"]).includes(t.match)||console.log(`ERROR: invalid value "${t.match}" for option.match. It should be one of following: ${A.join(", ")}.`),t.items=a.normMenu.call(this,t.items),t.selected=a.normMenu.call(this,t.selected),this.options=t,Array.isArray(t.selected)||(t.selected=[]),this.selected=t.selected;break;case"file":e={selected:[],max:0,maxSize:0,maxFileSize:0,maxItemWidth:250,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,align:"both",altRows:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseEnter:null,onMouseLeave:null},t=a.extend({},e,t),this.options=t,Array.isArray(t.selected)||(t.selected=[]),this.selected=t.selected,null==o(this.el).attr("placeholder")&&o(this.el).attr("placeholder",a.lang("Attach files by dragging and dropping or Click to Select"));break;default:console.log(`ERROR: field type "${this.type}" is not supported.`)}o(this.el).css("box-sizing","border-box").addClass("w2field w2ui-input").off(".w2field").on("change.w2field",(e=>{this.change(e)})).on("click.w2field",(e=>{this.click(e)})).on("focus.w2field",(e=>{this.focus(e)})).on("blur.w2field",(e=>{"list"!==this.type&&this.blur(e)})).on("keydown.w2field",(e=>{this.keyDown(e)})).on("keyup.w2field",(e=>{this.keyUp(e)})),this.addPrefix(),this.addSuffix(),this.addSearch(),this.addMultiSearch(),this.change(new Event("change"))}else console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el)}get(){return-1!==["list","enum","file"].indexOf(this.type)?this.selected:o(this.el).val()}set(e,t){-1!==["list","enum","file"].indexOf(this.type)?("list"!==this.type&&t?(Array.isArray(this.selected)||(this.selected=[]),this.selected.push(e),(t=m.get(this.el.id+"_menu"))&&(t.options.selected=this.selected)):(null==e&&(e=[]),t="enum"!==this.type||Array.isArray(e)?e:[e],this.selected=t),o(this.el).trigger("input").trigger("change"),this.refresh()):o(this.el).val(e)}setIndex(e,t){if(-1!==["list","enum"].indexOf(this.type)){var A=this.options.items;if(A&&A[e])return"list"==this.type&&(this.selected=A[e]),"enum"==this.type&&(t||(this.selected=[]),this.selected.push(A[e])),(t=m.get(this.el.id+"_menu"))&&(t.options.selected=this.selected),o(this.el).trigger("input").trigger("change"),this.refresh(),!0}return!1}refresh(){let e=this.options;var t=Date.now(),A=getComputedStyle(this.el);if("color"==this.type){let e=this.el.value;"#"!=e.substr(0,1)&&"rgb"!=e.substr(0,3)&&(e="#"+e),o(this.helpers.suffix).find(":scope > div").css("background-color",e)}if("list"==this.type){if(this.helpers.prefix&&this.helpers.prefix.hide(),!this.helpers.search)return;null==this.selected&&e.icon?e.prefix=`\n                    <span class="w2ui-icon ${e.icon} "style="cursor: pointer; font-size: 14px;\n                        display: inline-block; margin-top: -1px; color: #7F98AD; ${e.iconStyle}">\n                    </span>`:e.prefix="",this.addPrefix();let t=o(this.helpers.search_focus);var i=o(t[0].previousElementSibling);t.css({outline:"none"}),""===t.val()?(t.css("opacity",0),i.css("opacity",0),this.selected?.id?(r=this.selected.text,n=this.findItemIndex(e.items,this.selected.id),null!=r&&o(this.el).val(a.lang(r)).data({selected:r,selectedIndex:n[0]})):(this.el.value="",o(this.el).removeData("selected selectedIndex"))):(t.css("opacity",1),i.css("opacity",1),o(this.el).val(""),setTimeout((()=>{this.helpers.prefix&&this.helpers.prefix.hide(),e.icon?(t.css("margin-left","17px"),o(this.helpers.search).find(".w2ui-icon-search").addClass("show-search")):(t.css("margin-left","0px"),o(this.helpers.search).find(".w2ui-icon-search").removeClass("show-search"))}),1)),o(this.el).prop("readOnly")||o(this.el).prop("disabled")?setTimeout((()=>{this.helpers.prefix&&o(this.helpers.prefix).css("opacity","0.6"),this.helpers.suffix&&o(this.helpers.suffix).css("opacity","0.6")}),1):setTimeout((()=>{this.helpers.prefix&&o(this.helpers.prefix).css("opacity","1"),this.helpers.suffix&&o(this.helpers.suffix).css("opacity","1")}),1)}let s=this.helpers.multi;if(["enum","file"].includes(this.type)&&s){let t="";Array.isArray(this.selected)&&this.selected.forEach(((A,i)=>{null!=A&&(t+=`\n                        <div class="li-item" index="${i}" style="max-width: ${parseInt(e.maxItemWidth)}px; ${A.style||""}">\n                        ${"function"==typeof e.renderItem?e.renderItem(A,i,`<div class="w2ui-list-remove" index="${i}">&#160;&#160;</div>`):`\n                               ${A.icon?`<span class="w2ui-icon ${A.icon}"></span>`:""}\n                               <div class="w2ui-list-remove" index="${i}">&#160;&#160;</div>\n                               ${("enum"===this.type?A.text:A.name)??A.id??A}\n                               ${A.size?`<span class="file-size"> - ${a.formatSize(A.size)}</span>`:""}\n                            `}\n                        </div>`)}));var n,r=s.find(".w2ui-multi-items");e.style&&s.attr("style",s.attr("style")+";"+e.style),o(this.el).css("z-index","-1"),o(this.el).prop("readOnly")||o(this.el).prop("disabled")?setTimeout((()=>{s[0].scrollTop=0,s.addClass("w2ui-readonly").find(".li-item").css("opacity","0.9").parent().find(".li-search").hide().find("input").prop("readOnly",!0).closest(".w2ui-multi-items").find(".w2ui-list-remove").hide()}),1):setTimeout((()=>{s.removeClass("w2ui-readonly").find(".li-item").css("opacity","1").parent().find(".li-search").show().find("input").prop("readOnly",!1).closest(".w2ui-multi-items").find(".w2ui-list-remove").show()}),1),0<this.selected?.length&&o(this.el).attr("placeholder",""),s.find(".w2ui-enum-placeholder").remove(),r.find(".li-item").remove(),""!==t?r.prepend(t):null!=o(this.el).attr("placeholder")&&""===s.find("input").val()&&(n=a.stripSpaces(`\n                    padding-top: ${A["padding-top"]};\n                    padding-left: ${A["padding-left"]};\n                    box-sizing: ${A["box-sizing"]};\n                    line-height: ${A["line-height"]};\n                    font-size: ${A["font-size"]};\n                    font-family: ${A["font-family"]};\n                `),s.prepend(`<div class="w2ui-enum-placeholder" style="${n}">${o(this.el).attr("placeholder")}</div>`)),s.off(".w2item").on("scroll.w2item",(e=>{!0!==(e=this.trigger("scroll",{target:this.el,originalEvent:e})).isCancelled&&(g.hide(this.el.id+"_preview"),e.finish())})).find(".li-item").on("click.w2item",(e=>{var t=o(e.target).closest(".li-item"),A=t.attr("index"),i=this.selected[A];if(!o(t).hasClass("li-search")){let s;if(e.stopPropagation(),o(e.target).hasClass("w2ui-list-remove"))o(this.el).prop("readOnly")||o(this.el).prop("disabled")||!0!==(s=this.trigger("remove",{target:this.el,originalEvent:e,item:i})).isCancelled&&(this.selected.splice(A,1),o(this.el).trigger("input").trigger("change"),o(e.target).remove());else if(!0!==(s=this.trigger("click",{target:this.el,originalEvent:e.originalEvent,item:i})).isCancelled){let e=i.tooltip;if("file"===this.type&&(/image/i.test(i.type)&&(e=`\n                                    <div class="w2ui-file-preview">\n                                        <img src="${i.content?"data:"+i.type+";base64,"+i.content:""}"\n                                            style="max-width: 300px">\n                                    </div>`),e+=`\n                                <div class="w2ui-file-info">\n                                    <div class="file-caption">${a.lang("Name")}:</div>\n                                    <div class="file-value">${i.name}</div>\n                                    <div class="file-caption">${a.lang("Size")}:</div>\n                                    <div class="file-value">${a.formatSize(i.size)}</div>\n                                    <div class="file-caption">${a.lang("Type")}:</div>\n                                    <div class="file-value file-type">${i.type}</div>\n                                    <div class="file-caption">${a.lang("Modified")}:</div>\n                                    <div class="file-value">${a.date(i.modified)}</div>\n                                </div>`),e){let A=this.el.id+"_preview";g.show({name:A,anchor:t.get(0),html:e,hideOn:["doc-click"],class:""}).show((e=>{o(`#w2overlay-${A} img`).on("load",(function(e){var t=this.clientWidth,A=this.clientHeight;t<300&A<300||(A<=t&&300<t&&o(this).css("width","300px"),t<A&&300<A&&o(this).css("height","300px"))})).on("error",(function(e){this.style.display="none"}))}))}s.finish()}}})).on("mouseenter.w2item",(e=>{var t=o(e.target).closest(".li-item");o(t).hasClass("li-search")||(t=this.selected[o(e.target).attr("index")],!0!==(e=this.trigger("mouseEnter",{target:this.el,originalEvent:e,item:t})).isCancelled&&e.finish())})).on("mouseleave.w2item",(e=>{var t=o(e.target).closest(".li-item");o(t).hasClass("li-search")||(t=this.selected[o(e.target).attr("index")],!0!==(e=this.trigger("mouseLeave",{target:this.el,originalEvent:e,item:t})).isCancelled&&e.finish())})),"enum"===this.type?this.helpers.multi.find("input").css({width:"15px"}):this.helpers.multi.find(".li-search").hide(),this.resize()}return Date.now()-t}resize(){var e=this.el.clientWidth,t=getComputedStyle(this.el),A=this.helpers.search,i=this.helpers.multi,s=this.helpers.suffix,n=this.helpers.prefix;if(A&&o(A).css("width",e),i&&o(i).css("width",e-parseInt(t["margin-left"],10)-parseInt(t["margin-right"],10)),s&&this.addSuffix(),n&&this.addPrefix(),A=this.helpers.multi,["enum","file"].includes(this.type)&&A){o(this.el).css("height","");let e=o(A).find(":scope div.w2ui-multi-items").get(0).clientHeight+5;(e=(e=e<20?20:e)>this.tmp["max-height"]?this.tmp["max-height"]:e)<this.tmp["min-height"]&&(e=this.tmp["min-height"]),(i=a.getSize(this.el,"height")-2)>e&&(e=i),o(A).css({height:e+"px",overflow:e==this.tmp["max-height"]?"auto":"hidden"}),o(A).css("height",e+"px"),o(this.el).css({height:e+"px"})}this.tmp.current_width=e}reset(){null!=this.tmp&&(o(this.el).css("height",""),Array("padding-left","padding-right","background-color","border-color").forEach((e=>{this.tmp&&null!=this.tmp["old-"+e]&&(o(this.el).css(e,this.tmp["old-"+e]),delete this.tmp["old-"+e])})),clearInterval(this.tmp.sizeTimer)),o(this.el).val(this.clean(o(this.el).val())).removeClass("w2field w2ui-input").removeData("selected selectedIndex").off(".w2field"),Object.keys(this.helpers).forEach((e=>{o(this.helpers[e]).remove()})),this.helpers={},delete this.el._w2field}clean(e){var t;return"number"!=typeof e&&(t=this.options,e=String(e).trim(),["int","float","money","currency","percent"].includes(this.type))?""!==(e="string"==typeof e?(e=t.autoFormat&&(["money","currency"].includes(this.type)&&(e=String(e).replace(t.moneyRE,"")),"percent"===this.type&&(e=String(e).replace(t.percentRE,"")),["int","float"].includes(this.type))?String(e).replace(t.numberRE,""):e).replace(/\s+/g,"").replace(new RegExp(t.groupSymbol,"g"),"").replace(t.decimalSymbol,"."):e)&&a.isFloat(e)?Number(e):"":e}format(e){var t=this.options;if(t.autoFormat&&""!==e){switch(this.type){case"money":case"currency":""!==(e=a.formatNumber(e,t.currencyPrecision,!0))&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":""!==(e=a.formatNumber(e,t.precision,!0))&&(e+="%");break;case"float":e=a.formatNumber(e,t.precision,!0);break;case"int":e=a.formatNumber(e,0,!0)}var A=parseInt(1e3).toLocaleString(a.settings.locale,{useGrouping:!0}).slice(1,2);A!==this.options.groupSymbol&&(e=e.replaceAll(A,this.options.groupSymbol))}return e}change(e){if(-1!==["int","float","money","currency","percent"].indexOf(this.type)){var t=o(this.el).val(),A=this.format(this.clean(o(this.el).val()));if(""!==t&&t!=A)return o(this.el).val(A),e.stopPropagation(),e.preventDefault(),!1}if("color"===this.type){let e=o(this.el).val();"rgb"!==e.substr(0,3).toLowerCase()&&(e="#"+e,8!==(t=o(this.el).val().length))&&6!==t&&3!==t&&(e=""),A=o(this.el).get(0).nextElementSibling,o(A).find("div").css("background-color",e),o(this.el).hasClass("has-focus")&&this.updateOverlay()}if(-1!==["list","enum","file"].indexOf(this.type)&&this.refresh(),-1!==["date","time","datetime"].indexOf(this.type)){let e=parseInt(this.el.value);a.isInt(this.el.value)&&3e3<e&&("time"===this.type&&(e=a.formatTime(new Date(e),this.options.format)),"date"===this.type&&(e=a.formatDate(new Date(e),this.options.format)),"datetime"===this.type&&(e=a.formatDateTime(new Date(e),this.options.format)),o(this.el).val(e).trigger("input").trigger("change"))}}click(e){var t;["list","combo","enum"].includes(this.type)&&(o(this.el).hasClass("has-focus")||this.focus(e),"list"!=this.type&&"combo"!=this.type||(this.tmp.openedOnFocus||(t=this.el.id+"_menu",m.get(t)?.displayed?m.hide(t):this.updateOverlay()),delete this.tmp.openedOnFocus,"list"==this.type&&e.stopPropagation())),["date","time","datetime","color"].includes(this.type)&&this.updateOverlay()}focus(e){if("list"==this.type&&document.activeElement==this.el)this.helpers.search_focus.focus();else{if(-1!==["color","date","time","datetime"].indexOf(this.type)){if(o(this.el).prop("readOnly")||o(this.el).prop("disabled"))return;this.updateOverlay()}if(-1!==["list","combo","enum"].indexOf(this.type)){if(o(this.el).prop("readOnly")||o(this.el).prop("disabled"))return void o(this.el).addClass("has-focus");"function"==typeof this.options._items_fun&&(this.options.items=a.normMenu.call(this,this.options._items_fun)),this.helpers.search&&((t=this.helpers.search_focus).value="",t.select()),"enum"==this.type&&(t=o(this.el.previousElementSibling).find(".li-search input").get(0),document.activeElement!==t)&&t.focus(),this.resize(),!1===e.showMenu||!1===this.options.openOnFocus&&!o(this.el).hasClass("has-focus")||this.tmp.overlay?.overlay?.displayed||setTimeout((()=>{this.tmp.openedOnFocus=!0,this.updateOverlay()}),0)}var t;"file"==this.type&&(t=o(this.el).get(0).previousElementSibling,o(t).addClass("has-focus")),o(this.el).addClass("has-focus")}}blur(e){var t,A=o(this.el).val().trim();if(o(this.el).removeClass("has-focus"),["int","float","money","currency","percent"].includes(this.type)&&""!==A){let e=A,i="";this.isStrValid(A)?(t=this.clean(A),null!=this.options.min&&t<this.options.min&&(e=this.options.min,i="Should be >= "+this.options.min),null!=this.options.max&&t>this.options.max&&(e=this.options.max,i="Should be <= "+this.options.max)):e="",this.options.autoCorrect&&(o(this.el).val(e).trigger("input").trigger("change"),i)&&(g.show({name:this.el.id+"_error",anchor:this.el,html:i}),setTimeout((()=>{g.hide(this.el.id+"_error")}),3e3))}["date","time","datetime"].includes(this.type)&&this.options.autoCorrect&&""!==A&&(t="date"==this.type?a.isDate:"time"==this.type?a.isTime:a.isDateTime,w.inRange(this.el.value,this.options)&&t.bind(a)(this.el.value,this.options.format)||o(this.el).val("").trigger("input").trigger("change")),"enum"===this.type&&o(this.helpers.multi).find("input").val("").css("width","15px"),"file"==this.type&&(A=this.el.previousElementSibling,o(A).removeClass("has-focus")),"list"===this.type&&(this.el.value=this.selected?.text??"")}keyDown(e,t){var A,i=this.options;t=e.keyCode||t&&t.keyCode;let s,n,r,l,d,c,h=!1;if(["int","float","money","currency","percent","hex","bin","color","alphanumeric"].includes(this.type)&&!(e.metaKey||e.ctrlKey||e.altKey||this.isStrValid(e.key??"1",!0)||[9,8,13,27,37,38,39,40,46].includes(e.keyCode)))return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1;if(["int","float","money","currency","percent"].includes(this.type)){if(!i.keyboard||o(this.el).prop("readOnly")||o(this.el).prop("disabled"))return;switch(s=parseFloat(o(this.el).val().replace(i.moneyRE,""))||0,n=i.step,(e.ctrlKey||e.metaKey)&&(n=10*i.step),t){case 38:e.shiftKey||(d=s+n<=i.max||null==i.max?Number((s+n).toFixed(12)):i.max,o(this.el).val(d).trigger("input").trigger("change"),h=!0);break;case 40:e.shiftKey||(d=s-n>=i.min||null==i.min?Number((s-n).toFixed(12)):i.min,o(this.el).val(d).trigger("input").trigger("change"),h=!0)}h&&(e.preventDefault(),this.moveCaret2end())}if(["date","datetime"].includes(this.type)){if(!i.keyboard||o(this.el).prop("readOnly")||o(this.el).prop("disabled"))return;var u=("date"==this.type?a.isDate:a.isDateTime).bind(a),p=("date"==this.type?a.formatDate:a.formatDateTime).bind(a);switch(r=864e5,n=1,(e.ctrlKey||e.metaKey)&&(n=10),(l=u(o(this.el).val(),i.format,!0))||(l=new Date,r=0),t){case 38:e.shiftKey||(10==n?l.setMonth(l.getMonth()+1):l.setTime(l.getTime()+r),c=p(l.getTime(),i.format),o(this.el).val(c).trigger("input").trigger("change"),h=!0);break;case 40:e.shiftKey||(10==n?l.setMonth(l.getMonth()-1):l.setTime(l.getTime()-r),c=p(l.getTime(),i.format),o(this.el).val(c).trigger("input").trigger("change"),h=!0)}h&&(e.preventDefault(),this.moveCaret2end(),this.updateOverlay())}if("time"===this.type){if(!i.keyboard||o(this.el).prop("readOnly")||o(this.el).prop("disabled"))return;n=e.ctrlKey||e.metaKey?60:1,s=o(this.el).val();let A=w.str2min(s)||w.str2min((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(t){case 38:e.shiftKey||(A+=n,h=!0);break;case 40:e.shiftKey||(A-=n,h=!0)}h&&(e.preventDefault(),o(this.el).val(w.min2str(A)).trigger("input").trigger("change"),this.moveCaret2end())}if(["list","enum"].includes(this.type))switch(t){case 8:case 46:"list"==this.type?""==o(this.helpers.search_focus).val()&&(this.selected=null,m.hide(this.el.id+"_menu"),o(this.el).val("").trigger("input").trigger("change")):""==o(this.helpers.multi).find("input").val()&&(m.hide(this.el.id+"_menu"),this.selected.pop(),(A=m.get(this.el.id+"_menu"))&&(A.options.selected=this.selected),this.refresh());break;case 9:case 16:break;case 27:m.hide(this.el.id+"_menu"),this.refresh()}}keyUp(e){if("list"==this.type){let t=o(this.helpers.search_focus);""!==t.val()?o(this.el).attr("placeholder",""):o(this.el).attr("placeholder",this.tmp.pholder),13==e.keyCode&&setTimeout((()=>{t.val(""),m.hide(this.el.id+"_menu"),this.refresh()}),1),[38,40].includes(e.keyCode)&&!this.tmp.overlay?.overlay?.displayed&&this.updateOverlay(),this.refresh()}var t,A;"combo"==this.type&&([9,16,27].includes(e.keyCode)||!0===this.options.openOnFocus||this.updateOverlay(),[38,40].includes(e.keyCode))&&!this.tmp.overlay?.overlay?.displayed&&this.updateOverlay(),"enum"==this.type&&(t=this.helpers.multi.find("input"),A=getComputedStyle(t.get(0)),A=a.getStrWidth(t.val(),`font-family: ${A["font-family"]}; font-size: ${A["font-size"]};`),t.css({width:A+15+"px"}),this.resize(),[38,40].includes(e.keyCode))&&!this.tmp.overlay?.overlay?.displayed&&this.updateOverlay()}findItemIndex(e,t,A){let i=[];var s;return A=A||[],["list","combo","enum"].includes(this.type)&&this.options.url&&(s=m.get(this.el.id+"_menu"))&&(e=s.options.items,this.options.items=e),e.forEach(((e,s)=>{e.id===t&&(i=A.concat([s]),this.options.index=[s]),0==i.length&&e.items&&0<e.items.length&&(A.push(s),i=this.findItemIndex(e.items,t,A),A.pop())})),i}updateOverlay(e){let t=this.options;if("color"===this.type){if(o(this.el).prop("readOnly")||o(this.el).prop("disabled"))return;f.show(a.extend({name:this.el.id+"_color",anchor:this.el,transparent:t.transparent,advanced:t.advanced,color:this.el.value,liveUpdate:!0},this.options)).select((e=>{e=e.detail.color,o(this.el).val(e).trigger("input").trigger("change")})).liveUpdate((e=>{e=e.detail.color,o(this.helpers.suffix).find(":scope > div").css("background-color","#"+e)}))}if(["list","combo","enum"].includes(this.type)){var A;this.el;let e=this.el;"enum"===this.type&&(A=this.helpers.multi.get(0),e=o(A).find("input").get(0)),"list"===this.type&&(A=this.selected,a.isPlainObject(A)&&0<Object.keys(A).length&&0<(A=this.findItemIndex(t.items,A.id)).length&&(t.index=A),e=this.helpers.search_focus),!o(this.el).hasClass("has-focus")||this.el.readOnly||this.el.disabled||(A=a.extend({},t,{name:this.el.id+"_menu",anchor:e,selected:this.selected,search:!1,render:t.renderDrop,anchorClass:"",offsetY:5,maxHeight:t.maxDropHeight,maxWidth:t.maxDropWidth,minWidth:t.minDropWidth}),this.tmp.overlay=m.show(A).select((A=>{var i,s;["list","combo"].includes(this.type)?(this.selected=A.detail.item,o(e).val(""),o(this.el).val(this.selected.text).trigger("input").trigger("change"),this.focus({showMenu:!1})):(s=this.selected,(i=A.detail?.item)&&!0!==(A=this.trigger("add",{target:this.el,item:i,originalEvent:A})).isCancelled&&(s.length>=t.max&&0<t.max&&s.pop(),delete i.hidden,s.push(i),o(this.el).trigger("input").trigger("change"),o(this.helpers.multi).find("input").val(""),(s=m.get(this.el.id+"_menu"))&&(s.options.selected=this.selected),A.finish()))})))}!["date","time","datetime"].includes(this.type)||o(this.el).prop("readOnly")||o(this.el).prop("disabled")||w.show(a.extend({name:this.el.id+"_date",anchor:this.el,value:this.el.value},this.options)).select((e=>{null!=(e=e.detail.date)&&o(this.el).val(e).trigger("input").trigger("change")}))}isStrValid(e,t){let A=!0;switch(this.type){case"int":A=!(!t||!["-",this.options.groupSymbol].includes(e))||a.isInt(e.replace(this.options.numberRE,""));break;case"percent":e=e.replace(/%/g,"");case"float":A=!(!t||!["-","",this.options.decimalSymbol,this.options.groupSymbol].includes(e))||a.isFloat(e.replace(this.options.numberRE,""));break;case"money":case"currency":A=!(!t||!["-",this.options.decimalSymbol,this.options.groupSymbol,this.options.currencyPrefix,this.options.currencySuffix].includes(e))||a.isFloat(e.replace(this.options.moneyRE,""));break;case"bin":A=a.isBin(e);break;case"color":case"hex":A=a.isHex(e);break;case"alphanumeric":A=a.isAlphaNumeric(e)}return A}addPrefix(){var e,t;this.options.prefix&&(t=getComputedStyle(this.el),null==this.tmp["old-padding-left"]&&(this.tmp["old-padding-left"]=t["padding-left"]),this.helpers.prefix&&o(this.helpers.prefix).remove(),o(this.el).before(`<div class="w2ui-field-helper">${this.options.prefix}</div>`),e=o(this.el).get(0).previousElementSibling,o(e).css({color:t.color,"font-family":t["font-family"],"font-size":t["font-size"],height:this.el.clientHeight+"px","padding-top":parseInt(t["padding-top"],10)+1+"px","padding-bottom":parseInt(t["padding-bottom"],10)-1+"px","padding-left":this.tmp["old-padding-left"],"padding-right":0,"margin-top":parseInt(t["margin-top"],10)+"px","margin-bottom":parseInt(t["margin-bottom"],10)+"px","margin-left":t["margin-left"],"margin-right":0,"z-index":1,display:"flex","align-items":"center"}),o(this.el).css("padding-left",e.clientWidth+"px !important"),this.helpers.prefix=e)}addSuffix(){if(this.options.suffix||this.options.arrow){let A,i=this;var e=getComputedStyle(this.el),t=(null==this.tmp["old-padding-right"]&&(this.tmp["old-padding-right"]=e["padding-right"]),parseInt(e["padding-right"]||0));this.options.arrow&&(this.helpers.arrow&&o(this.helpers.arrow).remove(),o(this.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>'),A=o(this.el).get(0).nextElementSibling,o(A).css({color:e.color,"font-family":e["font-family"],"font-size":e["font-size"],height:this.el.clientHeight+"px",padding:0,"margin-top":parseInt(e["margin-top"],10)+1+"px","margin-bottom":0,"border-left":"1px solid silver",width:"16px",transform:"translateX(-100%)"}).on("mousedown",(function(e){o(e.target).hasClass("arrow-up")&&i.keyDown(e,{keyCode:38}),o(e.target).hasClass("arrow-down")&&i.keyDown(e,{keyCode:40})})),t+=A.clientWidth,o(this.el).css("padding-right",t+"px !important"),this.helpers.arrow=A),""!==this.options.suffix&&(this.helpers.suffix&&o(this.helpers.suffix).remove(),o(this.el).after(`<div class="w2ui-field-helper">${this.options.suffix}</div>`),A=o(this.el).get(0).nextElementSibling,o(A).css({color:e.color,"font-family":e["font-family"],"font-size":e["font-size"],height:this.el.clientHeight+"px","padding-top":e["padding-top"],"padding-bottom":e["padding-bottom"],"padding-left":0,"padding-right":e["padding-right"],"margin-top":parseInt(e["margin-top"],10)+2+"px","margin-bottom":parseInt(e["margin-bottom"],10)+1+"px",transform:"translateX(-100%)"}),o(this.el).css("padding-right",A.clientWidth+"px !important"),this.helpers.suffix=A)}}addSearch(){if("list"===this.type){this.helpers.search&&o(this.helpers.search).remove();let A=parseInt(o(this.el).attr("tabIndex")),i=(isNaN(A)||-1===A||(this.tmp["old-tabIndex"]=A),null!=(A=this.tmp["old-tabIndex"]?this.tmp["old-tabIndex"]:A)&&!isNaN(A)||(A=0),"");var e=`\n            <div class="w2ui-field-helper">\n                <span class="w2ui-icon w2ui-icon-search"></span>\n                <input ${i=null!=o(this.el).attr("id")?'id="'+o(this.el).attr("id")+'_search"':i} type="text" tabIndex="${A}" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"/>\n            </div>`,t=(o(this.el).attr("tabindex",-1).before(e),e=o(this.el).get(0).previousElementSibling,this.helpers.search=e,this.helpers.search_focus=o(e).find("input").get(0),getComputedStyle(this.el));o(e).css({width:this.el.clientWidth+"px","margin-top":t["margin-top"],"margin-left":t["margin-left"],"margin-bottom":t["margin-bottom"],"margin-right":t["margin-right"]}).find("input").css({cursor:"default",width:"100%",opacity:1,padding:t.padding,margin:t.margin,border:"1px solid transparent","background-color":"transparent"}),o(e).find("input").off(".helper").on("focus.helper",(e=>{o(e.target).val(""),this.tmp.pholder=o(this.el).attr("placeholder")??"",this.focus(e),e.stopPropagation()})).on("blur.helper",(e=>{o(e.target).val(""),null!=this.tmp.pholder&&o(this.el).attr("placeholder",this.tmp.pholder),this.blur(e),e.stopPropagation()})).on("keydown.helper",(e=>{this.keyDown(e)})).on("keyup.helper",(e=>{this.keyUp(e)})),o(e).on("click",(e=>{o(e.target).find("input").focus()}))}}addMultiSearch(){if(["enum","file"].includes(this.type)){o(this.helpers.multi).remove();let s="";var e,t,A=getComputedStyle(this.el),i=a.stripSpaces(`\n            margin-top: 0px;\n            margin-bottom: 0px;\n            margin-left: ${A["margin-left"]};\n            margin-right: ${A["margin-right"]};\n            width: ${a.getSize(this.el,"width")-parseInt(A["margin-left"],10)-parseInt(A["margin-right"],10)}px;\n        `);null==this.tmp["min-height"]&&(e=this.tmp["min-height"]=parseInt(("none"!=A["min-height"]?A["min-height"]:0)||0),t=parseInt(A.height),this.tmp["min-height"]=Math.max(e,t)),null==this.tmp["max-height"]&&"none"!=A["max-height"]&&(this.tmp["max-height"]=parseInt(A["max-height"]));let n="",r=(null!=o(this.el).attr("id")&&(n=`id="${o(this.el).attr("id")}_search"`),parseInt(o(this.el).attr("tabIndex"))),l=(isNaN(r)||-1===r||(this.tmp["old-tabIndex"]=r),null!=(r=this.tmp["old-tabIndex"]?this.tmp["old-tabIndex"]:r)&&!isNaN(r)||(r=0),"enum"===this.type&&(s=`\n            <div class="w2ui-field-helper w2ui-list" style="${i}">\n                <div class="w2ui-multi-items">\n                    <div class="li-search">\n                        <input ${n} type="text" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"\n                            tabindex="${r}"\n                            ${o(this.el).prop("readOnly")?"readonly":""}\n                            ${o(this.el).prop("disabled")?"disabled":""}>\n                    </div>\n                </div>\n            </div>`),"file"===this.type&&(s=`\n            <div class="w2ui-field-helper w2ui-list" style="${i}">\n                <div class="w2ui-multi-file">\n                    <input name="attachment" class="file-input" type="file" tabindex="-1"'\n                        style="width: 100%; height: 100%; opacity: 0" title=""\n                        ${1!==this.options.max?"multiple":""}\n                        ${o(this.el).prop("readOnly")||o(this.el).prop("disabled")?"disabled":""}\n                        ${o(this.el).attr("accept")?' accept="'+o(this.el).attr("accept")+'"':""}>\n                </div>\n                <div class="w2ui-multi-items">\n                    <div class="li-search" style="display: none">\n                        <input ${n} type="text" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"\n                            tabindex="${r}"\n                            ${o(this.el).prop("readOnly")?"readonly":""}\n                            ${o(this.el).prop("disabled")?"disabled":""}>\n                    </div>\n                </div>\n            </div>`),this.tmp["old-background-color"]=A["background-color"],this.tmp["old-border-color"]=A["border-color"],o(this.el).before(s).css({"border-color":"transparent","background-color":"transparent"}),o(this.el.previousElementSibling));this.helpers.multi=l,o(this.el).attr("tabindex",-1),l.on("click",(e=>{this.focus(e)})),l.find("input:not(.file-input)").on("click",(e=>{this.click(e)})).on("focus",(e=>{this.focus(e)})).on("blur",(e=>{this.blur(e)})).on("keydown",(e=>{this.keyDown(e)})).on("keyup",(e=>{this.keyUp(e)})),"file"===this.type&&l.find("input.file-input").off(".drag").on("click.drag",(e=>{e.stopPropagation(),o(this.el).prop("readOnly")||o(this.el).prop("disabled")||this.focus(e)})).on("dragenter.drag",(e=>{o(this.el).prop("readOnly")||o(this.el).prop("disabled")||l.addClass("w2ui-file-dragover")})).on("dragleave.drag",(e=>{o(this.el).prop("readOnly")||o(this.el).prop("disabled")||l.removeClass("w2ui-file-dragover")})).on("drop.drag",(e=>{o(this.el).prop("readOnly")||o(this.el).prop("disabled")||(l.removeClass("w2ui-file-dragover"),Array.from(e.dataTransfer.files).forEach((e=>{this.addFile(e)})),this.focus(e),e.preventDefault(),e.stopPropagation())})).on("dragover.drag",(e=>{e.preventDefault(),e.stopPropagation()})).on("change.drag",(e=>{void 0!==e.target.files&&Array.from(e.target.files).forEach((e=>{this.addFile(e)})),this.focus(e)})),this.refresh()}}addFile(e){var t=this.options,A=this.selected;let i={name:e.name,type:e.type,modified:e.lastModifiedDate,size:e.size,content:null,file:e},s=0,n=0,r=[],l=(Array.isArray(A)&&A.forEach((t=>{t.name==e.name&&t.size==e.size&&r.push(a.lang('The file "${name}" (${size}) is already added.',{name:e.name,size:a.formatSize(e.size)})),s+=t.size,n++})),0!==t.maxFileSize&&i.size>t.maxFileSize&&r.push(a.lang("Maximum file size is ${size}",{size:a.formatSize(t.maxFileSize)})),0!==t.maxSize&&s+i.size>t.maxSize&&r.push(a.lang("Maximum total size is ${size}",{size:a.formatSize(t.maxSize)})),0!==t.max&&n>=t.max&&r.push(a.lang("Maximum number of files is ${count}",{count:t.max})),this.trigger("add",{target:this.el,file:i,total:n,totalSize:s,errors:r}));if(!0!==l.isCancelled)if(!0!==t.silent&&0<r.length)g.show({anchor:this.el,html:"Errors: "+r.join("<br>")}),console.log("ERRORS (while adding files): ",r);else if(A.push(i),"undefined"!=typeof FileReader&&!0===t.readContent){A=new FileReader;let t=this;A.onload=function(e){var A=(e=e.target.result).indexOf(",");i.content=e.substr(A+1),t.refresh(),o(t.el).trigger("input").trigger("change"),l.finish()},A.readAsDataURL(e)}else this.refresh(),o(this.el).trigger("input").trigger("change"),l.finish()}moveCaret2end(){setTimeout((()=>{this.el.setSelectionRange(this.el.value.length,this.el.value.length)}),0)}}},872:(e,t,A)=>{"use strict";A.a(e,(async(e,t)=>{try{var i=A(675),s=(A(947),A(840)),n=A(80),r=A(715),o=A(402),l=A(830),a=A(71),d=A(229),c=A(972);let e=new c.A({y:0,x:0},[]),h=new c.A({y:0,x:0},[],!1);window.IconPicker=e,window.ImageIconComponentPicker=h,window.w2layout=i.Yw,window.w2alert=i.mJ,window.w2grid=i.A$,window.query=i.P,window.EditorWindowSidebar=s.A,window.EditorWindowTopMenu=n.A,window.EditorWindowStatusBar=r.A,window.EditorWindow=o.A,window.DefaultStart=l.A,(0,a.C$)(),window.updateQueue=a.df,window.sendQueue=a.oU,window.allIcons=await(0,d.A)(),window.IconPicker.icons=window.allIcons,t()}catch(e){t(e)}}),1)}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var A=n[e]={exports:{}};return s[e].call(A.exports,A,A.exports,r),A.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",A="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},r.a=(s,n,r)=>{var o;r&&((o=[]).d=-1);var l,a,d,c=new Set,h=s.exports,u=new Promise(((e,t)=>{d=t,a=e}));u[t]=h,u[e]=e=>(o&&e(o),c.forEach(e),u.catch((e=>{}))),s.exports=u,n((s=>{var n;l=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[e])return s;if(s.then){var n=[];n.d=0,s.then((e=>{r[t]=e,i(n)}),(e=>{r[A]=e,i(n)}));var r={};return r[e]=e=>e(n),r}}var o={};return o[e]=e=>{},o[t]=s,o})))(s);var r=()=>l.map((e=>{if(e[A])throw e[A];return e[t]})),a=new Promise((t=>{(n=()=>t(r)).r=0;var A=e=>e!==o&&!c.has(e)&&(c.add(e),e&&!e.d&&(n.r++,e.push(n)));l.map((t=>t[e](A)))}));return n.r?a:r()}),(e=>(e?d(u[A]=e):a(h),i(o)))),o&&o.d<0&&(o.d=0)},r.d=(e,t)=>{for(var A in t)r.o(t,A)&&!r.o(e,A)&&Object.defineProperty(e,A,{enumerable:!0,get:t[A]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(872)})();